{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0}],"Cache":[{"_id":"source/.DS_Store","hash":"b73689232c8b5d1da23e593d5993f4cc2b2ab1cc","modified":1533040675000},{"_id":"source/CNAME","hash":"10bf81547089ab9a0d012da6999ab120d58cc0db","modified":1533040675000},{"_id":"source/_posts/Docker.md","hash":"0dd6e3edd08a9868cca8677e0dbc9c1c37ff20a7","modified":1533040675000},{"_id":"source/_posts/Hexo搭建.md","hash":"e2cbe6674019ccd6de16c31cbb6f6ca2d6e4a88f","modified":1533040675000},{"_id":"source/_posts/Linux常用命令.md","hash":"f7c297dfddcd95c0a9409cf2503e06a3c14ab85a","modified":1533040675000},{"_id":"source/_posts/MVC.md","hash":"580ae0f4f816f9102c41e11d46b5af45a1beffd4","modified":1533040675000},{"_id":"source/_posts/MySQL权限控制.md","hash":"89020c7716f14568f5cb404011ae02645b84d710","modified":1533040675000},{"_id":"source/_posts/PHP中的魔术方法.md","hash":"0fa50fa1ce019f934f1f51e793477f003f1eec1b","modified":1533040675000},{"_id":"source/_posts/PHP常用字符串函数.md","hash":"a392ca9b58b9a9c97afa7a602fabd92c2d661386","modified":1533040675000},{"_id":"source/_posts/PHP常用数组函数.md","hash":"79538287365f8953e6717fd9d59dcb7ecc2d2094","modified":1533040675000},{"_id":"source/_posts/千万级表查询.md","hash":"435147666b3236e19c066b16423af25a04743748","modified":1533040675000},{"_id":"source/_posts/单例设计模式.md","hash":"c807674e67e19c5393af4514ffe12134c1b14c29","modified":1533040675000},{"_id":"source/_posts/工厂设计模式.md","hash":"dec2dc68e1ce0af4daba452d5ac093d9603f680e","modified":1533040675000},{"_id":"source/_posts/常见的几种算法.md","hash":"bfa60a0b32bb95ee16a3127da3c149644f7d3869","modified":1533040675000},{"_id":"source/_posts/策略模式.md","hash":"7409fe963b59f48a07c822a3c14b4e827b94e154","modified":1533040675000},{"_id":"source/_posts/观察者模式.md","hash":"af41bfb3a129ea48270d821facf77b9be8416134","modified":1533040675000},{"_id":"source/_posts/适配器模式.md","hash":"8ed832ce91a1fcd790bdb9e5cb542473d85922ef","modified":1533040675000},{"_id":"source/_posts/锁机制.md","hash":"0f36aac366361ceba42050dab2d70883fb32aec1","modified":1533040675000},{"_id":"public/2017/11/22/PHP常用字符串函数/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956123},{"_id":"public/2017/11/13/PHP常用数组函数/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956123},{"_id":"public/2017/10/31/千万级表查询/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956124},{"_id":"public/2017/10/23/常见的几种算法/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956124},{"_id":"public/2017/10/15/Docker/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956124},{"_id":"public/2017/09/30/MVC/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956124},{"_id":"public/2017/09/05/适配器模式/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956124},{"_id":"public/2017/09/01/观察者模式/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956124},{"_id":"public/2017/08/23/策略模式/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956124},{"_id":"public/2017/08/15/工厂设计模式/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956124},{"_id":"public/2017/08/07/单例设计模式/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956124},{"_id":"public/2017/08/01/PHP中的魔术方法/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956124},{"_id":"public/2017/07/28/Linux常用命令/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/2017/07/25/MySQL权限控制/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/2017/07/24/锁机制/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/2017/07/23/Hexo搭建/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/archives/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/archives/page/2/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/archives/2017/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/archives/2017/page/2/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/archives/2017/07/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/archives/2017/08/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/archives/2017/09/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/archives/2017/10/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/archives/2017/11/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/categories/Docker/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/categories/hexo/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956125},{"_id":"public/categories/Linux/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/categories/设计模式/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/categories/MySQL/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/categories/PHP/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/page/2/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/page/3/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/page/4/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/tags/Docker/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/tags/Hexo/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/tags/Linux/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/tags/设计模式/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/tags/MySQL/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956126},{"_id":"public/tags/PHP/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1533040956127}],"Category":[{"name":"Docker","_id":"cjk9oxuw50002ydqnkj50kkcg"},{"name":"hexo","_id":"cjk9oxuwa0007ydqnbd7k1jrx"},{"name":"Linux","_id":"cjk9oxuwf000dydqn9lllvelq"},{"name":"设计模式","_id":"cjk9oxuwh000jydqn8s3trdx2"},{"name":"MySQL","_id":"cjk9oxuwm000qydqndbbogj0a"},{"name":"PHP","_id":"cjk9oxuwr000zydqn1h7ckw5z"}],"Data":[],"Page":[],"Post":[{"title":"Docker","date":"2017-10-15T12:04:29.000Z","_content":"初识Docker是我在公司于公司其他部们负责人聊天的时候，知道公司的服务器使用Docker来搭建的，本着好奇，所以折腾折腾\n\n<!-- more -->\n\n## \tDocker的介绍\nDocker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口\n\n##\t为什么要用Docker\n作为一种轻量级的虚拟化方式，Docker在运行应用上跟传统的虚拟机方式相比具有显著优势：\n1、Docker容器很快，启动和停止可以在秒级实现，这相比传统的虚拟机方式要快得多。\n2、Docker容器对系统资源需求很少，一台主机上可以同时运行数千个Docker容器。\n3、Docker通过类似Git的操作来方便用户获取、分发和更新应用镜像，指令简明，学习成本较低。\n4、Docker通过Dockerfile配置文件来支持灵活的自动化创建和部署机制，提高工作效率。\n\nDocker容器除了运行其中的应用之外，基本不消耗额外的系统资源，保证应用性能的同时，尽量减小系统开销。传统虚拟机方式运行N个不同的应用就要启动N个虚拟机（每个虚拟机需要单独分配独占的内存、磁盘等资源），而Docker只需要启动N个隔离的容器，并将应用放到容器内即可。\n\n##\tDocker的好处\n1、更快速的交付和部署。使用Docker，开发人员可以使用镜像来快速构建一套标准的开发环境；开发完成之后，测试和运维人员可以直接使用相同环境来部署代码。Docker可以快速创建和删除容器，实现快速迭代，大量节约开发、测试、部署的时间。并且，各个步骤都有明确的配置和操作，整个过程全程可见，使团队更容易理解应用的创建和工作过程。\n2、更高效的资源利用。Docker容器的运行不需要额外的虚拟化管理程序（Virtual Machine Manager，VMM，以及Hypervisor）支持，它是内核级的虚拟化，可以实现更高的性能，同时对资源的额外需求很低。\n3、更轻松的迁移和扩展。Docker容器几乎可以在任意的平台上运行，包括物理机、虚拟机、公有云、私有云、个人电脑、服务器等。 这种兼容性让用户可以在不同平台之间轻松地迁移应用。\n4、更简单的更新管理。使用Dockerfile，只需要小小的配置修改，就可以替代以往大量的更新工作。并且所有修改都以增量的方式进行分发和更新，从而实现自动化并且高效的容器管理。\n\n## \tDocker命令\n\n1、docker images;\t\t#查看本地镜像\n2、docker ps;\t\t#查看本机正在运行的容器\n3、docker ps -a;\t\t#查看本机所有的容器\n4、docker run;\t\t#运行容器\n5、docker exec\t-it 容器名称 bin/bash;\t\t#进入容器\n6、docker start $(docker ps -a | awk '{ print $1}' | tail -n +2);\t\t#启动所有的容器命令\n7、docker restart $(docker ps -a | awk '{ print $1}' | tail -n +2);\t\t#重启所有的容器命令\n8、docker stop $(docker ps -a | awk '{ print $1}' | tail -n +2);\t\t#关闭所有容器\n9、docker rm $(docker ps -a | awk '{ print $1}' | tail -n +2);\t\t\t#删除所有的容器命令\n10、docker rmi $(docker images | awk '{print $3}' |tail -n +2);\t\t#删除所有的镜像\n11、docker logs 容器名称或者容器id:;\t\t#查看容器日志\n12、docker serach 镜像名称;\t\t#查看docker远程仓库的镜像版本\n13、docker pull 镜像版本;\t\t#可以从docker远程仓库拉取该镜像\n14、docker login;\t\t#登陆hub.docker\n\n\n","source":"_posts/Docker.md","raw":"---\ntitle: Docker\ndate: 2017-10-15 20:04:29\ntags: Docker\ncategories: Docker\n---\n初识Docker是我在公司于公司其他部们负责人聊天的时候，知道公司的服务器使用Docker来搭建的，本着好奇，所以折腾折腾\n\n<!-- more -->\n\n## \tDocker的介绍\nDocker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口\n\n##\t为什么要用Docker\n作为一种轻量级的虚拟化方式，Docker在运行应用上跟传统的虚拟机方式相比具有显著优势：\n1、Docker容器很快，启动和停止可以在秒级实现，这相比传统的虚拟机方式要快得多。\n2、Docker容器对系统资源需求很少，一台主机上可以同时运行数千个Docker容器。\n3、Docker通过类似Git的操作来方便用户获取、分发和更新应用镜像，指令简明，学习成本较低。\n4、Docker通过Dockerfile配置文件来支持灵活的自动化创建和部署机制，提高工作效率。\n\nDocker容器除了运行其中的应用之外，基本不消耗额外的系统资源，保证应用性能的同时，尽量减小系统开销。传统虚拟机方式运行N个不同的应用就要启动N个虚拟机（每个虚拟机需要单独分配独占的内存、磁盘等资源），而Docker只需要启动N个隔离的容器，并将应用放到容器内即可。\n\n##\tDocker的好处\n1、更快速的交付和部署。使用Docker，开发人员可以使用镜像来快速构建一套标准的开发环境；开发完成之后，测试和运维人员可以直接使用相同环境来部署代码。Docker可以快速创建和删除容器，实现快速迭代，大量节约开发、测试、部署的时间。并且，各个步骤都有明确的配置和操作，整个过程全程可见，使团队更容易理解应用的创建和工作过程。\n2、更高效的资源利用。Docker容器的运行不需要额外的虚拟化管理程序（Virtual Machine Manager，VMM，以及Hypervisor）支持，它是内核级的虚拟化，可以实现更高的性能，同时对资源的额外需求很低。\n3、更轻松的迁移和扩展。Docker容器几乎可以在任意的平台上运行，包括物理机、虚拟机、公有云、私有云、个人电脑、服务器等。 这种兼容性让用户可以在不同平台之间轻松地迁移应用。\n4、更简单的更新管理。使用Dockerfile，只需要小小的配置修改，就可以替代以往大量的更新工作。并且所有修改都以增量的方式进行分发和更新，从而实现自动化并且高效的容器管理。\n\n## \tDocker命令\n\n1、docker images;\t\t#查看本地镜像\n2、docker ps;\t\t#查看本机正在运行的容器\n3、docker ps -a;\t\t#查看本机所有的容器\n4、docker run;\t\t#运行容器\n5、docker exec\t-it 容器名称 bin/bash;\t\t#进入容器\n6、docker start $(docker ps -a | awk '{ print $1}' | tail -n +2);\t\t#启动所有的容器命令\n7、docker restart $(docker ps -a | awk '{ print $1}' | tail -n +2);\t\t#重启所有的容器命令\n8、docker stop $(docker ps -a | awk '{ print $1}' | tail -n +2);\t\t#关闭所有容器\n9、docker rm $(docker ps -a | awk '{ print $1}' | tail -n +2);\t\t\t#删除所有的容器命令\n10、docker rmi $(docker images | awk '{print $3}' |tail -n +2);\t\t#删除所有的镜像\n11、docker logs 容器名称或者容器id:;\t\t#查看容器日志\n12、docker serach 镜像名称;\t\t#查看docker远程仓库的镜像版本\n13、docker pull 镜像版本;\t\t#可以从docker远程仓库拉取该镜像\n14、docker login;\t\t#登陆hub.docker\n\n\n","slug":"Docker","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuw10000ydqnvo7n60ur","content":"<p>初识Docker是我在公司于公司其他部们负责人聊天的时候，知道公司的服务器使用Docker来搭建的，本着好奇，所以折腾折腾</p>\n<a id=\"more\"></a>\n<h2 id=\"Docker的介绍\"><a href=\"#Docker的介绍\" class=\"headerlink\" title=\"Docker的介绍\"></a>Docker的介绍</h2><p>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口</p>\n<h2 id=\"为什么要用Docker\"><a href=\"#为什么要用Docker\" class=\"headerlink\" title=\"为什么要用Docker\"></a>为什么要用Docker</h2><p>作为一种轻量级的虚拟化方式，Docker在运行应用上跟传统的虚拟机方式相比具有显著优势：<br>1、Docker容器很快，启动和停止可以在秒级实现，这相比传统的虚拟机方式要快得多。<br>2、Docker容器对系统资源需求很少，一台主机上可以同时运行数千个Docker容器。<br>3、Docker通过类似Git的操作来方便用户获取、分发和更新应用镜像，指令简明，学习成本较低。<br>4、Docker通过Dockerfile配置文件来支持灵活的自动化创建和部署机制，提高工作效率。</p>\n<p>Docker容器除了运行其中的应用之外，基本不消耗额外的系统资源，保证应用性能的同时，尽量减小系统开销。传统虚拟机方式运行N个不同的应用就要启动N个虚拟机（每个虚拟机需要单独分配独占的内存、磁盘等资源），而Docker只需要启动N个隔离的容器，并将应用放到容器内即可。</p>\n<h2 id=\"Docker的好处\"><a href=\"#Docker的好处\" class=\"headerlink\" title=\"Docker的好处\"></a>Docker的好处</h2><p>1、更快速的交付和部署。使用Docker，开发人员可以使用镜像来快速构建一套标准的开发环境；开发完成之后，测试和运维人员可以直接使用相同环境来部署代码。Docker可以快速创建和删除容器，实现快速迭代，大量节约开发、测试、部署的时间。并且，各个步骤都有明确的配置和操作，整个过程全程可见，使团队更容易理解应用的创建和工作过程。<br>2、更高效的资源利用。Docker容器的运行不需要额外的虚拟化管理程序（Virtual Machine Manager，VMM，以及Hypervisor）支持，它是内核级的虚拟化，可以实现更高的性能，同时对资源的额外需求很低。<br>3、更轻松的迁移和扩展。Docker容器几乎可以在任意的平台上运行，包括物理机、虚拟机、公有云、私有云、个人电脑、服务器等。 这种兼容性让用户可以在不同平台之间轻松地迁移应用。<br>4、更简单的更新管理。使用Dockerfile，只需要小小的配置修改，就可以替代以往大量的更新工作。并且所有修改都以增量的方式进行分发和更新，从而实现自动化并且高效的容器管理。</p>\n<h2 id=\"Docker命令\"><a href=\"#Docker命令\" class=\"headerlink\" title=\"Docker命令\"></a>Docker命令</h2><p>1、docker images;        #查看本地镜像<br>2、docker ps;        #查看本机正在运行的容器<br>3、docker ps -a;        #查看本机所有的容器<br>4、docker run;        #运行容器<br>5、docker exec    -it 容器名称 bin/bash;        #进入容器<br>6、docker start $(docker ps -a | awk ‘{ print $1}’ | tail -n +2);        #启动所有的容器命令<br>7、docker restart $(docker ps -a | awk ‘{ print $1}’ | tail -n +2);        #重启所有的容器命令<br>8、docker stop $(docker ps -a | awk ‘{ print $1}’ | tail -n +2);        #关闭所有容器<br>9、docker rm $(docker ps -a | awk ‘{ print $1}’ | tail -n +2);            #删除所有的容器命令<br>10、docker rmi $(docker images | awk ‘{print $3}’ |tail -n +2);        #删除所有的镜像<br>11、docker logs 容器名称或者容器id:;        #查看容器日志<br>12、docker serach 镜像名称;        #查看docker远程仓库的镜像版本<br>13、docker pull 镜像版本;        #可以从docker远程仓库拉取该镜像<br>14、docker login;        #登陆hub.docker</p>\n","site":{"data":{}},"excerpt":"<p>初识Docker是我在公司于公司其他部们负责人聊天的时候，知道公司的服务器使用Docker来搭建的，本着好奇，所以折腾折腾</p>","more":"<h2 id=\"Docker的介绍\"><a href=\"#Docker的介绍\" class=\"headerlink\" title=\"Docker的介绍\"></a>Docker的介绍</h2><p>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口</p>\n<h2 id=\"为什么要用Docker\"><a href=\"#为什么要用Docker\" class=\"headerlink\" title=\"为什么要用Docker\"></a>为什么要用Docker</h2><p>作为一种轻量级的虚拟化方式，Docker在运行应用上跟传统的虚拟机方式相比具有显著优势：<br>1、Docker容器很快，启动和停止可以在秒级实现，这相比传统的虚拟机方式要快得多。<br>2、Docker容器对系统资源需求很少，一台主机上可以同时运行数千个Docker容器。<br>3、Docker通过类似Git的操作来方便用户获取、分发和更新应用镜像，指令简明，学习成本较低。<br>4、Docker通过Dockerfile配置文件来支持灵活的自动化创建和部署机制，提高工作效率。</p>\n<p>Docker容器除了运行其中的应用之外，基本不消耗额外的系统资源，保证应用性能的同时，尽量减小系统开销。传统虚拟机方式运行N个不同的应用就要启动N个虚拟机（每个虚拟机需要单独分配独占的内存、磁盘等资源），而Docker只需要启动N个隔离的容器，并将应用放到容器内即可。</p>\n<h2 id=\"Docker的好处\"><a href=\"#Docker的好处\" class=\"headerlink\" title=\"Docker的好处\"></a>Docker的好处</h2><p>1、更快速的交付和部署。使用Docker，开发人员可以使用镜像来快速构建一套标准的开发环境；开发完成之后，测试和运维人员可以直接使用相同环境来部署代码。Docker可以快速创建和删除容器，实现快速迭代，大量节约开发、测试、部署的时间。并且，各个步骤都有明确的配置和操作，整个过程全程可见，使团队更容易理解应用的创建和工作过程。<br>2、更高效的资源利用。Docker容器的运行不需要额外的虚拟化管理程序（Virtual Machine Manager，VMM，以及Hypervisor）支持，它是内核级的虚拟化，可以实现更高的性能，同时对资源的额外需求很低。<br>3、更轻松的迁移和扩展。Docker容器几乎可以在任意的平台上运行，包括物理机、虚拟机、公有云、私有云、个人电脑、服务器等。 这种兼容性让用户可以在不同平台之间轻松地迁移应用。<br>4、更简单的更新管理。使用Dockerfile，只需要小小的配置修改，就可以替代以往大量的更新工作。并且所有修改都以增量的方式进行分发和更新，从而实现自动化并且高效的容器管理。</p>\n<h2 id=\"Docker命令\"><a href=\"#Docker命令\" class=\"headerlink\" title=\"Docker命令\"></a>Docker命令</h2><p>1、docker images;        #查看本地镜像<br>2、docker ps;        #查看本机正在运行的容器<br>3、docker ps -a;        #查看本机所有的容器<br>4、docker run;        #运行容器<br>5、docker exec    -it 容器名称 bin/bash;        #进入容器<br>6、docker start $(docker ps -a | awk ‘{ print $1}’ | tail -n +2);        #启动所有的容器命令<br>7、docker restart $(docker ps -a | awk ‘{ print $1}’ | tail -n +2);        #重启所有的容器命令<br>8、docker stop $(docker ps -a | awk ‘{ print $1}’ | tail -n +2);        #关闭所有容器<br>9、docker rm $(docker ps -a | awk ‘{ print $1}’ | tail -n +2);            #删除所有的容器命令<br>10、docker rmi $(docker images | awk ‘{print $3}’ |tail -n +2);        #删除所有的镜像<br>11、docker logs 容器名称或者容器id:;        #查看容器日志<br>12、docker serach 镜像名称;        #查看docker远程仓库的镜像版本<br>13、docker pull 镜像版本;        #可以从docker远程仓库拉取该镜像<br>14、docker login;        #登陆hub.docker</p>"},{"title":"Hexo搭建","date":"2017-07-23T09:41:51.000Z","_content":"hexo搭建及加载主题\n\n<!-- more -->\n## Mac通过域名 + GitHub Pages + hexo 搭建自己的博客\n\n~~~\n\t说明： 因本人使用电脑为mac，故部分操作仅限mac\n\thexo官网： hexo.io\n\tgithub官网： github.com\n~~~\n\n## GitHub配置\n\n~~~ \n\t登陆github官网后，点击界面右上角头像，找到Settings\n\t打开电脑的\"终端\"， 输入：ssh-key -t rsa 然后一只回车\n\tvi ~/.ssh/id_rsa.pub, 将里面的内容放入Settngs的SSH and GPG keys中\n~~~\n\n## 新建GitHub项目\n\n~~~\n\t打开github主页， New repository\n\t输入项目名称： 格式必须为： username.github.io\n\t创建之后， 点击 username.github.io项目，找到Settings -> GitHub Pages -> Custom domain\n~~~\n\n## 域名解析\n\n~~~\n\t登陆你域名所在服务商后台， 添加类型为CNAME的记录值, 域名则是你github仓库的地址: username.github.io\n~~~\n\n## 安装 Node.js\n\t通过homebrew安装(推荐)\n~~~\n\tbrew link node\n\tbrew uninstall node\n\tbrew install node\n~~~\n\n## 安装 Hexo\n\n~~~\n\tnpm install -g hexo-cli\n~~~\n\n## Hexo 建站\n\n~~~\n\tmkdir -p 网站名称\n\tcd 网站名称\n\thexo init \n~~~\n\t创建完后，目录应该如下\n~~~\n\t.\n\t├── _config.yml\n\t├── package.json\n\t├── scaffolds\n\t├── source\n\t|   ├── _drafts\n\t|   └── _posts\n\t└── themes\n~~~\n\n## 测试网站\n\n~~~\n\thexo s\n\t打开浏览器，输入localhost:4000/\n~~~\n\t如果能够正常打开hexo，那么本机hexo搞定\n\n## 更换主题\n\n~~~\n\thexo的主题官网: https://hexo.io/themes \n\t可以在这里面挑选你喜欢的主题，然后点击名称会跳转到github地址去\n~~~\n\t下面我拿我的博客主题为例\n~~~\n\tcd 博客文件\n\tgit clone https://github.com/tufu9441/maupassant-hexo.git themes/maupassant\n\tnpm install hexo-renderer-pug --save\n\tnpm install hexo-renderer-sass --save\n~~~\n注：\t若npm install hexo-renderer-sass安装时报错，可能是国内网络问题请尝试使用代理或者切换至淘宝NPM镜像安装，感谢光头强提供的方法。\n\n## 配置 config.yml 文件\n\t找到文件最下方，添加下面内容\n~~~\n\tdeploy:\n  \t type: git\n  \t repo: git@github.com:username/username.github.io.git\n  \t branch: master\n~~~\n\t保存之后, 输入下面命令\n~~~\n\thexo clean \n\thexo d\n~~~\n\t如果报错 ERROR Deployer not found: git\n~~~\n\tnpm install --save hexo-deployer-git\n~~~\n\n##\t特别注意\n\t如果你每次 hexo s之后 访问域名都会报404 那么你需要创建一个CNAME文件\n~~~\n\tcd hexo文件\n\tcd source\n\tvi CNAME \n\t在这个文件里面输入你的域名就可以了\n~~~\n\t文章中我尽可能的没有用vim 因为有的系统 vim 不一定是自带的\n\n\n\n\n","source":"_posts/Hexo搭建.md","raw":"---\ntitle: Hexo搭建\ndate: 2017-07-23 17:41:51\ntags: Hexo\ncategories: hexo\n\n---\nhexo搭建及加载主题\n\n<!-- more -->\n## Mac通过域名 + GitHub Pages + hexo 搭建自己的博客\n\n~~~\n\t说明： 因本人使用电脑为mac，故部分操作仅限mac\n\thexo官网： hexo.io\n\tgithub官网： github.com\n~~~\n\n## GitHub配置\n\n~~~ \n\t登陆github官网后，点击界面右上角头像，找到Settings\n\t打开电脑的\"终端\"， 输入：ssh-key -t rsa 然后一只回车\n\tvi ~/.ssh/id_rsa.pub, 将里面的内容放入Settngs的SSH and GPG keys中\n~~~\n\n## 新建GitHub项目\n\n~~~\n\t打开github主页， New repository\n\t输入项目名称： 格式必须为： username.github.io\n\t创建之后， 点击 username.github.io项目，找到Settings -> GitHub Pages -> Custom domain\n~~~\n\n## 域名解析\n\n~~~\n\t登陆你域名所在服务商后台， 添加类型为CNAME的记录值, 域名则是你github仓库的地址: username.github.io\n~~~\n\n## 安装 Node.js\n\t通过homebrew安装(推荐)\n~~~\n\tbrew link node\n\tbrew uninstall node\n\tbrew install node\n~~~\n\n## 安装 Hexo\n\n~~~\n\tnpm install -g hexo-cli\n~~~\n\n## Hexo 建站\n\n~~~\n\tmkdir -p 网站名称\n\tcd 网站名称\n\thexo init \n~~~\n\t创建完后，目录应该如下\n~~~\n\t.\n\t├── _config.yml\n\t├── package.json\n\t├── scaffolds\n\t├── source\n\t|   ├── _drafts\n\t|   └── _posts\n\t└── themes\n~~~\n\n## 测试网站\n\n~~~\n\thexo s\n\t打开浏览器，输入localhost:4000/\n~~~\n\t如果能够正常打开hexo，那么本机hexo搞定\n\n## 更换主题\n\n~~~\n\thexo的主题官网: https://hexo.io/themes \n\t可以在这里面挑选你喜欢的主题，然后点击名称会跳转到github地址去\n~~~\n\t下面我拿我的博客主题为例\n~~~\n\tcd 博客文件\n\tgit clone https://github.com/tufu9441/maupassant-hexo.git themes/maupassant\n\tnpm install hexo-renderer-pug --save\n\tnpm install hexo-renderer-sass --save\n~~~\n注：\t若npm install hexo-renderer-sass安装时报错，可能是国内网络问题请尝试使用代理或者切换至淘宝NPM镜像安装，感谢光头强提供的方法。\n\n## 配置 config.yml 文件\n\t找到文件最下方，添加下面内容\n~~~\n\tdeploy:\n  \t type: git\n  \t repo: git@github.com:username/username.github.io.git\n  \t branch: master\n~~~\n\t保存之后, 输入下面命令\n~~~\n\thexo clean \n\thexo d\n~~~\n\t如果报错 ERROR Deployer not found: git\n~~~\n\tnpm install --save hexo-deployer-git\n~~~\n\n##\t特别注意\n\t如果你每次 hexo s之后 访问域名都会报404 那么你需要创建一个CNAME文件\n~~~\n\tcd hexo文件\n\tcd source\n\tvi CNAME \n\t在这个文件里面输入你的域名就可以了\n~~~\n\t文章中我尽可能的没有用vim 因为有的系统 vim 不一定是自带的\n\n\n\n\n","slug":"Hexo搭建","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuw40001ydqnhid2838f","content":"<p>hexo搭建及加载主题</p>\n<a id=\"more\"></a>\n<h2 id=\"Mac通过域名-GitHub-Pages-hexo-搭建自己的博客\"><a href=\"#Mac通过域名-GitHub-Pages-hexo-搭建自己的博客\" class=\"headerlink\" title=\"Mac通过域名 + GitHub Pages + hexo 搭建自己的博客\"></a>Mac通过域名 + GitHub Pages + hexo 搭建自己的博客</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">说明： 因本人使用电脑为<span class=\"selector-tag\">mac</span>，故部分操作仅限<span class=\"selector-tag\">mac</span></span><br><span class=\"line\"><span class=\"selector-tag\">hexo</span>官网： <span class=\"selector-tag\">hexo</span><span class=\"selector-class\">.io</span></span><br><span class=\"line\"><span class=\"selector-tag\">github</span>官网： <span class=\"selector-tag\">github</span><span class=\"selector-class\">.com</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"GitHub配置\"><a href=\"#GitHub配置\" class=\"headerlink\" title=\"GitHub配置\"></a>GitHub配置</h2><figure class=\"highlight q\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">登陆github官网后，点击界面右上角头像，找到Settings</span><br><span class=\"line\">打开电脑的<span class=\"string\">\"终端\"</span>， 输入：ssh-<span class=\"built_in\">key</span> -t rsa 然后一只回车</span><br><span class=\"line\">vi ~/.ssh/id_rsa.pub, 将里面的内容放入Settngs的SSH <span class=\"built_in\">and</span> GPG <span class=\"built_in\">keys</span>中</span><br></pre></td></tr></table></figure>\n<h2 id=\"新建GitHub项目\"><a href=\"#新建GitHub项目\" class=\"headerlink\" title=\"新建GitHub项目\"></a>新建GitHub项目</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">打开github主页， New repository</span><br><span class=\"line\">输入项目名称： 格式必须为： username<span class=\"selector-class\">.github</span><span class=\"selector-class\">.io</span></span><br><span class=\"line\">创建之后， 点击 username<span class=\"selector-class\">.github</span><span class=\"selector-class\">.io</span>项目，找到Settings -&gt; GitHub Pages -&gt; Custom domain</span><br></pre></td></tr></table></figure>\n<h2 id=\"域名解析\"><a href=\"#域名解析\" class=\"headerlink\" title=\"域名解析\"></a>域名解析</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">登陆你域名所在服务商后台， 添加类型为CNAME的记录值, 域名则是你github仓库的地址: username<span class=\"selector-class\">.github</span><span class=\"selector-class\">.io</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"安装-Node-js\"><a href=\"#安装-Node-js\" class=\"headerlink\" title=\"安装 Node.js\"></a>安装 Node.js</h2><pre><code>通过homebrew安装(推荐)\n</code></pre><figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew link <span class=\"keyword\">node</span><span class=\"title\"></span></span><br><span class=\"line\"><span class=\"title\">brew</span> uninstall <span class=\"keyword\">node</span><span class=\"title\"></span></span><br><span class=\"line\"><span class=\"title\">brew</span> install <span class=\"keyword\">node</span><span class=\"title\"></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"安装-Hexo\"><a href=\"#安装-Hexo\" class=\"headerlink\" title=\"安装 Hexo\"></a>安装 Hexo</h2><figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g hexo-<span class=\"keyword\">cli</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Hexo-建站\"><a href=\"#Hexo-建站\" class=\"headerlink\" title=\"Hexo 建站\"></a>Hexo 建站</h2><figure class=\"highlight dos\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p 网站名称</span><br><span class=\"line\"><span class=\"built_in\">cd</span> 网站名称</span><br><span class=\"line\">hexo init</span><br></pre></td></tr></table></figure>\n<pre><code>创建完后，目录应该如下\n</code></pre><figure class=\"highlight sqf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.</span><br><span class=\"line\">├── <span class=\"variable\">_config</span>.yml</span><br><span class=\"line\">├── package.json</span><br><span class=\"line\">├── scaffolds</span><br><span class=\"line\">├── source</span><br><span class=\"line\">|   ├── <span class=\"variable\">_drafts</span></span><br><span class=\"line\">|   └── <span class=\"variable\">_posts</span></span><br><span class=\"line\">└── themes</span><br></pre></td></tr></table></figure>\n<h2 id=\"测试网站\"><a href=\"#测试网站\" class=\"headerlink\" title=\"测试网站\"></a>测试网站</h2><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo s</span><br><span class=\"line\">打开浏览器，输入<span class=\"string\">localhost:</span><span class=\"number\">4000</span>/</span><br></pre></td></tr></table></figure>\n<pre><code>如果能够正常打开hexo，那么本机hexo搞定\n</code></pre><h2 id=\"更换主题\"><a href=\"#更换主题\" class=\"headerlink\" title=\"更换主题\"></a>更换主题</h2><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo的主题官网: <span class=\"string\">https:</span><span class=\"comment\">//hexo.io/themes </span></span><br><span class=\"line\">可以在这里面挑选你喜欢的主题，然后点击名称会跳转到github地址去</span><br></pre></td></tr></table></figure>\n<pre><code>下面我拿我的博客主题为例\n</code></pre><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">cd</span> 博客文件</span><br><span class=\"line\">git clone https:<span class=\"string\">//github.com/tufu9441/maupassant-hexo.git</span> themes/maupassant</span><br><span class=\"line\">npm install hexo-renderer-pug <span class=\"params\">--save</span></span><br><span class=\"line\">npm install hexo-renderer-sass <span class=\"params\">--save</span></span><br></pre></td></tr></table></figure>\n<p>注：    若npm install hexo-renderer-sass安装时报错，可能是国内网络问题请尝试使用代理或者切换至淘宝NPM镜像安装，感谢光头强提供的方法。</p>\n<h2 id=\"配置-config-yml-文件\"><a href=\"#配置-config-yml-文件\" class=\"headerlink\" title=\"配置 config.yml 文件\"></a>配置 config.yml 文件</h2><pre><code>找到文件最下方，添加下面内容\n</code></pre><figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">deploy</span>:</span><br><span class=\"line\"> \t <span class=\"attribute\">type</span>: git</span><br><span class=\"line\"> \t <span class=\"attribute\">repo</span>: git<span class=\"variable\">@github</span>.<span class=\"attribute\">com</span>:username/username.github.io.git</span><br><span class=\"line\"> \t <span class=\"attribute\">branch</span>: master</span><br></pre></td></tr></table></figure>\n<pre><code>保存之后, 输入下面命令\n</code></pre><figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">hexo clean</span> </span><br><span class=\"line\"><span class=\"attribute\">hexo d</span></span><br></pre></td></tr></table></figure>\n<pre><code>如果报错 ERROR Deployer not found: git\n</code></pre><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">install</span> <span class=\"comment\">--save hexo-deployer-git</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"特别注意\"><a href=\"#特别注意\" class=\"headerlink\" title=\"特别注意\"></a>特别注意</h2><pre><code>如果你每次 hexo s之后 访问域名都会报404 那么你需要创建一个CNAME文件\n</code></pre><figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">cd</span> hexo文件</span><br><span class=\"line\"><span class=\"keyword\">cd</span> <span class=\"keyword\">source</span></span><br><span class=\"line\"><span class=\"keyword\">vi</span> CNAME </span><br><span class=\"line\">在这个文件里面输入你的域名就可以了</span><br></pre></td></tr></table></figure>\n<pre><code>文章中我尽可能的没有用vim 因为有的系统 vim 不一定是自带的\n</code></pre>","site":{"data":{}},"excerpt":"<p>hexo搭建及加载主题</p>","more":"<h2 id=\"Mac通过域名-GitHub-Pages-hexo-搭建自己的博客\"><a href=\"#Mac通过域名-GitHub-Pages-hexo-搭建自己的博客\" class=\"headerlink\" title=\"Mac通过域名 + GitHub Pages + hexo 搭建自己的博客\"></a>Mac通过域名 + GitHub Pages + hexo 搭建自己的博客</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">说明： 因本人使用电脑为<span class=\"selector-tag\">mac</span>，故部分操作仅限<span class=\"selector-tag\">mac</span></span><br><span class=\"line\"><span class=\"selector-tag\">hexo</span>官网： <span class=\"selector-tag\">hexo</span><span class=\"selector-class\">.io</span></span><br><span class=\"line\"><span class=\"selector-tag\">github</span>官网： <span class=\"selector-tag\">github</span><span class=\"selector-class\">.com</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"GitHub配置\"><a href=\"#GitHub配置\" class=\"headerlink\" title=\"GitHub配置\"></a>GitHub配置</h2><figure class=\"highlight q\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">登陆github官网后，点击界面右上角头像，找到Settings</span><br><span class=\"line\">打开电脑的<span class=\"string\">\"终端\"</span>， 输入：ssh-<span class=\"built_in\">key</span> -t rsa 然后一只回车</span><br><span class=\"line\">vi ~/.ssh/id_rsa.pub, 将里面的内容放入Settngs的SSH <span class=\"built_in\">and</span> GPG <span class=\"built_in\">keys</span>中</span><br></pre></td></tr></table></figure>\n<h2 id=\"新建GitHub项目\"><a href=\"#新建GitHub项目\" class=\"headerlink\" title=\"新建GitHub项目\"></a>新建GitHub项目</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">打开github主页， New repository</span><br><span class=\"line\">输入项目名称： 格式必须为： username<span class=\"selector-class\">.github</span><span class=\"selector-class\">.io</span></span><br><span class=\"line\">创建之后， 点击 username<span class=\"selector-class\">.github</span><span class=\"selector-class\">.io</span>项目，找到Settings -&gt; GitHub Pages -&gt; Custom domain</span><br></pre></td></tr></table></figure>\n<h2 id=\"域名解析\"><a href=\"#域名解析\" class=\"headerlink\" title=\"域名解析\"></a>域名解析</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">登陆你域名所在服务商后台， 添加类型为CNAME的记录值, 域名则是你github仓库的地址: username<span class=\"selector-class\">.github</span><span class=\"selector-class\">.io</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"安装-Node-js\"><a href=\"#安装-Node-js\" class=\"headerlink\" title=\"安装 Node.js\"></a>安装 Node.js</h2><pre><code>通过homebrew安装(推荐)\n</code></pre><figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew link <span class=\"keyword\">node</span><span class=\"title\"></span></span><br><span class=\"line\"><span class=\"title\">brew</span> uninstall <span class=\"keyword\">node</span><span class=\"title\"></span></span><br><span class=\"line\"><span class=\"title\">brew</span> install <span class=\"keyword\">node</span><span class=\"title\"></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"安装-Hexo\"><a href=\"#安装-Hexo\" class=\"headerlink\" title=\"安装 Hexo\"></a>安装 Hexo</h2><figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g hexo-<span class=\"keyword\">cli</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Hexo-建站\"><a href=\"#Hexo-建站\" class=\"headerlink\" title=\"Hexo 建站\"></a>Hexo 建站</h2><figure class=\"highlight dos\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p 网站名称</span><br><span class=\"line\"><span class=\"built_in\">cd</span> 网站名称</span><br><span class=\"line\">hexo init</span><br></pre></td></tr></table></figure>\n<pre><code>创建完后，目录应该如下\n</code></pre><figure class=\"highlight sqf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.</span><br><span class=\"line\">├── <span class=\"variable\">_config</span>.yml</span><br><span class=\"line\">├── package.json</span><br><span class=\"line\">├── scaffolds</span><br><span class=\"line\">├── source</span><br><span class=\"line\">|   ├── <span class=\"variable\">_drafts</span></span><br><span class=\"line\">|   └── <span class=\"variable\">_posts</span></span><br><span class=\"line\">└── themes</span><br></pre></td></tr></table></figure>\n<h2 id=\"测试网站\"><a href=\"#测试网站\" class=\"headerlink\" title=\"测试网站\"></a>测试网站</h2><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo s</span><br><span class=\"line\">打开浏览器，输入<span class=\"string\">localhost:</span><span class=\"number\">4000</span>/</span><br></pre></td></tr></table></figure>\n<pre><code>如果能够正常打开hexo，那么本机hexo搞定\n</code></pre><h2 id=\"更换主题\"><a href=\"#更换主题\" class=\"headerlink\" title=\"更换主题\"></a>更换主题</h2><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo的主题官网: <span class=\"string\">https:</span><span class=\"comment\">//hexo.io/themes </span></span><br><span class=\"line\">可以在这里面挑选你喜欢的主题，然后点击名称会跳转到github地址去</span><br></pre></td></tr></table></figure>\n<pre><code>下面我拿我的博客主题为例\n</code></pre><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">cd</span> 博客文件</span><br><span class=\"line\">git clone https:<span class=\"string\">//github.com/tufu9441/maupassant-hexo.git</span> themes/maupassant</span><br><span class=\"line\">npm install hexo-renderer-pug <span class=\"params\">--save</span></span><br><span class=\"line\">npm install hexo-renderer-sass <span class=\"params\">--save</span></span><br></pre></td></tr></table></figure>\n<p>注：    若npm install hexo-renderer-sass安装时报错，可能是国内网络问题请尝试使用代理或者切换至淘宝NPM镜像安装，感谢光头强提供的方法。</p>\n<h2 id=\"配置-config-yml-文件\"><a href=\"#配置-config-yml-文件\" class=\"headerlink\" title=\"配置 config.yml 文件\"></a>配置 config.yml 文件</h2><pre><code>找到文件最下方，添加下面内容\n</code></pre><figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">deploy</span>:</span><br><span class=\"line\"> \t <span class=\"attribute\">type</span>: git</span><br><span class=\"line\"> \t <span class=\"attribute\">repo</span>: git<span class=\"variable\">@github</span>.<span class=\"attribute\">com</span>:username/username.github.io.git</span><br><span class=\"line\"> \t <span class=\"attribute\">branch</span>: master</span><br></pre></td></tr></table></figure>\n<pre><code>保存之后, 输入下面命令\n</code></pre><figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">hexo clean</span> </span><br><span class=\"line\"><span class=\"attribute\">hexo d</span></span><br></pre></td></tr></table></figure>\n<pre><code>如果报错 ERROR Deployer not found: git\n</code></pre><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">install</span> <span class=\"comment\">--save hexo-deployer-git</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"特别注意\"><a href=\"#特别注意\" class=\"headerlink\" title=\"特别注意\"></a>特别注意</h2><pre><code>如果你每次 hexo s之后 访问域名都会报404 那么你需要创建一个CNAME文件\n</code></pre><figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">cd</span> hexo文件</span><br><span class=\"line\"><span class=\"keyword\">cd</span> <span class=\"keyword\">source</span></span><br><span class=\"line\"><span class=\"keyword\">vi</span> CNAME </span><br><span class=\"line\">在这个文件里面输入你的域名就可以了</span><br></pre></td></tr></table></figure>\n<pre><code>文章中我尽可能的没有用vim 因为有的系统 vim 不一定是自带的\n</code></pre>"},{"title":"Linux常用命令","date":"2017-07-28T10:56:01.000Z","_content":"\nLinux下的常用命令\n\n<!-- more -->\n\n## 登陆服务器\n```\n\tssh username@ip -p (回车输密码)\n```\n## yum\nyum主要负责安装一些所需要的linux命令\n例如我们需要安装git:\n```\n\tyum install -y git \n```\n'-y'参数是'yes'的意思， 如果不加，那么在安装的时候会提示让你输入'yes'\n## --help参数\nlinux里面每一个命令都会有一个help参数，它的作用是列举出你所想使用某一个命令的所有参数列表\n## 创建一个用户\n```\n\tuseradd username;\n\tpasswd password;\n```\n## 创建一个用户组\n```\n\tgroupadd groupname;\n```\n## 指定用户归属于哪个用户组\n```\n\tuseradd -g groupname username;\n```\n## 查看用户和用户组列表\n```\n\tcat /etc/passwd; #可以查看所有用户的列表\n\tcat /etc/group; #查看用户组\n```\n## 删除用户和组列表\n```\n\tuserdel username; #删除用户\n\tuserdel -r username; #删除用户同时删除用户的工作目录\n\tgroupdel groupname; #删除用户组\n\tgroupdel -r groupname; #删除用户组同时删除用户组的工作目录\n```\n## 修改用户组名\n```\n\tgroupmod -n groupname1 groupname2;\n```\n## 创建文件夹\n```\n\tmkdir -p dirname;\n```\n## 删除文件\n```\n\trm dirname ;\n\trm -rf dirname; #-rf 是不需要任何确认，直接删除\n```\n备注：千万不要使用 rm -rf /* ; \n## 变更文件或目录的权限\n```\n\tchmod u+x dirname; #赋予文件的执行权限\n\tchmod 777 dirname; #赋予文件可读可写可执行权限\n\tchmod -R 777 dirname; #赋予文件及目录下的文件最高权限\n```\n## linux的权限说明\n```\n\tw:4\n\tr:2\n\tx:1\n\t比如给一个用户读写权限，那么就是6\n```\n## 变更某个文件或目录的所有者和所属的组\n```\n\tchown -R user dirname; #将dirname更换为user用户\n\tchown -R username:groupname dirname; #将dirname更换为user用户及groupname组\n```\n","source":"_posts/Linux常用命令.md","raw":"---\ntitle: Linux常用命令\ndate: 2017-07-28 18:56:01\ntags: Linux\ncategories: Linux\n\n---\n\nLinux下的常用命令\n\n<!-- more -->\n\n## 登陆服务器\n```\n\tssh username@ip -p (回车输密码)\n```\n## yum\nyum主要负责安装一些所需要的linux命令\n例如我们需要安装git:\n```\n\tyum install -y git \n```\n'-y'参数是'yes'的意思， 如果不加，那么在安装的时候会提示让你输入'yes'\n## --help参数\nlinux里面每一个命令都会有一个help参数，它的作用是列举出你所想使用某一个命令的所有参数列表\n## 创建一个用户\n```\n\tuseradd username;\n\tpasswd password;\n```\n## 创建一个用户组\n```\n\tgroupadd groupname;\n```\n## 指定用户归属于哪个用户组\n```\n\tuseradd -g groupname username;\n```\n## 查看用户和用户组列表\n```\n\tcat /etc/passwd; #可以查看所有用户的列表\n\tcat /etc/group; #查看用户组\n```\n## 删除用户和组列表\n```\n\tuserdel username; #删除用户\n\tuserdel -r username; #删除用户同时删除用户的工作目录\n\tgroupdel groupname; #删除用户组\n\tgroupdel -r groupname; #删除用户组同时删除用户组的工作目录\n```\n## 修改用户组名\n```\n\tgroupmod -n groupname1 groupname2;\n```\n## 创建文件夹\n```\n\tmkdir -p dirname;\n```\n## 删除文件\n```\n\trm dirname ;\n\trm -rf dirname; #-rf 是不需要任何确认，直接删除\n```\n备注：千万不要使用 rm -rf /* ; \n## 变更文件或目录的权限\n```\n\tchmod u+x dirname; #赋予文件的执行权限\n\tchmod 777 dirname; #赋予文件可读可写可执行权限\n\tchmod -R 777 dirname; #赋予文件及目录下的文件最高权限\n```\n## linux的权限说明\n```\n\tw:4\n\tr:2\n\tx:1\n\t比如给一个用户读写权限，那么就是6\n```\n## 变更某个文件或目录的所有者和所属的组\n```\n\tchown -R user dirname; #将dirname更换为user用户\n\tchown -R username:groupname dirname; #将dirname更换为user用户及groupname组\n```\n","slug":"Linux常用命令","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuw70004ydqn0jv3djmx","content":"<p>Linux下的常用命令</p>\n<a id=\"more\"></a>\n<h2 id=\"登陆服务器\"><a href=\"#登陆服务器\" class=\"headerlink\" title=\"登陆服务器\"></a>登陆服务器</h2><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">ssh</span> username<span class=\"variable\">@ip</span> -p (回车输密码)</span><br></pre></td></tr></table></figure>\n<h2 id=\"yum\"><a href=\"#yum\" class=\"headerlink\" title=\"yum\"></a>yum</h2><p>yum主要负责安装一些所需要的linux命令<br>例如我们需要安装git:<br><figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum <span class=\"keyword\">install</span> -y git</span><br></pre></td></tr></table></figure></p>\n<p>‘-y’参数是’yes’的意思， 如果不加，那么在安装的时候会提示让你输入’yes’</p>\n<h2 id=\"–help参数\"><a href=\"#–help参数\" class=\"headerlink\" title=\"–help参数\"></a>–help参数</h2><p>linux里面每一个命令都会有一个help参数，它的作用是列举出你所想使用某一个命令的所有参数列表</p>\n<h2 id=\"创建一个用户\"><a href=\"#创建一个用户\" class=\"headerlink\" title=\"创建一个用户\"></a>创建一个用户</h2><figure class=\"highlight abnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd username<span class=\"comment\">;</span></span><br><span class=\"line\">passwd password<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"创建一个用户组\"><a href=\"#创建一个用户组\" class=\"headerlink\" title=\"创建一个用户组\"></a>创建一个用户组</h2><figure class=\"highlight abnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groupadd groupname<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"指定用户归属于哪个用户组\"><a href=\"#指定用户归属于哪个用户组\" class=\"headerlink\" title=\"指定用户归属于哪个用户组\"></a>指定用户归属于哪个用户组</h2><figure class=\"highlight abnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -g groupname username<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"查看用户和用户组列表\"><a href=\"#查看用户和用户组列表\" class=\"headerlink\" title=\"查看用户和用户组列表\"></a>查看用户和用户组列表</h2><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /etc/passwd; #可以查看所有用户的列表</span><br><span class=\"line\">cat /etc<span class=\"built_in\">/group; </span>#查看用户组</span><br></pre></td></tr></table></figure>\n<h2 id=\"删除用户和组列表\"><a href=\"#删除用户和组列表\" class=\"headerlink\" title=\"删除用户和组列表\"></a>删除用户和组列表</h2><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">userdel</span> username; <span class=\"comment\">#删除用户</span></span><br><span class=\"line\"><span class=\"attribute\">userdel</span> -r username; <span class=\"comment\">#删除用户同时删除用户的工作目录</span></span><br><span class=\"line\"><span class=\"attribute\">groupdel</span> groupname; <span class=\"comment\">#删除用户组</span></span><br><span class=\"line\"><span class=\"attribute\">groupdel</span> -r groupname; <span class=\"comment\">#删除用户组同时删除用户组的工作目录</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"修改用户组名\"><a href=\"#修改用户组名\" class=\"headerlink\" title=\"修改用户组名\"></a>修改用户组名</h2><figure class=\"highlight abnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groupmod -n groupname1 groupname2<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"创建文件夹\"><a href=\"#创建文件夹\" class=\"headerlink\" title=\"创建文件夹\"></a>创建文件夹</h2><figure class=\"highlight abnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p dirname<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"删除文件\"><a href=\"#删除文件\" class=\"headerlink\" title=\"删除文件\"></a>删除文件</h2><figure class=\"highlight mipsasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm <span class=\"keyword\">dirname </span><span class=\"comment\">;</span></span><br><span class=\"line\">rm -rf <span class=\"keyword\">dirname; </span><span class=\"comment\">#-rf 是不需要任何确认，直接删除</span></span><br></pre></td></tr></table></figure>\n<p>备注：千万不要使用 rm -rf /* ; </p>\n<h2 id=\"变更文件或目录的权限\"><a href=\"#变更文件或目录的权限\" class=\"headerlink\" title=\"变更文件或目录的权限\"></a>变更文件或目录的权限</h2><figure class=\"highlight mipsasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod u+x <span class=\"keyword\">dirname; </span><span class=\"comment\">#赋予文件的执行权限</span></span><br><span class=\"line\">chmod <span class=\"number\">777</span> <span class=\"keyword\">dirname; </span><span class=\"comment\">#赋予文件可读可写可执行权限</span></span><br><span class=\"line\">chmod -R <span class=\"number\">777</span> <span class=\"keyword\">dirname; </span><span class=\"comment\">#赋予文件及目录下的文件最高权限</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"linux的权限说明\"><a href=\"#linux的权限说明\" class=\"headerlink\" title=\"linux的权限说明\"></a>linux的权限说明</h2><figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">w:</span><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"symbol\">r:</span><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"symbol\">x:</span><span class=\"number\">1</span></span><br><span class=\"line\">比如给一个用户读写权限，那么就是<span class=\"number\">6</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"变更某个文件或目录的所有者和所属的组\"><a href=\"#变更某个文件或目录的所有者和所属的组\" class=\"headerlink\" title=\"变更某个文件或目录的所有者和所属的组\"></a>变更某个文件或目录的所有者和所属的组</h2><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown -R<span class=\"built_in\"> user </span>dirname; #将dirname更换为user用户</span><br><span class=\"line\">chown -R username:groupname dirname; #将dirname更换为user用户及groupname组</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>Linux下的常用命令</p>","more":"<h2 id=\"登陆服务器\"><a href=\"#登陆服务器\" class=\"headerlink\" title=\"登陆服务器\"></a>登陆服务器</h2><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">ssh</span> username<span class=\"variable\">@ip</span> -p (回车输密码)</span><br></pre></td></tr></table></figure>\n<h2 id=\"yum\"><a href=\"#yum\" class=\"headerlink\" title=\"yum\"></a>yum</h2><p>yum主要负责安装一些所需要的linux命令<br>例如我们需要安装git:<br><figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum <span class=\"keyword\">install</span> -y git</span><br></pre></td></tr></table></figure></p>\n<p>‘-y’参数是’yes’的意思， 如果不加，那么在安装的时候会提示让你输入’yes’</p>\n<h2 id=\"–help参数\"><a href=\"#–help参数\" class=\"headerlink\" title=\"–help参数\"></a>–help参数</h2><p>linux里面每一个命令都会有一个help参数，它的作用是列举出你所想使用某一个命令的所有参数列表</p>\n<h2 id=\"创建一个用户\"><a href=\"#创建一个用户\" class=\"headerlink\" title=\"创建一个用户\"></a>创建一个用户</h2><figure class=\"highlight abnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd username<span class=\"comment\">;</span></span><br><span class=\"line\">passwd password<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"创建一个用户组\"><a href=\"#创建一个用户组\" class=\"headerlink\" title=\"创建一个用户组\"></a>创建一个用户组</h2><figure class=\"highlight abnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groupadd groupname<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"指定用户归属于哪个用户组\"><a href=\"#指定用户归属于哪个用户组\" class=\"headerlink\" title=\"指定用户归属于哪个用户组\"></a>指定用户归属于哪个用户组</h2><figure class=\"highlight abnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -g groupname username<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"查看用户和用户组列表\"><a href=\"#查看用户和用户组列表\" class=\"headerlink\" title=\"查看用户和用户组列表\"></a>查看用户和用户组列表</h2><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /etc/passwd; #可以查看所有用户的列表</span><br><span class=\"line\">cat /etc<span class=\"built_in\">/group; </span>#查看用户组</span><br></pre></td></tr></table></figure>\n<h2 id=\"删除用户和组列表\"><a href=\"#删除用户和组列表\" class=\"headerlink\" title=\"删除用户和组列表\"></a>删除用户和组列表</h2><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">userdel</span> username; <span class=\"comment\">#删除用户</span></span><br><span class=\"line\"><span class=\"attribute\">userdel</span> -r username; <span class=\"comment\">#删除用户同时删除用户的工作目录</span></span><br><span class=\"line\"><span class=\"attribute\">groupdel</span> groupname; <span class=\"comment\">#删除用户组</span></span><br><span class=\"line\"><span class=\"attribute\">groupdel</span> -r groupname; <span class=\"comment\">#删除用户组同时删除用户组的工作目录</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"修改用户组名\"><a href=\"#修改用户组名\" class=\"headerlink\" title=\"修改用户组名\"></a>修改用户组名</h2><figure class=\"highlight abnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groupmod -n groupname1 groupname2<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"创建文件夹\"><a href=\"#创建文件夹\" class=\"headerlink\" title=\"创建文件夹\"></a>创建文件夹</h2><figure class=\"highlight abnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p dirname<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"删除文件\"><a href=\"#删除文件\" class=\"headerlink\" title=\"删除文件\"></a>删除文件</h2><figure class=\"highlight mipsasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm <span class=\"keyword\">dirname </span><span class=\"comment\">;</span></span><br><span class=\"line\">rm -rf <span class=\"keyword\">dirname; </span><span class=\"comment\">#-rf 是不需要任何确认，直接删除</span></span><br></pre></td></tr></table></figure>\n<p>备注：千万不要使用 rm -rf /* ; </p>\n<h2 id=\"变更文件或目录的权限\"><a href=\"#变更文件或目录的权限\" class=\"headerlink\" title=\"变更文件或目录的权限\"></a>变更文件或目录的权限</h2><figure class=\"highlight mipsasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod u+x <span class=\"keyword\">dirname; </span><span class=\"comment\">#赋予文件的执行权限</span></span><br><span class=\"line\">chmod <span class=\"number\">777</span> <span class=\"keyword\">dirname; </span><span class=\"comment\">#赋予文件可读可写可执行权限</span></span><br><span class=\"line\">chmod -R <span class=\"number\">777</span> <span class=\"keyword\">dirname; </span><span class=\"comment\">#赋予文件及目录下的文件最高权限</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"linux的权限说明\"><a href=\"#linux的权限说明\" class=\"headerlink\" title=\"linux的权限说明\"></a>linux的权限说明</h2><figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">w:</span><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"symbol\">r:</span><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"symbol\">x:</span><span class=\"number\">1</span></span><br><span class=\"line\">比如给一个用户读写权限，那么就是<span class=\"number\">6</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"变更某个文件或目录的所有者和所属的组\"><a href=\"#变更某个文件或目录的所有者和所属的组\" class=\"headerlink\" title=\"变更某个文件或目录的所有者和所属的组\"></a>变更某个文件或目录的所有者和所属的组</h2><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown -R<span class=\"built_in\"> user </span>dirname; #将dirname更换为user用户</span><br><span class=\"line\">chown -R username:groupname dirname; #将dirname更换为user用户及groupname组</span><br></pre></td></tr></table></figure>"},{"title":"MVC","date":"2017-09-29T19:35:43.000Z","_content":"我将MVC归属在设计模式里面,个人对MVC的理解它应该为一种设计模式。\n\n<!-- more -->\n\n##\t什么是MVC\n由模型(model),视图(view),控制器(controller)完成的应用程序由模型发出要实现的功能到控制器,控制器接收组织功能传递给视图;\n\nModel(模型)，程序应用功能的实现，程序的逻辑的实现。在PHP中负责数据管理，数据生成;\nView(视图)，图形界面逻辑。在PHP中负责输出，处理如何调用模板、需要的资源文件;\nController(控制器)，负责转发请求，对请求处理。在PHP中根据请求决定调用的视图及使用的数据;\n\n##\t为什么使用MVC\nMVC的主要作用是为了将代码分层、分类;\nMVC的主要目的是为了解决Web开发中分离开发与设计工作，使其工作相对独立;\n在这样的过程中还发现了其他的一些优点，网站的目录结构更加清晰，网站更易维护与扩展，可以实现模块的复用;\n\n## 我所认知的MVC\nMVC 是一个设计模式，它强制性的使应用程序的输入、处理和输出分开。使用 MVC 应 用程序被分成三个核心部件:模型、视图、控制器。它们各自处理自己的任务。视图是 用户看到并与之交互的界面。模型表示企业数据和业务规则。控制器接受用户的输入并 调用模型和视图去完成用户的需求。\n\n##\t优点\n低耦合性、高重用性和可适用性、较低的生命周期成本、快速的部署、 可维护性、可扩展性，有利于软件工程化管理\n\n##\t缺点\n没有明确的定义，完全理解 MVC 并不容易。不适合小型规模的应用程序;\n\n##\tMVC底层架构\n1、Image类\n```\n\t<?php\n\n\tnamespace Framework;\n\n\tclass Image\n\t{\n\t\t//路径\n\t\tprivate $path = './upload/';\n\t\t//随机文件名\n\t\tprivate $isRandName;\n\t\t\n\t\t//初使化成员属性\n\t\tpublic function  __construct($path = null , $r = true)\n\t\t{\n\t\t\tif (!is_null($path)) {\n\t\t\t\t$this->path = rtrim($path,'/').'/';\n\t\t\t} \n\t\t\t\n\t\t\t$this->isRandName = $r;\n\t\t}\n\t\t\n\t\t//water水印的方法  目标和源，自适应能力更强一些，直接调成员方法即可\n\t\t//源、目标、位置 、透明度\n\t\tpublic function  water($dst,$src,$pos = 9, $prefix = 'wa_', $tmd = 100)\n\t\t{\n\t\t\t//判断文件路径是否存在\n\t\t\t$src = $this->path . $src;\n\t\t\t\n\t\t\tif (!file_exists($dst) || !file_exists($src))\n\t\t\t{\n\t\t\t\texit('目标者水印图片不存在');\n\t\t\t}\n\t\t\t//获取图像的相关信息\n\t\t\t$dstInfo = self::getImageInfo($dst);\n\t\t\t$srcInfo = self::getImageInfo($src);\n\t\t\t\n\t\t\t//判断宽高是否超过了目标图片的宽和高\n\t\t\tif (!$this->_checkSize($dstInfo,$srcInfo)) {\n\t\t\t\texit('水印图片宽、高不合法');\n\t\t\t}\n\t\t\t//摆放位置 \n\t\t\t$position = self::getPosition($dstInfo,$srcInfo,$pos);\n\t\t\t\n\t\t\t//打开图片\n\t\t\t$dstRes = self::openImg($dst, $dstInfo);\n\t\t\t$srcRes = self::openImg($src, $srcInfo);\n\t\t\t\n\t\t\t//将两个图片合并在一起\n\t\t\t$newRes = $this->_mergeImage($dstRes,$srcRes,$position,$dstInfo,$srcInfo,$tmd);\n\t\t\t\n\t\t\t\n\t\t\tif ($this->isRandName) {\n\t\t\t\t\n\t\t\t\t$path = $this->path.$prefix.uniqid().'.'.$dstInfo['subfix'];\n\t\t\t} else {\n\t\t\t\t$path = $this->path.$prefix.$dstInfo['basename'];\n\t\t\t}\n\t\t\t//保存图片\n\t\t\tself::saveImage($newRes,$path,$dstInfo);\n\t\t\t\n\t\t\t//销毁资源\n\t\t\timagedestroy($newRes);\n\t\t\timagedestroy($srcRes);\n\t\t\t//返回路径\n\t\t\treturn $path;\n\t\t}\n\t\t\n\t\t//thumb 源 和 宽高\n\t\tpublic function thumb($dst,$width,$height,$prefix = 'thumb_')\n\t\t{\n\t\t\t//判断文件是否在\n\t\t\tif (!file_exists($dst)) {\n\t\t\t\texit('文件路径不存在');\n\t\t\t}\n\t\t\t//获取图像的信息，没有信息，你什么都 做不鸟\n\t\t\t$info = self::getImageInfo($dst);\n\t\t\t//得到新的尺寸\n\t\t\t$newSize = self::getNewSize($width,$height,$info);\n\t\t\t//打开资源\n\t\t\t$res = self::openImg($dst,$info);\n\t\t\t//等比缩放这个资源，处理gif背景变黑的问题 \n\t\t\t$newRes = self::kidOfImage($res,$newSize,$info);\n\t\t\t//保存\n\t\t\t$path = $this->path.$prefix.$info['basename'];\n\t\t\tself::saveImage($newRes,$path,$info);\n\t\t\t//销毁\n\t\t\timagedestroy($newRes);\n\t\t\t//返回路径\n\t\t\treturn $path;\n\t\t\t\n\t\t}\n\t\t\n\t\tprivate static function kidOfImage($srcImg, $size, $imgInfo)\n\t\t{\n\t\t\t$newImg = imagecreatetruecolor($size[\"width\"], $size[\"height\"]);\t\t\n\t\t\t$otsc = imagecolortransparent($srcImg);\n\t\t\tif ( $otsc >= 0 && $otsc < imagecolorstotal($srcImg)) {\n\t\t\t\t $transparentcolor = imagecolorsforindex( $srcImg, $otsc );\n\t\t\t\t\t $newtransparentcolor = imagecolorallocate(\n\t\t\t\t\t $newImg,\n\t\t\t\t\t $transparentcolor['red'],\n\t\t\t\t\t\t $transparentcolor['green'],\n\t\t\t\t\t $transparentcolor['blue']\n\t\t\t\t );\n\n\t\t\t\t imagefill( $newImg, 0, 0, $newtransparentcolor );\n\t\t\t\t imagecolortransparent( $newImg, $newtransparentcolor );\n\t\t\t}\n\n\t\t\n\t\t\timagecopyresized( $newImg, $srcImg, 0, 0, 0, 0, $size[\"width\"], $size[\"height\"], $imgInfo[\"width\"], $imgInfo[\"height\"] );\n\t\t\timagedestroy($srcImg);\n\t\t\treturn $newImg;\n\t\t}\n\t\t\n\t\tprivate static function getNewSize($width, $height, $imgInfo)\n\t\t{\t\n\t\t\t$size[\"width\"] = $imgInfo[\"width\"];   //将原图片的宽度给数组中的$size[\"width\"]\n\t\t\t$size[\"height\"] = $imgInfo[\"height\"];  //将原图片的高度给数组中的$size[\"height\"]\n\t\t\t\n\t\t\tif($width < $imgInfo[\"width\"]) {\n\t\t\t\t$size[\"width\"] = $width;             //缩放的宽度如果比原图小才重新设置宽度\n\t\t\t}\n\n\t\t\tif ($width < $imgInfo[\"height\"]) {\n\t\t\t\t$size[\"height\"] = $height;            //缩放的高度如果比原图小才重新设置高度\n\t\t\t}\n\n\t\t\tif($imgInfo[\"width\"]*$size[\"width\"] > $imgInfo[\"height\"] * $size[\"height\"]) {\n\t\t\t\t$size[\"height\"] = round($imgInfo[\"height\"] * $size[\"width\"] / $imgInfo[\"width\"]);\n\t\t\t} else {\n\t\t\t\t$size[\"width\"] = round($imgInfo[\"width\"] * $size[\"height\"] / $imgInfo[\"height\"]);\n\t\t\t}\n\n\t\t\treturn $size;\n\t\t}\t\t\n\t\t\n\t\t\n\t\tpublic static function saveImage($res,$path,$info)\n\t\t{\n\t\t\tswitch ($info['mime']) {\n\t\t\t\tcase 'image/png':\n\t\t\t\tcase 'image/x-png':\n\t\t\t\t\timagepng($res,$path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/jpeg':\n\t\t\t\tcase 'image/jpg':\n\t\t\t\tcase 'image/pjpeg':\n\t\t\t\t\timagejpeg($res,$path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/gif':\n\t\t\t\t\timagegif($res,$path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/wbmp':\n\t\t\t\tcase 'image/bmp':\n\t\t\t\t\timagewbmp($res,$path);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate function _mergeImage($dstRes,$srcRes,$position,$dstInfo,$srcInfo,$tmd)\n\t\t{\n\t\t\timagecopymerge($dstRes,$srcRes,$position['x'],$position['y'],0,0,$srcInfo['width'],$srcInfo['height'],$tmd);\n\t\t\treturn $dstRes;\n\t\t}\n\t\t\n\t\t\n\t\tpublic static function openImg($path, $info)\n\t\t{\n\t\t\tswitch ($info['mime']) {\n\t\t\t\tcase 'image/png':\n\t\t\t\tcase 'image/x-png':\n\t\t\t\t\t$res = imagecreatefrompng($path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/jpeg':\n\t\t\t\tcase 'image/jpg':\n\t\t\t\tcase 'image/pjpeg':\n\t\t\t\t\t$res = imagecreatefromjpeg($path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/gif':\n\t\t\t\t\t$res = imagecreatefromgif($path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/wbmp':\n\t\t\t\tcase 'image/bmp':\n\t\t\t\t\t$res = imagecreatefromwbmp($path);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn $res;\n\t\t}\n\t\t\n\t\tpublic static function getPosition($dstInfo,$srcInfo,$pos)\n\t\t{\n\t\t\tswitch ($pos) {\n\t\t\t\tcase 1:\n\t\t\t\t\t$x = 0;\n\t\t\t\t\t$y = 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\t$x = ceil(($dstInfo['width'] - $srcInfo['width']) / 2);\n\t\t\t\t\t$y = 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\t$x = $dstInfo['width'] - $srcInfo['width'];\n\t\t\t\t\t$y = 0;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\tcase 4:\n\t\t\t\t\t$x = 0;\n\t\t\t\t\t$y = ceil(($dstInfo['height'] - $srcInfo['height']) /2 );\n\t\t\t\t\tbreak;\n\t\t\t\tcase 5:\n\t\t\t\t\t$x = ceil(($dstInfo['width'] - $srcInfo['width']) / 2);\n\t\t\t\t\t$y = ceil(($dstInfo['height'] - $srcInfo['height']) /2 );\n\t\t\t\t\tbreak;\n\t\t\t\tcase 6:\n\t\t\t\t\t$x = $dstInfo['width'] - $srcInfo['width'];\n\t\t\t\t\t$y = ceil(($dstInfo['height'] - $srcInfo['height']) /2 );\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\tcase 7:\n\t\t\t\t\t$x = 0;\n\t\t\t\t\t$y = $dstInfo['height'] - $srcInfo['height'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 8:\n\t\t\t\t\t$x = ceil(($dstInfo['width'] - $srcInfo['width']) / 2);\n\t\t\t\t\t$y = $dstInfo['height'] - $srcInfo['height'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 9:\n\t\t\t\t\t$x = $dstInfo['width'] - $srcInfo['width'];\n\t\t\t\t\t$y = $dstInfo['height'] - $srcInfo['height'];\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t$x = mt_rand(0,$dstInfo['width'] - $srcInfo['width']);\n\t\t\t\t\t$y = mt_rand(0,$dstInfo['height'] - $srcInfo['height']);\n\t\t\t\t\n\t\t\t}\n\n\t\t\treturn ['x' => $x, 'y' => $y];\n\t\t}\n\t\t\n\t\tprivate function _checkSize($dstInfo,$srcInfo)\n\t\t{\n\t\t\tif ($dstInfo['width'] < $srcInfo['width'] || $dstInfo['height'] < $srcInfo['height']) {\n\t\t\t\treturn false;\t\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\tpublic static  function getImageInfo($path)\n\t\t{\n\t\t\t$data = [];\n\t\t\t$info = getimagesize($path);\n\t\t\t$data['width'] = $info[0];\n\t\t\t$data['height'] = $info[1];\n\t\t\t$data['mime'] = $info['mime'];\n\t\t\t$path = pathinfo($path);\n\t\t\t$data['basename'] = $path['basename'];\n\t\t\t$data['subfix'] = $path['extension'];\n\t\t\treturn $data;\n\t\t}\n\t}\n```\n2、Model类\n```\n\t<?php\n\tnamespace Framework;\n\n\n\tclass Model\n\t{\n\t\t//连接\n\t\tprotected $link;\n\t\t//用户名\n\t\tprotected $user;\n\t\t//密码\n\t\tprotected $pwd;\n\t\t//字符集\n\t\tprotected $charset;\n\t\t//表前缀\n\t\tprotected $prefix;\n\t\t//库名\n\t\tprotected $dbName;\n\t\t//主机\n\t\tprotected $host;\n\t\t//表名\n\t\tprotected $table;\n\t\t//字段\n\t\tprotected $fields;\n\t\t//保存的查询、更新、添加的参数\n\t\tprotected $options;\n\t\t\n\t\t//初使化数据库连接\n\t\t//把一批成员属性都 初使化\n\t\tpublic function __construct(Array $config)\n\t\t{\n\t\t\t$this->host = $config['DB_HOST'];\n\t\t\t$this->user = $config['DB_USER'];\n\t\t\t$this->pwd = $config['DB_PWD'];\n\t\t\t$this->dbName = $config['DB_NAME'];\n\t\t\t$this->charset = $config['DB_CHARSET'];\n\t\t\t$this->prefix = $config['DB_PREFIX'];\n\t\t\t//连接\n\t\t\t$this->link = $this->connect();\n\t\t\t//判断是否连接失败\n\t\t\tif (!$this->link) {\n\t\t\t\texit('数据库连接失败');\n\t\t\t}\n\t\t\t//表名\n\t\t\t$this->table = $this->getTable();\n\n\t\t\t//字段\n\t\t\t$this->fields = $this->getFields();\n\t\t\t\n\t\t\t\n\t\t}\n\t\t\n\t\t\n\t\t//连接数库\n\t\tprotected function connect()\n\t\t{\n\t\t\t$conn = mysqli_connect($this->host,$this->user,$this->pwd);\n\t\t\t//连接失败\n\t\t\tif (!$conn) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t//选择库失败处理\n\t\t\tif (!mysqli_select_db($conn,$this->dbName)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\n\t\t\tmysqli_set_charset($conn,$this->charset);\n\t\t\t\n\t\t\treturn $conn;\n\t\t\t\n\t\t}\n\t\t\n\t\t//初始化表\n\t\t//（报错，我们再根据命名空间去解决，涉及到命名空间的类名）\n\t\tprotected function getTable()\n\t\t{\n\t\t\tif (isset($this->table)) {\n\t\t\t\t//用户设置 过以用户设置的为准\n\t\t\t\treturn $this->prefix . ltrim($this->table,$this->prefix);\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\tif ($pos = strpos(get_class($this),'\\\\')) {\n\t\t\t\t\t\n\t\t\t\t\treturn $this->prefix .  strtolower(str_replace(['Model','model'],'',substr(get_class($this),$pos + 1)));\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\n\t\t\t\t\t//用户没有设置过，以类名拼接前缀，给成成全新的表名\n\t\t\t\t\treturn $this->prefix .strtolower(substr(get_class($this),0,-5));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t//始初化字段\n\t\t//要把字段缓存到一个文件中去\n\t\t\n\t\tprotected function getFields()\n\t\t{\n\t\t\t//如果有字段的文件则说明曾经缓存过这个文件，直接包含进来即可\n\t\t\t//知道文件路径命名的规则 \n\t\t\t$filePath = './Cache/'.$this->table.'.php';\n\t\t\tif (file_exists($filePath)) {\n\t\t\t\treturn include $filePath;\n\t\t\t} else {\n\t\t\t\t$fields = $this->queryFields();\n\t\t\t\t\n\t\t\t\t$str = \"<?php \\nreturn \".var_export($fields,true).';?>';\n\t\t\t\t\n\t\t\t\tfile_put_contents($filePath,$str);\n\t\t\t}\n\t\t\t\n\t\t\treturn $fields;\n\t\t}\n\t\t\n\t\t//查询出字段\n\t\tprotected function queryFields()\n\t\t{\n\t\t\t$sql = 'desc '.$this->table;\n\t\t\t\n\t\t\t$data = $this->query($sql);\n\t\t\n\t\t\t\n\t\t\t$fields = [];\n\t\t\tforeach ($data as $key => $val) {\n\t\t\t\t$fields[] = $val['Field'];\n\t\t\t\tif ($val['Key'] == 'PRI') {\n\t\t\t\t\t$fields['_pk'] = $val['Field'];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn $fields;\n\t\t\t\n\t\t}\n\t\t\n\t\t//系统级的查询方法，设置 为public ，如果在外部想要调用的时候，想自定sql句的候，可以直接query\n\t\t//查询应的结果，这个仅供读取使用\n\t\tpublic function query($sql)\n\t\t{\n\t\t\t\n\t\t\t$result = mysqli_query($this->link,$sql);\n\t\t\t\n\t\t\tif ($result) {\n\t\t\t\t$data = [];\n\t\t\t\twhile($row = mysqli_fetch_assoc($result)) {\n\t\t\t\t\t$data[] = $row;\n\t\t\t\t}\n\t\t\t\treturn $data;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t//查询方法\n\t\t//准备好无需换的SQL语句\n\t\t//用户调用询的时候，将call里面保存进去的参数，一一替换sql语句\n\t\t//发送SQL语句\n\t\t//返回查询果\n\t\tpublic function select()\n\t\t{\n\t\t\t\n\t\t\t$sql = \"select %FIELDS% from %TABLE% %WHERE% %GROUP% %HAVING% %ORDER% %LIMIT%\";\n\t\t\t\n\t\t\t$newSql = str_replace(\n\t\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t\t'%FIELDS%',\n\t\t\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t\t\t\t'%GROUP%',\n\t\t\t\t\t\t\t\t'%HAVING%',\n\t\t\t\t\t\t\t\t'%ORDER%',\n\t\t\t\t\t\t\t\t'%LIMIT%',\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t\t$this->parseFields(),\n\t\t\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t\t\t\t$this->parseGroup(),\n\t\t\t\t\t\t\t\t$this->parseHaving(),\n\t\t\t\t\t\t\t\t$this->parseOrder(),\n\t\t\t\t\t\t\t\t$this->parseLimit(),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t$sql\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\n\t\t\t//为了在外面想知道自动生成的SQL语旬是神马的时候\n\t\t\t$this->sql = $newSql;\n\t\t\treturn $this->query($newSql);\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function  parseFields()\n\t\t{\n\t\t\t//因为我们对比字段的时候不需要对比主键是谁\n\t\t\t//因此，我干掉主键 \n\t\t\t$fields = $this->fields;\n\t\t\tunset($fields['_pk']);\n\t\t\t\n\t\t\t//用户向fileds('id,username,password') 先将其切割，用,号切割explode\n\t\t\t//如果用户传的是一个数组fileds(['id','username','password'])，则对比应的字段，算交集\n\t\t\t//array_intersect\n\t\t\t//array_intersect_key\n\t\t\t//array_intersect_assoc\n\t\t\t//array_intersect_ukey\n\t\t\tif (isset($this->options['fields'][0])) {\n\t\t\t\t//是数组的时怎么处理法\n\t\t\t\tif (is_array($this->options['fields'][0])) {\n\t\t\t\t\tforeach($this->options['fields'][0] as $key => $val) {\n\t\t\t\t\t\tif (!in_array($val,$fields)) {\n\t\t\t\t\t\t\tunset($this->options['fields'][0][$key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn join(',',$this->options['fields'][0]);\n\t\t\t\t\t\n\t\t\t\t} elseif (is_string($this->options['fields'][0])) {\n\t\t\t\t\t//是字符串的时候先变为组再处理\n\t\t\t\t\t$this->options['fields'][0] = explode(',',$this->options['fields'][0]);\n\t\t\t\t\t\n\t\t\t\t\tforeach($this->options['fields'][0] as $key => $val) {\n\t\t\t\t\t\tif (!in_array($val,$fields)) {\n\t\t\t\t\t\t\tunset($this->options['fields'][0][$key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn join(',',$this->options['fields'][0]);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\treturn join(',',$fields);\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t//判断用户有没有手动指定过查询哪个用\n\t\t//如果指定过，则以用户设定的options里面的表为准\n\t\t//如果没有设定过，则以默认的为准\n\t\tprotected function  parseTable()\n\t\t{\n\t\t\tif (isset($this->options['table'][0])) {\n\t\t\t\treturn $this->options['table'][0];\n\t\t\t} else {\n\t\t\t\treturn $this->table;\n\t\t\t}\n\t\t}\n\t\t\n\t\t//看看用户是否设置过where，如果设置过以用户设置 的为准\n\t\t//如果没有设置 则为空\n\t\tprotected function  parseWhere()\n\t\t{\n\t\t\tif (isset($this->options['where'][0])) {\n\t\t\t\treturn 'WHERE '.$this->options['where'][0];\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\tprotected function  parseGroup()\n\t\t{\n\t\t\tif (isset($this->options['group'][0])) {\n\t\t\t\treturn 'GROUP BY '.$this->options['group'][0];\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\n\t\tprotected function  parseHaving()\n\t\t{\n\t\t\tif (isset($this->options['having'][0])) {\n\t\t\t\treturn 'HAVING '.$this->options['having'][0];\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t\t\n\t\tprotected function  parseOrder()\n\t\t{\n\t\t\tif (isset($this->options['order'][0])) {\n\t\t\t\treturn 'ORDER BY '.$this->options['order'][0];\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t\t\n\t\t//limit可以有以下几种传法\n\t\t//用户传进来的是一个整 数，就是查询指定的条数\n\t\t//用户传进来的是一个数组，则数组中的第一个元素为$offset,第二个元素为$num\n\t\t//如果户传进来的是一个字符串，则以用户传的为准\n\t\tprotected function  parseLimit()\n\t\t{\n\t\t\tif (isset($this->options['limit'][0])) {\n\t\t\t\t\n\t\t\t\tif (is_int($this->options['limit'][0])) {\n\t\t\t\t\treturn 'LIMIT '.$this->options['limit'][0];\n\t\t\t\t} elseif (is_array($this->options['limit'][0])) {\n\t\t\t\t\treturn 'LIMIT '. join(',',$this->options['limit'][0]);\n\t\t\t\t} else {\n\t\t\t\t\treturn 'LIMIT ' . $this->options['limit'][0];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t//增加方法\n\t\tpublic function add($data)\n\t\t{\n\t\t\t\n\t\t\n\t\t\t$sql = \"insert into %TABLE%(%FIELDS%) values(%VALUES%)\";\n\t\t\t//insert into bbs_user(username,sex) values('liwenkai','null');\n\t\t\t$newSql = str_replace(\n\t\t\t\t\t\tarray('%TABLE%','%FIELDS%','%VALUES%'),\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t\t$this->parseInsertFields($data),\n\t\t\t\t\t\t\tjoin(',',$this->parseValue($data)),\n\t\t\t\t\t\t),\n\t\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $newSql;\n\t\t\t\n\t\t\t//echo $newSql;\n\t\t\treturn $this->exec($newSql,true);\n\t\t}\n\t\t\n\t\tprotected function parseValue($data)\n\t\t{\n\t\t\tif (is_string($data)) {\n\t\t\t\t$data = '\\''.$data.'\\'';\n\t\t\t} elseif (is_array($data)) {\n\t\t\t\t$data = array_map(array($this,'parseValue'),$data);\n\t\t\t} elseif (is_null($data)) {\n\t\t\t\t$data = 'null';\n\t\t\t}\n\t \t\t\n\t\t\treturn $data;\n\t\t}\n\t\t\n\t\tprotected function parseInsertFields(&$data)\n\t\t{\n\t\t\tforeach ($data as $key => $value) {\n\t\t\t\tif (!in_array($key,$this->fields)) {\n\t\t\t\t\tunset($data[$key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn join(',',array_keys($data));\n\t\t}\n\t\t\n\t\t//更新方法\n\t\tpublic function update($data)\n\t\t{\n\t\t\t$sql = \"update %TABLE% set %SETS% %WHERE% %ORDER% %LIMIT%\";\n\t\t\t$newSql = str_replace(\n\t\t\t\t\t\t\tarray('%TABLE%','%SETS%','%WHERE%','%ORDER%','%LIMIT%'),\n\t\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t\t\t$this->parseSets($data),\n\t\t\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t\t\t\t$this->parseOrder(),\n\t\t\t\t\t\t\t\t$this->parseLimit(),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t$sql\n\t\t\t\t\t\t);\n\t\t\t\t\n\t\t\t\n\t\t\t$this->sql = $newSql;\n\t\t\treturn $this->exec($newSql);\n\t\t\t\n\t\t}\n\t\t\n\t\tpublic function parseSets($data)\n\t\t{\n\t\t\t$sets = [];\n\t\t\t\n\t\t\tforeach ($data as $key => $val) {\n\t\t\t\tif (in_array($key,$this->fields)) {\n\t\t\t\t\t\n\t\t\t\t\t$sets[] = $key.'='.$this->parseValue($val);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn join(',',$sets) ;\n\t\t\t\n\t\t}\n\t\t\n\t\t//删除方法\n\t\tpublic function delete()\n\t\t{\n\t\t\t$sql = \"delete from %TABLE% %WHERE% %ORDER% %LIMIT%\";\n\t\t\t\n\t\t\t$newSql = str_replace(\n\t\t\t\t\t\tarray('%TABLE%','%WHERE%','%ORDER%','%LIMIT%'),\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t\t\t$this->parseOrder(),\n\t\t\t\t\t\t\t$this->parseLimit(),\n\t\t\t\t\t\t),\n\t\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $newSql;\n\t\t\t\n\t\t\treturn $this->exec($newSql);\n\t\t\n\t\t}\n\t\t\n\t\tpublic function exec($sql, $isInsertId = false)\n\t\t{\n\t\t\t$result = mysqli_query($this->link,$sql);\n\t\t\t\n\t\t\tif ($result) {\n\t\t\t\t\n\t\t\t\tif ( $isInsertId ) {\n\t\t\t\t\t//insert 返回自动增长的ID\n\t\t\t\t\treturn mysqli_insert_id($this->link);\n\t\t\t\t} else {\n\t\t\t\t\t\n\t\t\t\t\t//update delete只直返回 受影响行数\n\t\t\t\t\treturn mysqli_affected_rows($this->link);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\t\t\n\t\t}\n\t\t\n\t\t//查最大值 \n\t\tpublic function count($field = null)\n\t\t{\n\t\t\tif (is_null($field)) {\n\t\t\t\t$field = $this->fields['_pk'];\n\t\t\t}\n\t\t\t\n\t\t\t$sql = \"select count($field) as num  from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray(\n\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t$data =  $this->query($sql);\n\t\t\t\n\t\t\treturn $data[0]['num'];\n\t\t\t\n\t\t}\n\t\t\n\t\t//最小值 \n\t\tpublic function min($field = null)\n\t\t{\n\t\t\tif (is_null($field)) {\n\t\t\t\t$field = $this->fields['_pk'];\n\t\t\t}\n\t\t\t\n\t\t\t$sql = \"select min($field) as num  from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray(\n\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t$data =  $this->query($sql);\n\t\t\t\n\t\t\treturn $data[0]['num'];\n\t\t\t\n\t\t}\n\t\t\n\t\tpublic function sum($field = null)\n\t\t{\n\t\t\tif (is_null($field)) {\n\t\t\t\t$field = $this->fields['_pk'];\n\t\t\t}\n\t\t\t\n\t\t\t$sql = \"select SUM($field) as num  from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray(\n\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t$data =  $this->query($sql);\n\t\t\t\n\t\t\treturn $data[0]['num'];\n\t\t\t\n\t\t}\n\t\t\n\t\t//求最大值 \n\t\tpublic function max($field = null)\n\t\t{\n\t\t\tif (is_null($field)) {\n\t\t\t\t$field = $this->fields['_pk'];\n\t\t\t}\n\t\t\t\n\t\t\t$sql = \"select max($field) as num  from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray(\n\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t$data =  $this->query($sql);\n\t\t\t\n\t\t\treturn $data[0]['num'];\n\t\t\t\n\t\t}\n\t\t\n\t\t//求平均数\n\t\tpublic function avg($field = null)\n\t\t{\n\t\t\tif (is_null($field)) {\n\t\t\t\t$field = $this->fields['_pk'];\n\t\t\t}\n\t\t\t\n\t\t\t$sql = \"select avg($field) as num  from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray(\n\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t$data =  $this->query($sql);\n\t\t\t\n\t\t\treturn $data[0]['num'];\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function getBy($field,$value)\n\t\t{\n\t\t\t\n\t\t\t$sql = \"select %FIELDS% from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray('%FIELDS%','%TABLE%','%WHERE%'),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseFields(),\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t'WHERE '.$field . \"='$value'\",\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t\n\t\t\treturn $this->query($sql);\n\t\t\t\n\t\t}\n\t\t\n\t\t//自动的一个按照字段来查询的智能化查询方法\n\t\t\n\t\t//__call方法，针对用户请求的limit()  order()  group having等将其保存到options中去\n\t\t//并且判断方法的法性\n\t\t//并且return $this，让其能连贯操作。ORM （对象映射模型）$user->limit()->order()\n\t\tpublic function __call($func,$args)\n\t\t{\n\t\t\t$allow = ['where','table','fields','order','limit','group','having'];\n\t\t\t$func = strtolower($func);\n\t\t\t\n\t\t\tif (in_array($func,$allow)) {\n\t\t\t\t$this->options[$func] = $args;\n\t\t\t\treturn $this;\n\t\t\t} elseif(substr($func,0,5) == 'getby'){\n\t\t\t\t$field = substr($func,5);\n\t\t\t\n\t\t\t\tif (in_array($field,$this->fields)) {\n\t\t\t\t\treturn $this->getby($field,$args[0]);\n\t\t\t\t}\n\t\t\t}else {\n\t\t\t\texit('方法不合法');\n\t\t\t}\n\t\t}\n\t\t\n\t\t//对象销毁者关闭页面的时候，自动执行\n\t\tpublic function __destruct()\n\t\t{\n\t\t\tmysqli_close($this->link);\n\t\t}\n\t}\n```\n3、Page类\n```\n\t<?php\n\tnamespace Framework;\n\n\n\t//声明page类\n\tclass Page\n\t{\n\t\t//url\n\t\tprotected $url;\n\t\t//总页数\n\t\tprotected $pageCount;\n\t\t//总条数\n\t\tprotected $total;\n\t\t//每页显示数\n\t\tprotected $num;\n\t\t//当前页\n\t\tprotected $page;\n\t\t\n\t\t\n\t\t//初使化成员属性\n\t\tpublic function __construct($total, $num = 5)\n\t\t{\n\t\t\t//总条数\n\t\t\t$this->total = ($total > 0) ? (int) $total : 1;\n\t\t\t//每页显示数\n\t\t\t$this->num = $num;\n\t\t\t//总页数\n\t\t\t$this->pageCount = $this->getPageCount();\n\t\t\t//当前页\n\t\t\t$this->page = $this->getCurrentPage();\n\t\t\t//url\n\t\t\t$this->url = $this->getUrl();\n\t\t}\n\t\t\n\t\t//一次性返回所有的分页信息\n\t\tpublic function rendor()\n\t\t{\n\t\t\treturn [\n\t\t\t\t'first' => $this->first(),\n\t\t\t\t'next' => $this->next(),\n\t\t\t\t'prev' => $this->prev(),\n\t\t\t\t'end' => $this->end(),\n\t\t\t];\n\t\t}\n\t\t\n\t\t//limit方法，在未来分页数据查询时候，直接返回对应的limit 0,5 这样的字符串\n\t\tpublic function limit()\n\t\t{\n\t\t\t$offset = ($this->page - 1) * $this->num;\n\t\t\t\n\t\t\t$str = $offset.','.$this->num;\n\t\t\t\n\t\t\treturn $str;\n\t\t}\n\t\t\n\t\t\n\t\tprotected function end()\n\t\t{\n\t\t\treturn $this->setQueryString('page='.$this->pageCount);\n\t\t}\n\t\t\n\t\t\n\t\t//上一页\n\t\tprotected function  prev()\n\t\t{\n\t\t\t\n\t\t\t$page = ($this->page <=1) ? 1 : ($this->page -1);\n\t\t\t\n\t\t\treturn $this->setQueryString('page='.$page);\n\t\t\t\n\t\t}\n\t\t\n\t\t//下一页\n\t\tprotected function next()\n\t\t{\n\t\t\t\n\t\t\t$page = ($this->page >= $this->pageCount) ?  $this->pageCount : ($this->page + 1);\n\t\t\t\n\t\t\treturn $this->setQueryString('page='.$page);\n\t\t}\n\t\t\n\t\t\n\t\t//首页\n\t\tprotected function first()\n\t\t{\n\t\t\t//设置查询的page页码为第一页，即为首页\n\t\t\treturn $this->setQueryString('page=1');\n\t\t\t\n\t\t}\n\t\t\n\t\t\n\t\t//一种况有?，一种情况是没有?的情况\n\t\tprotected function setQueryString($page)\n\t\t{\n\t\t\t//如果url当中有问号\n\t\t\tif (strpos($this->url, '?')) {\n\t\t\t\treturn $this->url.'&'.$page;\n\t\t\t} else {\n\t\t\t//如果url当中没有问号\n\t\t\t\treturn $this->url.'?'.$page;\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\tprotected function getUrl()\n\t\t{\n\t\t\t$path = $_SERVER['REQUEST_URI'];\n\t\t\t//先要获取户传进来的URI\n\t\t\t//用parse_url 解释URI\n\t\t\t$par = parse_url($path);\n\t\t\t\n\t\t\t\n\t\t\t//判断是否设置过query\n\t\t\tif (isset($par['query'])) {\n\t\t\t\t\n\t\t\t\tparse_str($par['query'],$query);\n\t\t\t\t\n\t\t\t\t//检查query里面是否有page,如果有就干掉page\n\t\t\t\tunset($query['page']);\n\t\t\t\t\n\t\t\t\t$path = $par['path'].'?'.http_build_query($query);\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t$path = rtrim($path,'?');\n\t\t\t\n\t\t\t\n\t\t\t//协议：主机：端口：文件和请求\n\t\t\t//判断是否定义过端口，并且端口是否为443，如果为443则是https协议，否则就是http协议\n\t\t\t$protocal = (isset($_SERVER['SERVER_PORT']) && $_SERVER['SERVER_PORT'] == 443) ?'https://' : 'http://';\n\t\t\t\n\t\t\tif (80 == $_SERVER['SERVER_PORT'] || 443 == $_SERVER['SERVER_PORT']) {\n\t\t\t\t$url = $protocal.$_SERVER['SERVER_NAME'].$path;\n\t\t\t} else {\n\t\t\t\t//http://www.baidu.com:8012/index.php?username=liwenkai\n\t\t\t\t\n\t\t\t\t$url = $protocal.$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].$path;\n\t\t\t}\n\t\t\t\n\t\t\t//拼接 path. ? . 全新组合成的URI\n\t\t\treturn $url;\n\t\t}\n\t\t\n\t\t\n\t\tprotected function getCurrentPage()\n\t\t{\n\t\t\t//如果用户设置过page信息，就返回page相关信息，强制转为整型\n\t\t\tif (isset($_GET['page'])) {\n\t\t\t\t//得到页码\n\t\t\t\t$page = (int) $_GET['page'];\n\t\t\t\t\n\t\t\t\t//你的页码不能够大于总页数\n\t\t\t\tif ($page > $this->pageCount) {\n\t\t\t\t\t$page = $this->pageCount;\n\t\t\t\t}\n\t\t\t\t//你的页码不能小于1\n\t\t\t\tif ($page < 1) {\n\t\t\t\t\t$page = 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t$page = 1;\n\t\t\t}\n\t\t\t\n\t\t\treturn $page;\n\t\t}\n\t\t\n\t\tprotected function getPageCount()\n\t\t{\n\t\t\t//计算总页数，使用到了进一法取整\n\t\t\treturn ceil($this->total / $this->num);\n\t\t}\n\t\t\n\t}\n```\n4、Tpl类\n```\n\t<?php\n\tnamespace Framework;\n\n\n\tclass Tpl\n\t{\n\t\t\n\t\t//缓存目录\n\t\tprotected $cacheDir = './Cache/';\n\t\t//模版目录\n\t\tprotected $tplDir = './Tpl/';\n\t\t//保存变量的成员方法\n\t\tprotected $vars = [];\n\t\t//缓存有效期\n\t\tprotected $cacheLifeTime = 3600;\n\t\t\n\t\t\n\t\t//初使化成员属性\n\t\t//判断缓存目录是否存在\n\t\t//判断模版路径是否存在，如果不存在要创建，如果不可写，要改权限\n\t\t//初化缓存时间\n\t\tpublic function __construct($tplDir = null, $cacheDir = null ,$cacheLifeTime = null)\n\t\t{\n\t\t\tif (isset($tplDir)) {\n\t\t\t\tif ($this->_checkDir($tplDir)) {\n\t\t\t\t\t$this->tplDir = rtrim($tplDir,'/').'/';\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (isset($cacheDir)) {\n\t\t\t\tif ($this->_checkDir($cacheDir)) {\n\t\t\t\t\t$this->cacheDir = rtrim($cacheDir,'/').'/';\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (isset($cacheLifeTime)) {\n\t\t\t\t$this->cacheLifeTime = $cacheLifeTime;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tprivate function _checkDir($path)\n\t\t{\n\t\t\tif (!file_exists($path) || !is_dir($path)) {\n\t\t\t\treturn mkdir($path,0755,true);\n\t\t\t}\n\t\t\t\n\t\t\tif (!is_writable($path) || !is_readable($path)) {\n\t\t\t\treturn chmod($path,0755);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\t//$tpl->assign()->assign()->display();\n\t\t\n\t\t//分配变量\n\t\tpublic function assign($key,$val)\n\t\t{\n\t\t\t$this->vars[$key] = $val;\n\t\t\t//return $this;\n\t\t}\n\t\t\n\t\t//display显示模版内容\n\t\tpublic function display($file,$isExecute = true, $uri = null)\n\t\t{\n\t\t\t//获得模版路径（模版目录路径 + 模版文件）\n\t\t\t$tplFilePath = $this->tplDir.$file;\n\t\t\t\n\t\t\t//判断文件是否存在\n\t\t\tif (!file_exists($tplFilePath)) {\n\t\t\t\techo $tplFilePath;\n\t\t\t\texit('模板文件不存在');\n\t\t\t}\n\t\t\t//获得编译文件路径（组合一个新的） page.php?page=3\n\t\t\t$cacheFile = md5($file.$uri).'.php';\n\t\t\t\n\t\t\t$cacheFilePath = $this->cacheDir . $cacheFile;\n\t\t\t\n\t\t\t//检测是否编译过、是否修改过模版文件，如果编译，并且在有效期内，则不编译\n\t\t\tif (!file_exists($cacheFilePath)) {\n\t\t\t\t$html = $this->compile($tplFilePath);\n\t\t\t} else {\n\t\t\t\t//如果修改过模版文件，则删除原有的编译文件重新编译\n\t\t\t\tif (filemtime($tplFilePath) > filemtime($cacheFilePath)) {\n\t\t\t\t\tunlink($cacheFilePath);\n\t\t\t\t\t$html = $this->compile($tplFilePath);\n\t\t\t\t}\n\t\t\t\n\t\t\t\t// 文件创建时间 + 缓存有效期 > time(当前时间) 没有过期，否则过期了\n\t\t\t\t//如果大于time 没过期\n\t\t\t\n\t\t\t\t$isTimeout = (filemtime($tplFilePath) + $this->cacheLifeTime > time()) ? false : true;\n\t\t\t\t\n\t\t\t\tif ($isTimeout) {\n\t\t\t\t\t$html = $this->compile($tplFilePath);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t//编译\n\t\t\tif (isset($html)) {\n\t\t\t\tif (!file_put_contents($cacheFilePath,$html)) {\n\t\t\t\t\texit('编译文件写入失败');\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t//判断是否需要执行\n\t\t\t//如果不需要执行则，则不包含 ，不extract变量，反之则不然\n\t\t\tif ($isExecute) {\n\t\t\t\textract($this->vars);\n\t\t\t\tinclude $cacheFilePath;\n\t\t\t}\n\t\t\n\t\t\n\t\t}\n\t\t\n\t\tprotected function compile($tplFilePath)\n\t\t{\n\t\t\t$html = file_get_contents($tplFilePath);\n\t\t\t\n\t\t\t$keys = [\n\t\t\t\t'{if %%}' => '<?php if(\\1): ?>',\n\t            '{else}' => '<?php else : ?>',\n\t            '{else if %%}' => '<?php elseif(\\1) : ?>',\n\t            '{elseif %%}' => '<?php elseif(\\1) : ?>',\n\t            '{/if}' => '<?php endif;?>',\n\t            '{$%%}' => '<?=$\\1;?>',\n\t            '{foreach %%}' => '<?php foreach(\\1) :?>',\n\t            '{/foreach}' => '<?php endforeach;?>',\n\t            '{for %%}' => '<?php for(\\1):?>',\n\t            '{/for}' => '<?php endfor;?>',\n\t            '{while %%}' => '<?php while(\\1):?>',\n\t            '{/while}' => '<?php endwhile;?>',\n\t            '{continue}' => '<?php continue;?>',\n\t            '{break}' => '<?php break;?>',\n\t            '{$%% = $%%}' => '<?php $\\1 = $\\2;?>',\n\t            '{$%%++}' => '<?php $\\1++;?>',\n\t            '{$%%--}' => '<?php $\\1--;?>',\n\t            '{comment}' => '<?php /* ',\n\t            '{/comment}' => ' */ ?>',\n\t            '{/*}' => '<?php /* ',\n\t            '{*/}' => '* ?>',\n\t            '{section}' => '<?php ',\n\t            '{/section}' => '?>',\n\t\t\t\t'{{%%(%%)}}' => '<?=\\1(\\2);?>',\n\t\t\t\t'{date(%%,$%%)}'=> '<?=date(\\1,$\\2);?>',\n\t\t\t\t'{include %%}' => '<?php include \"\\1\";?>',\n\t\t\t\t\n\t\t\t];\n\t\t\t\n\t\t\tforeach ($keys as $key => $val) {\n\t\t\t\t\n\t\t\t\t$pattern = '#'. str_replace('%%','(.+)',preg_quote($key,'#')) .'#imsU';\n\t\t\t\t$replace = $val;\n\t\t\t\t\n\t\t\t\tif (stripos($pattern,'include')) {\n\t\t\t\t\t//处理一次回调\n\t\t\t\t\n\t\t\t\t\t$html = preg_replace_callback($pattern,array($this,'parseInclude'),$html);\n\t\t\t\t} else {\n\t\t\t\t\t\n\t\t\t\t\t$html = preg_replace($pattern,$replace,$html);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn $html;\n\t\t}\n\t\t\n\t\tprotected function parseInclude($data)\n\t\t{\n\t\t\t\n\t\t\t$file = str_replace(['\\'','\"'],'',$data[1]);\n\t\t\t$path = $this->parsePath($file);\n\t\t\t$this->display($file,false);\n\t\t\t\n\t\t\treturn '<?php include \"'.$path.'\";?>';\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function parsePath($file)\n\t\t{\n\t\t\t$path = $this->cacheDir . md5($file).'.php';\n\t\t\treturn $path;\n\t\t\t\n\t\t}\n\t\t\n\t\t//删除缓存文件（递归）\n\t\tpublic function clearCache()\n\t\t{\n\t\t\tself::delDir($this->cacheDir);\n\t\t}\n\t\t\n\t\tpublic static function delDir($path)\n\t\t{\n\t\t\t$res = opendir($path);\n\t\t\t\n\t\t\twhile($file = readdir($res)) {\n\t\t\t\tif ($file == '.' || $file == '..') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t$newPath = $path.'/'.$file;\n\t\t\t\t\n\t\t\t\tif (is_dir($newPath)) {\n\t\t\t\t\tself::delDir($newPath);\n\t\t\t\t} else{\n\t\t\t\t\tunlink($newPath);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t}\n\t \t}\n\t\t\n\t}\n```\n5、Upload类\n```\n\t<?php\n\tnamespace Framework;\n\n\n\tclass Upload\n\t{\n\t\t//上传到哪个目录\n\t\tprotected $path = 'Upload/';\n\t\t//准许的MIME\n\t\tprotected $allowmime = ['image/png','image/jpg','image/jpeg','image/pjpeg','image/bmp','image/wbmp','image/gif','image/x-png'];\n\t\t//准许的后缀\n\t\tprotected $allowsubfix = ['jpg','png','jpeg','gif','bmp'];\n\t\t//准许的大小\n\t\tprotected $allowsize = 2097152;\n\t\t//是否准许随机文件名\n\t\tprotected $israndname = true;\n\t\t//是否准许日期目录\n\t\tprotected $isdatepath = true;\n\t\t//文件的大小\n\t\tprotected $size;\n\t\t//文件的原名\n\t\tprotected $orgname;\n\t\t//文件的新名\n\t\tprotected $newname;\n\t\t//文件的后缀\n\t\tprotected $subfix;\n\t\t//文件的MIME类型\n\t\tprotected $mime;\n\t\t//文件的新路径\n\t\tprotected $newpath;\n\t\t//错误号\n\t\tprotected $errorno;\n\t\t//错误信息\n\t\tprotected $errorinfo;\n\t\t//临时文件\n\t\tprotected $tmpfile;\n\t\t//前缀\n\t\tprotected $prefix;\n\t\t\n\t\t\n\t\t//初使化成员属性，传进来的东西特别多，我们要求以数组的形式来传递\n\t\t//foreach循环，取出键名、值\n\t\t//将键名设置为成员属性名，将键值设为成员属性值\n\t\t//注意键名的合法性\n\t\t// errorInfo   errorinfo\n\t\tpublic function __construct(Array $config = [])\n\t\t{\n\t\t\n\t\t\tforeach ($config as $key => $value) {\n\t \n\t\t\t\t$this->setOption($key,$value);\n\t\t\t}\n\t\t\n\t\t}\n\t\t\n\t\tprotected function setOption($key,$value)\n\t\t{\n\t\t\t$key = strtolower($key);\n\t\t\t\n\t\t\t$allPro = get_class_vars(get_class($this));\n\t\t\t//var_dump($allpro);\n\t\t\tif (array_key_exists($key,$allPro)) {\n\t\t\t\t$this->$key = $value;\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t//设置一个get方法专门获得新路径\n\t\t\n\t\t//设置 一个get方法专门来获得错误信息\n\t\t\n\t\t//成员方法上传方法\n\t\tpublic function uploadFile($field)\n\t\t{\n\t\t\t//var_dump($field);die;\n\t\t\t//检测路径用户是否定义过，如果没有定义失败\n\t\t\tif (!file_exists($this->path)) {\n\t\t\t\techo '11111111111';\n\t\t\t\t$this->setOption('errorNo',-1);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t//目录权限检测\n\t\t\tif (!$this->checkPath()) {\n\t\t\t\t$this->setOption('errorNo',-2);\n\t\t\t\treturn false;\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t//获得$_FILES当中五个基本信息\n\t\t\t$name = $_FILES[$field]['name'];\n\t\t\t$size = $_FILES[$field]['size'];\n\t\t\t$type = $_FILES[$field]['type'];\n\t\t\t \n\t\t\t$tmpName = $_FILES[$field]['tmp_name'];\n\t\t\t$error = $_FILES[$field]['error'];\n\t\t\t\n\t\t\t//var_dump($_FILES);die;\n\t\t\t//传入到一个成员方法里面进行设置\n\t\t\tif (!$this->setFiles($name,$size,$type,$tmpName,$error)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t//检测MIME是否合法，检测后缀是否合法，检测文件大小是否超过了自定义的大小\n\t\t\tif (!$this->checkMime() || !$this->checkSubfix() || !$this->checkSize()) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t//新名\n\t\t\t$this->newname = $this->getNewName();\n\t\t\t\n\t\t\t//新路径处理\n\t\t\t$this->newpath = $this->getNewPath();\n\t\t\n\t\t\t//是否是上传文件\n\t\t\t//如果是上传文件移动上传文件至指定的目录\n\t\t\t//如果成员return true\n\t\t\tif( $this->move()){\n\t\t\t\t\n\t\t\t\treturn $this->newpath . $this->newname;\n\t\t\t}\n\t\t\t\t\n\t\t\n\t\t}\n\t\t\n\t\tprotected function move()\n\t\t{\n\t\t\tif (!is_uploaded_file($this->tmpfile)) {\n\t\t\t\t$this->setOption('errorNo',-6);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\n\t\t\t//var_dump($this-tmpfile);\n\t\t\tif (move_uploaded_file($this->tmpfile,$this->newpath.$this->newname)) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\t$this->setOption('errorNo',-7);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\tpublic function getNewPath()\n\t\t{\n\t\t\t$this->path = rtrim($this->path,'/').'/';\n\t\t\t\n\t\t\tif ($this->isdatepath) {\n\t\t\t\t$newpath = $this->path.date('Y/m/d/');\n\t\t\t\tif (!file_exists($newpath)) {\n\t\t\t\t\tmkdir($newpath,0755,true);\n\t\t\t\t}\n\t\t\t\treturn $newpath;\n\t\t\t} else {\n\t\t\t\treturn $this->path;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function getNewName()\n\t\t{\n\t\t\tif ($this->israndname) {\n\t\t\t\t\n\t\t\t\treturn $this->prefix . uniqid() . '.' . $this->subfix;\n\t\t\t} else {\n\t\t\t\treturn $this->prefix . $this->orgname;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprotected function checkSize()\n\t\t{\n\t\t\tif ($this->size > $this->allowsize) {\n\t\t\t\n\t\t\t\t$this->setOption('errorNo',-5);\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function checkSubFix()\n\t\t{\n\t\t\n\t\t\tif (in_array($this->subfix,$this->allowsubfix)) {\n\t\t\t\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\t$this->setOption('errorNo',-4);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprotected function checkMime()\n\t\t{\n\t\t\tif (in_array($this->mime,$this->allowmime)) {\n\t\t\t\t\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\t$this->setOption('errorNo',-3);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t\n\t\tprotected function setFiles($name,$size,$type,$tmpName,$error) {\n\t\t\t//1 2 3 4 6 7  0(正常)\n\t\t\tif ($error) {\n\t\t\t\t$this->setOption('errorNo',$error);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t$this->orgname = $name;\n\t\t\t$this->size = $size;\n\t\t\t$this->tmpfile = $tmpName;\n\t\t\t$this->mime = $type;\n\t\t\t\n\t\t\t//后缀没处理\n\t\t\t$info = pathinfo($name);\n\t\t\t$this->subfix = $info['extension'];\n\t\t\t\n\t\t\treturn true;\n\t\t\t/*\n\t\t\t$arr = explode('.',$name);\n\t\t\t$this->subfix = array_pop($arr);\n\t\t\t\n\t\t\t\n\t\t\t$arr = explode('.',$name);\n\t\t\t$this->subfix = $arr[count($arr)-1];\n\t\t\t\n\t\t\t$pos = strrpos($name,'.');\n\t\t\techo substr($name,$pos + 1);\n\t\t\t*/\n\t\t}\n\t\t\n\t\tprotected function checkPath()\n\t\t{\n\t\t\t//检测路径是否是目录，如果不存在创建\n\t\t\tif (!is_dir($this->path)) {\n\t\t\t\treturn mkdir($this->path,0755,true);\n\t\t\t}\n\t\t\t//检测路径是否可写，如果不写写更改权限\n\t\t\tif (!is_writeable($this->path) ||  !is_readable($this->path)) {\n\t\t\t\treturn chmod($this->path,0755);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\tprotected function getErrorInfo()\n\t\t{\n\t\t\tswitch ($this->errorno) {\n\t\t\t\tcase 1:\n\t\t\t\t\t$str = '上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\t$str = '上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\t$str = '部份件被上传';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\t$str = '没有文件被上传';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 6:\n\t\t\t\t\t$str = '找不到临时文件夹';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 7:\n\t\t\t\t\t$str = '临时文件写入失败';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -1:\n\t\t\t\t\t$str = '自定义的上传路径不存在';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -2:\n\t\t\t\t\t$str = '没有权限';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -3:\n\t\t\t\tcase -4:\n\t\t\t\t\t$str = '类型或后缀不准许';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -5:\n\t\t\t\t\t$str = '超过了自定义的大小';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -6:\n\t\t\t\t\t$str = '不是上传文件';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -7:\n\t\t\t\t\t$str = '移动上传文件失败';\n\t\t\t\t\tbreak;\n\t\t\t\t\n\t\t\t}\n\t\t\treturn $str;\n\t\t}\n\t\t\n\t\tpublic function __get($key)\n\t\t{\n\t\t\tif (in_array($key, ['newpath','newname','errorno','size'])) {\n\t\t\t\tvar_dump($key);\n\t\t\t\treturn $this->$key;\n\t\t\t} else if ($key == 'errorinfo') {\n\t\t\t\treturn $this->getErrorInfo();\n\t\t\t}\n\t\t}\n\t}\n```\n6、Verify类\n```\n\t<?php\n\tnamespace Framework;\n\n\n\tclass Verify\n\t{\n\t\t//宽\n\t\tprotected $width;\n\t\t//高\n\t\tprotected $height;\n\t\t//图片类型\n\t\tprotected $imgType;\n\t\t//文字类型\n\t\tprotected $codeType;\n\t\t//文字的个数\n\t\tprotected $num;\n\t\t//保存的验证码字符串\n\t\tprotected $verifyCode;\n\t\t//保存验证码资源的一个成员属性\n\t\tprotected $res;\n\t\t\n\t\t\n\t\t//初始化成员\n\t\t//上面这些参数\n\t\tpublic function __construct($width = 100, $height = 50, $imgType = 'png', $codeType = 3, $num = 4)\n\t\t{\n\t\t\t$this->width = $width;\n\t\t\t$this->height = $height;\n\t\t\t$this->imgType = $imgType;\n\t\t\t$this->codeType = $codeType;\n\t\t\t$this->num = $num;\n\t\t\t$this->verifyCode = $this->createVerifyCode();\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function  createVerifyCode()\n\t\t{\n\t\t\t$string = '';\n\t\t\t\n\t\t\tswitch ($this->codeType) {\n\t\t\t\tcase 1:\n\t\t\t\t\t$string = implode('',array_rand(range(0,9),$this->num));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\t$string = join('',array_rand(array_flip(range('a','z')),4));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\t/*\n\t\t\t\t\tfor ($i = 0; $i < $this->num; $i++) {\n\t\t\t\t\t\t$r= mt_rand(0,2);\n\t\t\t\t\t\tswitch ($r) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\t$ascii = mt_rand(48,57);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\t\t$ascii = mt_rand(65,90);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\t$ascii = mt_rand(97,122);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$string .= chr($ascii);\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t\t$str = 'abcdefghijkmnpqrstuvwxzABCDEFGHJKLMNPQRSTUVWXYZ23456789';\n\t\t\t\t\t$string = substr(str_shuffle($str),0,$this->num);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\treturn $string;\n\t\t}\n\t\t\n\t\t//调验证码显示的一个方法 output\n\t\t//1.画图\n\t\t//2.分配颜色(写两个成员方法，调的时候直接调对应的成员方法即可)\n\t\t//3.背景填充\n\t\t//4.画干扰点\n\t\t//5.画干扰线\n\t\t//6.写字 \n\t\t//7. 输出类型\n\t\t//8. 输出图片\n\t\tpublic function outImg()\n\t\t{\n\t\t\t$this->createImg();\n\t\t\t$this->fillBgColor();\n\t\t\t$this->fillPix();\n\t\t\t$this->fillArc();\n\t\t\t$this->writeFont();\n\t\t\t$this->output();\n\t\t}\n\t\t\n\t\tprotected function output()\n\t\t{\n\t\t\t//imagepng\n\t\t\t$func = 'image'.$this->imgType;\n\t\t\t$mime = 'Content-type:image/'.$this->imgType;\n\t\t\theader($mime);\n\t\t\t$func($this->res);\n\t\t}\n\t\t\n\t\tprotected function writeFont()\n\t\t{\n\t\t\tfor ($i = 0; $i < $this->num; $i++) {\n\t\t\t\t\n\t\t\t\t$width = ceil($this->width / $this->num);\n\t\t\t\t$x = $width * $i;\n\t\t\t\t$y= mt_rand(5,$this->height - 10);\n\t\t\t\t$c = $this->verifyCode[$i];\n\t\t\t\timagechar($this->res,5,$x,$y,$c,$this->darkColor());\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function fillArc()\n\t\t{\n\t\t\tfor($i = 0; $i < 10; $i++) {\n\t\t\t\timagearc($this->res,\n\t\t\t\t\t\tmt_rand(10,$this->width - 10),\n\t\t\t\t\t\tmt_rand(10,$this->height - 10),\n\t\t\t\t\t\tmt_rand(0,$this->width),\n\t\t\t\t\t\tmt_rand(0,$this->height),\n\t\t\t\t\t\tmt_rand(0,180),\n\t\t\t\t\t\tmt_rand(181,360),\n\t\t\t\t\t\t$this->lightColor()\n\t\t\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\t\n\t\tprotected function fillPix()\n\t\t{\n\t\t\t$num = $this->pixNum();\n\t\t\tfor ($i = 0; $i < $num; $i++) {\n\t\t\t\t\n\t\t\t\timagesetpixel($this->res,mt_rand(0,$this->width),mt_rand(0,$this->height),$this->darkColor());\n\t\t\t}\n\t\t}\n\t\t\n\t\tprotected function pixNum()\n\t\t{\n\t\t\t$area = ceil(($this->width * $this->height) / 20);\n\t\t\treturn $area;\n\t\t}\n\t\t\n\t\t\n\t\tprotected function fillBgColor()\n\t\t{\n\t\t\timagefill($this->res,0,0,$this->lightColor());\n\t\t}\n\t\t\n\t\t\n\t\tprotected function lightColor()\n\t\t{\n\t\t\treturn imagecolorallocate($this->res,\n\t\t\t\t\t\t\t   mt_rand(130,255),\n\t\t\t\t\t\t\t   mt_rand(130,255),\n\t\t\t\t\t\t\t   mt_rand(130,255)\n\t\t\t\t\t\t\t\t);\n\t\t}\n\t\t\n\t\tprotected function darkColor()\n\t\t{\n\t\t\treturn imagecolorallocate($this->res,\n\t\t\t\t\t\t\t   mt_rand(0,120),\n\t\t\t\t\t\t\t   mt_rand(0,120),\n\t\t\t\t\t\t\t   mt_rand(0,120)\n\t\t\t\t\t\t\t\t);\n\t\t}\n\t\t\n\t\tprotected function createImg()\n\t\t{\n\t\t\t$this->res = imagecreatetruecolor($this->width,$this->height);\n\t\t}\n\t\t\n\t\t//9 .销毁图片资源\n\t\tpublic function __destruct()\n\t\t{\n\t\t\t//imagedestroy($this->res);\n\t\t}\n\t\t\n\t\t//可以做一个魔术方法__get专门用于得到验证码字符串\n\t\tpublic function __get($key)\n\t\t{\n\t\t\tif ($key == 'verifyCode') {\n\t\t\t\treturn $this->$key;\n\t\t\t}\n\t\t\t\n\t\t\treturn false;\n\t\t}\n\t}\n```\n7、auto_load(类的自动加载)\n```\n<?php\n\tclass Init\n\t{\n\t\t\n\t\tpublic function loader()\n\t\t{\n\t\t\t$psr = new Psr4();\n\t\t\t$psr->register();\n\t\t\t\n\t\t\tforeach ($GLOBALS['nameSpace'] as $name => $baseDir) {\n\t\t\t\t$psr->addNamespace($name,$baseDir);\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic function router()\n\t\t{\n\t\t\t$this->loader();\n\t\t\t\n\t\t\t$_GET['m'] = isset($_GET['m']) ? ucfirst(strtolower($_GET['m'])) : 'Index';\n\t\t\t$_GET['a'] = isset($_GET['a']) ? $_GET['a'] :'index';\n\t\t\t\n\t\t\t$controllerName = 'Controller\\\\'.$_GET['m'].'Controller';\n\t\t\t\n\t\t\t\n\t\t\t$mod = new $controllerName();\n\t\t\t\n\t\t\tif (method_exists($mod,$_GET['a'])) {\n\t\t\t\t\n\t\t\t\tcall_user_func(array($mod,$_GET['a']));\n\t\t\t} else{\n\t\t\t\texit('方法不合法');\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t}\n```\n8、PSR_4\n```\n\t<?php\n\tclass Psr4\n\t{\n\t\t\n\t\tprivate $prefixes;\n\t\t\n\t\t\n\t\tpublic function register()\n\t\t{\n\t\t\tspl_autoload_register(array($this,'loadClass'));\n\t\t}\n\t\t\n\t\tpublic function addNamespace($nameSpace, $path)\n\t\t{\n\t\t\t$nameSpace = trim($nameSpace,'\\\\');\n\t\t\t$path = rtrim($path,DIRECTORY_SEPARATOR).'/';\n\t\t\t\n\t\t\tif (isset($this->prefixes[$nameSpace]) == false) {\n\t\t\t\t$this->prefixes[$nameSpace] = array();\n\t\t\t}\n\t\t\t\n\t\t\tarray_push($this->prefixes[$nameSpace],$path);\n\t\t\t\n\t\t}\n\t\t\n\t\tprivate function loadClass($className)\n\t\t{\n\t\t\t$pos = strrpos($className,'\\\\');\n\t\t\t//µÃµ½ÃüÃû¿Õ¼ä\n\t\t\t$nameSpace = substr($className,0, $pos);\n\t\t\t$realClass = substr($className,$pos + 1);\n\t\t\t\n\t\t\t\n\t\t\t//´¦ÀíÓ³Éä°üº¬\n\t\t\t$this->mappingFile($nameSpace, $realClass);\n\t\t}\n\t\t\n\t\tprivate function mappingFile($nameSpace, $realClass)\n\t\t{\n\t\t\tif (isset($this->prefixes[$nameSpace]) == false) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\tforeach ($this->prefixes[$nameSpace] as $baseDir) {\n\t\t\t\t$file = $baseDir . str_replace('\\\\','/',$realClass).'.php';\n\t\t\t\t\n\t\t\t\t$this->requireFile($file);\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tprivate function requireFile($file)\n\t\t{\n\t\t\tif (file_exists($file)) {\n\t\t\t\tinclude $file;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t}\n```\n9、NameSpace\n```\n\t<?php\n\treturn [\n\t\t'Model' => 'App/Model/',\n\t\t'Controller' => 'App/Controller/',\n\t\t'Framework' => 'Vendor/Phone/Framework/Src/',\n\t];\n```","source":"_posts/MVC.md","raw":"---\ntitle: MVC\ndate: 2017-09-30 03:35:43\ntags: 设计模式\ncategories: 设计模式\n---\n我将MVC归属在设计模式里面,个人对MVC的理解它应该为一种设计模式。\n\n<!-- more -->\n\n##\t什么是MVC\n由模型(model),视图(view),控制器(controller)完成的应用程序由模型发出要实现的功能到控制器,控制器接收组织功能传递给视图;\n\nModel(模型)，程序应用功能的实现，程序的逻辑的实现。在PHP中负责数据管理，数据生成;\nView(视图)，图形界面逻辑。在PHP中负责输出，处理如何调用模板、需要的资源文件;\nController(控制器)，负责转发请求，对请求处理。在PHP中根据请求决定调用的视图及使用的数据;\n\n##\t为什么使用MVC\nMVC的主要作用是为了将代码分层、分类;\nMVC的主要目的是为了解决Web开发中分离开发与设计工作，使其工作相对独立;\n在这样的过程中还发现了其他的一些优点，网站的目录结构更加清晰，网站更易维护与扩展，可以实现模块的复用;\n\n## 我所认知的MVC\nMVC 是一个设计模式，它强制性的使应用程序的输入、处理和输出分开。使用 MVC 应 用程序被分成三个核心部件:模型、视图、控制器。它们各自处理自己的任务。视图是 用户看到并与之交互的界面。模型表示企业数据和业务规则。控制器接受用户的输入并 调用模型和视图去完成用户的需求。\n\n##\t优点\n低耦合性、高重用性和可适用性、较低的生命周期成本、快速的部署、 可维护性、可扩展性，有利于软件工程化管理\n\n##\t缺点\n没有明确的定义，完全理解 MVC 并不容易。不适合小型规模的应用程序;\n\n##\tMVC底层架构\n1、Image类\n```\n\t<?php\n\n\tnamespace Framework;\n\n\tclass Image\n\t{\n\t\t//路径\n\t\tprivate $path = './upload/';\n\t\t//随机文件名\n\t\tprivate $isRandName;\n\t\t\n\t\t//初使化成员属性\n\t\tpublic function  __construct($path = null , $r = true)\n\t\t{\n\t\t\tif (!is_null($path)) {\n\t\t\t\t$this->path = rtrim($path,'/').'/';\n\t\t\t} \n\t\t\t\n\t\t\t$this->isRandName = $r;\n\t\t}\n\t\t\n\t\t//water水印的方法  目标和源，自适应能力更强一些，直接调成员方法即可\n\t\t//源、目标、位置 、透明度\n\t\tpublic function  water($dst,$src,$pos = 9, $prefix = 'wa_', $tmd = 100)\n\t\t{\n\t\t\t//判断文件路径是否存在\n\t\t\t$src = $this->path . $src;\n\t\t\t\n\t\t\tif (!file_exists($dst) || !file_exists($src))\n\t\t\t{\n\t\t\t\texit('目标者水印图片不存在');\n\t\t\t}\n\t\t\t//获取图像的相关信息\n\t\t\t$dstInfo = self::getImageInfo($dst);\n\t\t\t$srcInfo = self::getImageInfo($src);\n\t\t\t\n\t\t\t//判断宽高是否超过了目标图片的宽和高\n\t\t\tif (!$this->_checkSize($dstInfo,$srcInfo)) {\n\t\t\t\texit('水印图片宽、高不合法');\n\t\t\t}\n\t\t\t//摆放位置 \n\t\t\t$position = self::getPosition($dstInfo,$srcInfo,$pos);\n\t\t\t\n\t\t\t//打开图片\n\t\t\t$dstRes = self::openImg($dst, $dstInfo);\n\t\t\t$srcRes = self::openImg($src, $srcInfo);\n\t\t\t\n\t\t\t//将两个图片合并在一起\n\t\t\t$newRes = $this->_mergeImage($dstRes,$srcRes,$position,$dstInfo,$srcInfo,$tmd);\n\t\t\t\n\t\t\t\n\t\t\tif ($this->isRandName) {\n\t\t\t\t\n\t\t\t\t$path = $this->path.$prefix.uniqid().'.'.$dstInfo['subfix'];\n\t\t\t} else {\n\t\t\t\t$path = $this->path.$prefix.$dstInfo['basename'];\n\t\t\t}\n\t\t\t//保存图片\n\t\t\tself::saveImage($newRes,$path,$dstInfo);\n\t\t\t\n\t\t\t//销毁资源\n\t\t\timagedestroy($newRes);\n\t\t\timagedestroy($srcRes);\n\t\t\t//返回路径\n\t\t\treturn $path;\n\t\t}\n\t\t\n\t\t//thumb 源 和 宽高\n\t\tpublic function thumb($dst,$width,$height,$prefix = 'thumb_')\n\t\t{\n\t\t\t//判断文件是否在\n\t\t\tif (!file_exists($dst)) {\n\t\t\t\texit('文件路径不存在');\n\t\t\t}\n\t\t\t//获取图像的信息，没有信息，你什么都 做不鸟\n\t\t\t$info = self::getImageInfo($dst);\n\t\t\t//得到新的尺寸\n\t\t\t$newSize = self::getNewSize($width,$height,$info);\n\t\t\t//打开资源\n\t\t\t$res = self::openImg($dst,$info);\n\t\t\t//等比缩放这个资源，处理gif背景变黑的问题 \n\t\t\t$newRes = self::kidOfImage($res,$newSize,$info);\n\t\t\t//保存\n\t\t\t$path = $this->path.$prefix.$info['basename'];\n\t\t\tself::saveImage($newRes,$path,$info);\n\t\t\t//销毁\n\t\t\timagedestroy($newRes);\n\t\t\t//返回路径\n\t\t\treturn $path;\n\t\t\t\n\t\t}\n\t\t\n\t\tprivate static function kidOfImage($srcImg, $size, $imgInfo)\n\t\t{\n\t\t\t$newImg = imagecreatetruecolor($size[\"width\"], $size[\"height\"]);\t\t\n\t\t\t$otsc = imagecolortransparent($srcImg);\n\t\t\tif ( $otsc >= 0 && $otsc < imagecolorstotal($srcImg)) {\n\t\t\t\t $transparentcolor = imagecolorsforindex( $srcImg, $otsc );\n\t\t\t\t\t $newtransparentcolor = imagecolorallocate(\n\t\t\t\t\t $newImg,\n\t\t\t\t\t $transparentcolor['red'],\n\t\t\t\t\t\t $transparentcolor['green'],\n\t\t\t\t\t $transparentcolor['blue']\n\t\t\t\t );\n\n\t\t\t\t imagefill( $newImg, 0, 0, $newtransparentcolor );\n\t\t\t\t imagecolortransparent( $newImg, $newtransparentcolor );\n\t\t\t}\n\n\t\t\n\t\t\timagecopyresized( $newImg, $srcImg, 0, 0, 0, 0, $size[\"width\"], $size[\"height\"], $imgInfo[\"width\"], $imgInfo[\"height\"] );\n\t\t\timagedestroy($srcImg);\n\t\t\treturn $newImg;\n\t\t}\n\t\t\n\t\tprivate static function getNewSize($width, $height, $imgInfo)\n\t\t{\t\n\t\t\t$size[\"width\"] = $imgInfo[\"width\"];   //将原图片的宽度给数组中的$size[\"width\"]\n\t\t\t$size[\"height\"] = $imgInfo[\"height\"];  //将原图片的高度给数组中的$size[\"height\"]\n\t\t\t\n\t\t\tif($width < $imgInfo[\"width\"]) {\n\t\t\t\t$size[\"width\"] = $width;             //缩放的宽度如果比原图小才重新设置宽度\n\t\t\t}\n\n\t\t\tif ($width < $imgInfo[\"height\"]) {\n\t\t\t\t$size[\"height\"] = $height;            //缩放的高度如果比原图小才重新设置高度\n\t\t\t}\n\n\t\t\tif($imgInfo[\"width\"]*$size[\"width\"] > $imgInfo[\"height\"] * $size[\"height\"]) {\n\t\t\t\t$size[\"height\"] = round($imgInfo[\"height\"] * $size[\"width\"] / $imgInfo[\"width\"]);\n\t\t\t} else {\n\t\t\t\t$size[\"width\"] = round($imgInfo[\"width\"] * $size[\"height\"] / $imgInfo[\"height\"]);\n\t\t\t}\n\n\t\t\treturn $size;\n\t\t}\t\t\n\t\t\n\t\t\n\t\tpublic static function saveImage($res,$path,$info)\n\t\t{\n\t\t\tswitch ($info['mime']) {\n\t\t\t\tcase 'image/png':\n\t\t\t\tcase 'image/x-png':\n\t\t\t\t\timagepng($res,$path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/jpeg':\n\t\t\t\tcase 'image/jpg':\n\t\t\t\tcase 'image/pjpeg':\n\t\t\t\t\timagejpeg($res,$path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/gif':\n\t\t\t\t\timagegif($res,$path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/wbmp':\n\t\t\t\tcase 'image/bmp':\n\t\t\t\t\timagewbmp($res,$path);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate function _mergeImage($dstRes,$srcRes,$position,$dstInfo,$srcInfo,$tmd)\n\t\t{\n\t\t\timagecopymerge($dstRes,$srcRes,$position['x'],$position['y'],0,0,$srcInfo['width'],$srcInfo['height'],$tmd);\n\t\t\treturn $dstRes;\n\t\t}\n\t\t\n\t\t\n\t\tpublic static function openImg($path, $info)\n\t\t{\n\t\t\tswitch ($info['mime']) {\n\t\t\t\tcase 'image/png':\n\t\t\t\tcase 'image/x-png':\n\t\t\t\t\t$res = imagecreatefrompng($path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/jpeg':\n\t\t\t\tcase 'image/jpg':\n\t\t\t\tcase 'image/pjpeg':\n\t\t\t\t\t$res = imagecreatefromjpeg($path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/gif':\n\t\t\t\t\t$res = imagecreatefromgif($path);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image/wbmp':\n\t\t\t\tcase 'image/bmp':\n\t\t\t\t\t$res = imagecreatefromwbmp($path);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn $res;\n\t\t}\n\t\t\n\t\tpublic static function getPosition($dstInfo,$srcInfo,$pos)\n\t\t{\n\t\t\tswitch ($pos) {\n\t\t\t\tcase 1:\n\t\t\t\t\t$x = 0;\n\t\t\t\t\t$y = 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\t$x = ceil(($dstInfo['width'] - $srcInfo['width']) / 2);\n\t\t\t\t\t$y = 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\t$x = $dstInfo['width'] - $srcInfo['width'];\n\t\t\t\t\t$y = 0;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\tcase 4:\n\t\t\t\t\t$x = 0;\n\t\t\t\t\t$y = ceil(($dstInfo['height'] - $srcInfo['height']) /2 );\n\t\t\t\t\tbreak;\n\t\t\t\tcase 5:\n\t\t\t\t\t$x = ceil(($dstInfo['width'] - $srcInfo['width']) / 2);\n\t\t\t\t\t$y = ceil(($dstInfo['height'] - $srcInfo['height']) /2 );\n\t\t\t\t\tbreak;\n\t\t\t\tcase 6:\n\t\t\t\t\t$x = $dstInfo['width'] - $srcInfo['width'];\n\t\t\t\t\t$y = ceil(($dstInfo['height'] - $srcInfo['height']) /2 );\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\tcase 7:\n\t\t\t\t\t$x = 0;\n\t\t\t\t\t$y = $dstInfo['height'] - $srcInfo['height'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 8:\n\t\t\t\t\t$x = ceil(($dstInfo['width'] - $srcInfo['width']) / 2);\n\t\t\t\t\t$y = $dstInfo['height'] - $srcInfo['height'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 9:\n\t\t\t\t\t$x = $dstInfo['width'] - $srcInfo['width'];\n\t\t\t\t\t$y = $dstInfo['height'] - $srcInfo['height'];\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t$x = mt_rand(0,$dstInfo['width'] - $srcInfo['width']);\n\t\t\t\t\t$y = mt_rand(0,$dstInfo['height'] - $srcInfo['height']);\n\t\t\t\t\n\t\t\t}\n\n\t\t\treturn ['x' => $x, 'y' => $y];\n\t\t}\n\t\t\n\t\tprivate function _checkSize($dstInfo,$srcInfo)\n\t\t{\n\t\t\tif ($dstInfo['width'] < $srcInfo['width'] || $dstInfo['height'] < $srcInfo['height']) {\n\t\t\t\treturn false;\t\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\tpublic static  function getImageInfo($path)\n\t\t{\n\t\t\t$data = [];\n\t\t\t$info = getimagesize($path);\n\t\t\t$data['width'] = $info[0];\n\t\t\t$data['height'] = $info[1];\n\t\t\t$data['mime'] = $info['mime'];\n\t\t\t$path = pathinfo($path);\n\t\t\t$data['basename'] = $path['basename'];\n\t\t\t$data['subfix'] = $path['extension'];\n\t\t\treturn $data;\n\t\t}\n\t}\n```\n2、Model类\n```\n\t<?php\n\tnamespace Framework;\n\n\n\tclass Model\n\t{\n\t\t//连接\n\t\tprotected $link;\n\t\t//用户名\n\t\tprotected $user;\n\t\t//密码\n\t\tprotected $pwd;\n\t\t//字符集\n\t\tprotected $charset;\n\t\t//表前缀\n\t\tprotected $prefix;\n\t\t//库名\n\t\tprotected $dbName;\n\t\t//主机\n\t\tprotected $host;\n\t\t//表名\n\t\tprotected $table;\n\t\t//字段\n\t\tprotected $fields;\n\t\t//保存的查询、更新、添加的参数\n\t\tprotected $options;\n\t\t\n\t\t//初使化数据库连接\n\t\t//把一批成员属性都 初使化\n\t\tpublic function __construct(Array $config)\n\t\t{\n\t\t\t$this->host = $config['DB_HOST'];\n\t\t\t$this->user = $config['DB_USER'];\n\t\t\t$this->pwd = $config['DB_PWD'];\n\t\t\t$this->dbName = $config['DB_NAME'];\n\t\t\t$this->charset = $config['DB_CHARSET'];\n\t\t\t$this->prefix = $config['DB_PREFIX'];\n\t\t\t//连接\n\t\t\t$this->link = $this->connect();\n\t\t\t//判断是否连接失败\n\t\t\tif (!$this->link) {\n\t\t\t\texit('数据库连接失败');\n\t\t\t}\n\t\t\t//表名\n\t\t\t$this->table = $this->getTable();\n\n\t\t\t//字段\n\t\t\t$this->fields = $this->getFields();\n\t\t\t\n\t\t\t\n\t\t}\n\t\t\n\t\t\n\t\t//连接数库\n\t\tprotected function connect()\n\t\t{\n\t\t\t$conn = mysqli_connect($this->host,$this->user,$this->pwd);\n\t\t\t//连接失败\n\t\t\tif (!$conn) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t//选择库失败处理\n\t\t\tif (!mysqli_select_db($conn,$this->dbName)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\n\t\t\tmysqli_set_charset($conn,$this->charset);\n\t\t\t\n\t\t\treturn $conn;\n\t\t\t\n\t\t}\n\t\t\n\t\t//初始化表\n\t\t//（报错，我们再根据命名空间去解决，涉及到命名空间的类名）\n\t\tprotected function getTable()\n\t\t{\n\t\t\tif (isset($this->table)) {\n\t\t\t\t//用户设置 过以用户设置的为准\n\t\t\t\treturn $this->prefix . ltrim($this->table,$this->prefix);\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\tif ($pos = strpos(get_class($this),'\\\\')) {\n\t\t\t\t\t\n\t\t\t\t\treturn $this->prefix .  strtolower(str_replace(['Model','model'],'',substr(get_class($this),$pos + 1)));\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\n\t\t\t\t\t//用户没有设置过，以类名拼接前缀，给成成全新的表名\n\t\t\t\t\treturn $this->prefix .strtolower(substr(get_class($this),0,-5));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t//始初化字段\n\t\t//要把字段缓存到一个文件中去\n\t\t\n\t\tprotected function getFields()\n\t\t{\n\t\t\t//如果有字段的文件则说明曾经缓存过这个文件，直接包含进来即可\n\t\t\t//知道文件路径命名的规则 \n\t\t\t$filePath = './Cache/'.$this->table.'.php';\n\t\t\tif (file_exists($filePath)) {\n\t\t\t\treturn include $filePath;\n\t\t\t} else {\n\t\t\t\t$fields = $this->queryFields();\n\t\t\t\t\n\t\t\t\t$str = \"<?php \\nreturn \".var_export($fields,true).';?>';\n\t\t\t\t\n\t\t\t\tfile_put_contents($filePath,$str);\n\t\t\t}\n\t\t\t\n\t\t\treturn $fields;\n\t\t}\n\t\t\n\t\t//查询出字段\n\t\tprotected function queryFields()\n\t\t{\n\t\t\t$sql = 'desc '.$this->table;\n\t\t\t\n\t\t\t$data = $this->query($sql);\n\t\t\n\t\t\t\n\t\t\t$fields = [];\n\t\t\tforeach ($data as $key => $val) {\n\t\t\t\t$fields[] = $val['Field'];\n\t\t\t\tif ($val['Key'] == 'PRI') {\n\t\t\t\t\t$fields['_pk'] = $val['Field'];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn $fields;\n\t\t\t\n\t\t}\n\t\t\n\t\t//系统级的查询方法，设置 为public ，如果在外部想要调用的时候，想自定sql句的候，可以直接query\n\t\t//查询应的结果，这个仅供读取使用\n\t\tpublic function query($sql)\n\t\t{\n\t\t\t\n\t\t\t$result = mysqli_query($this->link,$sql);\n\t\t\t\n\t\t\tif ($result) {\n\t\t\t\t$data = [];\n\t\t\t\twhile($row = mysqli_fetch_assoc($result)) {\n\t\t\t\t\t$data[] = $row;\n\t\t\t\t}\n\t\t\t\treturn $data;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t//查询方法\n\t\t//准备好无需换的SQL语句\n\t\t//用户调用询的时候，将call里面保存进去的参数，一一替换sql语句\n\t\t//发送SQL语句\n\t\t//返回查询果\n\t\tpublic function select()\n\t\t{\n\t\t\t\n\t\t\t$sql = \"select %FIELDS% from %TABLE% %WHERE% %GROUP% %HAVING% %ORDER% %LIMIT%\";\n\t\t\t\n\t\t\t$newSql = str_replace(\n\t\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t\t'%FIELDS%',\n\t\t\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t\t\t\t'%GROUP%',\n\t\t\t\t\t\t\t\t'%HAVING%',\n\t\t\t\t\t\t\t\t'%ORDER%',\n\t\t\t\t\t\t\t\t'%LIMIT%',\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t\t$this->parseFields(),\n\t\t\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t\t\t\t$this->parseGroup(),\n\t\t\t\t\t\t\t\t$this->parseHaving(),\n\t\t\t\t\t\t\t\t$this->parseOrder(),\n\t\t\t\t\t\t\t\t$this->parseLimit(),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t$sql\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\n\t\t\t//为了在外面想知道自动生成的SQL语旬是神马的时候\n\t\t\t$this->sql = $newSql;\n\t\t\treturn $this->query($newSql);\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function  parseFields()\n\t\t{\n\t\t\t//因为我们对比字段的时候不需要对比主键是谁\n\t\t\t//因此，我干掉主键 \n\t\t\t$fields = $this->fields;\n\t\t\tunset($fields['_pk']);\n\t\t\t\n\t\t\t//用户向fileds('id,username,password') 先将其切割，用,号切割explode\n\t\t\t//如果用户传的是一个数组fileds(['id','username','password'])，则对比应的字段，算交集\n\t\t\t//array_intersect\n\t\t\t//array_intersect_key\n\t\t\t//array_intersect_assoc\n\t\t\t//array_intersect_ukey\n\t\t\tif (isset($this->options['fields'][0])) {\n\t\t\t\t//是数组的时怎么处理法\n\t\t\t\tif (is_array($this->options['fields'][0])) {\n\t\t\t\t\tforeach($this->options['fields'][0] as $key => $val) {\n\t\t\t\t\t\tif (!in_array($val,$fields)) {\n\t\t\t\t\t\t\tunset($this->options['fields'][0][$key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn join(',',$this->options['fields'][0]);\n\t\t\t\t\t\n\t\t\t\t} elseif (is_string($this->options['fields'][0])) {\n\t\t\t\t\t//是字符串的时候先变为组再处理\n\t\t\t\t\t$this->options['fields'][0] = explode(',',$this->options['fields'][0]);\n\t\t\t\t\t\n\t\t\t\t\tforeach($this->options['fields'][0] as $key => $val) {\n\t\t\t\t\t\tif (!in_array($val,$fields)) {\n\t\t\t\t\t\t\tunset($this->options['fields'][0][$key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn join(',',$this->options['fields'][0]);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\treturn join(',',$fields);\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t//判断用户有没有手动指定过查询哪个用\n\t\t//如果指定过，则以用户设定的options里面的表为准\n\t\t//如果没有设定过，则以默认的为准\n\t\tprotected function  parseTable()\n\t\t{\n\t\t\tif (isset($this->options['table'][0])) {\n\t\t\t\treturn $this->options['table'][0];\n\t\t\t} else {\n\t\t\t\treturn $this->table;\n\t\t\t}\n\t\t}\n\t\t\n\t\t//看看用户是否设置过where，如果设置过以用户设置 的为准\n\t\t//如果没有设置 则为空\n\t\tprotected function  parseWhere()\n\t\t{\n\t\t\tif (isset($this->options['where'][0])) {\n\t\t\t\treturn 'WHERE '.$this->options['where'][0];\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\tprotected function  parseGroup()\n\t\t{\n\t\t\tif (isset($this->options['group'][0])) {\n\t\t\t\treturn 'GROUP BY '.$this->options['group'][0];\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\n\t\tprotected function  parseHaving()\n\t\t{\n\t\t\tif (isset($this->options['having'][0])) {\n\t\t\t\treturn 'HAVING '.$this->options['having'][0];\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t\t\n\t\tprotected function  parseOrder()\n\t\t{\n\t\t\tif (isset($this->options['order'][0])) {\n\t\t\t\treturn 'ORDER BY '.$this->options['order'][0];\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t\t\n\t\t//limit可以有以下几种传法\n\t\t//用户传进来的是一个整 数，就是查询指定的条数\n\t\t//用户传进来的是一个数组，则数组中的第一个元素为$offset,第二个元素为$num\n\t\t//如果户传进来的是一个字符串，则以用户传的为准\n\t\tprotected function  parseLimit()\n\t\t{\n\t\t\tif (isset($this->options['limit'][0])) {\n\t\t\t\t\n\t\t\t\tif (is_int($this->options['limit'][0])) {\n\t\t\t\t\treturn 'LIMIT '.$this->options['limit'][0];\n\t\t\t\t} elseif (is_array($this->options['limit'][0])) {\n\t\t\t\t\treturn 'LIMIT '. join(',',$this->options['limit'][0]);\n\t\t\t\t} else {\n\t\t\t\t\treturn 'LIMIT ' . $this->options['limit'][0];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t//增加方法\n\t\tpublic function add($data)\n\t\t{\n\t\t\t\n\t\t\n\t\t\t$sql = \"insert into %TABLE%(%FIELDS%) values(%VALUES%)\";\n\t\t\t//insert into bbs_user(username,sex) values('liwenkai','null');\n\t\t\t$newSql = str_replace(\n\t\t\t\t\t\tarray('%TABLE%','%FIELDS%','%VALUES%'),\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t\t$this->parseInsertFields($data),\n\t\t\t\t\t\t\tjoin(',',$this->parseValue($data)),\n\t\t\t\t\t\t),\n\t\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $newSql;\n\t\t\t\n\t\t\t//echo $newSql;\n\t\t\treturn $this->exec($newSql,true);\n\t\t}\n\t\t\n\t\tprotected function parseValue($data)\n\t\t{\n\t\t\tif (is_string($data)) {\n\t\t\t\t$data = '\\''.$data.'\\'';\n\t\t\t} elseif (is_array($data)) {\n\t\t\t\t$data = array_map(array($this,'parseValue'),$data);\n\t\t\t} elseif (is_null($data)) {\n\t\t\t\t$data = 'null';\n\t\t\t}\n\t \t\t\n\t\t\treturn $data;\n\t\t}\n\t\t\n\t\tprotected function parseInsertFields(&$data)\n\t\t{\n\t\t\tforeach ($data as $key => $value) {\n\t\t\t\tif (!in_array($key,$this->fields)) {\n\t\t\t\t\tunset($data[$key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn join(',',array_keys($data));\n\t\t}\n\t\t\n\t\t//更新方法\n\t\tpublic function update($data)\n\t\t{\n\t\t\t$sql = \"update %TABLE% set %SETS% %WHERE% %ORDER% %LIMIT%\";\n\t\t\t$newSql = str_replace(\n\t\t\t\t\t\t\tarray('%TABLE%','%SETS%','%WHERE%','%ORDER%','%LIMIT%'),\n\t\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t\t\t$this->parseSets($data),\n\t\t\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t\t\t\t$this->parseOrder(),\n\t\t\t\t\t\t\t\t$this->parseLimit(),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t$sql\n\t\t\t\t\t\t);\n\t\t\t\t\n\t\t\t\n\t\t\t$this->sql = $newSql;\n\t\t\treturn $this->exec($newSql);\n\t\t\t\n\t\t}\n\t\t\n\t\tpublic function parseSets($data)\n\t\t{\n\t\t\t$sets = [];\n\t\t\t\n\t\t\tforeach ($data as $key => $val) {\n\t\t\t\tif (in_array($key,$this->fields)) {\n\t\t\t\t\t\n\t\t\t\t\t$sets[] = $key.'='.$this->parseValue($val);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn join(',',$sets) ;\n\t\t\t\n\t\t}\n\t\t\n\t\t//删除方法\n\t\tpublic function delete()\n\t\t{\n\t\t\t$sql = \"delete from %TABLE% %WHERE% %ORDER% %LIMIT%\";\n\t\t\t\n\t\t\t$newSql = str_replace(\n\t\t\t\t\t\tarray('%TABLE%','%WHERE%','%ORDER%','%LIMIT%'),\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t\t\t$this->parseOrder(),\n\t\t\t\t\t\t\t$this->parseLimit(),\n\t\t\t\t\t\t),\n\t\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $newSql;\n\t\t\t\n\t\t\treturn $this->exec($newSql);\n\t\t\n\t\t}\n\t\t\n\t\tpublic function exec($sql, $isInsertId = false)\n\t\t{\n\t\t\t$result = mysqli_query($this->link,$sql);\n\t\t\t\n\t\t\tif ($result) {\n\t\t\t\t\n\t\t\t\tif ( $isInsertId ) {\n\t\t\t\t\t//insert 返回自动增长的ID\n\t\t\t\t\treturn mysqli_insert_id($this->link);\n\t\t\t\t} else {\n\t\t\t\t\t\n\t\t\t\t\t//update delete只直返回 受影响行数\n\t\t\t\t\treturn mysqli_affected_rows($this->link);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\t\t\n\t\t}\n\t\t\n\t\t//查最大值 \n\t\tpublic function count($field = null)\n\t\t{\n\t\t\tif (is_null($field)) {\n\t\t\t\t$field = $this->fields['_pk'];\n\t\t\t}\n\t\t\t\n\t\t\t$sql = \"select count($field) as num  from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray(\n\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t$data =  $this->query($sql);\n\t\t\t\n\t\t\treturn $data[0]['num'];\n\t\t\t\n\t\t}\n\t\t\n\t\t//最小值 \n\t\tpublic function min($field = null)\n\t\t{\n\t\t\tif (is_null($field)) {\n\t\t\t\t$field = $this->fields['_pk'];\n\t\t\t}\n\t\t\t\n\t\t\t$sql = \"select min($field) as num  from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray(\n\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t$data =  $this->query($sql);\n\t\t\t\n\t\t\treturn $data[0]['num'];\n\t\t\t\n\t\t}\n\t\t\n\t\tpublic function sum($field = null)\n\t\t{\n\t\t\tif (is_null($field)) {\n\t\t\t\t$field = $this->fields['_pk'];\n\t\t\t}\n\t\t\t\n\t\t\t$sql = \"select SUM($field) as num  from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray(\n\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t$data =  $this->query($sql);\n\t\t\t\n\t\t\treturn $data[0]['num'];\n\t\t\t\n\t\t}\n\t\t\n\t\t//求最大值 \n\t\tpublic function max($field = null)\n\t\t{\n\t\t\tif (is_null($field)) {\n\t\t\t\t$field = $this->fields['_pk'];\n\t\t\t}\n\t\t\t\n\t\t\t$sql = \"select max($field) as num  from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray(\n\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t$data =  $this->query($sql);\n\t\t\t\n\t\t\treturn $data[0]['num'];\n\t\t\t\n\t\t}\n\t\t\n\t\t//求平均数\n\t\tpublic function avg($field = null)\n\t\t{\n\t\t\tif (is_null($field)) {\n\t\t\t\t$field = $this->fields['_pk'];\n\t\t\t}\n\t\t\t\n\t\t\t$sql = \"select avg($field) as num  from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray(\n\t\t\t\t\t\t'%TABLE%',\n\t\t\t\t\t\t'%WHERE%',\n\t\t\t\t\t),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t$this->parseWhere(),\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t$data =  $this->query($sql);\n\t\t\t\n\t\t\treturn $data[0]['num'];\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function getBy($field,$value)\n\t\t{\n\t\t\t\n\t\t\t$sql = \"select %FIELDS% from %TABLE% %WHERE%\";\n\t\t\t\n\t\t\t$sql = str_replace(\n\t\t\t\t\tarray('%FIELDS%','%TABLE%','%WHERE%'),\n\t\t\t\t\tarray(\n\t\t\t\t\t\t$this->parseFields(),\n\t\t\t\t\t\t$this->parseTable(),\n\t\t\t\t\t\t'WHERE '.$field . \"='$value'\",\n\t\t\t\t\t),\n\t\t\t\t\t$sql\n\t\t\t\t\t);\n\t\t\t\n\t\t\t$this->sql = $sql;\n\t\t\t\n\t\t\treturn $this->query($sql);\n\t\t\t\n\t\t}\n\t\t\n\t\t//自动的一个按照字段来查询的智能化查询方法\n\t\t\n\t\t//__call方法，针对用户请求的limit()  order()  group having等将其保存到options中去\n\t\t//并且判断方法的法性\n\t\t//并且return $this，让其能连贯操作。ORM （对象映射模型）$user->limit()->order()\n\t\tpublic function __call($func,$args)\n\t\t{\n\t\t\t$allow = ['where','table','fields','order','limit','group','having'];\n\t\t\t$func = strtolower($func);\n\t\t\t\n\t\t\tif (in_array($func,$allow)) {\n\t\t\t\t$this->options[$func] = $args;\n\t\t\t\treturn $this;\n\t\t\t} elseif(substr($func,0,5) == 'getby'){\n\t\t\t\t$field = substr($func,5);\n\t\t\t\n\t\t\t\tif (in_array($field,$this->fields)) {\n\t\t\t\t\treturn $this->getby($field,$args[0]);\n\t\t\t\t}\n\t\t\t}else {\n\t\t\t\texit('方法不合法');\n\t\t\t}\n\t\t}\n\t\t\n\t\t//对象销毁者关闭页面的时候，自动执行\n\t\tpublic function __destruct()\n\t\t{\n\t\t\tmysqli_close($this->link);\n\t\t}\n\t}\n```\n3、Page类\n```\n\t<?php\n\tnamespace Framework;\n\n\n\t//声明page类\n\tclass Page\n\t{\n\t\t//url\n\t\tprotected $url;\n\t\t//总页数\n\t\tprotected $pageCount;\n\t\t//总条数\n\t\tprotected $total;\n\t\t//每页显示数\n\t\tprotected $num;\n\t\t//当前页\n\t\tprotected $page;\n\t\t\n\t\t\n\t\t//初使化成员属性\n\t\tpublic function __construct($total, $num = 5)\n\t\t{\n\t\t\t//总条数\n\t\t\t$this->total = ($total > 0) ? (int) $total : 1;\n\t\t\t//每页显示数\n\t\t\t$this->num = $num;\n\t\t\t//总页数\n\t\t\t$this->pageCount = $this->getPageCount();\n\t\t\t//当前页\n\t\t\t$this->page = $this->getCurrentPage();\n\t\t\t//url\n\t\t\t$this->url = $this->getUrl();\n\t\t}\n\t\t\n\t\t//一次性返回所有的分页信息\n\t\tpublic function rendor()\n\t\t{\n\t\t\treturn [\n\t\t\t\t'first' => $this->first(),\n\t\t\t\t'next' => $this->next(),\n\t\t\t\t'prev' => $this->prev(),\n\t\t\t\t'end' => $this->end(),\n\t\t\t];\n\t\t}\n\t\t\n\t\t//limit方法，在未来分页数据查询时候，直接返回对应的limit 0,5 这样的字符串\n\t\tpublic function limit()\n\t\t{\n\t\t\t$offset = ($this->page - 1) * $this->num;\n\t\t\t\n\t\t\t$str = $offset.','.$this->num;\n\t\t\t\n\t\t\treturn $str;\n\t\t}\n\t\t\n\t\t\n\t\tprotected function end()\n\t\t{\n\t\t\treturn $this->setQueryString('page='.$this->pageCount);\n\t\t}\n\t\t\n\t\t\n\t\t//上一页\n\t\tprotected function  prev()\n\t\t{\n\t\t\t\n\t\t\t$page = ($this->page <=1) ? 1 : ($this->page -1);\n\t\t\t\n\t\t\treturn $this->setQueryString('page='.$page);\n\t\t\t\n\t\t}\n\t\t\n\t\t//下一页\n\t\tprotected function next()\n\t\t{\n\t\t\t\n\t\t\t$page = ($this->page >= $this->pageCount) ?  $this->pageCount : ($this->page + 1);\n\t\t\t\n\t\t\treturn $this->setQueryString('page='.$page);\n\t\t}\n\t\t\n\t\t\n\t\t//首页\n\t\tprotected function first()\n\t\t{\n\t\t\t//设置查询的page页码为第一页，即为首页\n\t\t\treturn $this->setQueryString('page=1');\n\t\t\t\n\t\t}\n\t\t\n\t\t\n\t\t//一种况有?，一种情况是没有?的情况\n\t\tprotected function setQueryString($page)\n\t\t{\n\t\t\t//如果url当中有问号\n\t\t\tif (strpos($this->url, '?')) {\n\t\t\t\treturn $this->url.'&'.$page;\n\t\t\t} else {\n\t\t\t//如果url当中没有问号\n\t\t\t\treturn $this->url.'?'.$page;\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\tprotected function getUrl()\n\t\t{\n\t\t\t$path = $_SERVER['REQUEST_URI'];\n\t\t\t//先要获取户传进来的URI\n\t\t\t//用parse_url 解释URI\n\t\t\t$par = parse_url($path);\n\t\t\t\n\t\t\t\n\t\t\t//判断是否设置过query\n\t\t\tif (isset($par['query'])) {\n\t\t\t\t\n\t\t\t\tparse_str($par['query'],$query);\n\t\t\t\t\n\t\t\t\t//检查query里面是否有page,如果有就干掉page\n\t\t\t\tunset($query['page']);\n\t\t\t\t\n\t\t\t\t$path = $par['path'].'?'.http_build_query($query);\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t$path = rtrim($path,'?');\n\t\t\t\n\t\t\t\n\t\t\t//协议：主机：端口：文件和请求\n\t\t\t//判断是否定义过端口，并且端口是否为443，如果为443则是https协议，否则就是http协议\n\t\t\t$protocal = (isset($_SERVER['SERVER_PORT']) && $_SERVER['SERVER_PORT'] == 443) ?'https://' : 'http://';\n\t\t\t\n\t\t\tif (80 == $_SERVER['SERVER_PORT'] || 443 == $_SERVER['SERVER_PORT']) {\n\t\t\t\t$url = $protocal.$_SERVER['SERVER_NAME'].$path;\n\t\t\t} else {\n\t\t\t\t//http://www.baidu.com:8012/index.php?username=liwenkai\n\t\t\t\t\n\t\t\t\t$url = $protocal.$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].$path;\n\t\t\t}\n\t\t\t\n\t\t\t//拼接 path. ? . 全新组合成的URI\n\t\t\treturn $url;\n\t\t}\n\t\t\n\t\t\n\t\tprotected function getCurrentPage()\n\t\t{\n\t\t\t//如果用户设置过page信息，就返回page相关信息，强制转为整型\n\t\t\tif (isset($_GET['page'])) {\n\t\t\t\t//得到页码\n\t\t\t\t$page = (int) $_GET['page'];\n\t\t\t\t\n\t\t\t\t//你的页码不能够大于总页数\n\t\t\t\tif ($page > $this->pageCount) {\n\t\t\t\t\t$page = $this->pageCount;\n\t\t\t\t}\n\t\t\t\t//你的页码不能小于1\n\t\t\t\tif ($page < 1) {\n\t\t\t\t\t$page = 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t$page = 1;\n\t\t\t}\n\t\t\t\n\t\t\treturn $page;\n\t\t}\n\t\t\n\t\tprotected function getPageCount()\n\t\t{\n\t\t\t//计算总页数，使用到了进一法取整\n\t\t\treturn ceil($this->total / $this->num);\n\t\t}\n\t\t\n\t}\n```\n4、Tpl类\n```\n\t<?php\n\tnamespace Framework;\n\n\n\tclass Tpl\n\t{\n\t\t\n\t\t//缓存目录\n\t\tprotected $cacheDir = './Cache/';\n\t\t//模版目录\n\t\tprotected $tplDir = './Tpl/';\n\t\t//保存变量的成员方法\n\t\tprotected $vars = [];\n\t\t//缓存有效期\n\t\tprotected $cacheLifeTime = 3600;\n\t\t\n\t\t\n\t\t//初使化成员属性\n\t\t//判断缓存目录是否存在\n\t\t//判断模版路径是否存在，如果不存在要创建，如果不可写，要改权限\n\t\t//初化缓存时间\n\t\tpublic function __construct($tplDir = null, $cacheDir = null ,$cacheLifeTime = null)\n\t\t{\n\t\t\tif (isset($tplDir)) {\n\t\t\t\tif ($this->_checkDir($tplDir)) {\n\t\t\t\t\t$this->tplDir = rtrim($tplDir,'/').'/';\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (isset($cacheDir)) {\n\t\t\t\tif ($this->_checkDir($cacheDir)) {\n\t\t\t\t\t$this->cacheDir = rtrim($cacheDir,'/').'/';\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (isset($cacheLifeTime)) {\n\t\t\t\t$this->cacheLifeTime = $cacheLifeTime;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tprivate function _checkDir($path)\n\t\t{\n\t\t\tif (!file_exists($path) || !is_dir($path)) {\n\t\t\t\treturn mkdir($path,0755,true);\n\t\t\t}\n\t\t\t\n\t\t\tif (!is_writable($path) || !is_readable($path)) {\n\t\t\t\treturn chmod($path,0755);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\t//$tpl->assign()->assign()->display();\n\t\t\n\t\t//分配变量\n\t\tpublic function assign($key,$val)\n\t\t{\n\t\t\t$this->vars[$key] = $val;\n\t\t\t//return $this;\n\t\t}\n\t\t\n\t\t//display显示模版内容\n\t\tpublic function display($file,$isExecute = true, $uri = null)\n\t\t{\n\t\t\t//获得模版路径（模版目录路径 + 模版文件）\n\t\t\t$tplFilePath = $this->tplDir.$file;\n\t\t\t\n\t\t\t//判断文件是否存在\n\t\t\tif (!file_exists($tplFilePath)) {\n\t\t\t\techo $tplFilePath;\n\t\t\t\texit('模板文件不存在');\n\t\t\t}\n\t\t\t//获得编译文件路径（组合一个新的） page.php?page=3\n\t\t\t$cacheFile = md5($file.$uri).'.php';\n\t\t\t\n\t\t\t$cacheFilePath = $this->cacheDir . $cacheFile;\n\t\t\t\n\t\t\t//检测是否编译过、是否修改过模版文件，如果编译，并且在有效期内，则不编译\n\t\t\tif (!file_exists($cacheFilePath)) {\n\t\t\t\t$html = $this->compile($tplFilePath);\n\t\t\t} else {\n\t\t\t\t//如果修改过模版文件，则删除原有的编译文件重新编译\n\t\t\t\tif (filemtime($tplFilePath) > filemtime($cacheFilePath)) {\n\t\t\t\t\tunlink($cacheFilePath);\n\t\t\t\t\t$html = $this->compile($tplFilePath);\n\t\t\t\t}\n\t\t\t\n\t\t\t\t// 文件创建时间 + 缓存有效期 > time(当前时间) 没有过期，否则过期了\n\t\t\t\t//如果大于time 没过期\n\t\t\t\n\t\t\t\t$isTimeout = (filemtime($tplFilePath) + $this->cacheLifeTime > time()) ? false : true;\n\t\t\t\t\n\t\t\t\tif ($isTimeout) {\n\t\t\t\t\t$html = $this->compile($tplFilePath);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t//编译\n\t\t\tif (isset($html)) {\n\t\t\t\tif (!file_put_contents($cacheFilePath,$html)) {\n\t\t\t\t\texit('编译文件写入失败');\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t//判断是否需要执行\n\t\t\t//如果不需要执行则，则不包含 ，不extract变量，反之则不然\n\t\t\tif ($isExecute) {\n\t\t\t\textract($this->vars);\n\t\t\t\tinclude $cacheFilePath;\n\t\t\t}\n\t\t\n\t\t\n\t\t}\n\t\t\n\t\tprotected function compile($tplFilePath)\n\t\t{\n\t\t\t$html = file_get_contents($tplFilePath);\n\t\t\t\n\t\t\t$keys = [\n\t\t\t\t'{if %%}' => '<?php if(\\1): ?>',\n\t            '{else}' => '<?php else : ?>',\n\t            '{else if %%}' => '<?php elseif(\\1) : ?>',\n\t            '{elseif %%}' => '<?php elseif(\\1) : ?>',\n\t            '{/if}' => '<?php endif;?>',\n\t            '{$%%}' => '<?=$\\1;?>',\n\t            '{foreach %%}' => '<?php foreach(\\1) :?>',\n\t            '{/foreach}' => '<?php endforeach;?>',\n\t            '{for %%}' => '<?php for(\\1):?>',\n\t            '{/for}' => '<?php endfor;?>',\n\t            '{while %%}' => '<?php while(\\1):?>',\n\t            '{/while}' => '<?php endwhile;?>',\n\t            '{continue}' => '<?php continue;?>',\n\t            '{break}' => '<?php break;?>',\n\t            '{$%% = $%%}' => '<?php $\\1 = $\\2;?>',\n\t            '{$%%++}' => '<?php $\\1++;?>',\n\t            '{$%%--}' => '<?php $\\1--;?>',\n\t            '{comment}' => '<?php /* ',\n\t            '{/comment}' => ' */ ?>',\n\t            '{/*}' => '<?php /* ',\n\t            '{*/}' => '* ?>',\n\t            '{section}' => '<?php ',\n\t            '{/section}' => '?>',\n\t\t\t\t'{{%%(%%)}}' => '<?=\\1(\\2);?>',\n\t\t\t\t'{date(%%,$%%)}'=> '<?=date(\\1,$\\2);?>',\n\t\t\t\t'{include %%}' => '<?php include \"\\1\";?>',\n\t\t\t\t\n\t\t\t];\n\t\t\t\n\t\t\tforeach ($keys as $key => $val) {\n\t\t\t\t\n\t\t\t\t$pattern = '#'. str_replace('%%','(.+)',preg_quote($key,'#')) .'#imsU';\n\t\t\t\t$replace = $val;\n\t\t\t\t\n\t\t\t\tif (stripos($pattern,'include')) {\n\t\t\t\t\t//处理一次回调\n\t\t\t\t\n\t\t\t\t\t$html = preg_replace_callback($pattern,array($this,'parseInclude'),$html);\n\t\t\t\t} else {\n\t\t\t\t\t\n\t\t\t\t\t$html = preg_replace($pattern,$replace,$html);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn $html;\n\t\t}\n\t\t\n\t\tprotected function parseInclude($data)\n\t\t{\n\t\t\t\n\t\t\t$file = str_replace(['\\'','\"'],'',$data[1]);\n\t\t\t$path = $this->parsePath($file);\n\t\t\t$this->display($file,false);\n\t\t\t\n\t\t\treturn '<?php include \"'.$path.'\";?>';\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function parsePath($file)\n\t\t{\n\t\t\t$path = $this->cacheDir . md5($file).'.php';\n\t\t\treturn $path;\n\t\t\t\n\t\t}\n\t\t\n\t\t//删除缓存文件（递归）\n\t\tpublic function clearCache()\n\t\t{\n\t\t\tself::delDir($this->cacheDir);\n\t\t}\n\t\t\n\t\tpublic static function delDir($path)\n\t\t{\n\t\t\t$res = opendir($path);\n\t\t\t\n\t\t\twhile($file = readdir($res)) {\n\t\t\t\tif ($file == '.' || $file == '..') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t$newPath = $path.'/'.$file;\n\t\t\t\t\n\t\t\t\tif (is_dir($newPath)) {\n\t\t\t\t\tself::delDir($newPath);\n\t\t\t\t} else{\n\t\t\t\t\tunlink($newPath);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t}\n\t \t}\n\t\t\n\t}\n```\n5、Upload类\n```\n\t<?php\n\tnamespace Framework;\n\n\n\tclass Upload\n\t{\n\t\t//上传到哪个目录\n\t\tprotected $path = 'Upload/';\n\t\t//准许的MIME\n\t\tprotected $allowmime = ['image/png','image/jpg','image/jpeg','image/pjpeg','image/bmp','image/wbmp','image/gif','image/x-png'];\n\t\t//准许的后缀\n\t\tprotected $allowsubfix = ['jpg','png','jpeg','gif','bmp'];\n\t\t//准许的大小\n\t\tprotected $allowsize = 2097152;\n\t\t//是否准许随机文件名\n\t\tprotected $israndname = true;\n\t\t//是否准许日期目录\n\t\tprotected $isdatepath = true;\n\t\t//文件的大小\n\t\tprotected $size;\n\t\t//文件的原名\n\t\tprotected $orgname;\n\t\t//文件的新名\n\t\tprotected $newname;\n\t\t//文件的后缀\n\t\tprotected $subfix;\n\t\t//文件的MIME类型\n\t\tprotected $mime;\n\t\t//文件的新路径\n\t\tprotected $newpath;\n\t\t//错误号\n\t\tprotected $errorno;\n\t\t//错误信息\n\t\tprotected $errorinfo;\n\t\t//临时文件\n\t\tprotected $tmpfile;\n\t\t//前缀\n\t\tprotected $prefix;\n\t\t\n\t\t\n\t\t//初使化成员属性，传进来的东西特别多，我们要求以数组的形式来传递\n\t\t//foreach循环，取出键名、值\n\t\t//将键名设置为成员属性名，将键值设为成员属性值\n\t\t//注意键名的合法性\n\t\t// errorInfo   errorinfo\n\t\tpublic function __construct(Array $config = [])\n\t\t{\n\t\t\n\t\t\tforeach ($config as $key => $value) {\n\t \n\t\t\t\t$this->setOption($key,$value);\n\t\t\t}\n\t\t\n\t\t}\n\t\t\n\t\tprotected function setOption($key,$value)\n\t\t{\n\t\t\t$key = strtolower($key);\n\t\t\t\n\t\t\t$allPro = get_class_vars(get_class($this));\n\t\t\t//var_dump($allpro);\n\t\t\tif (array_key_exists($key,$allPro)) {\n\t\t\t\t$this->$key = $value;\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t//设置一个get方法专门获得新路径\n\t\t\n\t\t//设置 一个get方法专门来获得错误信息\n\t\t\n\t\t//成员方法上传方法\n\t\tpublic function uploadFile($field)\n\t\t{\n\t\t\t//var_dump($field);die;\n\t\t\t//检测路径用户是否定义过，如果没有定义失败\n\t\t\tif (!file_exists($this->path)) {\n\t\t\t\techo '11111111111';\n\t\t\t\t$this->setOption('errorNo',-1);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t//目录权限检测\n\t\t\tif (!$this->checkPath()) {\n\t\t\t\t$this->setOption('errorNo',-2);\n\t\t\t\treturn false;\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t//获得$_FILES当中五个基本信息\n\t\t\t$name = $_FILES[$field]['name'];\n\t\t\t$size = $_FILES[$field]['size'];\n\t\t\t$type = $_FILES[$field]['type'];\n\t\t\t \n\t\t\t$tmpName = $_FILES[$field]['tmp_name'];\n\t\t\t$error = $_FILES[$field]['error'];\n\t\t\t\n\t\t\t//var_dump($_FILES);die;\n\t\t\t//传入到一个成员方法里面进行设置\n\t\t\tif (!$this->setFiles($name,$size,$type,$tmpName,$error)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t//检测MIME是否合法，检测后缀是否合法，检测文件大小是否超过了自定义的大小\n\t\t\tif (!$this->checkMime() || !$this->checkSubfix() || !$this->checkSize()) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t//新名\n\t\t\t$this->newname = $this->getNewName();\n\t\t\t\n\t\t\t//新路径处理\n\t\t\t$this->newpath = $this->getNewPath();\n\t\t\n\t\t\t//是否是上传文件\n\t\t\t//如果是上传文件移动上传文件至指定的目录\n\t\t\t//如果成员return true\n\t\t\tif( $this->move()){\n\t\t\t\t\n\t\t\t\treturn $this->newpath . $this->newname;\n\t\t\t}\n\t\t\t\t\n\t\t\n\t\t}\n\t\t\n\t\tprotected function move()\n\t\t{\n\t\t\tif (!is_uploaded_file($this->tmpfile)) {\n\t\t\t\t$this->setOption('errorNo',-6);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\n\t\t\t//var_dump($this-tmpfile);\n\t\t\tif (move_uploaded_file($this->tmpfile,$this->newpath.$this->newname)) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\t$this->setOption('errorNo',-7);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\tpublic function getNewPath()\n\t\t{\n\t\t\t$this->path = rtrim($this->path,'/').'/';\n\t\t\t\n\t\t\tif ($this->isdatepath) {\n\t\t\t\t$newpath = $this->path.date('Y/m/d/');\n\t\t\t\tif (!file_exists($newpath)) {\n\t\t\t\t\tmkdir($newpath,0755,true);\n\t\t\t\t}\n\t\t\t\treturn $newpath;\n\t\t\t} else {\n\t\t\t\treturn $this->path;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function getNewName()\n\t\t{\n\t\t\tif ($this->israndname) {\n\t\t\t\t\n\t\t\t\treturn $this->prefix . uniqid() . '.' . $this->subfix;\n\t\t\t} else {\n\t\t\t\treturn $this->prefix . $this->orgname;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprotected function checkSize()\n\t\t{\n\t\t\tif ($this->size > $this->allowsize) {\n\t\t\t\n\t\t\t\t$this->setOption('errorNo',-5);\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function checkSubFix()\n\t\t{\n\t\t\n\t\t\tif (in_array($this->subfix,$this->allowsubfix)) {\n\t\t\t\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\t$this->setOption('errorNo',-4);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprotected function checkMime()\n\t\t{\n\t\t\tif (in_array($this->mime,$this->allowmime)) {\n\t\t\t\t\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\t$this->setOption('errorNo',-3);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t\n\t\tprotected function setFiles($name,$size,$type,$tmpName,$error) {\n\t\t\t//1 2 3 4 6 7  0(正常)\n\t\t\tif ($error) {\n\t\t\t\t$this->setOption('errorNo',$error);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t$this->orgname = $name;\n\t\t\t$this->size = $size;\n\t\t\t$this->tmpfile = $tmpName;\n\t\t\t$this->mime = $type;\n\t\t\t\n\t\t\t//后缀没处理\n\t\t\t$info = pathinfo($name);\n\t\t\t$this->subfix = $info['extension'];\n\t\t\t\n\t\t\treturn true;\n\t\t\t/*\n\t\t\t$arr = explode('.',$name);\n\t\t\t$this->subfix = array_pop($arr);\n\t\t\t\n\t\t\t\n\t\t\t$arr = explode('.',$name);\n\t\t\t$this->subfix = $arr[count($arr)-1];\n\t\t\t\n\t\t\t$pos = strrpos($name,'.');\n\t\t\techo substr($name,$pos + 1);\n\t\t\t*/\n\t\t}\n\t\t\n\t\tprotected function checkPath()\n\t\t{\n\t\t\t//检测路径是否是目录，如果不存在创建\n\t\t\tif (!is_dir($this->path)) {\n\t\t\t\treturn mkdir($this->path,0755,true);\n\t\t\t}\n\t\t\t//检测路径是否可写，如果不写写更改权限\n\t\t\tif (!is_writeable($this->path) ||  !is_readable($this->path)) {\n\t\t\t\treturn chmod($this->path,0755);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\tprotected function getErrorInfo()\n\t\t{\n\t\t\tswitch ($this->errorno) {\n\t\t\t\tcase 1:\n\t\t\t\t\t$str = '上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\t$str = '上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\t$str = '部份件被上传';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\t$str = '没有文件被上传';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 6:\n\t\t\t\t\t$str = '找不到临时文件夹';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 7:\n\t\t\t\t\t$str = '临时文件写入失败';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -1:\n\t\t\t\t\t$str = '自定义的上传路径不存在';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -2:\n\t\t\t\t\t$str = '没有权限';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -3:\n\t\t\t\tcase -4:\n\t\t\t\t\t$str = '类型或后缀不准许';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -5:\n\t\t\t\t\t$str = '超过了自定义的大小';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -6:\n\t\t\t\t\t$str = '不是上传文件';\n\t\t\t\t\tbreak;\n\t\t\t\tcase -7:\n\t\t\t\t\t$str = '移动上传文件失败';\n\t\t\t\t\tbreak;\n\t\t\t\t\n\t\t\t}\n\t\t\treturn $str;\n\t\t}\n\t\t\n\t\tpublic function __get($key)\n\t\t{\n\t\t\tif (in_array($key, ['newpath','newname','errorno','size'])) {\n\t\t\t\tvar_dump($key);\n\t\t\t\treturn $this->$key;\n\t\t\t} else if ($key == 'errorinfo') {\n\t\t\t\treturn $this->getErrorInfo();\n\t\t\t}\n\t\t}\n\t}\n```\n6、Verify类\n```\n\t<?php\n\tnamespace Framework;\n\n\n\tclass Verify\n\t{\n\t\t//宽\n\t\tprotected $width;\n\t\t//高\n\t\tprotected $height;\n\t\t//图片类型\n\t\tprotected $imgType;\n\t\t//文字类型\n\t\tprotected $codeType;\n\t\t//文字的个数\n\t\tprotected $num;\n\t\t//保存的验证码字符串\n\t\tprotected $verifyCode;\n\t\t//保存验证码资源的一个成员属性\n\t\tprotected $res;\n\t\t\n\t\t\n\t\t//初始化成员\n\t\t//上面这些参数\n\t\tpublic function __construct($width = 100, $height = 50, $imgType = 'png', $codeType = 3, $num = 4)\n\t\t{\n\t\t\t$this->width = $width;\n\t\t\t$this->height = $height;\n\t\t\t$this->imgType = $imgType;\n\t\t\t$this->codeType = $codeType;\n\t\t\t$this->num = $num;\n\t\t\t$this->verifyCode = $this->createVerifyCode();\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function  createVerifyCode()\n\t\t{\n\t\t\t$string = '';\n\t\t\t\n\t\t\tswitch ($this->codeType) {\n\t\t\t\tcase 1:\n\t\t\t\t\t$string = implode('',array_rand(range(0,9),$this->num));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\t$string = join('',array_rand(array_flip(range('a','z')),4));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\t/*\n\t\t\t\t\tfor ($i = 0; $i < $this->num; $i++) {\n\t\t\t\t\t\t$r= mt_rand(0,2);\n\t\t\t\t\t\tswitch ($r) {\n\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\t$ascii = mt_rand(48,57);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\t\t$ascii = mt_rand(65,90);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\t$ascii = mt_rand(97,122);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$string .= chr($ascii);\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t\t$str = 'abcdefghijkmnpqrstuvwxzABCDEFGHJKLMNPQRSTUVWXYZ23456789';\n\t\t\t\t\t$string = substr(str_shuffle($str),0,$this->num);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\treturn $string;\n\t\t}\n\t\t\n\t\t//调验证码显示的一个方法 output\n\t\t//1.画图\n\t\t//2.分配颜色(写两个成员方法，调的时候直接调对应的成员方法即可)\n\t\t//3.背景填充\n\t\t//4.画干扰点\n\t\t//5.画干扰线\n\t\t//6.写字 \n\t\t//7. 输出类型\n\t\t//8. 输出图片\n\t\tpublic function outImg()\n\t\t{\n\t\t\t$this->createImg();\n\t\t\t$this->fillBgColor();\n\t\t\t$this->fillPix();\n\t\t\t$this->fillArc();\n\t\t\t$this->writeFont();\n\t\t\t$this->output();\n\t\t}\n\t\t\n\t\tprotected function output()\n\t\t{\n\t\t\t//imagepng\n\t\t\t$func = 'image'.$this->imgType;\n\t\t\t$mime = 'Content-type:image/'.$this->imgType;\n\t\t\theader($mime);\n\t\t\t$func($this->res);\n\t\t}\n\t\t\n\t\tprotected function writeFont()\n\t\t{\n\t\t\tfor ($i = 0; $i < $this->num; $i++) {\n\t\t\t\t\n\t\t\t\t$width = ceil($this->width / $this->num);\n\t\t\t\t$x = $width * $i;\n\t\t\t\t$y= mt_rand(5,$this->height - 10);\n\t\t\t\t$c = $this->verifyCode[$i];\n\t\t\t\timagechar($this->res,5,$x,$y,$c,$this->darkColor());\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tprotected function fillArc()\n\t\t{\n\t\t\tfor($i = 0; $i < 10; $i++) {\n\t\t\t\timagearc($this->res,\n\t\t\t\t\t\tmt_rand(10,$this->width - 10),\n\t\t\t\t\t\tmt_rand(10,$this->height - 10),\n\t\t\t\t\t\tmt_rand(0,$this->width),\n\t\t\t\t\t\tmt_rand(0,$this->height),\n\t\t\t\t\t\tmt_rand(0,180),\n\t\t\t\t\t\tmt_rand(181,360),\n\t\t\t\t\t\t$this->lightColor()\n\t\t\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\t\n\t\tprotected function fillPix()\n\t\t{\n\t\t\t$num = $this->pixNum();\n\t\t\tfor ($i = 0; $i < $num; $i++) {\n\t\t\t\t\n\t\t\t\timagesetpixel($this->res,mt_rand(0,$this->width),mt_rand(0,$this->height),$this->darkColor());\n\t\t\t}\n\t\t}\n\t\t\n\t\tprotected function pixNum()\n\t\t{\n\t\t\t$area = ceil(($this->width * $this->height) / 20);\n\t\t\treturn $area;\n\t\t}\n\t\t\n\t\t\n\t\tprotected function fillBgColor()\n\t\t{\n\t\t\timagefill($this->res,0,0,$this->lightColor());\n\t\t}\n\t\t\n\t\t\n\t\tprotected function lightColor()\n\t\t{\n\t\t\treturn imagecolorallocate($this->res,\n\t\t\t\t\t\t\t   mt_rand(130,255),\n\t\t\t\t\t\t\t   mt_rand(130,255),\n\t\t\t\t\t\t\t   mt_rand(130,255)\n\t\t\t\t\t\t\t\t);\n\t\t}\n\t\t\n\t\tprotected function darkColor()\n\t\t{\n\t\t\treturn imagecolorallocate($this->res,\n\t\t\t\t\t\t\t   mt_rand(0,120),\n\t\t\t\t\t\t\t   mt_rand(0,120),\n\t\t\t\t\t\t\t   mt_rand(0,120)\n\t\t\t\t\t\t\t\t);\n\t\t}\n\t\t\n\t\tprotected function createImg()\n\t\t{\n\t\t\t$this->res = imagecreatetruecolor($this->width,$this->height);\n\t\t}\n\t\t\n\t\t//9 .销毁图片资源\n\t\tpublic function __destruct()\n\t\t{\n\t\t\t//imagedestroy($this->res);\n\t\t}\n\t\t\n\t\t//可以做一个魔术方法__get专门用于得到验证码字符串\n\t\tpublic function __get($key)\n\t\t{\n\t\t\tif ($key == 'verifyCode') {\n\t\t\t\treturn $this->$key;\n\t\t\t}\n\t\t\t\n\t\t\treturn false;\n\t\t}\n\t}\n```\n7、auto_load(类的自动加载)\n```\n<?php\n\tclass Init\n\t{\n\t\t\n\t\tpublic function loader()\n\t\t{\n\t\t\t$psr = new Psr4();\n\t\t\t$psr->register();\n\t\t\t\n\t\t\tforeach ($GLOBALS['nameSpace'] as $name => $baseDir) {\n\t\t\t\t$psr->addNamespace($name,$baseDir);\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic function router()\n\t\t{\n\t\t\t$this->loader();\n\t\t\t\n\t\t\t$_GET['m'] = isset($_GET['m']) ? ucfirst(strtolower($_GET['m'])) : 'Index';\n\t\t\t$_GET['a'] = isset($_GET['a']) ? $_GET['a'] :'index';\n\t\t\t\n\t\t\t$controllerName = 'Controller\\\\'.$_GET['m'].'Controller';\n\t\t\t\n\t\t\t\n\t\t\t$mod = new $controllerName();\n\t\t\t\n\t\t\tif (method_exists($mod,$_GET['a'])) {\n\t\t\t\t\n\t\t\t\tcall_user_func(array($mod,$_GET['a']));\n\t\t\t} else{\n\t\t\t\texit('方法不合法');\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t}\n```\n8、PSR_4\n```\n\t<?php\n\tclass Psr4\n\t{\n\t\t\n\t\tprivate $prefixes;\n\t\t\n\t\t\n\t\tpublic function register()\n\t\t{\n\t\t\tspl_autoload_register(array($this,'loadClass'));\n\t\t}\n\t\t\n\t\tpublic function addNamespace($nameSpace, $path)\n\t\t{\n\t\t\t$nameSpace = trim($nameSpace,'\\\\');\n\t\t\t$path = rtrim($path,DIRECTORY_SEPARATOR).'/';\n\t\t\t\n\t\t\tif (isset($this->prefixes[$nameSpace]) == false) {\n\t\t\t\t$this->prefixes[$nameSpace] = array();\n\t\t\t}\n\t\t\t\n\t\t\tarray_push($this->prefixes[$nameSpace],$path);\n\t\t\t\n\t\t}\n\t\t\n\t\tprivate function loadClass($className)\n\t\t{\n\t\t\t$pos = strrpos($className,'\\\\');\n\t\t\t//µÃµ½ÃüÃû¿Õ¼ä\n\t\t\t$nameSpace = substr($className,0, $pos);\n\t\t\t$realClass = substr($className,$pos + 1);\n\t\t\t\n\t\t\t\n\t\t\t//´¦ÀíÓ³Éä°üº¬\n\t\t\t$this->mappingFile($nameSpace, $realClass);\n\t\t}\n\t\t\n\t\tprivate function mappingFile($nameSpace, $realClass)\n\t\t{\n\t\t\tif (isset($this->prefixes[$nameSpace]) == false) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\tforeach ($this->prefixes[$nameSpace] as $baseDir) {\n\t\t\t\t$file = $baseDir . str_replace('\\\\','/',$realClass).'.php';\n\t\t\t\t\n\t\t\t\t$this->requireFile($file);\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tprivate function requireFile($file)\n\t\t{\n\t\t\tif (file_exists($file)) {\n\t\t\t\tinclude $file;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t}\n```\n9、NameSpace\n```\n\t<?php\n\treturn [\n\t\t'Model' => 'App/Model/',\n\t\t'Controller' => 'App/Controller/',\n\t\t'Framework' => 'Vendor/Phone/Framework/Src/',\n\t];\n```","slug":"MVC","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuw80005ydqndmoasn9z","content":"<p>我将MVC归属在设计模式里面,个人对MVC的理解它应该为一种设计模式。</p>\n<a id=\"more\"></a>\n<h2 id=\"什么是MVC\"><a href=\"#什么是MVC\" class=\"headerlink\" title=\"什么是MVC\"></a>什么是MVC</h2><p>由模型(model),视图(view),控制器(controller)完成的应用程序由模型发出要实现的功能到控制器,控制器接收组织功能传递给视图;</p>\n<p>Model(模型)，程序应用功能的实现，程序的逻辑的实现。在PHP中负责数据管理，数据生成;<br>View(视图)，图形界面逻辑。在PHP中负责输出，处理如何调用模板、需要的资源文件;<br>Controller(控制器)，负责转发请求，对请求处理。在PHP中根据请求决定调用的视图及使用的数据;</p>\n<h2 id=\"为什么使用MVC\"><a href=\"#为什么使用MVC\" class=\"headerlink\" title=\"为什么使用MVC\"></a>为什么使用MVC</h2><p>MVC的主要作用是为了将代码分层、分类;<br>MVC的主要目的是为了解决Web开发中分离开发与设计工作，使其工作相对独立;<br>在这样的过程中还发现了其他的一些优点，网站的目录结构更加清晰，网站更易维护与扩展，可以实现模块的复用;</p>\n<h2 id=\"我所认知的MVC\"><a href=\"#我所认知的MVC\" class=\"headerlink\" title=\"我所认知的MVC\"></a>我所认知的MVC</h2><p>MVC 是一个设计模式，它强制性的使应用程序的输入、处理和输出分开。使用 MVC 应 用程序被分成三个核心部件:模型、视图、控制器。它们各自处理自己的任务。视图是 用户看到并与之交互的界面。模型表示企业数据和业务规则。控制器接受用户的输入并 调用模型和视图去完成用户的需求。</p>\n<h2 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h2><p>低耦合性、高重用性和可适用性、较低的生命周期成本、快速的部署、 可维护性、可扩展性，有利于软件工程化管理</p>\n<h2 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h2><p>没有明确的定义，完全理解 MVC 并不容易。不适合小型规模的应用程序;</p>\n<h2 id=\"MVC底层架构\"><a href=\"#MVC底层架构\" class=\"headerlink\" title=\"MVC底层架构\"></a>MVC底层架构</h2><p>1、Image类<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Image</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//路径</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> $path = <span class=\"string\">'./upload/'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//随机文件名</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> $isRandName;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//初使化成员属性</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">__construct</span><span class=\"params\">($path = null , $r = true)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!is_null($path)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;path = rtrim($path,<span class=\"string\">'/'</span>).<span class=\"string\">'/'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; </span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;isRandName = $r;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//water水印的方法  目标和源，自适应能力更强一些，直接调成员方法即可</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//源、目标、位置 、透明度</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">water</span><span class=\"params\">($dst,$src,$pos = <span class=\"number\">9</span>, $prefix = <span class=\"string\">'wa_'</span>, $tmd = <span class=\"number\">100</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//判断文件路径是否存在</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$src = <span class=\"keyword\">$this</span>-&gt;path . $src;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!file_exists($dst) || !file_exists($src))</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'目标者水印图片不存在'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//获取图像的相关信息</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$dstInfo = <span class=\"keyword\">self</span>::getImageInfo($dst);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$srcInfo = <span class=\"keyword\">self</span>::getImageInfo($src);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//判断宽高是否超过了目标图片的宽和高</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;_checkSize($dstInfo,$srcInfo)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'水印图片宽、高不合法'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//摆放位置 </span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$position = <span class=\"keyword\">self</span>::getPosition($dstInfo,$srcInfo,$pos);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//打开图片</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$dstRes = <span class=\"keyword\">self</span>::openImg($dst, $dstInfo);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$srcRes = <span class=\"keyword\">self</span>::openImg($src, $srcInfo);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//将两个图片合并在一起</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$newRes = <span class=\"keyword\">$this</span>-&gt;_mergeImage($dstRes,$srcRes,$position,$dstInfo,$srcInfo,$tmd);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;isRandName) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$path = <span class=\"keyword\">$this</span>-&gt;path.$prefix.uniqid().<span class=\"string\">'.'</span>.$dstInfo[<span class=\"string\">'subfix'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$path = <span class=\"keyword\">$this</span>-&gt;path.$prefix.$dstInfo[<span class=\"string\">'basename'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//保存图片</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">self</span>::saveImage($newRes,$path,$dstInfo);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//销毁资源</span></span></span><br><span class=\"line\"><span class=\"php\">\t\timagedestroy($newRes);</span></span><br><span class=\"line\"><span class=\"php\">\t\timagedestroy($srcRes);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//返回路径</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $path;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//thumb 源 和 宽高</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">thumb</span><span class=\"params\">($dst,$width,$height,$prefix = <span class=\"string\">'thumb_'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//判断文件是否在</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!file_exists($dst)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'文件路径不存在'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//获取图像的信息，没有信息，你什么都 做不鸟</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$info = <span class=\"keyword\">self</span>::getImageInfo($dst);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//得到新的尺寸</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$newSize = <span class=\"keyword\">self</span>::getNewSize($width,$height,$info);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//打开资源</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$res = <span class=\"keyword\">self</span>::openImg($dst,$info);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//等比缩放这个资源，处理gif背景变黑的问题 </span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$newRes = <span class=\"keyword\">self</span>::kidOfImage($res,$newSize,$info);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//保存</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$path = <span class=\"keyword\">$this</span>-&gt;path.$prefix.$info[<span class=\"string\">'basename'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">self</span>::saveImage($newRes,$path,$info);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//销毁</span></span></span><br><span class=\"line\"><span class=\"php\">\t\timagedestroy($newRes);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//返回路径</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $path;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">kidOfImage</span><span class=\"params\">($srcImg, $size, $imgInfo)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$newImg = imagecreatetruecolor($size[<span class=\"string\">\"width\"</span>], $size[<span class=\"string\">\"height\"</span>]);\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$otsc = imagecolortransparent($srcImg);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> ( $otsc &gt;= <span class=\"number\">0</span> &amp;&amp; $otsc &lt; imagecolorstotal($srcImg)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t $transparentcolor = imagecolorsforindex( $srcImg, $otsc );</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t $newtransparentcolor = imagecolorallocate(</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t $newImg,</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t $transparentcolor[<span class=\"string\">'red'</span>],</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t $transparentcolor[<span class=\"string\">'green'</span>],</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t $transparentcolor[<span class=\"string\">'blue'</span>]</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t );</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t imagefill( $newImg, <span class=\"number\">0</span>, <span class=\"number\">0</span>, $newtransparentcolor );</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t imagecolortransparent( $newImg, $newtransparentcolor );</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t\timagecopyresized( $newImg, $srcImg, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, $size[<span class=\"string\">\"width\"</span>], $size[<span class=\"string\">\"height\"</span>], $imgInfo[<span class=\"string\">\"width\"</span>], $imgInfo[<span class=\"string\">\"height\"</span>] );</span></span><br><span class=\"line\"><span class=\"php\">\t\timagedestroy($srcImg);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $newImg;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNewSize</span><span class=\"params\">($width, $height, $imgInfo)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$size[<span class=\"string\">\"width\"</span>] = $imgInfo[<span class=\"string\">\"width\"</span>];   <span class=\"comment\">//将原图片的宽度给数组中的$size[\"width\"]</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$size[<span class=\"string\">\"height\"</span>] = $imgInfo[<span class=\"string\">\"height\"</span>];  <span class=\"comment\">//将原图片的高度给数组中的$size[\"height\"]</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span>($width &lt; $imgInfo[<span class=\"string\">\"width\"</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$size[<span class=\"string\">\"width\"</span>] = $width;             <span class=\"comment\">//缩放的宽度如果比原图小才重新设置宽度</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> ($width &lt; $imgInfo[<span class=\"string\">\"height\"</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$size[<span class=\"string\">\"height\"</span>] = $height;            <span class=\"comment\">//缩放的高度如果比原图小才重新设置高度</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span>($imgInfo[<span class=\"string\">\"width\"</span>]*$size[<span class=\"string\">\"width\"</span>] &gt; $imgInfo[<span class=\"string\">\"height\"</span>] * $size[<span class=\"string\">\"height\"</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$size[<span class=\"string\">\"height\"</span>] = round($imgInfo[<span class=\"string\">\"height\"</span>] * $size[<span class=\"string\">\"width\"</span>] / $imgInfo[<span class=\"string\">\"width\"</span>]);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$size[<span class=\"string\">\"width\"</span>] = round($imgInfo[<span class=\"string\">\"width\"</span>] * $size[<span class=\"string\">\"height\"</span>] / $imgInfo[<span class=\"string\">\"height\"</span>]);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $size;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">saveImage</span><span class=\"params\">($res,$path,$info)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">switch</span> ($info[<span class=\"string\">'mime'</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/png'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/x-png'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\timagepng($res,$path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/jpeg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/jpg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/pjpeg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\timagejpeg($res,$path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/gif'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\timagegif($res,$path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/wbmp'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/bmp'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\timagewbmp($res,$path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_mergeImage</span><span class=\"params\">($dstRes,$srcRes,$position,$dstInfo,$srcInfo,$tmd)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\timagecopymerge($dstRes,$srcRes,$position[<span class=\"string\">'x'</span>],$position[<span class=\"string\">'y'</span>],<span class=\"number\">0</span>,<span class=\"number\">0</span>,$srcInfo[<span class=\"string\">'width'</span>],$srcInfo[<span class=\"string\">'height'</span>],$tmd);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $dstRes;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">openImg</span><span class=\"params\">($path, $info)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">switch</span> ($info[<span class=\"string\">'mime'</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/png'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/x-png'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$res = imagecreatefrompng($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/jpeg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/jpg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/pjpeg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$res = imagecreatefromjpeg($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/gif'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$res = imagecreatefromgif($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/wbmp'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/bmp'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$res = imagecreatefromwbmp($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $res;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getPosition</span><span class=\"params\">($dstInfo,$srcInfo,$pos)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">switch</span> ($pos) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = ceil(($dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>]) / <span class=\"number\">2</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = $dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = ceil(($dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>]) /<span class=\"number\">2</span> );</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = ceil(($dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>]) / <span class=\"number\">2</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = ceil(($dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>]) /<span class=\"number\">2</span> );</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = $dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = ceil(($dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>]) /<span class=\"number\">2</span> );</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = $dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = ceil(($dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>]) / <span class=\"number\">2</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = $dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = $dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = $dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">default</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = mt_rand(<span class=\"number\">0</span>,$dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>]);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = mt_rand(<span class=\"number\">0</span>,$dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>]);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> [<span class=\"string\">'x'</span> =&gt; $x, <span class=\"string\">'y'</span> =&gt; $y];</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_checkSize</span><span class=\"params\">($dstInfo,$srcInfo)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> ($dstInfo[<span class=\"string\">'width'</span>] &lt; $srcInfo[<span class=\"string\">'width'</span>] || $dstInfo[<span class=\"string\">'height'</span>] &lt; $srcInfo[<span class=\"string\">'height'</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span>  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getImageInfo</span><span class=\"params\">($path)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data = [];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$info = getimagesize($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data[<span class=\"string\">'width'</span>] = $info[<span class=\"number\">0</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data[<span class=\"string\">'height'</span>] = $info[<span class=\"number\">1</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data[<span class=\"string\">'mime'</span>] = $info[<span class=\"string\">'mime'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$path = pathinfo($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data[<span class=\"string\">'basename'</span>] = $path[<span class=\"string\">'basename'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data[<span class=\"string\">'subfix'</span>] = $path[<span class=\"string\">'extension'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $data;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>2、Model类<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Model</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//连接</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $link;</span><br><span class=\"line\">\t<span class=\"comment\">//用户名</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $user;</span><br><span class=\"line\">\t<span class=\"comment\">//密码</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $pwd;</span><br><span class=\"line\">\t<span class=\"comment\">//字符集</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $charset;</span><br><span class=\"line\">\t<span class=\"comment\">//表前缀</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $prefix;</span><br><span class=\"line\">\t<span class=\"comment\">//库名</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $dbName;</span><br><span class=\"line\">\t<span class=\"comment\">//主机</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $host;</span><br><span class=\"line\">\t<span class=\"comment\">//表名</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $table;</span><br><span class=\"line\">\t<span class=\"comment\">//字段</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $fields;</span><br><span class=\"line\">\t<span class=\"comment\">//保存的查询、更新、添加的参数</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $options;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//初使化数据库连接</span></span><br><span class=\"line\">\t<span class=\"comment\">//把一批成员属性都 初使化</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(Array $config)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;host = $config[<span class=\"string\">'DB_HOST'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;user = $config[<span class=\"string\">'DB_USER'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;pwd = $config[<span class=\"string\">'DB_PWD'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;dbName = $config[<span class=\"string\">'DB_NAME'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;charset = $config[<span class=\"string\">'DB_CHARSET'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;prefix = $config[<span class=\"string\">'DB_PREFIX'</span>];</span><br><span class=\"line\">\t\t<span class=\"comment\">//连接</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;link = <span class=\"keyword\">$this</span>-&gt;connect();</span><br><span class=\"line\">\t\t<span class=\"comment\">//判断是否连接失败</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;link) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'数据库连接失败'</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">//表名</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;table = <span class=\"keyword\">$this</span>-&gt;getTable();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">//字段</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;fields = <span class=\"keyword\">$this</span>-&gt;getFields();</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//连接数库</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$conn = mysqli_connect(<span class=\"keyword\">$this</span>-&gt;host,<span class=\"keyword\">$this</span>-&gt;user,<span class=\"keyword\">$this</span>-&gt;pwd);</span><br><span class=\"line\">\t\t<span class=\"comment\">//连接失败</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!$conn) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">//选择库失败处理</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!mysqli_select_db($conn,<span class=\"keyword\">$this</span>-&gt;dbName)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t\tmysqli_set_charset($conn,<span class=\"keyword\">$this</span>-&gt;charset);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $conn;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//初始化表</span></span><br><span class=\"line\">\t<span class=\"comment\">//（报错，我们再根据命名空间去解决，涉及到命名空间的类名）</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getTable</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;table)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//用户设置 过以用户设置的为准</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;prefix . ltrim(<span class=\"keyword\">$this</span>-&gt;table,<span class=\"keyword\">$this</span>-&gt;prefix);</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ($pos = strpos(get_class(<span class=\"keyword\">$this</span>),<span class=\"string\">'\\\\'</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;prefix .  strtolower(str_replace([<span class=\"string\">'Model'</span>,<span class=\"string\">'model'</span>],<span class=\"string\">''</span>,substr(get_class(<span class=\"keyword\">$this</span>),$pos + <span class=\"number\">1</span>)));</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//用户没有设置过，以类名拼接前缀，给成成全新的表名</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;prefix .strtolower(substr(get_class(<span class=\"keyword\">$this</span>),<span class=\"number\">0</span>,<span class=\"number\">-5</span>));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//始初化字段</span></span><br><span class=\"line\">\t<span class=\"comment\">//要把字段缓存到一个文件中去</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getFields</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//如果有字段的文件则说明曾经缓存过这个文件，直接包含进来即可</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//知道文件路径命名的规则 </span></span><br><span class=\"line\">\t\t$filePath = <span class=\"string\">'./Cache/'</span>.<span class=\"keyword\">$this</span>-&gt;table.<span class=\"string\">'.php'</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (file_exists($filePath)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">include</span> $filePath;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t$fields = <span class=\"keyword\">$this</span>-&gt;queryFields();</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t$str = <span class=\"string\">\"&lt;?php \\nreturn \"</span>.var_export($fields,<span class=\"keyword\">true</span>).<span class=\"string\">';?&gt;'</span>;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tfile_put_contents($filePath,$str);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $fields;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//查询出字段</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">queryFields</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">'desc '</span>.<span class=\"keyword\">$this</span>-&gt;table;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$data = <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$fields = [];</span><br><span class=\"line\">\t\t<span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $key =&gt; $val) &#123;</span><br><span class=\"line\">\t\t\t$fields[] = $val[<span class=\"string\">'Field'</span>];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ($val[<span class=\"string\">'Key'</span>] == <span class=\"string\">'PRI'</span>) &#123;</span><br><span class=\"line\">\t\t\t\t$fields[<span class=\"string\">'_pk'</span>] = $val[<span class=\"string\">'Field'</span>];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $fields;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//系统级的查询方法，设置 为public ，如果在外部想要调用的时候，想自定sql句的候，可以直接query</span></span><br><span class=\"line\">\t<span class=\"comment\">//查询应的结果，这个仅供读取使用</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">query</span><span class=\"params\">($sql)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$result = mysqli_query(<span class=\"keyword\">$this</span>-&gt;link,$sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ($result) &#123;</span><br><span class=\"line\">\t\t\t$data = [];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span>($row = mysqli_fetch_assoc($result)) &#123;</span><br><span class=\"line\">\t\t\t\t$data[] = $row;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> $data;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//查询方法</span></span><br><span class=\"line\">\t<span class=\"comment\">//准备好无需换的SQL语句</span></span><br><span class=\"line\">\t<span class=\"comment\">//用户调用询的时候，将call里面保存进去的参数，一一替换sql语句</span></span><br><span class=\"line\">\t<span class=\"comment\">//发送SQL语句</span></span><br><span class=\"line\">\t<span class=\"comment\">//返回查询果</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">select</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select %FIELDS% from %TABLE% %WHERE% %GROUP% %HAVING% %ORDER% %LIMIT%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$newSql = str_replace(</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%FIELDS%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%GROUP%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%HAVING%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%ORDER%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%LIMIT%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseFields(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseGroup(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseHaving(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseOrder(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseLimit(),</span><br><span class=\"line\">\t\t\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//为了在外面想知道自动生成的SQL语旬是神马的时候</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $newSql;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;query($newSql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseFields</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//因为我们对比字段的时候不需要对比主键是谁</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//因此，我干掉主键 </span></span><br><span class=\"line\">\t\t$fields = <span class=\"keyword\">$this</span>-&gt;fields;</span><br><span class=\"line\">\t\t<span class=\"keyword\">unset</span>($fields[<span class=\"string\">'_pk'</span>]);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//用户向fileds('id,username,password') 先将其切割，用,号切割explode</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//如果用户传的是一个数组fileds(['id','username','password'])，则对比应的字段，算交集</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//array_intersect</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//array_intersect_key</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//array_intersect_assoc</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//array_intersect_ukey</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//是数组的时怎么处理法</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (is_array(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">foreach</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>] <span class=\"keyword\">as</span> $key =&gt; $val) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (!in_array($val,$fields)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">unset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>][$key]);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> join(<span class=\"string\">','</span>,<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">elseif</span> (is_string(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//是字符串的时候先变为组再处理</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>] = explode(<span class=\"string\">','</span>,<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">foreach</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>] <span class=\"keyword\">as</span> $key =&gt; $val) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (!in_array($val,$fields)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">unset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>][$key]);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> join(<span class=\"string\">','</span>,<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> join(<span class=\"string\">','</span>,$fields);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//判断用户有没有手动指定过查询哪个用</span></span><br><span class=\"line\">\t<span class=\"comment\">//如果指定过，则以用户设定的options里面的表为准</span></span><br><span class=\"line\">\t<span class=\"comment\">//如果没有设定过，则以默认的为准</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseTable</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'table'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'table'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;table;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//看看用户是否设置过where，如果设置过以用户设置 的为准</span></span><br><span class=\"line\">\t<span class=\"comment\">//如果没有设置 则为空</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseWhere</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'where'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'WHERE '</span>.<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'where'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseGroup</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'group'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'GROUP BY '</span>.<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'group'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseHaving</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'having'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'HAVING '</span>.<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'having'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseOrder</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'order'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'ORDER BY '</span>.<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'order'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//limit可以有以下几种传法</span></span><br><span class=\"line\">\t<span class=\"comment\">//用户传进来的是一个整 数，就是查询指定的条数</span></span><br><span class=\"line\">\t<span class=\"comment\">//用户传进来的是一个数组，则数组中的第一个元素为$offset,第二个元素为$num</span></span><br><span class=\"line\">\t<span class=\"comment\">//如果户传进来的是一个字符串，则以用户传的为准</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseLimit</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (is_int(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'LIMIT '</span>.<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">elseif</span> (is_array(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'LIMIT '</span>. join(<span class=\"string\">','</span>,<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'LIMIT '</span> . <span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//增加方法</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">($data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"insert into %TABLE%(%FIELDS%) values(%VALUES%)\"</span>;</span><br><span class=\"line\">\t\t<span class=\"comment\">//insert into bbs_user(username,sex) values('liwenkai','null');</span></span><br><span class=\"line\">\t\t$newSql = str_replace(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">array</span>(<span class=\"string\">'%TABLE%'</span>,<span class=\"string\">'%FIELDS%'</span>,<span class=\"string\">'%VALUES%'</span>),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseInsertFields($data),</span><br><span class=\"line\">\t\t\t\t\t\tjoin(<span class=\"string\">','</span>,<span class=\"keyword\">$this</span>-&gt;parseValue($data)),</span><br><span class=\"line\">\t\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $newSql;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//echo $newSql;</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;exec($newSql,<span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseValue</span><span class=\"params\">($data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_string($data)) &#123;</span><br><span class=\"line\">\t\t\t$data = <span class=\"string\">'\\''</span>.$data.<span class=\"string\">'\\''</span>;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">elseif</span> (is_array($data)) &#123;</span><br><span class=\"line\">\t\t\t$data = array_map(<span class=\"keyword\">array</span>(<span class=\"keyword\">$this</span>,<span class=\"string\">'parseValue'</span>),$data);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">elseif</span> (is_null($data)) &#123;</span><br><span class=\"line\">\t\t\t$data = <span class=\"string\">'null'</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"> \t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseInsertFields</span><span class=\"params\">(&amp;$data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $key =&gt; $value) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (!in_array($key,<span class=\"keyword\">$this</span>-&gt;fields)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">unset</span>($data[$key]);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> join(<span class=\"string\">','</span>,array_keys($data));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//更新方法</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">($data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"update %TABLE% set %SETS% %WHERE% %ORDER% %LIMIT%\"</span>;</span><br><span class=\"line\">\t\t$newSql = str_replace(</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">array</span>(<span class=\"string\">'%TABLE%'</span>,<span class=\"string\">'%SETS%'</span>,<span class=\"string\">'%WHERE%'</span>,<span class=\"string\">'%ORDER%'</span>,<span class=\"string\">'%LIMIT%'</span>),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseSets($data),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseOrder(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseLimit(),</span><br><span class=\"line\">\t\t\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t\t);</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $newSql;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;exec($newSql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseSets</span><span class=\"params\">($data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$sets = [];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $key =&gt; $val) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (in_array($key,<span class=\"keyword\">$this</span>-&gt;fields)) &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t$sets[] = $key.<span class=\"string\">'='</span>.<span class=\"keyword\">$this</span>-&gt;parseValue($val);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> join(<span class=\"string\">','</span>,$sets) ;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//删除方法</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delete</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"delete from %TABLE% %WHERE% %ORDER% %LIMIT%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$newSql = str_replace(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">array</span>(<span class=\"string\">'%TABLE%'</span>,<span class=\"string\">'%WHERE%'</span>,<span class=\"string\">'%ORDER%'</span>,<span class=\"string\">'%LIMIT%'</span>),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseOrder(),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseLimit(),</span><br><span class=\"line\">\t\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $newSql;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;exec($newSql);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">exec</span><span class=\"params\">($sql, $isInsertId = false)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$result = mysqli_query(<span class=\"keyword\">$this</span>-&gt;link,$sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ($result) &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ( $isInsertId ) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//insert 返回自动增长的ID</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> mysqli_insert_id(<span class=\"keyword\">$this</span>-&gt;link);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//update delete只直返回 受影响行数</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> mysqli_affected_rows(<span class=\"keyword\">$this</span>-&gt;link);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t&#125;\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//查最大值 </span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span><span class=\"params\">($field = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_null($field)) &#123;</span><br><span class=\"line\">\t\t\t$field = <span class=\"keyword\">$this</span>-&gt;fields[<span class=\"string\">'_pk'</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select count($field) as num  from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t$data =  <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data[<span class=\"number\">0</span>][<span class=\"string\">'num'</span>];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//最小值 </span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">min</span><span class=\"params\">($field = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_null($field)) &#123;</span><br><span class=\"line\">\t\t\t$field = <span class=\"keyword\">$this</span>-&gt;fields[<span class=\"string\">'_pk'</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select min($field) as num  from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t$data =  <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data[<span class=\"number\">0</span>][<span class=\"string\">'num'</span>];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sum</span><span class=\"params\">($field = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_null($field)) &#123;</span><br><span class=\"line\">\t\t\t$field = <span class=\"keyword\">$this</span>-&gt;fields[<span class=\"string\">'_pk'</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select SUM($field) as num  from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t$data =  <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data[<span class=\"number\">0</span>][<span class=\"string\">'num'</span>];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//求最大值 </span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">max</span><span class=\"params\">($field = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_null($field)) &#123;</span><br><span class=\"line\">\t\t\t$field = <span class=\"keyword\">$this</span>-&gt;fields[<span class=\"string\">'_pk'</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select max($field) as num  from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t$data =  <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data[<span class=\"number\">0</span>][<span class=\"string\">'num'</span>];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//求平均数</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">avg</span><span class=\"params\">($field = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_null($field)) &#123;</span><br><span class=\"line\">\t\t\t$field = <span class=\"keyword\">$this</span>-&gt;fields[<span class=\"string\">'_pk'</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select avg($field) as num  from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t$data =  <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data[<span class=\"number\">0</span>][<span class=\"string\">'num'</span>];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBy</span><span class=\"params\">($field,$value)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select %FIELDS% from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(<span class=\"string\">'%FIELDS%'</span>,<span class=\"string\">'%TABLE%'</span>,<span class=\"string\">'%WHERE%'</span>),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseFields(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'WHERE '</span>.$field . <span class=\"string\">\"='$value'\"</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//自动的一个按照字段来查询的智能化查询方法</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//__call方法，针对用户请求的limit()  order()  group having等将其保存到options中去</span></span><br><span class=\"line\">\t<span class=\"comment\">//并且判断方法的法性</span></span><br><span class=\"line\">\t<span class=\"comment\">//并且return $this，让其能连贯操作。ORM （对象映射模型）$user-&gt;limit()-&gt;order()</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($func,$args)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$allow = [<span class=\"string\">'where'</span>,<span class=\"string\">'table'</span>,<span class=\"string\">'fields'</span>,<span class=\"string\">'order'</span>,<span class=\"string\">'limit'</span>,<span class=\"string\">'group'</span>,<span class=\"string\">'having'</span>];</span><br><span class=\"line\">\t\t$func = strtolower($func);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (in_array($func,$allow)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">$this</span>-&gt;options[$func] = $args;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">elseif</span>(substr($func,<span class=\"number\">0</span>,<span class=\"number\">5</span>) == <span class=\"string\">'getby'</span>)&#123;</span><br><span class=\"line\">\t\t\t$field = substr($func,<span class=\"number\">5</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (in_array($field,<span class=\"keyword\">$this</span>-&gt;fields)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;getby($field,$args[<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'方法不合法'</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//对象销毁者关闭页面的时候，自动执行</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\tmysqli_close(<span class=\"keyword\">$this</span>-&gt;link);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>3、Page类<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//声明page类</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Page</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//url</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $url;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//总页数</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $pageCount;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//总条数</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $total;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//每页显示数</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $num;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//当前页</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $page;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//初使化成员属性</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($total, $num = <span class=\"number\">5</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//总条数</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;total = ($total &gt; <span class=\"number\">0</span>) ? (int) $total : <span class=\"number\">1</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//每页显示数</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;num = $num;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//总页数</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;pageCount = <span class=\"keyword\">$this</span>-&gt;getPageCount();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//当前页</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;page = <span class=\"keyword\">$this</span>-&gt;getCurrentPage();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//url</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;url = <span class=\"keyword\">$this</span>-&gt;getUrl();</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//一次性返回所有的分页信息</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">rendor</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> [</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"string\">'first'</span> =&gt; <span class=\"keyword\">$this</span>-&gt;first(),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"string\">'next'</span> =&gt; <span class=\"keyword\">$this</span>-&gt;next(),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"string\">'prev'</span> =&gt; <span class=\"keyword\">$this</span>-&gt;prev(),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"string\">'end'</span> =&gt; <span class=\"keyword\">$this</span>-&gt;end(),</span></span><br><span class=\"line\"><span class=\"php\">\t\t];</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//limit方法，在未来分页数据查询时候，直接返回对应的limit 0,5 这样的字符串</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">limit</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$offset = (<span class=\"keyword\">$this</span>-&gt;page - <span class=\"number\">1</span>) * <span class=\"keyword\">$this</span>-&gt;num;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$str = $offset.<span class=\"string\">','</span>.<span class=\"keyword\">$this</span>-&gt;num;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $str;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">end</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;setQueryString(<span class=\"string\">'page='</span>.<span class=\"keyword\">$this</span>-&gt;pageCount);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//上一页</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">prev</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$page = (<span class=\"keyword\">$this</span>-&gt;page &lt;=<span class=\"number\">1</span>) ? <span class=\"number\">1</span> : (<span class=\"keyword\">$this</span>-&gt;page <span class=\"number\">-1</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;setQueryString(<span class=\"string\">'page='</span>.$page);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//下一页</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">next</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$page = (<span class=\"keyword\">$this</span>-&gt;page &gt;= <span class=\"keyword\">$this</span>-&gt;pageCount) ?  <span class=\"keyword\">$this</span>-&gt;pageCount : (<span class=\"keyword\">$this</span>-&gt;page + <span class=\"number\">1</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;setQueryString(<span class=\"string\">'page='</span>.$page);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//首页</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">first</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//设置查询的page页码为第一页，即为首页</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;setQueryString(<span class=\"string\">'page=1'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//一种况有?，一种情况是没有?的情况</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setQueryString</span><span class=\"params\">($page)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果url当中有问号</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (strpos(<span class=\"keyword\">$this</span>-&gt;url, <span class=\"string\">'?'</span>)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;url.<span class=\"string\">'&amp;'</span>.$page;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果url当中没有问号</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;url.<span class=\"string\">'?'</span>.$page;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getUrl</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$path = $_SERVER[<span class=\"string\">'REQUEST_URI'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//先要获取户传进来的URI</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//用parse_url 解释URI</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$par = parse_url($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//判断是否设置过query</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($par[<span class=\"string\">'query'</span>])) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\tparse_str($par[<span class=\"string\">'query'</span>],$query);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"comment\">//检查query里面是否有page,如果有就干掉page</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">unset</span>($query[<span class=\"string\">'page'</span>]);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$path = $par[<span class=\"string\">'path'</span>].<span class=\"string\">'?'</span>.http_build_query($query);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$path = rtrim($path,<span class=\"string\">'?'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//协议：主机：端口：文件和请求</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//判断是否定义过端口，并且端口是否为443，如果为443则是https协议，否则就是http协议</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$protocal = (<span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">'SERVER_PORT'</span>]) &amp;&amp; $_SERVER[<span class=\"string\">'SERVER_PORT'</span>] == <span class=\"number\">443</span>) ?<span class=\"string\">'https://'</span> : <span class=\"string\">'http://'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"number\">80</span> == $_SERVER[<span class=\"string\">'SERVER_PORT'</span>] || <span class=\"number\">443</span> == $_SERVER[<span class=\"string\">'SERVER_PORT'</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$url = $protocal.$_SERVER[<span class=\"string\">'SERVER_NAME'</span>].$path;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"comment\">//http://www.baidu.com:8012/index.php?username=liwenkai</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$url = $protocal.$_SERVER[<span class=\"string\">'SERVER_NAME'</span>].<span class=\"string\">':'</span>.$_SERVER[<span class=\"string\">'SERVER_PORT'</span>].$path;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//拼接 path. ? . 全新组合成的URI</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $url;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getCurrentPage</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果用户设置过page信息，就返回page相关信息，强制转为整型</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'page'</span>])) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"comment\">//得到页码</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$page = (int) $_GET[<span class=\"string\">'page'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"comment\">//你的页码不能够大于总页数</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">if</span> ($page &gt; <span class=\"keyword\">$this</span>-&gt;pageCount) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$page = <span class=\"keyword\">$this</span>-&gt;pageCount;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"comment\">//你的页码不能小于1</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">if</span> ($page &lt; <span class=\"number\">1</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$page = <span class=\"number\">1</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$page = <span class=\"number\">1</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $page;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getPageCount</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//计算总页数，使用到了进一法取整</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> ceil(<span class=\"keyword\">$this</span>-&gt;total / <span class=\"keyword\">$this</span>-&gt;num);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>4、Tpl类<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Tpl</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//缓存目录</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $cacheDir = <span class=\"string\">'./Cache/'</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//模版目录</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $tplDir = <span class=\"string\">'./Tpl/'</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//保存变量的成员方法</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $vars = [];</span><br><span class=\"line\">\t<span class=\"comment\">//缓存有效期</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $cacheLifeTime = <span class=\"number\">3600</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//初使化成员属性</span></span><br><span class=\"line\">\t<span class=\"comment\">//判断缓存目录是否存在</span></span><br><span class=\"line\">\t<span class=\"comment\">//判断模版路径是否存在，如果不存在要创建，如果不可写，要改权限</span></span><br><span class=\"line\">\t<span class=\"comment\">//初化缓存时间</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($tplDir = null, $cacheDir = null ,$cacheLifeTime = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($tplDir)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;_checkDir($tplDir)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">$this</span>-&gt;tplDir = rtrim($tplDir,<span class=\"string\">'/'</span>).<span class=\"string\">'/'</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($cacheDir)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;_checkDir($cacheDir)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">$this</span>-&gt;cacheDir = rtrim($cacheDir,<span class=\"string\">'/'</span>).<span class=\"string\">'/'</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($cacheLifeTime)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">$this</span>-&gt;cacheLifeTime = $cacheLifeTime;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_checkDir</span><span class=\"params\">($path)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!file_exists($path) || !is_dir($path)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> mkdir($path,<span class=\"number\">0755</span>,<span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!is_writable($path) || !is_readable($path)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> chmod($path,<span class=\"number\">0755</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//$tpl-&gt;assign()-&gt;assign()-&gt;display();</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//分配变量</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">assign</span><span class=\"params\">($key,$val)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;vars[$key] = $val;</span><br><span class=\"line\">\t\t<span class=\"comment\">//return $this;</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//display显示模版内容</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">display</span><span class=\"params\">($file,$isExecute = true, $uri = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//获得模版路径（模版目录路径 + 模版文件）</span></span><br><span class=\"line\">\t\t$tplFilePath = <span class=\"keyword\">$this</span>-&gt;tplDir.$file;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//判断文件是否存在</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!file_exists($tplFilePath)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">echo</span> $tplFilePath;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'模板文件不存在'</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">//获得编译文件路径（组合一个新的） page.php?page=3</span></span><br><span class=\"line\">\t\t$cacheFile = md5($file.$uri).<span class=\"string\">'.php'</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$cacheFilePath = <span class=\"keyword\">$this</span>-&gt;cacheDir . $cacheFile;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//检测是否编译过、是否修改过模版文件，如果编译，并且在有效期内，则不编译</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!file_exists($cacheFilePath)) &#123;</span><br><span class=\"line\">\t\t\t$html = <span class=\"keyword\">$this</span>-&gt;compile($tplFilePath);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//如果修改过模版文件，则删除原有的编译文件重新编译</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (filemtime($tplFilePath) &gt; filemtime($cacheFilePath)) &#123;</span><br><span class=\"line\">\t\t\t\tunlink($cacheFilePath);</span><br><span class=\"line\">\t\t\t\t$html = <span class=\"keyword\">$this</span>-&gt;compile($tplFilePath);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 文件创建时间 + 缓存有效期 &gt; time(当前时间) 没有过期，否则过期了</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//如果大于time 没过期</span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t\t$isTimeout = (filemtime($tplFilePath) + <span class=\"keyword\">$this</span>-&gt;cacheLifeTime &gt; time()) ? <span class=\"keyword\">false</span> : <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ($isTimeout) &#123;</span><br><span class=\"line\">\t\t\t\t$html = <span class=\"keyword\">$this</span>-&gt;compile($tplFilePath);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//编译</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($html)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (!file_put_contents($cacheFilePath,$html)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'编译文件写入失败'</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//判断是否需要执行</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//如果不需要执行则，则不包含 ，不extract变量，反之则不然</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ($isExecute) &#123;</span><br><span class=\"line\">\t\t\textract(<span class=\"keyword\">$this</span>-&gt;vars);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">include</span> $cacheFilePath;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">compile</span><span class=\"params\">($tplFilePath)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$html = file_get_contents($tplFilePath);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$keys = [</span><br><span class=\"line\">\t\t\t<span class=\"string\">'&#123;if %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php if(\\1): ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;else&#125;'</span> =&gt; <span class=\"string\">'&lt;?php else : ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;else if %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php elseif(\\1) : ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;elseif %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php elseif(\\1) : ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/if&#125;'</span> =&gt; <span class=\"string\">'&lt;?php endif;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;$%%&#125;'</span> =&gt; <span class=\"string\">'&lt;?=$\\1;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;foreach %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php foreach(\\1) :?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/foreach&#125;'</span> =&gt; <span class=\"string\">'&lt;?php endforeach;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;for %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php for(\\1):?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/for&#125;'</span> =&gt; <span class=\"string\">'&lt;?php endfor;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;while %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php while(\\1):?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/while&#125;'</span> =&gt; <span class=\"string\">'&lt;?php endwhile;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;continue&#125;'</span> =&gt; <span class=\"string\">'&lt;?php continue;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;break&#125;'</span> =&gt; <span class=\"string\">'&lt;?php break;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;$%% = $%%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php $\\1 = $\\2;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;$%%++&#125;'</span> =&gt; <span class=\"string\">'&lt;?php $\\1++;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;$%%--&#125;'</span> =&gt; <span class=\"string\">'&lt;?php $\\1--;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;comment&#125;'</span> =&gt; <span class=\"string\">'&lt;?php /* '</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/comment&#125;'</span> =&gt; <span class=\"string\">' */ ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/*&#125;'</span> =&gt; <span class=\"string\">'&lt;?php /* '</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;*/&#125;'</span> =&gt; <span class=\"string\">'* ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;section&#125;'</span> =&gt; <span class=\"string\">'&lt;?php '</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/section&#125;'</span> =&gt; <span class=\"string\">'?&gt;'</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">'&#123;&#123;%%(%%)&#125;&#125;'</span> =&gt; <span class=\"string\">'&lt;?=\\1(\\2);?&gt;'</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">'&#123;date(%%,$%%)&#125;'</span>=&gt; <span class=\"string\">'&lt;?=date(\\1,$\\2);?&gt;'</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">'&#123;include %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php include \"\\1\";?&gt;'</span>,</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">foreach</span> ($keys <span class=\"keyword\">as</span> $key =&gt; $val) &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t$pattern = <span class=\"string\">'#'</span>. str_replace(<span class=\"string\">'%%'</span>,<span class=\"string\">'(.+)'</span>,preg_quote($key,<span class=\"string\">'#'</span>)) .<span class=\"string\">'#imsU'</span>;</span><br><span class=\"line\">\t\t\t$replace = $val;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (stripos($pattern,<span class=\"string\">'include'</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//处理一次回调</span></span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t\t$html = preg_replace_callback($pattern,<span class=\"keyword\">array</span>(<span class=\"keyword\">$this</span>,<span class=\"string\">'parseInclude'</span>),$html);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t$html = preg_replace($pattern,$replace,$html);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $html;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseInclude</span><span class=\"params\">($data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$file = str_replace([<span class=\"string\">'\\''</span>,<span class=\"string\">'\"'</span>],<span class=\"string\">''</span>,$data[<span class=\"number\">1</span>]);</span><br><span class=\"line\">\t\t$path = <span class=\"keyword\">$this</span>-&gt;parsePath($file);</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;display($file,<span class=\"keyword\">false</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"string\">'&lt;?php include \"'</span>.$path.<span class=\"string\">'\";?&gt;'</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parsePath</span><span class=\"params\">($file)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$path = <span class=\"keyword\">$this</span>-&gt;cacheDir . md5($file).<span class=\"string\">'.php'</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $path;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//删除缓存文件（递归）</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">clearCache</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">self</span>::delDir(<span class=\"keyword\">$this</span>-&gt;cacheDir);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delDir</span><span class=\"params\">($path)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$res = opendir($path);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span>($file = readdir($res)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ($file == <span class=\"string\">'.'</span> || $file == <span class=\"string\">'..'</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t$newPath = $path.<span class=\"string\">'/'</span>.$file;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (is_dir($newPath)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">self</span>::delDir($newPath);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\tunlink($newPath);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"> \t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>5、Upload类<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Upload</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//上传到哪个目录</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $path = <span class=\"string\">'Upload/'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//准许的MIME</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $allowmime = [<span class=\"string\">'image/png'</span>,<span class=\"string\">'image/jpg'</span>,<span class=\"string\">'image/jpeg'</span>,<span class=\"string\">'image/pjpeg'</span>,<span class=\"string\">'image/bmp'</span>,<span class=\"string\">'image/wbmp'</span>,<span class=\"string\">'image/gif'</span>,<span class=\"string\">'image/x-png'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//准许的后缀</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $allowsubfix = [<span class=\"string\">'jpg'</span>,<span class=\"string\">'png'</span>,<span class=\"string\">'jpeg'</span>,<span class=\"string\">'gif'</span>,<span class=\"string\">'bmp'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//准许的大小</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $allowsize = <span class=\"number\">2097152</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//是否准许随机文件名</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $israndname = <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//是否准许日期目录</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $isdatepath = <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的大小</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $size;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的原名</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $orgname;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的新名</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $newname;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的后缀</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $subfix;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的MIME类型</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $mime;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的新路径</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $newpath;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//错误号</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $errorno;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//错误信息</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $errorinfo;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//临时文件</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $tmpfile;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//前缀</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $prefix;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//初使化成员属性，传进来的东西特别多，我们要求以数组的形式来传递</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//foreach循环，取出键名、值</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//将键名设置为成员属性名，将键值设为成员属性值</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//注意键名的合法性</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">// errorInfo   errorinfo</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(Array $config = [])</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">foreach</span> ($config <span class=\"keyword\">as</span> $key =&gt; $value) &#123;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption($key,$value);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setOption</span><span class=\"params\">($key,$value)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$key = strtolower($key);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$allPro = get_class_vars(get_class(<span class=\"keyword\">$this</span>));</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//var_dump($allpro);</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (array_key_exists($key,$allPro)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;$key = $value;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//设置一个get方法专门获得新路径</span></span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//设置 一个get方法专门来获得错误信息</span></span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//成员方法上传方法</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">uploadFile</span><span class=\"params\">($field)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//var_dump($field);die;</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//检测路径用户是否定义过，如果没有定义失败</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!file_exists(<span class=\"keyword\">$this</span>-&gt;path)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">echo</span> <span class=\"string\">'11111111111'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-1</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//目录权限检测</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;checkPath()) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-2</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//获得$_FILES当中五个基本信息</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$name = $_FILES[$field][<span class=\"string\">'name'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$size = $_FILES[$field][<span class=\"string\">'size'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$type = $_FILES[$field][<span class=\"string\">'type'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t </span></span><br><span class=\"line\"><span class=\"php\">\t\t$tmpName = $_FILES[$field][<span class=\"string\">'tmp_name'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$error = $_FILES[$field][<span class=\"string\">'error'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//var_dump($_FILES);die;</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//传入到一个成员方法里面进行设置</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;setFiles($name,$size,$type,$tmpName,$error)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//检测MIME是否合法，检测后缀是否合法，检测文件大小是否超过了自定义的大小</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;checkMime() || !<span class=\"keyword\">$this</span>-&gt;checkSubfix() || !<span class=\"keyword\">$this</span>-&gt;checkSize()) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//新名</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;newname = <span class=\"keyword\">$this</span>-&gt;getNewName();</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//新路径处理</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;newpath = <span class=\"keyword\">$this</span>-&gt;getNewPath();</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//是否是上传文件</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果是上传文件移动上传文件至指定的目录</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果成员return true</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span>( <span class=\"keyword\">$this</span>-&gt;move())&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;newpath . <span class=\"keyword\">$this</span>-&gt;newname;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">move</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!is_uploaded_file(<span class=\"keyword\">$this</span>-&gt;tmpfile)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-6</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//var_dump($this-tmpfile);</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"keyword\">$this</span>-&gt;tmpfile,<span class=\"keyword\">$this</span>-&gt;newpath.<span class=\"keyword\">$this</span>-&gt;newname)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-7</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNewPath</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;path = rtrim(<span class=\"keyword\">$this</span>-&gt;path,<span class=\"string\">'/'</span>).<span class=\"string\">'/'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;isdatepath) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$newpath = <span class=\"keyword\">$this</span>-&gt;path.date(<span class=\"string\">'Y/m/d/'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">if</span> (!file_exists($newpath)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\tmkdir($newpath,<span class=\"number\">0755</span>,<span class=\"keyword\">true</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> $newpath;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;path;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNewName</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;israndname) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;prefix . uniqid() . <span class=\"string\">'.'</span> . <span class=\"keyword\">$this</span>-&gt;subfix;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;prefix . <span class=\"keyword\">$this</span>-&gt;orgname;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkSize</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;size &gt; <span class=\"keyword\">$this</span>-&gt;allowsize) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-5</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkSubFix</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (in_array(<span class=\"keyword\">$this</span>-&gt;subfix,<span class=\"keyword\">$this</span>-&gt;allowsubfix)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-4</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkMime</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (in_array(<span class=\"keyword\">$this</span>-&gt;mime,<span class=\"keyword\">$this</span>-&gt;allowmime)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-3</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setFiles</span><span class=\"params\">($name,$size,$type,$tmpName,$error)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//1 2 3 4 6 7  0(正常)</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> ($error) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,$error);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;orgname = $name;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;size = $size;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;tmpfile = $tmpName;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;mime = $type;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//后缀没处理</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$info = pathinfo($name);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;subfix = $info[<span class=\"string\">'extension'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\">\t\t/*</span><br><span class=\"line\">\t\t$arr = explode('.',$name);</span><br><span class=\"line\">\t\t$this-&gt;subfix = array_pop($arr);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$arr = explode('.',$name);</span><br><span class=\"line\">\t\t$this-&gt;subfix = $arr[count($arr)-1];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$pos = strrpos($name,'.');</span><br><span class=\"line\">\t\techo substr($name,$pos + 1);</span><br><span class=\"line\"><span class=\"php\">\t\t*/</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkPath</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//检测路径是否是目录，如果不存在创建</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!is_dir(<span class=\"keyword\">$this</span>-&gt;path)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> mkdir(<span class=\"keyword\">$this</span>-&gt;path,<span class=\"number\">0755</span>,<span class=\"keyword\">true</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//检测路径是否可写，如果不写写更改权限</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!is_writeable(<span class=\"keyword\">$this</span>-&gt;path) ||  !is_readable(<span class=\"keyword\">$this</span>-&gt;path)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> chmod(<span class=\"keyword\">$this</span>-&gt;path,<span class=\"number\">0755</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getErrorInfo</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">switch</span> (<span class=\"keyword\">$this</span>-&gt;errorno) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'部份件被上传'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'没有文件被上传'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'找不到临时文件夹'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'临时文件写入失败'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-1</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'自定义的上传路径不存在'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-2</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'没有权限'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-3</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-4</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'类型或后缀不准许'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-5</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'超过了自定义的大小'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-6</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'不是上传文件'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-7</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'移动上传文件失败'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $str;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($key)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (in_array($key, [<span class=\"string\">'newpath'</span>,<span class=\"string\">'newname'</span>,<span class=\"string\">'errorno'</span>,<span class=\"string\">'size'</span>])) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\tvar_dump($key);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$key;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ($key == <span class=\"string\">'errorinfo'</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;getErrorInfo();</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>6、Verify类<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Verify</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//宽</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $width;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//高</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $height;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//图片类型</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $imgType;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文字类型</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $codeType;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文字的个数</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $num;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//保存的验证码字符串</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $verifyCode;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//保存验证码资源的一个成员属性</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $res;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//初始化成员</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//上面这些参数</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($width = <span class=\"number\">100</span>, $height = <span class=\"number\">50</span>, $imgType = <span class=\"string\">'png'</span>, $codeType = <span class=\"number\">3</span>, $num = <span class=\"number\">4</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;width = $width;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;height = $height;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;imgType = $imgType;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;codeType = $codeType;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;num = $num;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;verifyCode = <span class=\"keyword\">$this</span>-&gt;createVerifyCode();</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">createVerifyCode</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$string = <span class=\"string\">''</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">switch</span> (<span class=\"keyword\">$this</span>-&gt;codeType) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$string = implode(<span class=\"string\">''</span>,array_rand(range(<span class=\"number\">0</span>,<span class=\"number\">9</span>),<span class=\"keyword\">$this</span>-&gt;num));</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$string = join(<span class=\"string\">''</span>,array_rand(array_flip(range(<span class=\"string\">'a'</span>,<span class=\"string\">'z'</span>)),<span class=\"number\">4</span>));</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span></span><br><span class=\"line\">\t\t\t\t/*</span><br><span class=\"line\">\t\t\t\tfor ($i = 0; $i &lt; $this-&gt;num; $i++) &#123;</span><br><span class=\"line\">\t\t\t\t\t$r= mt_rand(0,2);</span><br><span class=\"line\">\t\t\t\t\tswitch ($r) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tcase 0:</span><br><span class=\"line\">\t\t\t\t\t\t\t$ascii = mt_rand(48,57);</span><br><span class=\"line\">\t\t\t\t\t\t\tbreak;</span><br><span class=\"line\">\t\t\t\t\t\tcase 1:</span><br><span class=\"line\">\t\t\t\t\t\t\t$ascii = mt_rand(65,90);</span><br><span class=\"line\">\t\t\t\t\t\t\tbreak;</span><br><span class=\"line\">\t\t\t\t\t\tcase 2:</span><br><span class=\"line\">\t\t\t\t\t\t\t$ascii = mt_rand(97,122);</span><br><span class=\"line\">\t\t\t\t\t\t\tbreak;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t$string .= chr($ascii);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"><span class=\"php\">\t\t\t\t*/</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'abcdefghijkmnpqrstuvwxzABCDEFGHJKLMNPQRSTUVWXYZ23456789'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$string = substr(str_shuffle($str),<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;num);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $string;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//调验证码显示的一个方法 output</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//1.画图</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//2.分配颜色(写两个成员方法，调的时候直接调对应的成员方法即可)</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//3.背景填充</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//4.画干扰点</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//5.画干扰线</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//6.写字 </span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//7. 输出类型</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//8. 输出图片</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">outImg</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;createImg();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;fillBgColor();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;fillPix();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;fillArc();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;writeFont();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;output();</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">output</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//imagepng</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$func = <span class=\"string\">'image'</span>.<span class=\"keyword\">$this</span>-&gt;imgType;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$mime = <span class=\"string\">'Content-type:image/'</span>.<span class=\"keyword\">$this</span>-&gt;imgType;</span></span><br><span class=\"line\"><span class=\"php\">\t\theader($mime);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$func(<span class=\"keyword\">$this</span>-&gt;res);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">writeFont</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; <span class=\"keyword\">$this</span>-&gt;num; $i++) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$width = ceil(<span class=\"keyword\">$this</span>-&gt;width / <span class=\"keyword\">$this</span>-&gt;num);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$x = $width * $i;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$y= mt_rand(<span class=\"number\">5</span>,<span class=\"keyword\">$this</span>-&gt;height - <span class=\"number\">10</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$c = <span class=\"keyword\">$this</span>-&gt;verifyCode[$i];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\timagechar(<span class=\"keyword\">$this</span>-&gt;res,<span class=\"number\">5</span>,$x,$y,$c,<span class=\"keyword\">$this</span>-&gt;darkColor());</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fillArc</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">for</span>($i = <span class=\"number\">0</span>; $i &lt; <span class=\"number\">10</span>; $i++) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\timagearc(<span class=\"keyword\">$this</span>-&gt;res,</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">10</span>,<span class=\"keyword\">$this</span>-&gt;width - <span class=\"number\">10</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">10</span>,<span class=\"keyword\">$this</span>-&gt;height - <span class=\"number\">10</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;width),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;height),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">0</span>,<span class=\"number\">180</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">181</span>,<span class=\"number\">360</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;lightColor()</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fillPix</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$num = <span class=\"keyword\">$this</span>-&gt;pixNum();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; $num; $i++) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\timagesetpixel(<span class=\"keyword\">$this</span>-&gt;res,mt_rand(<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;width),mt_rand(<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;height),<span class=\"keyword\">$this</span>-&gt;darkColor());</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pixNum</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$area = ceil((<span class=\"keyword\">$this</span>-&gt;width * <span class=\"keyword\">$this</span>-&gt;height) / <span class=\"number\">20</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $area;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fillBgColor</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\timagefill(<span class=\"keyword\">$this</span>-&gt;res,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;lightColor());</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">lightColor</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> imagecolorallocate(<span class=\"keyword\">$this</span>-&gt;res,</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">130</span>,<span class=\"number\">255</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">130</span>,<span class=\"number\">255</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">130</span>,<span class=\"number\">255</span>)</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t\t);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">darkColor</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> imagecolorallocate(<span class=\"keyword\">$this</span>-&gt;res,</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">0</span>,<span class=\"number\">120</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">0</span>,<span class=\"number\">120</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">0</span>,<span class=\"number\">120</span>)</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t\t);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createImg</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;res = imagecreatetruecolor(<span class=\"keyword\">$this</span>-&gt;width,<span class=\"keyword\">$this</span>-&gt;height);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//9 .销毁图片资源</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//imagedestroy($this-&gt;res);</span></span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//可以做一个魔术方法__get专门用于得到验证码字符串</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($key)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> ($key == <span class=\"string\">'verifyCode'</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$key;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>7、auto_load(类的自动加载)<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Init</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loader</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$psr = <span class=\"keyword\">new</span> Psr4();</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$psr-&gt;register();</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">foreach</span> ($GLOBALS[<span class=\"string\">'nameSpace'</span>] <span class=\"keyword\">as</span> $name =&gt; $baseDir) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$psr-&gt;addNamespace($name,$baseDir);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">router</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;loader();</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$_GET[<span class=\"string\">'m'</span>] = <span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'m'</span>]) ? ucfirst(strtolower($_GET[<span class=\"string\">'m'</span>])) : <span class=\"string\">'Index'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$_GET[<span class=\"string\">'a'</span>] = <span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'a'</span>]) ? $_GET[<span class=\"string\">'a'</span>] :<span class=\"string\">'index'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$controllerName = <span class=\"string\">'Controller\\\\'</span>.$_GET[<span class=\"string\">'m'</span>].<span class=\"string\">'Controller'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$mod = <span class=\"keyword\">new</span> $controllerName();</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">if</span> (method_exists($mod,$_GET[<span class=\"string\">'a'</span>])) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\tcall_user_func(<span class=\"keyword\">array</span>($mod,$_GET[<span class=\"string\">'a'</span>]));</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125; <span class=\"keyword\">else</span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'方法不合法'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>8、PSR_4<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Psr4</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> $prefixes;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">register</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\tspl_autoload_register(<span class=\"keyword\">array</span>(<span class=\"keyword\">$this</span>,<span class=\"string\">'loadClass'</span>));</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addNamespace</span><span class=\"params\">($nameSpace, $path)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$nameSpace = trim($nameSpace,<span class=\"string\">'\\\\'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$path = rtrim($path,DIRECTORY_SEPARATOR).<span class=\"string\">'/'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;prefixes[$nameSpace]) == <span class=\"keyword\">false</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;prefixes[$nameSpace] = <span class=\"keyword\">array</span>();</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\tarray_push(<span class=\"keyword\">$this</span>-&gt;prefixes[$nameSpace],$path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadClass</span><span class=\"params\">($className)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$pos = strrpos($className,<span class=\"string\">'\\\\'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//µÃµ½ÃüÃû¿Õ¼ä</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$nameSpace = substr($className,<span class=\"number\">0</span>, $pos);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$realClass = substr($className,$pos + <span class=\"number\">1</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//´¦ÀíÓ³Éä°üº¬</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;mappingFile($nameSpace, $realClass);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mappingFile</span><span class=\"params\">($nameSpace, $realClass)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;prefixes[$nameSpace]) == <span class=\"keyword\">false</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;prefixes[$nameSpace] <span class=\"keyword\">as</span> $baseDir) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$file = $baseDir . str_replace(<span class=\"string\">'\\\\'</span>,<span class=\"string\">'/'</span>,$realClass).<span class=\"string\">'.php'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;requireFile($file);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">requireFile</span><span class=\"params\">($file)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (file_exists($file)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">include</span> $file;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>9、NameSpace<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">return</span> [</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"string\">'Model'</span> =&gt; <span class=\"string\">'App/Model/'</span>,</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"string\">'Controller'</span> =&gt; <span class=\"string\">'App/Controller/'</span>,</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"string\">'Framework'</span> =&gt; <span class=\"string\">'Vendor/Phone/Framework/Src/'</span>,</span></span><br><span class=\"line\"><span class=\"php\">];</span></span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"<p>我将MVC归属在设计模式里面,个人对MVC的理解它应该为一种设计模式。</p>","more":"<h2 id=\"什么是MVC\"><a href=\"#什么是MVC\" class=\"headerlink\" title=\"什么是MVC\"></a>什么是MVC</h2><p>由模型(model),视图(view),控制器(controller)完成的应用程序由模型发出要实现的功能到控制器,控制器接收组织功能传递给视图;</p>\n<p>Model(模型)，程序应用功能的实现，程序的逻辑的实现。在PHP中负责数据管理，数据生成;<br>View(视图)，图形界面逻辑。在PHP中负责输出，处理如何调用模板、需要的资源文件;<br>Controller(控制器)，负责转发请求，对请求处理。在PHP中根据请求决定调用的视图及使用的数据;</p>\n<h2 id=\"为什么使用MVC\"><a href=\"#为什么使用MVC\" class=\"headerlink\" title=\"为什么使用MVC\"></a>为什么使用MVC</h2><p>MVC的主要作用是为了将代码分层、分类;<br>MVC的主要目的是为了解决Web开发中分离开发与设计工作，使其工作相对独立;<br>在这样的过程中还发现了其他的一些优点，网站的目录结构更加清晰，网站更易维护与扩展，可以实现模块的复用;</p>\n<h2 id=\"我所认知的MVC\"><a href=\"#我所认知的MVC\" class=\"headerlink\" title=\"我所认知的MVC\"></a>我所认知的MVC</h2><p>MVC 是一个设计模式，它强制性的使应用程序的输入、处理和输出分开。使用 MVC 应 用程序被分成三个核心部件:模型、视图、控制器。它们各自处理自己的任务。视图是 用户看到并与之交互的界面。模型表示企业数据和业务规则。控制器接受用户的输入并 调用模型和视图去完成用户的需求。</p>\n<h2 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h2><p>低耦合性、高重用性和可适用性、较低的生命周期成本、快速的部署、 可维护性、可扩展性，有利于软件工程化管理</p>\n<h2 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h2><p>没有明确的定义，完全理解 MVC 并不容易。不适合小型规模的应用程序;</p>\n<h2 id=\"MVC底层架构\"><a href=\"#MVC底层架构\" class=\"headerlink\" title=\"MVC底层架构\"></a>MVC底层架构</h2><p>1、Image类<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Image</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//路径</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> $path = <span class=\"string\">'./upload/'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//随机文件名</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> $isRandName;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//初使化成员属性</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">__construct</span><span class=\"params\">($path = null , $r = true)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!is_null($path)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;path = rtrim($path,<span class=\"string\">'/'</span>).<span class=\"string\">'/'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; </span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;isRandName = $r;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//water水印的方法  目标和源，自适应能力更强一些，直接调成员方法即可</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//源、目标、位置 、透明度</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">water</span><span class=\"params\">($dst,$src,$pos = <span class=\"number\">9</span>, $prefix = <span class=\"string\">'wa_'</span>, $tmd = <span class=\"number\">100</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//判断文件路径是否存在</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$src = <span class=\"keyword\">$this</span>-&gt;path . $src;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!file_exists($dst) || !file_exists($src))</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'目标者水印图片不存在'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//获取图像的相关信息</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$dstInfo = <span class=\"keyword\">self</span>::getImageInfo($dst);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$srcInfo = <span class=\"keyword\">self</span>::getImageInfo($src);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//判断宽高是否超过了目标图片的宽和高</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;_checkSize($dstInfo,$srcInfo)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'水印图片宽、高不合法'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//摆放位置 </span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$position = <span class=\"keyword\">self</span>::getPosition($dstInfo,$srcInfo,$pos);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//打开图片</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$dstRes = <span class=\"keyword\">self</span>::openImg($dst, $dstInfo);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$srcRes = <span class=\"keyword\">self</span>::openImg($src, $srcInfo);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//将两个图片合并在一起</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$newRes = <span class=\"keyword\">$this</span>-&gt;_mergeImage($dstRes,$srcRes,$position,$dstInfo,$srcInfo,$tmd);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;isRandName) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$path = <span class=\"keyword\">$this</span>-&gt;path.$prefix.uniqid().<span class=\"string\">'.'</span>.$dstInfo[<span class=\"string\">'subfix'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$path = <span class=\"keyword\">$this</span>-&gt;path.$prefix.$dstInfo[<span class=\"string\">'basename'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//保存图片</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">self</span>::saveImage($newRes,$path,$dstInfo);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//销毁资源</span></span></span><br><span class=\"line\"><span class=\"php\">\t\timagedestroy($newRes);</span></span><br><span class=\"line\"><span class=\"php\">\t\timagedestroy($srcRes);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//返回路径</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $path;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//thumb 源 和 宽高</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">thumb</span><span class=\"params\">($dst,$width,$height,$prefix = <span class=\"string\">'thumb_'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//判断文件是否在</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!file_exists($dst)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'文件路径不存在'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//获取图像的信息，没有信息，你什么都 做不鸟</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$info = <span class=\"keyword\">self</span>::getImageInfo($dst);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//得到新的尺寸</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$newSize = <span class=\"keyword\">self</span>::getNewSize($width,$height,$info);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//打开资源</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$res = <span class=\"keyword\">self</span>::openImg($dst,$info);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//等比缩放这个资源，处理gif背景变黑的问题 </span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$newRes = <span class=\"keyword\">self</span>::kidOfImage($res,$newSize,$info);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//保存</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$path = <span class=\"keyword\">$this</span>-&gt;path.$prefix.$info[<span class=\"string\">'basename'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">self</span>::saveImage($newRes,$path,$info);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//销毁</span></span></span><br><span class=\"line\"><span class=\"php\">\t\timagedestroy($newRes);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//返回路径</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $path;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">kidOfImage</span><span class=\"params\">($srcImg, $size, $imgInfo)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$newImg = imagecreatetruecolor($size[<span class=\"string\">\"width\"</span>], $size[<span class=\"string\">\"height\"</span>]);\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$otsc = imagecolortransparent($srcImg);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> ( $otsc &gt;= <span class=\"number\">0</span> &amp;&amp; $otsc &lt; imagecolorstotal($srcImg)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t $transparentcolor = imagecolorsforindex( $srcImg, $otsc );</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t $newtransparentcolor = imagecolorallocate(</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t $newImg,</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t $transparentcolor[<span class=\"string\">'red'</span>],</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t $transparentcolor[<span class=\"string\">'green'</span>],</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t $transparentcolor[<span class=\"string\">'blue'</span>]</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t );</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t imagefill( $newImg, <span class=\"number\">0</span>, <span class=\"number\">0</span>, $newtransparentcolor );</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t imagecolortransparent( $newImg, $newtransparentcolor );</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t\timagecopyresized( $newImg, $srcImg, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, $size[<span class=\"string\">\"width\"</span>], $size[<span class=\"string\">\"height\"</span>], $imgInfo[<span class=\"string\">\"width\"</span>], $imgInfo[<span class=\"string\">\"height\"</span>] );</span></span><br><span class=\"line\"><span class=\"php\">\t\timagedestroy($srcImg);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $newImg;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNewSize</span><span class=\"params\">($width, $height, $imgInfo)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$size[<span class=\"string\">\"width\"</span>] = $imgInfo[<span class=\"string\">\"width\"</span>];   <span class=\"comment\">//将原图片的宽度给数组中的$size[\"width\"]</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$size[<span class=\"string\">\"height\"</span>] = $imgInfo[<span class=\"string\">\"height\"</span>];  <span class=\"comment\">//将原图片的高度给数组中的$size[\"height\"]</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span>($width &lt; $imgInfo[<span class=\"string\">\"width\"</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$size[<span class=\"string\">\"width\"</span>] = $width;             <span class=\"comment\">//缩放的宽度如果比原图小才重新设置宽度</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> ($width &lt; $imgInfo[<span class=\"string\">\"height\"</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$size[<span class=\"string\">\"height\"</span>] = $height;            <span class=\"comment\">//缩放的高度如果比原图小才重新设置高度</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span>($imgInfo[<span class=\"string\">\"width\"</span>]*$size[<span class=\"string\">\"width\"</span>] &gt; $imgInfo[<span class=\"string\">\"height\"</span>] * $size[<span class=\"string\">\"height\"</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$size[<span class=\"string\">\"height\"</span>] = round($imgInfo[<span class=\"string\">\"height\"</span>] * $size[<span class=\"string\">\"width\"</span>] / $imgInfo[<span class=\"string\">\"width\"</span>]);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$size[<span class=\"string\">\"width\"</span>] = round($imgInfo[<span class=\"string\">\"width\"</span>] * $size[<span class=\"string\">\"height\"</span>] / $imgInfo[<span class=\"string\">\"height\"</span>]);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $size;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">saveImage</span><span class=\"params\">($res,$path,$info)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">switch</span> ($info[<span class=\"string\">'mime'</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/png'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/x-png'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\timagepng($res,$path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/jpeg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/jpg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/pjpeg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\timagejpeg($res,$path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/gif'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\timagegif($res,$path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/wbmp'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/bmp'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\timagewbmp($res,$path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_mergeImage</span><span class=\"params\">($dstRes,$srcRes,$position,$dstInfo,$srcInfo,$tmd)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\timagecopymerge($dstRes,$srcRes,$position[<span class=\"string\">'x'</span>],$position[<span class=\"string\">'y'</span>],<span class=\"number\">0</span>,<span class=\"number\">0</span>,$srcInfo[<span class=\"string\">'width'</span>],$srcInfo[<span class=\"string\">'height'</span>],$tmd);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $dstRes;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">openImg</span><span class=\"params\">($path, $info)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">switch</span> ($info[<span class=\"string\">'mime'</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/png'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/x-png'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$res = imagecreatefrompng($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/jpeg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/jpg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/pjpeg'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$res = imagecreatefromjpeg($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/gif'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$res = imagecreatefromgif($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/wbmp'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"string\">'image/bmp'</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$res = imagecreatefromwbmp($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $res;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getPosition</span><span class=\"params\">($dstInfo,$srcInfo,$pos)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">switch</span> ($pos) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = ceil(($dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>]) / <span class=\"number\">2</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = $dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = ceil(($dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>]) /<span class=\"number\">2</span> );</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = ceil(($dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>]) / <span class=\"number\">2</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = ceil(($dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>]) /<span class=\"number\">2</span> );</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = $dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = ceil(($dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>]) /<span class=\"number\">2</span> );</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = $dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = ceil(($dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>]) / <span class=\"number\">2</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = $dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = $dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = $dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">default</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$x = mt_rand(<span class=\"number\">0</span>,$dstInfo[<span class=\"string\">'width'</span>] - $srcInfo[<span class=\"string\">'width'</span>]);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$y = mt_rand(<span class=\"number\">0</span>,$dstInfo[<span class=\"string\">'height'</span>] - $srcInfo[<span class=\"string\">'height'</span>]);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> [<span class=\"string\">'x'</span> =&gt; $x, <span class=\"string\">'y'</span> =&gt; $y];</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_checkSize</span><span class=\"params\">($dstInfo,$srcInfo)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> ($dstInfo[<span class=\"string\">'width'</span>] &lt; $srcInfo[<span class=\"string\">'width'</span>] || $dstInfo[<span class=\"string\">'height'</span>] &lt; $srcInfo[<span class=\"string\">'height'</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span>  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getImageInfo</span><span class=\"params\">($path)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data = [];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$info = getimagesize($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data[<span class=\"string\">'width'</span>] = $info[<span class=\"number\">0</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data[<span class=\"string\">'height'</span>] = $info[<span class=\"number\">1</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data[<span class=\"string\">'mime'</span>] = $info[<span class=\"string\">'mime'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$path = pathinfo($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data[<span class=\"string\">'basename'</span>] = $path[<span class=\"string\">'basename'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$data[<span class=\"string\">'subfix'</span>] = $path[<span class=\"string\">'extension'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $data;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>2、Model类<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Model</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//连接</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $link;</span><br><span class=\"line\">\t<span class=\"comment\">//用户名</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $user;</span><br><span class=\"line\">\t<span class=\"comment\">//密码</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $pwd;</span><br><span class=\"line\">\t<span class=\"comment\">//字符集</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $charset;</span><br><span class=\"line\">\t<span class=\"comment\">//表前缀</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $prefix;</span><br><span class=\"line\">\t<span class=\"comment\">//库名</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $dbName;</span><br><span class=\"line\">\t<span class=\"comment\">//主机</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $host;</span><br><span class=\"line\">\t<span class=\"comment\">//表名</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $table;</span><br><span class=\"line\">\t<span class=\"comment\">//字段</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $fields;</span><br><span class=\"line\">\t<span class=\"comment\">//保存的查询、更新、添加的参数</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $options;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//初使化数据库连接</span></span><br><span class=\"line\">\t<span class=\"comment\">//把一批成员属性都 初使化</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(Array $config)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;host = $config[<span class=\"string\">'DB_HOST'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;user = $config[<span class=\"string\">'DB_USER'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;pwd = $config[<span class=\"string\">'DB_PWD'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;dbName = $config[<span class=\"string\">'DB_NAME'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;charset = $config[<span class=\"string\">'DB_CHARSET'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;prefix = $config[<span class=\"string\">'DB_PREFIX'</span>];</span><br><span class=\"line\">\t\t<span class=\"comment\">//连接</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;link = <span class=\"keyword\">$this</span>-&gt;connect();</span><br><span class=\"line\">\t\t<span class=\"comment\">//判断是否连接失败</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;link) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'数据库连接失败'</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">//表名</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;table = <span class=\"keyword\">$this</span>-&gt;getTable();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">//字段</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;fields = <span class=\"keyword\">$this</span>-&gt;getFields();</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//连接数库</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$conn = mysqli_connect(<span class=\"keyword\">$this</span>-&gt;host,<span class=\"keyword\">$this</span>-&gt;user,<span class=\"keyword\">$this</span>-&gt;pwd);</span><br><span class=\"line\">\t\t<span class=\"comment\">//连接失败</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!$conn) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">//选择库失败处理</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!mysqli_select_db($conn,<span class=\"keyword\">$this</span>-&gt;dbName)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t\tmysqli_set_charset($conn,<span class=\"keyword\">$this</span>-&gt;charset);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $conn;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//初始化表</span></span><br><span class=\"line\">\t<span class=\"comment\">//（报错，我们再根据命名空间去解决，涉及到命名空间的类名）</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getTable</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;table)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//用户设置 过以用户设置的为准</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;prefix . ltrim(<span class=\"keyword\">$this</span>-&gt;table,<span class=\"keyword\">$this</span>-&gt;prefix);</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ($pos = strpos(get_class(<span class=\"keyword\">$this</span>),<span class=\"string\">'\\\\'</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;prefix .  strtolower(str_replace([<span class=\"string\">'Model'</span>,<span class=\"string\">'model'</span>],<span class=\"string\">''</span>,substr(get_class(<span class=\"keyword\">$this</span>),$pos + <span class=\"number\">1</span>)));</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//用户没有设置过，以类名拼接前缀，给成成全新的表名</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;prefix .strtolower(substr(get_class(<span class=\"keyword\">$this</span>),<span class=\"number\">0</span>,<span class=\"number\">-5</span>));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//始初化字段</span></span><br><span class=\"line\">\t<span class=\"comment\">//要把字段缓存到一个文件中去</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getFields</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//如果有字段的文件则说明曾经缓存过这个文件，直接包含进来即可</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//知道文件路径命名的规则 </span></span><br><span class=\"line\">\t\t$filePath = <span class=\"string\">'./Cache/'</span>.<span class=\"keyword\">$this</span>-&gt;table.<span class=\"string\">'.php'</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (file_exists($filePath)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">include</span> $filePath;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t$fields = <span class=\"keyword\">$this</span>-&gt;queryFields();</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t$str = <span class=\"string\">\"&lt;?php \\nreturn \"</span>.var_export($fields,<span class=\"keyword\">true</span>).<span class=\"string\">';?&gt;'</span>;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tfile_put_contents($filePath,$str);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $fields;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//查询出字段</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">queryFields</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">'desc '</span>.<span class=\"keyword\">$this</span>-&gt;table;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$data = <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$fields = [];</span><br><span class=\"line\">\t\t<span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $key =&gt; $val) &#123;</span><br><span class=\"line\">\t\t\t$fields[] = $val[<span class=\"string\">'Field'</span>];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ($val[<span class=\"string\">'Key'</span>] == <span class=\"string\">'PRI'</span>) &#123;</span><br><span class=\"line\">\t\t\t\t$fields[<span class=\"string\">'_pk'</span>] = $val[<span class=\"string\">'Field'</span>];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $fields;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//系统级的查询方法，设置 为public ，如果在外部想要调用的时候，想自定sql句的候，可以直接query</span></span><br><span class=\"line\">\t<span class=\"comment\">//查询应的结果，这个仅供读取使用</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">query</span><span class=\"params\">($sql)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$result = mysqli_query(<span class=\"keyword\">$this</span>-&gt;link,$sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ($result) &#123;</span><br><span class=\"line\">\t\t\t$data = [];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span>($row = mysqli_fetch_assoc($result)) &#123;</span><br><span class=\"line\">\t\t\t\t$data[] = $row;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> $data;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//查询方法</span></span><br><span class=\"line\">\t<span class=\"comment\">//准备好无需换的SQL语句</span></span><br><span class=\"line\">\t<span class=\"comment\">//用户调用询的时候，将call里面保存进去的参数，一一替换sql语句</span></span><br><span class=\"line\">\t<span class=\"comment\">//发送SQL语句</span></span><br><span class=\"line\">\t<span class=\"comment\">//返回查询果</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">select</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select %FIELDS% from %TABLE% %WHERE% %GROUP% %HAVING% %ORDER% %LIMIT%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$newSql = str_replace(</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%FIELDS%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%GROUP%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%HAVING%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%ORDER%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">'%LIMIT%'</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseFields(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseGroup(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseHaving(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseOrder(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseLimit(),</span><br><span class=\"line\">\t\t\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t\t\t);</span><br><span class=\"line\">\t\t\t\t\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//为了在外面想知道自动生成的SQL语旬是神马的时候</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $newSql;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;query($newSql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseFields</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//因为我们对比字段的时候不需要对比主键是谁</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//因此，我干掉主键 </span></span><br><span class=\"line\">\t\t$fields = <span class=\"keyword\">$this</span>-&gt;fields;</span><br><span class=\"line\">\t\t<span class=\"keyword\">unset</span>($fields[<span class=\"string\">'_pk'</span>]);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//用户向fileds('id,username,password') 先将其切割，用,号切割explode</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//如果用户传的是一个数组fileds(['id','username','password'])，则对比应的字段，算交集</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//array_intersect</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//array_intersect_key</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//array_intersect_assoc</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//array_intersect_ukey</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//是数组的时怎么处理法</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (is_array(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">foreach</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>] <span class=\"keyword\">as</span> $key =&gt; $val) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (!in_array($val,$fields)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">unset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>][$key]);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> join(<span class=\"string\">','</span>,<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">elseif</span> (is_string(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//是字符串的时候先变为组再处理</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>] = explode(<span class=\"string\">','</span>,<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">foreach</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>] <span class=\"keyword\">as</span> $key =&gt; $val) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (!in_array($val,$fields)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">unset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>][$key]);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> join(<span class=\"string\">','</span>,<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'fields'</span>][<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> join(<span class=\"string\">','</span>,$fields);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//判断用户有没有手动指定过查询哪个用</span></span><br><span class=\"line\">\t<span class=\"comment\">//如果指定过，则以用户设定的options里面的表为准</span></span><br><span class=\"line\">\t<span class=\"comment\">//如果没有设定过，则以默认的为准</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseTable</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'table'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'table'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;table;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//看看用户是否设置过where，如果设置过以用户设置 的为准</span></span><br><span class=\"line\">\t<span class=\"comment\">//如果没有设置 则为空</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseWhere</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'where'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'WHERE '</span>.<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'where'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseGroup</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'group'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'GROUP BY '</span>.<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'group'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseHaving</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'having'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'HAVING '</span>.<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'having'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseOrder</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'order'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'ORDER BY '</span>.<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'order'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//limit可以有以下几种传法</span></span><br><span class=\"line\">\t<span class=\"comment\">//用户传进来的是一个整 数，就是查询指定的条数</span></span><br><span class=\"line\">\t<span class=\"comment\">//用户传进来的是一个数组，则数组中的第一个元素为$offset,第二个元素为$num</span></span><br><span class=\"line\">\t<span class=\"comment\">//如果户传进来的是一个字符串，则以用户传的为准</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">parseLimit</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (is_int(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'LIMIT '</span>.<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">elseif</span> (is_array(<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'LIMIT '</span>. join(<span class=\"string\">','</span>,<span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">'LIMIT '</span> . <span class=\"keyword\">$this</span>-&gt;options[<span class=\"string\">'limit'</span>][<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//增加方法</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">($data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"insert into %TABLE%(%FIELDS%) values(%VALUES%)\"</span>;</span><br><span class=\"line\">\t\t<span class=\"comment\">//insert into bbs_user(username,sex) values('liwenkai','null');</span></span><br><span class=\"line\">\t\t$newSql = str_replace(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">array</span>(<span class=\"string\">'%TABLE%'</span>,<span class=\"string\">'%FIELDS%'</span>,<span class=\"string\">'%VALUES%'</span>),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseInsertFields($data),</span><br><span class=\"line\">\t\t\t\t\t\tjoin(<span class=\"string\">','</span>,<span class=\"keyword\">$this</span>-&gt;parseValue($data)),</span><br><span class=\"line\">\t\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $newSql;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//echo $newSql;</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;exec($newSql,<span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseValue</span><span class=\"params\">($data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_string($data)) &#123;</span><br><span class=\"line\">\t\t\t$data = <span class=\"string\">'\\''</span>.$data.<span class=\"string\">'\\''</span>;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">elseif</span> (is_array($data)) &#123;</span><br><span class=\"line\">\t\t\t$data = array_map(<span class=\"keyword\">array</span>(<span class=\"keyword\">$this</span>,<span class=\"string\">'parseValue'</span>),$data);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">elseif</span> (is_null($data)) &#123;</span><br><span class=\"line\">\t\t\t$data = <span class=\"string\">'null'</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"> \t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseInsertFields</span><span class=\"params\">(&amp;$data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $key =&gt; $value) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (!in_array($key,<span class=\"keyword\">$this</span>-&gt;fields)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">unset</span>($data[$key]);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> join(<span class=\"string\">','</span>,array_keys($data));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//更新方法</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">($data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"update %TABLE% set %SETS% %WHERE% %ORDER% %LIMIT%\"</span>;</span><br><span class=\"line\">\t\t$newSql = str_replace(</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">array</span>(<span class=\"string\">'%TABLE%'</span>,<span class=\"string\">'%SETS%'</span>,<span class=\"string\">'%WHERE%'</span>,<span class=\"string\">'%ORDER%'</span>,<span class=\"string\">'%LIMIT%'</span>),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseSets($data),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseOrder(),</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseLimit(),</span><br><span class=\"line\">\t\t\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t\t);</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $newSql;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;exec($newSql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseSets</span><span class=\"params\">($data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$sets = [];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $key =&gt; $val) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (in_array($key,<span class=\"keyword\">$this</span>-&gt;fields)) &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t$sets[] = $key.<span class=\"string\">'='</span>.<span class=\"keyword\">$this</span>-&gt;parseValue($val);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> join(<span class=\"string\">','</span>,$sets) ;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//删除方法</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delete</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"delete from %TABLE% %WHERE% %ORDER% %LIMIT%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$newSql = str_replace(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">array</span>(<span class=\"string\">'%TABLE%'</span>,<span class=\"string\">'%WHERE%'</span>,<span class=\"string\">'%ORDER%'</span>,<span class=\"string\">'%LIMIT%'</span>),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseOrder(),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseLimit(),</span><br><span class=\"line\">\t\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $newSql;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;exec($newSql);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">exec</span><span class=\"params\">($sql, $isInsertId = false)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$result = mysqli_query(<span class=\"keyword\">$this</span>-&gt;link,$sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ($result) &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ( $isInsertId ) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//insert 返回自动增长的ID</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> mysqli_insert_id(<span class=\"keyword\">$this</span>-&gt;link);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//update delete只直返回 受影响行数</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> mysqli_affected_rows(<span class=\"keyword\">$this</span>-&gt;link);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t&#125;\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//查最大值 </span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span><span class=\"params\">($field = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_null($field)) &#123;</span><br><span class=\"line\">\t\t\t$field = <span class=\"keyword\">$this</span>-&gt;fields[<span class=\"string\">'_pk'</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select count($field) as num  from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t$data =  <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data[<span class=\"number\">0</span>][<span class=\"string\">'num'</span>];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//最小值 </span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">min</span><span class=\"params\">($field = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_null($field)) &#123;</span><br><span class=\"line\">\t\t\t$field = <span class=\"keyword\">$this</span>-&gt;fields[<span class=\"string\">'_pk'</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select min($field) as num  from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t$data =  <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data[<span class=\"number\">0</span>][<span class=\"string\">'num'</span>];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sum</span><span class=\"params\">($field = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_null($field)) &#123;</span><br><span class=\"line\">\t\t\t$field = <span class=\"keyword\">$this</span>-&gt;fields[<span class=\"string\">'_pk'</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select SUM($field) as num  from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t$data =  <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data[<span class=\"number\">0</span>][<span class=\"string\">'num'</span>];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//求最大值 </span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">max</span><span class=\"params\">($field = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_null($field)) &#123;</span><br><span class=\"line\">\t\t\t$field = <span class=\"keyword\">$this</span>-&gt;fields[<span class=\"string\">'_pk'</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select max($field) as num  from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t$data =  <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data[<span class=\"number\">0</span>][<span class=\"string\">'num'</span>];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//求平均数</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">avg</span><span class=\"params\">($field = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_null($field)) &#123;</span><br><span class=\"line\">\t\t\t$field = <span class=\"keyword\">$this</span>-&gt;fields[<span class=\"string\">'_pk'</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select avg($field) as num  from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%TABLE%'</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'%WHERE%'</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseWhere(),</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t$data =  <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $data[<span class=\"number\">0</span>][<span class=\"string\">'num'</span>];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBy</span><span class=\"params\">($field,$value)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"select %FIELDS% from %TABLE% %WHERE%\"</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$sql = str_replace(</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(<span class=\"string\">'%FIELDS%'</span>,<span class=\"string\">'%TABLE%'</span>,<span class=\"string\">'%WHERE%'</span>),</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">array</span>(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseFields(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;parseTable(),</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">'WHERE '</span>.$field . <span class=\"string\">\"='$value'\"</span>,</span><br><span class=\"line\">\t\t\t\t),</span><br><span class=\"line\">\t\t\t\t$sql</span><br><span class=\"line\">\t\t\t\t);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;sql = $sql;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;query($sql);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//自动的一个按照字段来查询的智能化查询方法</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//__call方法，针对用户请求的limit()  order()  group having等将其保存到options中去</span></span><br><span class=\"line\">\t<span class=\"comment\">//并且判断方法的法性</span></span><br><span class=\"line\">\t<span class=\"comment\">//并且return $this，让其能连贯操作。ORM （对象映射模型）$user-&gt;limit()-&gt;order()</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($func,$args)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$allow = [<span class=\"string\">'where'</span>,<span class=\"string\">'table'</span>,<span class=\"string\">'fields'</span>,<span class=\"string\">'order'</span>,<span class=\"string\">'limit'</span>,<span class=\"string\">'group'</span>,<span class=\"string\">'having'</span>];</span><br><span class=\"line\">\t\t$func = strtolower($func);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (in_array($func,$allow)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">$this</span>-&gt;options[$func] = $args;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">elseif</span>(substr($func,<span class=\"number\">0</span>,<span class=\"number\">5</span>) == <span class=\"string\">'getby'</span>)&#123;</span><br><span class=\"line\">\t\t\t$field = substr($func,<span class=\"number\">5</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (in_array($field,<span class=\"keyword\">$this</span>-&gt;fields)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;getby($field,$args[<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'方法不合法'</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//对象销毁者关闭页面的时候，自动执行</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\tmysqli_close(<span class=\"keyword\">$this</span>-&gt;link);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>3、Page类<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//声明page类</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Page</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//url</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $url;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//总页数</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $pageCount;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//总条数</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $total;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//每页显示数</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $num;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//当前页</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $page;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//初使化成员属性</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($total, $num = <span class=\"number\">5</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//总条数</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;total = ($total &gt; <span class=\"number\">0</span>) ? (int) $total : <span class=\"number\">1</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//每页显示数</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;num = $num;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//总页数</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;pageCount = <span class=\"keyword\">$this</span>-&gt;getPageCount();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//当前页</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;page = <span class=\"keyword\">$this</span>-&gt;getCurrentPage();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//url</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;url = <span class=\"keyword\">$this</span>-&gt;getUrl();</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//一次性返回所有的分页信息</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">rendor</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> [</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"string\">'first'</span> =&gt; <span class=\"keyword\">$this</span>-&gt;first(),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"string\">'next'</span> =&gt; <span class=\"keyword\">$this</span>-&gt;next(),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"string\">'prev'</span> =&gt; <span class=\"keyword\">$this</span>-&gt;prev(),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"string\">'end'</span> =&gt; <span class=\"keyword\">$this</span>-&gt;end(),</span></span><br><span class=\"line\"><span class=\"php\">\t\t];</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//limit方法，在未来分页数据查询时候，直接返回对应的limit 0,5 这样的字符串</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">limit</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$offset = (<span class=\"keyword\">$this</span>-&gt;page - <span class=\"number\">1</span>) * <span class=\"keyword\">$this</span>-&gt;num;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$str = $offset.<span class=\"string\">','</span>.<span class=\"keyword\">$this</span>-&gt;num;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $str;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">end</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;setQueryString(<span class=\"string\">'page='</span>.<span class=\"keyword\">$this</span>-&gt;pageCount);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//上一页</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">prev</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$page = (<span class=\"keyword\">$this</span>-&gt;page &lt;=<span class=\"number\">1</span>) ? <span class=\"number\">1</span> : (<span class=\"keyword\">$this</span>-&gt;page <span class=\"number\">-1</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;setQueryString(<span class=\"string\">'page='</span>.$page);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//下一页</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">next</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$page = (<span class=\"keyword\">$this</span>-&gt;page &gt;= <span class=\"keyword\">$this</span>-&gt;pageCount) ?  <span class=\"keyword\">$this</span>-&gt;pageCount : (<span class=\"keyword\">$this</span>-&gt;page + <span class=\"number\">1</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;setQueryString(<span class=\"string\">'page='</span>.$page);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//首页</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">first</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//设置查询的page页码为第一页，即为首页</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;setQueryString(<span class=\"string\">'page=1'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//一种况有?，一种情况是没有?的情况</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setQueryString</span><span class=\"params\">($page)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果url当中有问号</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (strpos(<span class=\"keyword\">$this</span>-&gt;url, <span class=\"string\">'?'</span>)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;url.<span class=\"string\">'&amp;'</span>.$page;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果url当中没有问号</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;url.<span class=\"string\">'?'</span>.$page;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getUrl</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$path = $_SERVER[<span class=\"string\">'REQUEST_URI'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//先要获取户传进来的URI</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//用parse_url 解释URI</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$par = parse_url($path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//判断是否设置过query</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($par[<span class=\"string\">'query'</span>])) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\tparse_str($par[<span class=\"string\">'query'</span>],$query);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"comment\">//检查query里面是否有page,如果有就干掉page</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">unset</span>($query[<span class=\"string\">'page'</span>]);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$path = $par[<span class=\"string\">'path'</span>].<span class=\"string\">'?'</span>.http_build_query($query);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$path = rtrim($path,<span class=\"string\">'?'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//协议：主机：端口：文件和请求</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//判断是否定义过端口，并且端口是否为443，如果为443则是https协议，否则就是http协议</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$protocal = (<span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">'SERVER_PORT'</span>]) &amp;&amp; $_SERVER[<span class=\"string\">'SERVER_PORT'</span>] == <span class=\"number\">443</span>) ?<span class=\"string\">'https://'</span> : <span class=\"string\">'http://'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"number\">80</span> == $_SERVER[<span class=\"string\">'SERVER_PORT'</span>] || <span class=\"number\">443</span> == $_SERVER[<span class=\"string\">'SERVER_PORT'</span>]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$url = $protocal.$_SERVER[<span class=\"string\">'SERVER_NAME'</span>].$path;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"comment\">//http://www.baidu.com:8012/index.php?username=liwenkai</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$url = $protocal.$_SERVER[<span class=\"string\">'SERVER_NAME'</span>].<span class=\"string\">':'</span>.$_SERVER[<span class=\"string\">'SERVER_PORT'</span>].$path;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//拼接 path. ? . 全新组合成的URI</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $url;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getCurrentPage</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果用户设置过page信息，就返回page相关信息，强制转为整型</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'page'</span>])) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"comment\">//得到页码</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$page = (int) $_GET[<span class=\"string\">'page'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"comment\">//你的页码不能够大于总页数</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">if</span> ($page &gt; <span class=\"keyword\">$this</span>-&gt;pageCount) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$page = <span class=\"keyword\">$this</span>-&gt;pageCount;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"comment\">//你的页码不能小于1</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">if</span> ($page &lt; <span class=\"number\">1</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$page = <span class=\"number\">1</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$page = <span class=\"number\">1</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $page;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getPageCount</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//计算总页数，使用到了进一法取整</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> ceil(<span class=\"keyword\">$this</span>-&gt;total / <span class=\"keyword\">$this</span>-&gt;num);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>4、Tpl类<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Tpl</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//缓存目录</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $cacheDir = <span class=\"string\">'./Cache/'</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//模版目录</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $tplDir = <span class=\"string\">'./Tpl/'</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//保存变量的成员方法</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $vars = [];</span><br><span class=\"line\">\t<span class=\"comment\">//缓存有效期</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $cacheLifeTime = <span class=\"number\">3600</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//初使化成员属性</span></span><br><span class=\"line\">\t<span class=\"comment\">//判断缓存目录是否存在</span></span><br><span class=\"line\">\t<span class=\"comment\">//判断模版路径是否存在，如果不存在要创建，如果不可写，要改权限</span></span><br><span class=\"line\">\t<span class=\"comment\">//初化缓存时间</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($tplDir = null, $cacheDir = null ,$cacheLifeTime = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($tplDir)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;_checkDir($tplDir)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">$this</span>-&gt;tplDir = rtrim($tplDir,<span class=\"string\">'/'</span>).<span class=\"string\">'/'</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($cacheDir)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;_checkDir($cacheDir)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">$this</span>-&gt;cacheDir = rtrim($cacheDir,<span class=\"string\">'/'</span>).<span class=\"string\">'/'</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($cacheLifeTime)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">$this</span>-&gt;cacheLifeTime = $cacheLifeTime;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_checkDir</span><span class=\"params\">($path)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!file_exists($path) || !is_dir($path)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> mkdir($path,<span class=\"number\">0755</span>,<span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!is_writable($path) || !is_readable($path)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> chmod($path,<span class=\"number\">0755</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//$tpl-&gt;assign()-&gt;assign()-&gt;display();</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//分配变量</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">assign</span><span class=\"params\">($key,$val)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;vars[$key] = $val;</span><br><span class=\"line\">\t\t<span class=\"comment\">//return $this;</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//display显示模版内容</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">display</span><span class=\"params\">($file,$isExecute = true, $uri = null)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//获得模版路径（模版目录路径 + 模版文件）</span></span><br><span class=\"line\">\t\t$tplFilePath = <span class=\"keyword\">$this</span>-&gt;tplDir.$file;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//判断文件是否存在</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!file_exists($tplFilePath)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">echo</span> $tplFilePath;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'模板文件不存在'</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">//获得编译文件路径（组合一个新的） page.php?page=3</span></span><br><span class=\"line\">\t\t$cacheFile = md5($file.$uri).<span class=\"string\">'.php'</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$cacheFilePath = <span class=\"keyword\">$this</span>-&gt;cacheDir . $cacheFile;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//检测是否编译过、是否修改过模版文件，如果编译，并且在有效期内，则不编译</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!file_exists($cacheFilePath)) &#123;</span><br><span class=\"line\">\t\t\t$html = <span class=\"keyword\">$this</span>-&gt;compile($tplFilePath);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//如果修改过模版文件，则删除原有的编译文件重新编译</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (filemtime($tplFilePath) &gt; filemtime($cacheFilePath)) &#123;</span><br><span class=\"line\">\t\t\t\tunlink($cacheFilePath);</span><br><span class=\"line\">\t\t\t\t$html = <span class=\"keyword\">$this</span>-&gt;compile($tplFilePath);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 文件创建时间 + 缓存有效期 &gt; time(当前时间) 没有过期，否则过期了</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//如果大于time 没过期</span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t\t$isTimeout = (filemtime($tplFilePath) + <span class=\"keyword\">$this</span>-&gt;cacheLifeTime &gt; time()) ? <span class=\"keyword\">false</span> : <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ($isTimeout) &#123;</span><br><span class=\"line\">\t\t\t\t$html = <span class=\"keyword\">$this</span>-&gt;compile($tplFilePath);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//编译</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($html)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (!file_put_contents($cacheFilePath,$html)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'编译文件写入失败'</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">//判断是否需要执行</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//如果不需要执行则，则不包含 ，不extract变量，反之则不然</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ($isExecute) &#123;</span><br><span class=\"line\">\t\t\textract(<span class=\"keyword\">$this</span>-&gt;vars);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">include</span> $cacheFilePath;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">compile</span><span class=\"params\">($tplFilePath)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$html = file_get_contents($tplFilePath);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$keys = [</span><br><span class=\"line\">\t\t\t<span class=\"string\">'&#123;if %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php if(\\1): ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;else&#125;'</span> =&gt; <span class=\"string\">'&lt;?php else : ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;else if %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php elseif(\\1) : ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;elseif %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php elseif(\\1) : ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/if&#125;'</span> =&gt; <span class=\"string\">'&lt;?php endif;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;$%%&#125;'</span> =&gt; <span class=\"string\">'&lt;?=$\\1;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;foreach %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php foreach(\\1) :?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/foreach&#125;'</span> =&gt; <span class=\"string\">'&lt;?php endforeach;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;for %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php for(\\1):?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/for&#125;'</span> =&gt; <span class=\"string\">'&lt;?php endfor;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;while %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php while(\\1):?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/while&#125;'</span> =&gt; <span class=\"string\">'&lt;?php endwhile;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;continue&#125;'</span> =&gt; <span class=\"string\">'&lt;?php continue;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;break&#125;'</span> =&gt; <span class=\"string\">'&lt;?php break;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;$%% = $%%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php $\\1 = $\\2;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;$%%++&#125;'</span> =&gt; <span class=\"string\">'&lt;?php $\\1++;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;$%%--&#125;'</span> =&gt; <span class=\"string\">'&lt;?php $\\1--;?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;comment&#125;'</span> =&gt; <span class=\"string\">'&lt;?php /* '</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/comment&#125;'</span> =&gt; <span class=\"string\">' */ ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/*&#125;'</span> =&gt; <span class=\"string\">'&lt;?php /* '</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;*/&#125;'</span> =&gt; <span class=\"string\">'* ?&gt;'</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;section&#125;'</span> =&gt; <span class=\"string\">'&lt;?php '</span>,</span><br><span class=\"line\">            <span class=\"string\">'&#123;/section&#125;'</span> =&gt; <span class=\"string\">'?&gt;'</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">'&#123;&#123;%%(%%)&#125;&#125;'</span> =&gt; <span class=\"string\">'&lt;?=\\1(\\2);?&gt;'</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">'&#123;date(%%,$%%)&#125;'</span>=&gt; <span class=\"string\">'&lt;?=date(\\1,$\\2);?&gt;'</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">'&#123;include %%&#125;'</span> =&gt; <span class=\"string\">'&lt;?php include \"\\1\";?&gt;'</span>,</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">foreach</span> ($keys <span class=\"keyword\">as</span> $key =&gt; $val) &#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t$pattern = <span class=\"string\">'#'</span>. str_replace(<span class=\"string\">'%%'</span>,<span class=\"string\">'(.+)'</span>,preg_quote($key,<span class=\"string\">'#'</span>)) .<span class=\"string\">'#imsU'</span>;</span><br><span class=\"line\">\t\t\t$replace = $val;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (stripos($pattern,<span class=\"string\">'include'</span>)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//处理一次回调</span></span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t\t$html = preg_replace_callback($pattern,<span class=\"keyword\">array</span>(<span class=\"keyword\">$this</span>,<span class=\"string\">'parseInclude'</span>),$html);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t$html = preg_replace($pattern,$replace,$html);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $html;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseInclude</span><span class=\"params\">($data)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$file = str_replace([<span class=\"string\">'\\''</span>,<span class=\"string\">'\"'</span>],<span class=\"string\">''</span>,$data[<span class=\"number\">1</span>]);</span><br><span class=\"line\">\t\t$path = <span class=\"keyword\">$this</span>-&gt;parsePath($file);</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;display($file,<span class=\"keyword\">false</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"string\">'&lt;?php include \"'</span>.$path.<span class=\"string\">'\";?&gt;'</span>;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parsePath</span><span class=\"params\">($file)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$path = <span class=\"keyword\">$this</span>-&gt;cacheDir . md5($file).<span class=\"string\">'.php'</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $path;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//删除缓存文件（递归）</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">clearCache</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">self</span>::delDir(<span class=\"keyword\">$this</span>-&gt;cacheDir);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delDir</span><span class=\"params\">($path)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$res = opendir($path);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span>($file = readdir($res)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ($file == <span class=\"string\">'.'</span> || $file == <span class=\"string\">'..'</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t$newPath = $path.<span class=\"string\">'/'</span>.$file;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (is_dir($newPath)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">self</span>::delDir($newPath);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\tunlink($newPath);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"> \t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>5、Upload类<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Upload</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//上传到哪个目录</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $path = <span class=\"string\">'Upload/'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//准许的MIME</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $allowmime = [<span class=\"string\">'image/png'</span>,<span class=\"string\">'image/jpg'</span>,<span class=\"string\">'image/jpeg'</span>,<span class=\"string\">'image/pjpeg'</span>,<span class=\"string\">'image/bmp'</span>,<span class=\"string\">'image/wbmp'</span>,<span class=\"string\">'image/gif'</span>,<span class=\"string\">'image/x-png'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//准许的后缀</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $allowsubfix = [<span class=\"string\">'jpg'</span>,<span class=\"string\">'png'</span>,<span class=\"string\">'jpeg'</span>,<span class=\"string\">'gif'</span>,<span class=\"string\">'bmp'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//准许的大小</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $allowsize = <span class=\"number\">2097152</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//是否准许随机文件名</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $israndname = <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//是否准许日期目录</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $isdatepath = <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的大小</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $size;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的原名</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $orgname;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的新名</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $newname;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的后缀</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $subfix;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的MIME类型</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $mime;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文件的新路径</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $newpath;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//错误号</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $errorno;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//错误信息</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $errorinfo;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//临时文件</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $tmpfile;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//前缀</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $prefix;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//初使化成员属性，传进来的东西特别多，我们要求以数组的形式来传递</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//foreach循环，取出键名、值</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//将键名设置为成员属性名，将键值设为成员属性值</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//注意键名的合法性</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">// errorInfo   errorinfo</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(Array $config = [])</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">foreach</span> ($config <span class=\"keyword\">as</span> $key =&gt; $value) &#123;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption($key,$value);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setOption</span><span class=\"params\">($key,$value)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$key = strtolower($key);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t$allPro = get_class_vars(get_class(<span class=\"keyword\">$this</span>));</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//var_dump($allpro);</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (array_key_exists($key,$allPro)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;$key = $value;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//设置一个get方法专门获得新路径</span></span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//设置 一个get方法专门来获得错误信息</span></span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//成员方法上传方法</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">uploadFile</span><span class=\"params\">($field)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//var_dump($field);die;</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//检测路径用户是否定义过，如果没有定义失败</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!file_exists(<span class=\"keyword\">$this</span>-&gt;path)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">echo</span> <span class=\"string\">'11111111111'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-1</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//目录权限检测</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;checkPath()) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-2</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//获得$_FILES当中五个基本信息</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$name = $_FILES[$field][<span class=\"string\">'name'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$size = $_FILES[$field][<span class=\"string\">'size'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$type = $_FILES[$field][<span class=\"string\">'type'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t </span></span><br><span class=\"line\"><span class=\"php\">\t\t$tmpName = $_FILES[$field][<span class=\"string\">'tmp_name'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t$error = $_FILES[$field][<span class=\"string\">'error'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//var_dump($_FILES);die;</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//传入到一个成员方法里面进行设置</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;setFiles($name,$size,$type,$tmpName,$error)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//检测MIME是否合法，检测后缀是否合法，检测文件大小是否超过了自定义的大小</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;checkMime() || !<span class=\"keyword\">$this</span>-&gt;checkSubfix() || !<span class=\"keyword\">$this</span>-&gt;checkSize()) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//新名</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;newname = <span class=\"keyword\">$this</span>-&gt;getNewName();</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//新路径处理</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;newpath = <span class=\"keyword\">$this</span>-&gt;getNewPath();</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//是否是上传文件</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果是上传文件移动上传文件至指定的目录</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果成员return true</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span>( <span class=\"keyword\">$this</span>-&gt;move())&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;newpath . <span class=\"keyword\">$this</span>-&gt;newname;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">move</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!is_uploaded_file(<span class=\"keyword\">$this</span>-&gt;tmpfile)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-6</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//var_dump($this-tmpfile);</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"keyword\">$this</span>-&gt;tmpfile,<span class=\"keyword\">$this</span>-&gt;newpath.<span class=\"keyword\">$this</span>-&gt;newname)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-7</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNewPath</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;path = rtrim(<span class=\"keyword\">$this</span>-&gt;path,<span class=\"string\">'/'</span>).<span class=\"string\">'/'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;isdatepath) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$newpath = <span class=\"keyword\">$this</span>-&gt;path.date(<span class=\"string\">'Y/m/d/'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">if</span> (!file_exists($newpath)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\tmkdir($newpath,<span class=\"number\">0755</span>,<span class=\"keyword\">true</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> $newpath;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;path;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNewName</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;israndname) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;prefix . uniqid() . <span class=\"string\">'.'</span> . <span class=\"keyword\">$this</span>-&gt;subfix;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;prefix . <span class=\"keyword\">$this</span>-&gt;orgname;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkSize</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;size &gt; <span class=\"keyword\">$this</span>-&gt;allowsize) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-5</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkSubFix</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (in_array(<span class=\"keyword\">$this</span>-&gt;subfix,<span class=\"keyword\">$this</span>-&gt;allowsubfix)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-4</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkMime</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (in_array(<span class=\"keyword\">$this</span>-&gt;mime,<span class=\"keyword\">$this</span>-&gt;allowmime)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,<span class=\"number\">-3</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setFiles</span><span class=\"params\">($name,$size,$type,$tmpName,$error)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//1 2 3 4 6 7  0(正常)</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> ($error) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;setOption(<span class=\"string\">'errorNo'</span>,$error);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;orgname = $name;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;size = $size;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;tmpfile = $tmpName;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;mime = $type;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//后缀没处理</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$info = pathinfo($name);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;subfix = $info[<span class=\"string\">'extension'</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\">\t\t/*</span><br><span class=\"line\">\t\t$arr = explode('.',$name);</span><br><span class=\"line\">\t\t$this-&gt;subfix = array_pop($arr);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$arr = explode('.',$name);</span><br><span class=\"line\">\t\t$this-&gt;subfix = $arr[count($arr)-1];</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$pos = strrpos($name,'.');</span><br><span class=\"line\">\t\techo substr($name,$pos + 1);</span><br><span class=\"line\"><span class=\"php\">\t\t*/</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkPath</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//检测路径是否是目录，如果不存在创建</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!is_dir(<span class=\"keyword\">$this</span>-&gt;path)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> mkdir(<span class=\"keyword\">$this</span>-&gt;path,<span class=\"number\">0755</span>,<span class=\"keyword\">true</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//检测路径是否可写，如果不写写更改权限</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (!is_writeable(<span class=\"keyword\">$this</span>-&gt;path) ||  !is_readable(<span class=\"keyword\">$this</span>-&gt;path)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> chmod(<span class=\"keyword\">$this</span>-&gt;path,<span class=\"number\">0755</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getErrorInfo</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">switch</span> (<span class=\"keyword\">$this</span>-&gt;errorno) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'部份件被上传'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'没有文件被上传'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'找不到临时文件夹'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'临时文件写入失败'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-1</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'自定义的上传路径不存在'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-2</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'没有权限'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-3</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-4</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'类型或后缀不准许'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-5</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'超过了自定义的大小'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-6</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'不是上传文件'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">-7</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'移动上传文件失败'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $str;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($key)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (in_array($key, [<span class=\"string\">'newpath'</span>,<span class=\"string\">'newname'</span>,<span class=\"string\">'errorno'</span>,<span class=\"string\">'size'</span>])) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\tvar_dump($key);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$key;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ($key == <span class=\"string\">'errorinfo'</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;getErrorInfo();</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>6、Verify类<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">Framework</span>;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Verify</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//宽</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $width;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//高</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $height;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//图片类型</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $imgType;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文字类型</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $codeType;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//文字的个数</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $num;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//保存的验证码字符串</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $verifyCode;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//保存验证码资源的一个成员属性</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> $res;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//初始化成员</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//上面这些参数</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($width = <span class=\"number\">100</span>, $height = <span class=\"number\">50</span>, $imgType = <span class=\"string\">'png'</span>, $codeType = <span class=\"number\">3</span>, $num = <span class=\"number\">4</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;width = $width;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;height = $height;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;imgType = $imgType;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;codeType = $codeType;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;num = $num;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;verifyCode = <span class=\"keyword\">$this</span>-&gt;createVerifyCode();</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">createVerifyCode</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$string = <span class=\"string\">''</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">switch</span> (<span class=\"keyword\">$this</span>-&gt;codeType) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$string = implode(<span class=\"string\">''</span>,array_rand(range(<span class=\"number\">0</span>,<span class=\"number\">9</span>),<span class=\"keyword\">$this</span>-&gt;num));</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$string = join(<span class=\"string\">''</span>,array_rand(array_flip(range(<span class=\"string\">'a'</span>,<span class=\"string\">'z'</span>)),<span class=\"number\">4</span>));</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span></span><br><span class=\"line\">\t\t\t\t/*</span><br><span class=\"line\">\t\t\t\tfor ($i = 0; $i &lt; $this-&gt;num; $i++) &#123;</span><br><span class=\"line\">\t\t\t\t\t$r= mt_rand(0,2);</span><br><span class=\"line\">\t\t\t\t\tswitch ($r) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tcase 0:</span><br><span class=\"line\">\t\t\t\t\t\t\t$ascii = mt_rand(48,57);</span><br><span class=\"line\">\t\t\t\t\t\t\tbreak;</span><br><span class=\"line\">\t\t\t\t\t\tcase 1:</span><br><span class=\"line\">\t\t\t\t\t\t\t$ascii = mt_rand(65,90);</span><br><span class=\"line\">\t\t\t\t\t\t\tbreak;</span><br><span class=\"line\">\t\t\t\t\t\tcase 2:</span><br><span class=\"line\">\t\t\t\t\t\t\t$ascii = mt_rand(97,122);</span><br><span class=\"line\">\t\t\t\t\t\t\tbreak;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t$string .= chr($ascii);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"><span class=\"php\">\t\t\t\t*/</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$str = <span class=\"string\">'abcdefghijkmnpqrstuvwxzABCDEFGHJKLMNPQRSTUVWXYZ23456789'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$string = substr(str_shuffle($str),<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;num);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $string;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//调验证码显示的一个方法 output</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//1.画图</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//2.分配颜色(写两个成员方法，调的时候直接调对应的成员方法即可)</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//3.背景填充</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//4.画干扰点</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//5.画干扰线</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//6.写字 </span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//7. 输出类型</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//8. 输出图片</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">outImg</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;createImg();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;fillBgColor();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;fillPix();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;fillArc();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;writeFont();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;output();</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">output</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//imagepng</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$func = <span class=\"string\">'image'</span>.<span class=\"keyword\">$this</span>-&gt;imgType;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$mime = <span class=\"string\">'Content-type:image/'</span>.<span class=\"keyword\">$this</span>-&gt;imgType;</span></span><br><span class=\"line\"><span class=\"php\">\t\theader($mime);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$func(<span class=\"keyword\">$this</span>-&gt;res);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">writeFont</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; <span class=\"keyword\">$this</span>-&gt;num; $i++) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$width = ceil(<span class=\"keyword\">$this</span>-&gt;width / <span class=\"keyword\">$this</span>-&gt;num);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$x = $width * $i;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$y= mt_rand(<span class=\"number\">5</span>,<span class=\"keyword\">$this</span>-&gt;height - <span class=\"number\">10</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$c = <span class=\"keyword\">$this</span>-&gt;verifyCode[$i];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\timagechar(<span class=\"keyword\">$this</span>-&gt;res,<span class=\"number\">5</span>,$x,$y,$c,<span class=\"keyword\">$this</span>-&gt;darkColor());</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fillArc</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">for</span>($i = <span class=\"number\">0</span>; $i &lt; <span class=\"number\">10</span>; $i++) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\timagearc(<span class=\"keyword\">$this</span>-&gt;res,</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">10</span>,<span class=\"keyword\">$this</span>-&gt;width - <span class=\"number\">10</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">10</span>,<span class=\"keyword\">$this</span>-&gt;height - <span class=\"number\">10</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;width),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;height),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">0</span>,<span class=\"number\">180</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\tmt_rand(<span class=\"number\">181</span>,<span class=\"number\">360</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t<span class=\"keyword\">$this</span>-&gt;lightColor()</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fillPix</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$num = <span class=\"keyword\">$this</span>-&gt;pixNum();</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; $num; $i++) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\timagesetpixel(<span class=\"keyword\">$this</span>-&gt;res,mt_rand(<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;width),mt_rand(<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;height),<span class=\"keyword\">$this</span>-&gt;darkColor());</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pixNum</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$area = ceil((<span class=\"keyword\">$this</span>-&gt;width * <span class=\"keyword\">$this</span>-&gt;height) / <span class=\"number\">20</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> $area;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fillBgColor</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\timagefill(<span class=\"keyword\">$this</span>-&gt;res,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"keyword\">$this</span>-&gt;lightColor());</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">lightColor</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> imagecolorallocate(<span class=\"keyword\">$this</span>-&gt;res,</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">130</span>,<span class=\"number\">255</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">130</span>,<span class=\"number\">255</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">130</span>,<span class=\"number\">255</span>)</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t\t);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">darkColor</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> imagecolorallocate(<span class=\"keyword\">$this</span>-&gt;res,</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">0</span>,<span class=\"number\">120</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">0</span>,<span class=\"number\">120</span>),</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t   mt_rand(<span class=\"number\">0</span>,<span class=\"number\">120</span>)</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t\t\t\t);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createImg</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;res = imagecreatetruecolor(<span class=\"keyword\">$this</span>-&gt;width,<span class=\"keyword\">$this</span>-&gt;height);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//9 .销毁图片资源</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//imagedestroy($this-&gt;res);</span></span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"comment\">//可以做一个魔术方法__get专门用于得到验证码字符串</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($key)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> ($key == <span class=\"string\">'verifyCode'</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$key;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>7、auto_load(类的自动加载)<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Init</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loader</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$psr = <span class=\"keyword\">new</span> Psr4();</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$psr-&gt;register();</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">foreach</span> ($GLOBALS[<span class=\"string\">'nameSpace'</span>] <span class=\"keyword\">as</span> $name =&gt; $baseDir) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$psr-&gt;addNamespace($name,$baseDir);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">router</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;loader();</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$_GET[<span class=\"string\">'m'</span>] = <span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'m'</span>]) ? ucfirst(strtolower($_GET[<span class=\"string\">'m'</span>])) : <span class=\"string\">'Index'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$_GET[<span class=\"string\">'a'</span>] = <span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'a'</span>]) ? $_GET[<span class=\"string\">'a'</span>] :<span class=\"string\">'index'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$controllerName = <span class=\"string\">'Controller\\\\'</span>.$_GET[<span class=\"string\">'m'</span>].<span class=\"string\">'Controller'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$mod = <span class=\"keyword\">new</span> $controllerName();</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">if</span> (method_exists($mod,$_GET[<span class=\"string\">'a'</span>])) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\tcall_user_func(<span class=\"keyword\">array</span>($mod,$_GET[<span class=\"string\">'a'</span>]));</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125; <span class=\"keyword\">else</span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">'方法不合法'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>8、PSR_4<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Psr4</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> $prefixes;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">register</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\tspl_autoload_register(<span class=\"keyword\">array</span>(<span class=\"keyword\">$this</span>,<span class=\"string\">'loadClass'</span>));</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addNamespace</span><span class=\"params\">($nameSpace, $path)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$nameSpace = trim($nameSpace,<span class=\"string\">'\\\\'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$path = rtrim($path,DIRECTORY_SEPARATOR).<span class=\"string\">'/'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;prefixes[$nameSpace]) == <span class=\"keyword\">false</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;prefixes[$nameSpace] = <span class=\"keyword\">array</span>();</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\tarray_push(<span class=\"keyword\">$this</span>-&gt;prefixes[$nameSpace],$path);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadClass</span><span class=\"params\">($className)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t$pos = strrpos($className,<span class=\"string\">'\\\\'</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//µÃµ½ÃüÃû¿Õ¼ä</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t$nameSpace = substr($className,<span class=\"number\">0</span>, $pos);</span></span><br><span class=\"line\"><span class=\"php\">\t\t$realClass = substr($className,$pos + <span class=\"number\">1</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//´¦ÀíÓ³Éä°üº¬</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">$this</span>-&gt;mappingFile($nameSpace, $realClass);</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mappingFile</span><span class=\"params\">($nameSpace, $realClass)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;prefixes[$nameSpace]) == <span class=\"keyword\">false</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;prefixes[$nameSpace] <span class=\"keyword\">as</span> $baseDir) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$file = $baseDir . str_replace(<span class=\"string\">'\\\\'</span>,<span class=\"string\">'/'</span>,$realClass).<span class=\"string\">'.php'</span>;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">$this</span>-&gt;requireFile($file);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">requireFile</span><span class=\"params\">($file)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span> (file_exists($file)) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">include</span> $file;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>9、NameSpace<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">return</span> [</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"string\">'Model'</span> =&gt; <span class=\"string\">'App/Model/'</span>,</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"string\">'Controller'</span> =&gt; <span class=\"string\">'App/Controller/'</span>,</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"string\">'Framework'</span> =&gt; <span class=\"string\">'Vendor/Phone/Framework/Src/'</span>,</span></span><br><span class=\"line\"><span class=\"php\">];</span></span><br></pre></td></tr></table></figure></p>"},{"title":"MySQL权限控制","date":"2017-07-25T10:07:56.000Z","_content":"\n如何操作数据库的权限，下面我会根据不同的场景配合命令进行说明\n<!-- more --> \n\n## 数据库的权限\n查找(SELECT)、 增加(INSERT)、修改(UPDATE)、删除(DELETE)\n## 限制root登陆ip\n\n一般数据库创建的时候，root登陆的ip为localhost， 但是现在更多的是使用工具(至少我身边的人),所以我们需要先把root账号设置成我们公司或者家庭的固定ip。那么如何查看自己的ip地址？打开度娘然后输入ip，就可以了。 \n```\n\tmsyql -h localhost -u -p (回车输密码)\n\tuser mysql;\n\tgrant all privileges on *.* to 'root'@'ip' identified by 'password'; \n\tflush privileges;\n```\n备注： 如果命令执行完成， 但你使用工具无法连接时，那么建议你查看一下服务器的3306端口是否开启，如果是阿里的，那么登陆阿里的控制台，在安全组内开通。\n如果是自己的服务器，那么再后续的文章中我会讲解。\n\n## 某个用户拥有对某个数据库的权限\n我们一般拥有很多的项目，那么就需要分配不同的用户去查找不同的数据库，那么这时候我们就需要以下命令:\n```\n\tcreate user username@'ip' identified by 'password';\n\tgrant all privileges on db.* to 'username'@'%' identified by 'password'; \n\tgrant create on db.* to 'username'@'%' identified by 'password'; \n\tgrant alter on db.* to 'username'@'%' identified by 'password'; \n\tgrant drop on db.* to 'username'@'%' identified by 'password'; \n\tflush privileges;\n```\n备注：all可以更换为：查找(SELECT)、 增加(INSERT)、修改(UPDATE)、删除(DELETE)\n\n## 修改某个用户的权限\n比如你的一个同事，刚入职的时候，你给他的是某个数据库的SELECT权限，但是工作时间久了或者是因为特定原因，现在需要讲他的权限改为全部，那么你需要下面的命令\n```\n\tevoke all privileges on db.* from 'username'@'ip';\n\tgrant all privileges on db.* to 'username'@'%' identified by 'password'; \n\tflush privileges;\n```\n备注：最好不要删除用户，因为你删除了用户，但却没有删除用户的权限，所以以后再添加一个用户的时候，可能会出现问题\n## 删除一个用户及他的权限\n如果你公司的某个员工离职了，那么你需要把他的权限给删除掉，当然一般都是设定了ip，不会发生这种情况\n```\n\tdelete from mysql.user  where user = \"username\";\n\trevoke insert,update,delete,select on *.* from 'db'@'ip' identified by 'password'; \n\tflush privileges;\n```\n## 给用户lock\n```\n\talter user 'username'@'ip' account lock; 增加lock\n\talter user 'username'@'ip' account unlock; 删除lock\n```\n当客户端使用lock状态的用户登录MySQL时，会收到如此报错 Access denied for user 'username'@'ip'\n## 查看用户的权限\n```\n\tshow grants for username;\n```\n## Grant的语法及权限列表\n\t1、 语法\n```\n\tGRANT privileges (columns) ON db.tables TO user IDENTIFIED BY \"password\" WITH GRANT OPTION;\n```\n\t2、 权限列表\n```\n\tALTER: 修改表和索引。\n\tCREATE: 创建数据库和表。\n\tDELETE: 删除表中已有的记录。\n\tDROP: 抛弃(删除)数据库和表。\n\tINDEX: 创建或抛弃索引。\n\tINSERT: 向表中插入新行。\n\tREFERENCE: 未用。\n\tSELECT: 检索表中的记录。\n\tUPDATE: 修改现存表记录。\n\tFILE: 读或写服务器上的文件。\n\tPROCESS: 查看服务器中执行的线程信息或杀死线程。\n\tRELOAD: 重载授权表或清空日志、主机缓存或表缓存。\n\tSHUTDOWN: 关闭服务器。\n\tALL: 所有权限，ALL PRIVILEGES同义词。\n\tUSAGE: 特殊的 \"无权限\" 权限。\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/MySQL权限控制.md","raw":"---\ntitle: MySQL权限控制\ndate: 2017-07-25 18:07:56\ntags: MySQL\ncategories: MySQL\n\n---\n\n如何操作数据库的权限，下面我会根据不同的场景配合命令进行说明\n<!-- more --> \n\n## 数据库的权限\n查找(SELECT)、 增加(INSERT)、修改(UPDATE)、删除(DELETE)\n## 限制root登陆ip\n\n一般数据库创建的时候，root登陆的ip为localhost， 但是现在更多的是使用工具(至少我身边的人),所以我们需要先把root账号设置成我们公司或者家庭的固定ip。那么如何查看自己的ip地址？打开度娘然后输入ip，就可以了。 \n```\n\tmsyql -h localhost -u -p (回车输密码)\n\tuser mysql;\n\tgrant all privileges on *.* to 'root'@'ip' identified by 'password'; \n\tflush privileges;\n```\n备注： 如果命令执行完成， 但你使用工具无法连接时，那么建议你查看一下服务器的3306端口是否开启，如果是阿里的，那么登陆阿里的控制台，在安全组内开通。\n如果是自己的服务器，那么再后续的文章中我会讲解。\n\n## 某个用户拥有对某个数据库的权限\n我们一般拥有很多的项目，那么就需要分配不同的用户去查找不同的数据库，那么这时候我们就需要以下命令:\n```\n\tcreate user username@'ip' identified by 'password';\n\tgrant all privileges on db.* to 'username'@'%' identified by 'password'; \n\tgrant create on db.* to 'username'@'%' identified by 'password'; \n\tgrant alter on db.* to 'username'@'%' identified by 'password'; \n\tgrant drop on db.* to 'username'@'%' identified by 'password'; \n\tflush privileges;\n```\n备注：all可以更换为：查找(SELECT)、 增加(INSERT)、修改(UPDATE)、删除(DELETE)\n\n## 修改某个用户的权限\n比如你的一个同事，刚入职的时候，你给他的是某个数据库的SELECT权限，但是工作时间久了或者是因为特定原因，现在需要讲他的权限改为全部，那么你需要下面的命令\n```\n\tevoke all privileges on db.* from 'username'@'ip';\n\tgrant all privileges on db.* to 'username'@'%' identified by 'password'; \n\tflush privileges;\n```\n备注：最好不要删除用户，因为你删除了用户，但却没有删除用户的权限，所以以后再添加一个用户的时候，可能会出现问题\n## 删除一个用户及他的权限\n如果你公司的某个员工离职了，那么你需要把他的权限给删除掉，当然一般都是设定了ip，不会发生这种情况\n```\n\tdelete from mysql.user  where user = \"username\";\n\trevoke insert,update,delete,select on *.* from 'db'@'ip' identified by 'password'; \n\tflush privileges;\n```\n## 给用户lock\n```\n\talter user 'username'@'ip' account lock; 增加lock\n\talter user 'username'@'ip' account unlock; 删除lock\n```\n当客户端使用lock状态的用户登录MySQL时，会收到如此报错 Access denied for user 'username'@'ip'\n## 查看用户的权限\n```\n\tshow grants for username;\n```\n## Grant的语法及权限列表\n\t1、 语法\n```\n\tGRANT privileges (columns) ON db.tables TO user IDENTIFIED BY \"password\" WITH GRANT OPTION;\n```\n\t2、 权限列表\n```\n\tALTER: 修改表和索引。\n\tCREATE: 创建数据库和表。\n\tDELETE: 删除表中已有的记录。\n\tDROP: 抛弃(删除)数据库和表。\n\tINDEX: 创建或抛弃索引。\n\tINSERT: 向表中插入新行。\n\tREFERENCE: 未用。\n\tSELECT: 检索表中的记录。\n\tUPDATE: 修改现存表记录。\n\tFILE: 读或写服务器上的文件。\n\tPROCESS: 查看服务器中执行的线程信息或杀死线程。\n\tRELOAD: 重载授权表或清空日志、主机缓存或表缓存。\n\tSHUTDOWN: 关闭服务器。\n\tALL: 所有权限，ALL PRIVILEGES同义词。\n\tUSAGE: 特殊的 \"无权限\" 权限。\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"MySQL权限控制","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuw90006ydqn406pm855","content":"<p>如何操作数据库的权限，下面我会根据不同的场景配合命令进行说明<br><a id=\"more\"></a> </p>\n<h2 id=\"数据库的权限\"><a href=\"#数据库的权限\" class=\"headerlink\" title=\"数据库的权限\"></a>数据库的权限</h2><p>查找(SELECT)、 增加(INSERT)、修改(UPDATE)、删除(DELETE)</p>\n<h2 id=\"限制root登陆ip\"><a href=\"#限制root登陆ip\" class=\"headerlink\" title=\"限制root登陆ip\"></a>限制root登陆ip</h2><p>一般数据库创建的时候，root登陆的ip为localhost， 但是现在更多的是使用工具(至少我身边的人),所以我们需要先把root账号设置成我们公司或者家庭的固定ip。那么如何查看自己的ip地址？打开度娘然后输入ip，就可以了。<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">msyql -h localhost -u -p (回车输密码)</span><br><span class=\"line\">user mysql;</span><br><span class=\"line\"><span class=\"keyword\">grant</span> all <span class=\"keyword\">privileges</span> <span class=\"keyword\">on</span> *.* <span class=\"keyword\">to</span> <span class=\"string\">'root'</span>@<span class=\"string\">'ip'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">flush</span> <span class=\"keyword\">privileges</span>;</span><br></pre></td></tr></table></figure></p>\n<p>备注： 如果命令执行完成， 但你使用工具无法连接时，那么建议你查看一下服务器的3306端口是否开启，如果是阿里的，那么登陆阿里的控制台，在安全组内开通。<br>如果是自己的服务器，那么再后续的文章中我会讲解。</p>\n<h2 id=\"某个用户拥有对某个数据库的权限\"><a href=\"#某个用户拥有对某个数据库的权限\" class=\"headerlink\" title=\"某个用户拥有对某个数据库的权限\"></a>某个用户拥有对某个数据库的权限</h2><p>我们一般拥有很多的项目，那么就需要分配不同的用户去查找不同的数据库，那么这时候我们就需要以下命令:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">user</span> username@<span class=\"string\">'ip'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>;</span><br><span class=\"line\"><span class=\"keyword\">grant</span> all <span class=\"keyword\">privileges</span> <span class=\"keyword\">on</span> db.* <span class=\"keyword\">to</span> <span class=\"string\">'username'</span>@<span class=\"string\">'%'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">grant</span> <span class=\"keyword\">create</span> <span class=\"keyword\">on</span> db.* <span class=\"keyword\">to</span> <span class=\"string\">'username'</span>@<span class=\"string\">'%'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">grant</span> <span class=\"keyword\">alter</span> <span class=\"keyword\">on</span> db.* <span class=\"keyword\">to</span> <span class=\"string\">'username'</span>@<span class=\"string\">'%'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">grant</span> <span class=\"keyword\">drop</span> <span class=\"keyword\">on</span> db.* <span class=\"keyword\">to</span> <span class=\"string\">'username'</span>@<span class=\"string\">'%'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">flush</span> <span class=\"keyword\">privileges</span>;</span><br></pre></td></tr></table></figure></p>\n<p>备注：all可以更换为：查找(SELECT)、 增加(INSERT)、修改(UPDATE)、删除(DELETE)</p>\n<h2 id=\"修改某个用户的权限\"><a href=\"#修改某个用户的权限\" class=\"headerlink\" title=\"修改某个用户的权限\"></a>修改某个用户的权限</h2><p>比如你的一个同事，刚入职的时候，你给他的是某个数据库的SELECT权限，但是工作时间久了或者是因为特定原因，现在需要讲他的权限改为全部，那么你需要下面的命令<br><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">evoke</span> all privileges <span class=\"literal\">on</span> <span class=\"regexp\">db.*</span> from <span class=\"string\">'username'</span>@<span class=\"string\">'ip'</span>;</span><br><span class=\"line\"><span class=\"attribute\">grant</span> all privileges <span class=\"literal\">on</span> <span class=\"regexp\">db.*</span> to <span class=\"string\">'username'</span>@<span class=\"string\">'%'</span> identified by <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"attribute\">flush</span> privileges;</span><br></pre></td></tr></table></figure></p>\n<p>备注：最好不要删除用户，因为你删除了用户，但却没有删除用户的权限，所以以后再添加一个用户的时候，可能会出现问题</p>\n<h2 id=\"删除一个用户及他的权限\"><a href=\"#删除一个用户及他的权限\" class=\"headerlink\" title=\"删除一个用户及他的权限\"></a>删除一个用户及他的权限</h2><p>如果你公司的某个员工离职了，那么你需要把他的权限给删除掉，当然一般都是设定了ip，不会发生这种情况<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> mysql.user  <span class=\"keyword\">where</span> <span class=\"keyword\">user</span> = <span class=\"string\">\"username\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">revoke</span> <span class=\"keyword\">insert</span>,<span class=\"keyword\">update</span>,<span class=\"keyword\">delete</span>,<span class=\"keyword\">select</span> <span class=\"keyword\">on</span> *.* <span class=\"keyword\">from</span> <span class=\"string\">'db'</span>@<span class=\"string\">'ip'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">flush</span> <span class=\"keyword\">privileges</span>;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"给用户lock\"><a href=\"#给用户lock\" class=\"headerlink\" title=\"给用户lock\"></a>给用户lock</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">user</span> <span class=\"string\">'username'</span>@<span class=\"string\">'ip'</span> <span class=\"keyword\">account</span> <span class=\"keyword\">lock</span>; 增加<span class=\"keyword\">lock</span></span><br><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">user</span> <span class=\"string\">'username'</span>@<span class=\"string\">'ip'</span> <span class=\"keyword\">account</span> <span class=\"keyword\">unlock</span>; 删除<span class=\"keyword\">lock</span></span><br></pre></td></tr></table></figure>\n<p>当客户端使用lock状态的用户登录MySQL时，会收到如此报错 Access denied for user ‘username‘@’ip’</p>\n<h2 id=\"查看用户的权限\"><a href=\"#查看用户的权限\" class=\"headerlink\" title=\"查看用户的权限\"></a>查看用户的权限</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">grants</span> <span class=\"keyword\">for</span> username;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Grant的语法及权限列表\"><a href=\"#Grant的语法及权限列表\" class=\"headerlink\" title=\"Grant的语法及权限列表\"></a>Grant的语法及权限列表</h2><pre><code>1、 语法\n</code></pre><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">privileges</span> (<span class=\"keyword\">columns</span>) <span class=\"keyword\">ON</span> db.tables <span class=\"keyword\">TO</span> <span class=\"keyword\">user</span> <span class=\"keyword\">IDENTIFIED</span> <span class=\"keyword\">BY</span> <span class=\"string\">\"password\"</span> <span class=\"keyword\">WITH</span> <span class=\"keyword\">GRANT</span> <span class=\"keyword\">OPTION</span>;</span><br></pre></td></tr></table></figure>\n<pre><code>2、 权限列表\n</code></pre><figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">ALTER:</span> 修改表和索引。</span><br><span class=\"line\"><span class=\"symbol\">CREATE:</span> 创建数据库和表。</span><br><span class=\"line\"><span class=\"symbol\">DELETE:</span> 删除表中已有的记录。</span><br><span class=\"line\"><span class=\"symbol\">DROP:</span> 抛弃(删除)数据库和表。</span><br><span class=\"line\"><span class=\"symbol\">INDEX:</span> 创建或抛弃索引。</span><br><span class=\"line\"><span class=\"symbol\">INSERT:</span> 向表中插入新行。</span><br><span class=\"line\"><span class=\"symbol\">REFERENCE:</span> 未用。</span><br><span class=\"line\"><span class=\"symbol\">SELECT:</span> 检索表中的记录。</span><br><span class=\"line\"><span class=\"symbol\">UPDATE:</span> 修改现存表记录。</span><br><span class=\"line\"><span class=\"symbol\">FILE:</span> 读或写服务器上的文件。</span><br><span class=\"line\"><span class=\"symbol\">PROCESS:</span> 查看服务器中执行的线程信息或杀死线程。</span><br><span class=\"line\"><span class=\"symbol\">RELOAD:</span> 重载授权表或清空日志、主机缓存或表缓存。</span><br><span class=\"line\"><span class=\"symbol\">SHUTDOWN:</span> 关闭服务器。</span><br><span class=\"line\"><span class=\"symbol\">ALL:</span> 所有权限，ALL PRIVILEGES同义词。</span><br><span class=\"line\"><span class=\"symbol\">USAGE:</span> 特殊的 <span class=\"string\">\"无权限\"</span> 权限。</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>如何操作数据库的权限，下面我会根据不同的场景配合命令进行说明<br>","more":"</p>\n<h2 id=\"数据库的权限\"><a href=\"#数据库的权限\" class=\"headerlink\" title=\"数据库的权限\"></a>数据库的权限</h2><p>查找(SELECT)、 增加(INSERT)、修改(UPDATE)、删除(DELETE)</p>\n<h2 id=\"限制root登陆ip\"><a href=\"#限制root登陆ip\" class=\"headerlink\" title=\"限制root登陆ip\"></a>限制root登陆ip</h2><p>一般数据库创建的时候，root登陆的ip为localhost， 但是现在更多的是使用工具(至少我身边的人),所以我们需要先把root账号设置成我们公司或者家庭的固定ip。那么如何查看自己的ip地址？打开度娘然后输入ip，就可以了。<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">msyql -h localhost -u -p (回车输密码)</span><br><span class=\"line\">user mysql;</span><br><span class=\"line\"><span class=\"keyword\">grant</span> all <span class=\"keyword\">privileges</span> <span class=\"keyword\">on</span> *.* <span class=\"keyword\">to</span> <span class=\"string\">'root'</span>@<span class=\"string\">'ip'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">flush</span> <span class=\"keyword\">privileges</span>;</span><br></pre></td></tr></table></figure></p>\n<p>备注： 如果命令执行完成， 但你使用工具无法连接时，那么建议你查看一下服务器的3306端口是否开启，如果是阿里的，那么登陆阿里的控制台，在安全组内开通。<br>如果是自己的服务器，那么再后续的文章中我会讲解。</p>\n<h2 id=\"某个用户拥有对某个数据库的权限\"><a href=\"#某个用户拥有对某个数据库的权限\" class=\"headerlink\" title=\"某个用户拥有对某个数据库的权限\"></a>某个用户拥有对某个数据库的权限</h2><p>我们一般拥有很多的项目，那么就需要分配不同的用户去查找不同的数据库，那么这时候我们就需要以下命令:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">user</span> username@<span class=\"string\">'ip'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>;</span><br><span class=\"line\"><span class=\"keyword\">grant</span> all <span class=\"keyword\">privileges</span> <span class=\"keyword\">on</span> db.* <span class=\"keyword\">to</span> <span class=\"string\">'username'</span>@<span class=\"string\">'%'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">grant</span> <span class=\"keyword\">create</span> <span class=\"keyword\">on</span> db.* <span class=\"keyword\">to</span> <span class=\"string\">'username'</span>@<span class=\"string\">'%'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">grant</span> <span class=\"keyword\">alter</span> <span class=\"keyword\">on</span> db.* <span class=\"keyword\">to</span> <span class=\"string\">'username'</span>@<span class=\"string\">'%'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">grant</span> <span class=\"keyword\">drop</span> <span class=\"keyword\">on</span> db.* <span class=\"keyword\">to</span> <span class=\"string\">'username'</span>@<span class=\"string\">'%'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">flush</span> <span class=\"keyword\">privileges</span>;</span><br></pre></td></tr></table></figure></p>\n<p>备注：all可以更换为：查找(SELECT)、 增加(INSERT)、修改(UPDATE)、删除(DELETE)</p>\n<h2 id=\"修改某个用户的权限\"><a href=\"#修改某个用户的权限\" class=\"headerlink\" title=\"修改某个用户的权限\"></a>修改某个用户的权限</h2><p>比如你的一个同事，刚入职的时候，你给他的是某个数据库的SELECT权限，但是工作时间久了或者是因为特定原因，现在需要讲他的权限改为全部，那么你需要下面的命令<br><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">evoke</span> all privileges <span class=\"literal\">on</span> <span class=\"regexp\">db.*</span> from <span class=\"string\">'username'</span>@<span class=\"string\">'ip'</span>;</span><br><span class=\"line\"><span class=\"attribute\">grant</span> all privileges <span class=\"literal\">on</span> <span class=\"regexp\">db.*</span> to <span class=\"string\">'username'</span>@<span class=\"string\">'%'</span> identified by <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"attribute\">flush</span> privileges;</span><br></pre></td></tr></table></figure></p>\n<p>备注：最好不要删除用户，因为你删除了用户，但却没有删除用户的权限，所以以后再添加一个用户的时候，可能会出现问题</p>\n<h2 id=\"删除一个用户及他的权限\"><a href=\"#删除一个用户及他的权限\" class=\"headerlink\" title=\"删除一个用户及他的权限\"></a>删除一个用户及他的权限</h2><p>如果你公司的某个员工离职了，那么你需要把他的权限给删除掉，当然一般都是设定了ip，不会发生这种情况<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> mysql.user  <span class=\"keyword\">where</span> <span class=\"keyword\">user</span> = <span class=\"string\">\"username\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">revoke</span> <span class=\"keyword\">insert</span>,<span class=\"keyword\">update</span>,<span class=\"keyword\">delete</span>,<span class=\"keyword\">select</span> <span class=\"keyword\">on</span> *.* <span class=\"keyword\">from</span> <span class=\"string\">'db'</span>@<span class=\"string\">'ip'</span> <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> <span class=\"string\">'password'</span>; </span><br><span class=\"line\"><span class=\"keyword\">flush</span> <span class=\"keyword\">privileges</span>;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"给用户lock\"><a href=\"#给用户lock\" class=\"headerlink\" title=\"给用户lock\"></a>给用户lock</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">user</span> <span class=\"string\">'username'</span>@<span class=\"string\">'ip'</span> <span class=\"keyword\">account</span> <span class=\"keyword\">lock</span>; 增加<span class=\"keyword\">lock</span></span><br><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">user</span> <span class=\"string\">'username'</span>@<span class=\"string\">'ip'</span> <span class=\"keyword\">account</span> <span class=\"keyword\">unlock</span>; 删除<span class=\"keyword\">lock</span></span><br></pre></td></tr></table></figure>\n<p>当客户端使用lock状态的用户登录MySQL时，会收到如此报错 Access denied for user ‘username‘@’ip’</p>\n<h2 id=\"查看用户的权限\"><a href=\"#查看用户的权限\" class=\"headerlink\" title=\"查看用户的权限\"></a>查看用户的权限</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">grants</span> <span class=\"keyword\">for</span> username;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Grant的语法及权限列表\"><a href=\"#Grant的语法及权限列表\" class=\"headerlink\" title=\"Grant的语法及权限列表\"></a>Grant的语法及权限列表</h2><pre><code>1、 语法\n</code></pre><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">privileges</span> (<span class=\"keyword\">columns</span>) <span class=\"keyword\">ON</span> db.tables <span class=\"keyword\">TO</span> <span class=\"keyword\">user</span> <span class=\"keyword\">IDENTIFIED</span> <span class=\"keyword\">BY</span> <span class=\"string\">\"password\"</span> <span class=\"keyword\">WITH</span> <span class=\"keyword\">GRANT</span> <span class=\"keyword\">OPTION</span>;</span><br></pre></td></tr></table></figure>\n<pre><code>2、 权限列表\n</code></pre><figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">ALTER:</span> 修改表和索引。</span><br><span class=\"line\"><span class=\"symbol\">CREATE:</span> 创建数据库和表。</span><br><span class=\"line\"><span class=\"symbol\">DELETE:</span> 删除表中已有的记录。</span><br><span class=\"line\"><span class=\"symbol\">DROP:</span> 抛弃(删除)数据库和表。</span><br><span class=\"line\"><span class=\"symbol\">INDEX:</span> 创建或抛弃索引。</span><br><span class=\"line\"><span class=\"symbol\">INSERT:</span> 向表中插入新行。</span><br><span class=\"line\"><span class=\"symbol\">REFERENCE:</span> 未用。</span><br><span class=\"line\"><span class=\"symbol\">SELECT:</span> 检索表中的记录。</span><br><span class=\"line\"><span class=\"symbol\">UPDATE:</span> 修改现存表记录。</span><br><span class=\"line\"><span class=\"symbol\">FILE:</span> 读或写服务器上的文件。</span><br><span class=\"line\"><span class=\"symbol\">PROCESS:</span> 查看服务器中执行的线程信息或杀死线程。</span><br><span class=\"line\"><span class=\"symbol\">RELOAD:</span> 重载授权表或清空日志、主机缓存或表缓存。</span><br><span class=\"line\"><span class=\"symbol\">SHUTDOWN:</span> 关闭服务器。</span><br><span class=\"line\"><span class=\"symbol\">ALL:</span> 所有权限，ALL PRIVILEGES同义词。</span><br><span class=\"line\"><span class=\"symbol\">USAGE:</span> 特殊的 <span class=\"string\">\"无权限\"</span> 权限。</span><br></pre></td></tr></table></figure>"},{"title":"PHP中的魔术方法","date":"2017-07-31T18:25:00.000Z","_content":"\nPHP中魔术方法一共有十六中魔术方法\n\n<!-- more -->\n\n##\t魔术方法列表\n```\n\t__construct()，类的构造函数\n\t__destruct()，类的析构函数\n\t__call()，在对象中调用一个不可访问方法时调用\n\t__callStatic()，用静态方式中调用一个不可访问方法时调用\n\t__get()，获得一个类的成员变量时调用\n\t__set()，设置一个类的成员变量时调用\n\t__isset()，当对不可访问属性调用isset()或empty()时调用\n\t__unset()，当对不可访问属性调用unset()时被调用。\n\t__sleep()，执行serialize()时，先会调用这个函数\n\t__wakeup()，执行unserialize()时，先会调用这个函数\n\t__toString()，类被当成字符串时的回应方法\n\t__invoke()，调用函数的方式调用一个对象时的回应方法\n\t__set_state()，调用var_export()导出类时，此静态方法会被调用。\n\t__clone()，当对象复制完成时调用\n\t__autoload()，尝试加载未定义的类\n\t__debugInfo()，打印所需调试信息\n```\n## \t构造函数\n在同一个类中只能声明一个构造方法，原因是，PHP不支持构造函数重载。\n```\n\tclass Db\n\t{\n\t\tpublic $name;    \n\t    public $age;    \n\t    public $sex;\n\n\t\t/**\n\t    * 显示声明一个构造方法且带参数\n\t    */                                           \n\t    public function __construct($name=\"\", $sex=\"男\", $age=22)\n\t    {   \n\t      $this->name = $name;\n\t      $this->sex = $sex;\n\t      $this->age = $age;\n\t    }\n\t     \n\t    /**\n\t    * say 方法\n\t    */\n\t    public function say()\n\t    { \n\t      echo \"我叫：\" . $this->name . \"，性别：\" . $this->sex . \"，年龄：\" . $this->age;\n\t    }  \n\n\t}\n```\n## \t析构函数\n析构方法允许在销毁一个类之前执行的一些操作或完成一些功能，比如说关闭文件、释放结果集等。\n```\n\tfunction  __destruct()\n\t{\n\t\t//方法体\n\t}\n```\n## \t__call(),在对象中调用一个不可访问方法时调用。\n为了避免当调用的方法不存在时产生错误，而意外的导致程序中止，可以使用 __call() 方法来避免。\n该方法在调用的方法不存在时会自动调用，程序仍会继续执行下去。\n```\n\t<?php\n\tclass Person\n\t{               \n\t  function say()\n\t  { \n\t                \n\t      echo \"Hello, world!<br>\"; \n\t  }   \n\t     \n\t  /**\n\t   * 声明此方法用来处理调用对象中不存在的方法\n\t   */\n\t  function __call($funName, $arguments)\n\t  { \n\t     echo \"你所调用的函数：\" . $funName . \"(参数：\" ; // 输出调用不存在的方法名\n\t     print_r($arguments); // 输出调用不存在的方法时的参数列表\n\t     echo \")不存在！<br>\\n\"; // 结束换行           \n\t  }                     \n\t}\n\t$Person = new Person();      \n\t$Person->run(\"teacher\"); // 调用对象中不存在的方法，则自动调用了对象中的__call()方法\n\t$Person->eat(\"小明\", \"苹果\");       \n\t$Person->say();\n```\n运行结果:\n\n调用的函数：run(参数：Array ( [0] => teacher ) )不存在！\n调用的函数：eat(参数：Array ( [0] => 小明 [1] => 苹果 ) )不存在！\nHello, world!\n\n## \t__callStatic(),用静态方式中调用一个不可访问方法时调用\n此方法与上面所说的 __call() 功能除了 __callStatic() 是未静态方法准备的之外，其它都是一样的\n```\n\t<?php\n\tclass Person\n\t{\n\t  function say()\n\t  {\n\t \n\t    echo \"Hello, world!<br>\";\n\t  }\n\t \n\t  /**\n\t   * 声明此方法用来处理调用对象中不存在的方法\n\t   */\n\t  public static function __callStatic($funName, $arguments)\n\t  {\n\t    echo \"你所调用的静态方法：\" . $funName . \"(参数：\" ; // 输出调用不存在的方法名\n\t    print_r($arguments); // 输出调用不存在的方法时的参数列表\n\t    echo \")不存在！<br>\\n\"; // 结束换行\n\t  }\n\t}\n\t$Person = new Person();\n\t$Person::run(\"teacher\"); // 调用对象中不存在的方法，则自动调用了对象中的__call()方法\n\t$Person::eat(\"小明\", \"苹果\");\n\t$Person->say();\n```\n运行结果如下：\n\n调用的静态方法：run(参数：Array ( [0] => teacher ) )不存在！\n调用的静态方法：eat(参数：Array ( [0] => 小明 [1] => 苹果 ) )不存在！\nHello, world!\n## \t__get(),获得一个类的成员变量时调用\n在 php 面向对象编程中，类的成员属性被设定为 private 后，如果我们试图在外面调用它则会出现“不能访问某个私有属性”的错误。那么为了解决这个问题，我们可以使用魔术方法 __get()。\n```\n\t<?php\n\tclass Person\n\t{\n\t  private $name;\n\t  private $age;\n\t \n\t  function __construct($name=\"\", $age=1)\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t  }\n\t \n\t  /**\n\t   * 在类中添加__get()方法，在直接获取属性值时自动调用一次，以属性名作为参数传入并处理\n\t   * @param $propertyName\n\t   *\n\t   * @return int\n\t   */\n\t  public function __get($propertyName)\n\t  {  \n\t    if ($propertyName == \"age\") {\n\t      if ($this->age > 30) {\n\t        return $this->age - 10;\n\t      } else {\n\t        return $this->$propertyName;\n\t      }\n\t    } else {\n\t      return $this->$propertyName;\n\t    }\n\t  }\n\t}\n\t$Person = new Person(\"小明\", 60);  // 通过Person类实例化的对象，并通过构造方法为属性赋初值\n\techo \"姓名：\" . $Person->name . \"<br>\";  // 直接访问私有属性name，自动调用了__get()方法可以间接获取\n\techo \"年龄：\" . $Person->age . \"<br>\";  // 自动调用了__get()方法，根据对象本身的情况会返回不同的值\n```\n运行结果：\n\n姓名：小明\n年龄：50\n##\t__set()，设置一个类的成员变量时调用\n用来设置私有属性， 给一个未定义的属性赋值时，此方法会被触发，传递的参数是被设置的属性名和值。\n```\n\t<?php\n\tclass Person\n\t{\n\t  private $name;\n\t  private $age;\n\t \n\t  public function __construct($name=\"\", $age=25)\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t  }\n\t \n\t  /**\n\t   * 声明魔术方法需要两个参数，真接为私有属性赋值时自动调用，并可以屏蔽一些非法赋值\n\t   * @param $property\n\t   * @param $value\n\t   */\n\t  public function __set($property, $value) {\n\t    if ($property==\"age\")\n\t    {\n\t      if ($value > 150 || $value < 0) {\n\t        return;\n\t      }\n\t    }\n\t    $this->$property = $value;\n\t  }\n\t \n\t  /**\n\t   * 在类中声明说话的方法，将所有的私有属性说出\n\t   */\n\t  public function say(){\n\t    echo \"我叫\".$this->name.\"，今年\".$this->age.\"岁了\";\n\t  }\n\t}\n\t \n\t$Person=new Person(\"小明\", 25); //注意，初始值将被下面所改变\n\t//自动调用了__set()函数，将属性名name传给第一个参数，将属性值”李四”传给第二个参数\n\t$Person->name = \"小红\";   //赋值成功。如果没有__set()，则出错。\n\t//自动调用了__set()函数，将属性名age传给第一个参数，将属性值26传给第二个参数\n\t$Person->age = 16; //赋值成功\n\t$Person->age = 160; //160是一个非法值，赋值失效\n\t$Person->say(); //输出：我叫小红，今年16岁了\n```\n运行结果：\n\n我叫小红，今年16岁了\n##\t__isset(),当对不可访问属性调用isset()或empty()时调用\n当对不可访问属性调用 isset() 或 empty() 时，__isset() 会被调用。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  private $name;\n\t  private $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  /**\n\t   * @param $content\n\t   *\n\t   * @return bool\n\t   */\n\t  public function __isset($content) {\n\t    echo \"当在类外部使用isset()函数测定私有成员{$content}时，自动调用<br>\";\n\t    echo isset($this->$content);\n\t  }\n\t}\n\t \n\t$person = new Person(\"小明\", 25); // 初始赋值\n\techo isset($person->sex),\"<br>\";\n\techo isset($person->name),\"<br>\";\n\techo isset($person->age),\"<br>\";\n```\n运行结果如下：\n\n当在类外部使用isset()函数测定私有成员name时，自动调用 // __isset() 内 第一个echo\n当在类外部使用isset()函数测定私有成员age时，自动调用 // __isset() 内 第一个echo\n##\t__unset(),当对不可访问属性调用unset()时被调用。\n1、如果一个对象里面的成员属性是公有的，就可以使用这个函数在对象外面删除对象的公有属性。\n2、如果对象的成员属性是私有的，我使用这个函数就没有权限去删除。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  private $name;\n\t  private $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  /**\n\t   * @param $content\n\t   *\n\t   * @return bool\n\t   */\n\t  public function __unset($content) {\n\t    echo \"当在类外部使用unset()函数来删除私有成员时自动调用的<br>\";\n\t    echo isset($this->$content);\n\t  }\n\t}\n\t \n\t$person = new Person(\"小明\", 25); // 初始赋值\n\tunset($person->sex);\n\tunset($person->name);\n\tunset($person->age);\n```\n运行结果：\n\n当在类外部使用unset()函数来删除私有成员时自动调用的\n##\t __sleep()，执行serialize()时，先会调用这个函数\nerialize() 函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，则该方法会优先被调用，然后才执行序列化操作。\n此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。\n如果该方法未返回任何内容，则 NULL 被序列化，并产生一个 E_NOTICE 级别的错误。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  /**\n\t   * @return array\n\t   */\n\t  public function __sleep() {\n\t    echo \"当在类外部使用serialize()时会调用这里的__sleep()方法<br>\";\n\t    $this->name = base64_encode($this->name);\n\t    return array('name', 'age'); // 这里必须返回一个数值，里边的元素表示返回的属性名称\n\t  }\n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\techo serialize($person);\n\techo '<br/>';\n```\n代码运行结果：\n\n当在类外部使用serialize()时会调用这里的__sleep()方法\nO:6:\"Person\":2:{s:4:\"name\";s:8:\"5bCP5piO\";s:3:\"age\";i:25;}\n\n注：__sleep() 不能返回父类的私有成员的名字。这样做会产生一个 E_NOTICE 级别的错误。可以用 Serializable 接口来替代。\n\t\t__sleep() 方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。\n\n## \t__wakeup(),执行unserialize()时，先会调用这个函数\n\nunserialize() 会检查是否存在一个 __wakeup()方法。如果存在，则会先调用 __wakeup方法，预先准备对象需要的资源。\n__wakeup() 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  /**\n\t   * @return array\n\t   */\n\t  public function __sleep() {\n\t    echo \"当在类外部使用serialize()时会调用这里的__sleep()方法<br>\";\n\t    $this->name = base64_encode($this->name);\n\t    return array('name', 'age'); // 这里必须返回一个数值，里边的元素表示返回的属性名称\n\t  }\n\t \n\t  /**\n\t   * __wakeup\n\t   */\n\t  public function __wakeup() {\n\t    echo \"当在类外部使用unserialize()时会调用这里的__wakeup()方法<br>\";\n\t    $this->name = 2;\n\t    $this->sex = '男';\n\t    // 这里不需要返回数组\n\t  }\n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\tvar_dump(serialize($person));\n\tvar_dump(unserialize(serialize($person)));\n```\n运行结果：\n\n当在类外部使用serialize()时会调用这里的__sleep()方法\nstring(58) \"O:6:\"Person\":2:{s:4:\"name\";s:8:\"5bCP5piO\";s:3:\"age\";i:25;}\" 当在类外部使用serialize()时会调用这里的__sleep()方法\n当在类外部使用unserialize()时会调用这里的__wakeup()方法\nobject(Person)#2 (3) { [\"sex\"]=> string(3) \"男\" [\"name\"]=> int(2) [\"age\"]=> int(25) }\n\n##\t__toString()，类被当成字符串时的回应方法\n__toString() 方法用于一个类被当成字符串时应怎样回应。例如 `echo $obj;` 应该显示些什么。\n此方法必须返回一个字符串，否则将发出一条 `E_RECOVERABLE_ERROR` 级别的致命错误。\n不能在 __toString() 方法中抛出异常。这么做会导致致命错误。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  public function __toString()\n\t  {\n\t    return 'go go go';\n\t  }\n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\techo $person;\n```\n结果：\n\ngo go go\n\n## \t__invoke()，调用函数的方式调用一个对象时的回应方法\n当尝试以调用函数的方式调用一个对象时，__invoke() 方法会被自动调用。\n\n注意：本特性只在 PHP 5.3.0 及以上版本有效。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  public function __invoke() {\n\t    echo '这可是一个对象哦';\n\t  }\n\t \n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\t$person();\n```\n查看运行结果：\n\n这可是一个对象哦\n当然，如果你执意要将对象当函数方法使用，那么会得到下面结果：\nFatal error: index.php on line 18\n\n##\t__set_state()，调用var_export()导出类时，此静态方法会被调用。\n自 PHP 5.1.0 起，当调用 var_export() 导出类时，此静态方法会被自动调用。\n```\n<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\tvar_export($person);\n```\n看结果：\n\nPerson::__set_state(array( 'sex' => '男', 'name' => '小明', 'age' => 25, ))\n\n##\t __clone()，当对象复制完成时调用\n对象复制可以通过 clone 关键字来完成（如果可能，这将调用对象的 __clone() 方法）。对象中的 __clone() 方法不能被直接调用。\n\n注意：\n\n当对象被复制后，PHP 5 会对对象的所有属性执行一个浅复制（shallow copy）。所有的引用属性 仍然会是一个指向原来的变量的引用。\n当复制完成时，如果定义了 __clone() 方法，则新创建的对象（复制生成的对象）中的 __clone() 方法会被调用，可用于修改属性的值（如果有必要的话）。\n\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  public function __clone()\n\t  {\n\t    echo __METHOD__.\"你正在克隆对象<br>\";\n\t  }\n\t \n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\t$person2 = clone $person;\n\t \n\tvar_dump('persion1:');\n\tvar_dump($person);\n\techo '<br>';\n\tvar_dump('persion2:');\n\tvar_dump($person2);\n```\n看结果：\n\nPerson::__clone你正在克隆对象\nstring(9) \"persion1:\" object(Person)#1 (3) { [\"sex\"]=> string(3) \"男\" [\"name\"]=> string(6) \"小明\" [\"age\"]=> int(25) } \nstring(9) \"persion2:\" object(Person)#2 (3) { [\"sex\"]=> string(3) \"男\" [\"name\"]=> string(6) \"小明\" [\"age\"]=> int(25) }\n克隆成功。\n\n##\t__autoload()，尝试加载未定义的类\n这里没有代码\nPHP有很多成熟的框架，例如：ThinkPHP、Laravel、Yii、Ci等， 但底层都是MVC， 那么MVC是如何运行的？\nMVC的运行，离不开PSR_0, PSR_4以及autoload(类的自动加载), 感兴趣的同学可以google或者其他的方式去了解的\n\n##\t__debugInfo()，打印所需调试信息\n该方法在PHP 5.6.0及其以上版本才可以用，如果你发现使用无效或者报错，请查看啊你的版本\n```\n\t<?php\n\tclass C {\n\t  private $prop;\n\t \n\t  public function __construct($val) {\n\t    $this->prop = $val;\n\t  }\n\t \n\t  /**\n\t   * @return array\n\t   */\n\t  public function __debugInfo() {\n\t    return [\n\t      'propSquared' => $this->prop ** 2,\n\t    ];\n\t  }\n\t}\n\t \n\tvar_dump(new C(42));\n```\n结果：\n\nobject(C)#1 (1) { [\"propSquared\"]=> int(1764) }\n\n\n\n\n","source":"_posts/PHP中的魔术方法.md","raw":"---\ntitle: PHP中的魔术方法\ndate: 2017-08-1 02:25:00\ntags: PHP\ncategories: PHP\n---\n\nPHP中魔术方法一共有十六中魔术方法\n\n<!-- more -->\n\n##\t魔术方法列表\n```\n\t__construct()，类的构造函数\n\t__destruct()，类的析构函数\n\t__call()，在对象中调用一个不可访问方法时调用\n\t__callStatic()，用静态方式中调用一个不可访问方法时调用\n\t__get()，获得一个类的成员变量时调用\n\t__set()，设置一个类的成员变量时调用\n\t__isset()，当对不可访问属性调用isset()或empty()时调用\n\t__unset()，当对不可访问属性调用unset()时被调用。\n\t__sleep()，执行serialize()时，先会调用这个函数\n\t__wakeup()，执行unserialize()时，先会调用这个函数\n\t__toString()，类被当成字符串时的回应方法\n\t__invoke()，调用函数的方式调用一个对象时的回应方法\n\t__set_state()，调用var_export()导出类时，此静态方法会被调用。\n\t__clone()，当对象复制完成时调用\n\t__autoload()，尝试加载未定义的类\n\t__debugInfo()，打印所需调试信息\n```\n## \t构造函数\n在同一个类中只能声明一个构造方法，原因是，PHP不支持构造函数重载。\n```\n\tclass Db\n\t{\n\t\tpublic $name;    \n\t    public $age;    \n\t    public $sex;\n\n\t\t/**\n\t    * 显示声明一个构造方法且带参数\n\t    */                                           \n\t    public function __construct($name=\"\", $sex=\"男\", $age=22)\n\t    {   \n\t      $this->name = $name;\n\t      $this->sex = $sex;\n\t      $this->age = $age;\n\t    }\n\t     \n\t    /**\n\t    * say 方法\n\t    */\n\t    public function say()\n\t    { \n\t      echo \"我叫：\" . $this->name . \"，性别：\" . $this->sex . \"，年龄：\" . $this->age;\n\t    }  \n\n\t}\n```\n## \t析构函数\n析构方法允许在销毁一个类之前执行的一些操作或完成一些功能，比如说关闭文件、释放结果集等。\n```\n\tfunction  __destruct()\n\t{\n\t\t//方法体\n\t}\n```\n## \t__call(),在对象中调用一个不可访问方法时调用。\n为了避免当调用的方法不存在时产生错误，而意外的导致程序中止，可以使用 __call() 方法来避免。\n该方法在调用的方法不存在时会自动调用，程序仍会继续执行下去。\n```\n\t<?php\n\tclass Person\n\t{               \n\t  function say()\n\t  { \n\t                \n\t      echo \"Hello, world!<br>\"; \n\t  }   \n\t     \n\t  /**\n\t   * 声明此方法用来处理调用对象中不存在的方法\n\t   */\n\t  function __call($funName, $arguments)\n\t  { \n\t     echo \"你所调用的函数：\" . $funName . \"(参数：\" ; // 输出调用不存在的方法名\n\t     print_r($arguments); // 输出调用不存在的方法时的参数列表\n\t     echo \")不存在！<br>\\n\"; // 结束换行           \n\t  }                     \n\t}\n\t$Person = new Person();      \n\t$Person->run(\"teacher\"); // 调用对象中不存在的方法，则自动调用了对象中的__call()方法\n\t$Person->eat(\"小明\", \"苹果\");       \n\t$Person->say();\n```\n运行结果:\n\n调用的函数：run(参数：Array ( [0] => teacher ) )不存在！\n调用的函数：eat(参数：Array ( [0] => 小明 [1] => 苹果 ) )不存在！\nHello, world!\n\n## \t__callStatic(),用静态方式中调用一个不可访问方法时调用\n此方法与上面所说的 __call() 功能除了 __callStatic() 是未静态方法准备的之外，其它都是一样的\n```\n\t<?php\n\tclass Person\n\t{\n\t  function say()\n\t  {\n\t \n\t    echo \"Hello, world!<br>\";\n\t  }\n\t \n\t  /**\n\t   * 声明此方法用来处理调用对象中不存在的方法\n\t   */\n\t  public static function __callStatic($funName, $arguments)\n\t  {\n\t    echo \"你所调用的静态方法：\" . $funName . \"(参数：\" ; // 输出调用不存在的方法名\n\t    print_r($arguments); // 输出调用不存在的方法时的参数列表\n\t    echo \")不存在！<br>\\n\"; // 结束换行\n\t  }\n\t}\n\t$Person = new Person();\n\t$Person::run(\"teacher\"); // 调用对象中不存在的方法，则自动调用了对象中的__call()方法\n\t$Person::eat(\"小明\", \"苹果\");\n\t$Person->say();\n```\n运行结果如下：\n\n调用的静态方法：run(参数：Array ( [0] => teacher ) )不存在！\n调用的静态方法：eat(参数：Array ( [0] => 小明 [1] => 苹果 ) )不存在！\nHello, world!\n## \t__get(),获得一个类的成员变量时调用\n在 php 面向对象编程中，类的成员属性被设定为 private 后，如果我们试图在外面调用它则会出现“不能访问某个私有属性”的错误。那么为了解决这个问题，我们可以使用魔术方法 __get()。\n```\n\t<?php\n\tclass Person\n\t{\n\t  private $name;\n\t  private $age;\n\t \n\t  function __construct($name=\"\", $age=1)\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t  }\n\t \n\t  /**\n\t   * 在类中添加__get()方法，在直接获取属性值时自动调用一次，以属性名作为参数传入并处理\n\t   * @param $propertyName\n\t   *\n\t   * @return int\n\t   */\n\t  public function __get($propertyName)\n\t  {  \n\t    if ($propertyName == \"age\") {\n\t      if ($this->age > 30) {\n\t        return $this->age - 10;\n\t      } else {\n\t        return $this->$propertyName;\n\t      }\n\t    } else {\n\t      return $this->$propertyName;\n\t    }\n\t  }\n\t}\n\t$Person = new Person(\"小明\", 60);  // 通过Person类实例化的对象，并通过构造方法为属性赋初值\n\techo \"姓名：\" . $Person->name . \"<br>\";  // 直接访问私有属性name，自动调用了__get()方法可以间接获取\n\techo \"年龄：\" . $Person->age . \"<br>\";  // 自动调用了__get()方法，根据对象本身的情况会返回不同的值\n```\n运行结果：\n\n姓名：小明\n年龄：50\n##\t__set()，设置一个类的成员变量时调用\n用来设置私有属性， 给一个未定义的属性赋值时，此方法会被触发，传递的参数是被设置的属性名和值。\n```\n\t<?php\n\tclass Person\n\t{\n\t  private $name;\n\t  private $age;\n\t \n\t  public function __construct($name=\"\", $age=25)\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t  }\n\t \n\t  /**\n\t   * 声明魔术方法需要两个参数，真接为私有属性赋值时自动调用，并可以屏蔽一些非法赋值\n\t   * @param $property\n\t   * @param $value\n\t   */\n\t  public function __set($property, $value) {\n\t    if ($property==\"age\")\n\t    {\n\t      if ($value > 150 || $value < 0) {\n\t        return;\n\t      }\n\t    }\n\t    $this->$property = $value;\n\t  }\n\t \n\t  /**\n\t   * 在类中声明说话的方法，将所有的私有属性说出\n\t   */\n\t  public function say(){\n\t    echo \"我叫\".$this->name.\"，今年\".$this->age.\"岁了\";\n\t  }\n\t}\n\t \n\t$Person=new Person(\"小明\", 25); //注意，初始值将被下面所改变\n\t//自动调用了__set()函数，将属性名name传给第一个参数，将属性值”李四”传给第二个参数\n\t$Person->name = \"小红\";   //赋值成功。如果没有__set()，则出错。\n\t//自动调用了__set()函数，将属性名age传给第一个参数，将属性值26传给第二个参数\n\t$Person->age = 16; //赋值成功\n\t$Person->age = 160; //160是一个非法值，赋值失效\n\t$Person->say(); //输出：我叫小红，今年16岁了\n```\n运行结果：\n\n我叫小红，今年16岁了\n##\t__isset(),当对不可访问属性调用isset()或empty()时调用\n当对不可访问属性调用 isset() 或 empty() 时，__isset() 会被调用。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  private $name;\n\t  private $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  /**\n\t   * @param $content\n\t   *\n\t   * @return bool\n\t   */\n\t  public function __isset($content) {\n\t    echo \"当在类外部使用isset()函数测定私有成员{$content}时，自动调用<br>\";\n\t    echo isset($this->$content);\n\t  }\n\t}\n\t \n\t$person = new Person(\"小明\", 25); // 初始赋值\n\techo isset($person->sex),\"<br>\";\n\techo isset($person->name),\"<br>\";\n\techo isset($person->age),\"<br>\";\n```\n运行结果如下：\n\n当在类外部使用isset()函数测定私有成员name时，自动调用 // __isset() 内 第一个echo\n当在类外部使用isset()函数测定私有成员age时，自动调用 // __isset() 内 第一个echo\n##\t__unset(),当对不可访问属性调用unset()时被调用。\n1、如果一个对象里面的成员属性是公有的，就可以使用这个函数在对象外面删除对象的公有属性。\n2、如果对象的成员属性是私有的，我使用这个函数就没有权限去删除。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  private $name;\n\t  private $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  /**\n\t   * @param $content\n\t   *\n\t   * @return bool\n\t   */\n\t  public function __unset($content) {\n\t    echo \"当在类外部使用unset()函数来删除私有成员时自动调用的<br>\";\n\t    echo isset($this->$content);\n\t  }\n\t}\n\t \n\t$person = new Person(\"小明\", 25); // 初始赋值\n\tunset($person->sex);\n\tunset($person->name);\n\tunset($person->age);\n```\n运行结果：\n\n当在类外部使用unset()函数来删除私有成员时自动调用的\n##\t __sleep()，执行serialize()时，先会调用这个函数\nerialize() 函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，则该方法会优先被调用，然后才执行序列化操作。\n此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。\n如果该方法未返回任何内容，则 NULL 被序列化，并产生一个 E_NOTICE 级别的错误。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  /**\n\t   * @return array\n\t   */\n\t  public function __sleep() {\n\t    echo \"当在类外部使用serialize()时会调用这里的__sleep()方法<br>\";\n\t    $this->name = base64_encode($this->name);\n\t    return array('name', 'age'); // 这里必须返回一个数值，里边的元素表示返回的属性名称\n\t  }\n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\techo serialize($person);\n\techo '<br/>';\n```\n代码运行结果：\n\n当在类外部使用serialize()时会调用这里的__sleep()方法\nO:6:\"Person\":2:{s:4:\"name\";s:8:\"5bCP5piO\";s:3:\"age\";i:25;}\n\n注：__sleep() 不能返回父类的私有成员的名字。这样做会产生一个 E_NOTICE 级别的错误。可以用 Serializable 接口来替代。\n\t\t__sleep() 方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。\n\n## \t__wakeup(),执行unserialize()时，先会调用这个函数\n\nunserialize() 会检查是否存在一个 __wakeup()方法。如果存在，则会先调用 __wakeup方法，预先准备对象需要的资源。\n__wakeup() 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  /**\n\t   * @return array\n\t   */\n\t  public function __sleep() {\n\t    echo \"当在类外部使用serialize()时会调用这里的__sleep()方法<br>\";\n\t    $this->name = base64_encode($this->name);\n\t    return array('name', 'age'); // 这里必须返回一个数值，里边的元素表示返回的属性名称\n\t  }\n\t \n\t  /**\n\t   * __wakeup\n\t   */\n\t  public function __wakeup() {\n\t    echo \"当在类外部使用unserialize()时会调用这里的__wakeup()方法<br>\";\n\t    $this->name = 2;\n\t    $this->sex = '男';\n\t    // 这里不需要返回数组\n\t  }\n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\tvar_dump(serialize($person));\n\tvar_dump(unserialize(serialize($person)));\n```\n运行结果：\n\n当在类外部使用serialize()时会调用这里的__sleep()方法\nstring(58) \"O:6:\"Person\":2:{s:4:\"name\";s:8:\"5bCP5piO\";s:3:\"age\";i:25;}\" 当在类外部使用serialize()时会调用这里的__sleep()方法\n当在类外部使用unserialize()时会调用这里的__wakeup()方法\nobject(Person)#2 (3) { [\"sex\"]=> string(3) \"男\" [\"name\"]=> int(2) [\"age\"]=> int(25) }\n\n##\t__toString()，类被当成字符串时的回应方法\n__toString() 方法用于一个类被当成字符串时应怎样回应。例如 `echo $obj;` 应该显示些什么。\n此方法必须返回一个字符串，否则将发出一条 `E_RECOVERABLE_ERROR` 级别的致命错误。\n不能在 __toString() 方法中抛出异常。这么做会导致致命错误。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  public function __toString()\n\t  {\n\t    return 'go go go';\n\t  }\n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\techo $person;\n```\n结果：\n\ngo go go\n\n## \t__invoke()，调用函数的方式调用一个对象时的回应方法\n当尝试以调用函数的方式调用一个对象时，__invoke() 方法会被自动调用。\n\n注意：本特性只在 PHP 5.3.0 及以上版本有效。\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  public function __invoke() {\n\t    echo '这可是一个对象哦';\n\t  }\n\t \n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\t$person();\n```\n查看运行结果：\n\n这可是一个对象哦\n当然，如果你执意要将对象当函数方法使用，那么会得到下面结果：\nFatal error: index.php on line 18\n\n##\t__set_state()，调用var_export()导出类时，此静态方法会被调用。\n自 PHP 5.1.0 起，当调用 var_export() 导出类时，此静态方法会被自动调用。\n```\n<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\tvar_export($person);\n```\n看结果：\n\nPerson::__set_state(array( 'sex' => '男', 'name' => '小明', 'age' => 25, ))\n\n##\t __clone()，当对象复制完成时调用\n对象复制可以通过 clone 关键字来完成（如果可能，这将调用对象的 __clone() 方法）。对象中的 __clone() 方法不能被直接调用。\n\n注意：\n\n当对象被复制后，PHP 5 会对对象的所有属性执行一个浅复制（shallow copy）。所有的引用属性 仍然会是一个指向原来的变量的引用。\n当复制完成时，如果定义了 __clone() 方法，则新创建的对象（复制生成的对象）中的 __clone() 方法会被调用，可用于修改属性的值（如果有必要的话）。\n\n```\n\t<?php\n\tclass Person\n\t{\n\t  public $sex;\n\t  public $name;\n\t  public $age;\n\t \n\t  public function __construct($name=\"\", $age=25, $sex='男')\n\t  {\n\t    $this->name = $name;\n\t    $this->age = $age;\n\t    $this->sex = $sex;\n\t  }\n\t \n\t  public function __clone()\n\t  {\n\t    echo __METHOD__.\"你正在克隆对象<br>\";\n\t  }\n\t \n\t}\n\t \n\t$person = new Person('小明'); // 初始赋值\n\t$person2 = clone $person;\n\t \n\tvar_dump('persion1:');\n\tvar_dump($person);\n\techo '<br>';\n\tvar_dump('persion2:');\n\tvar_dump($person2);\n```\n看结果：\n\nPerson::__clone你正在克隆对象\nstring(9) \"persion1:\" object(Person)#1 (3) { [\"sex\"]=> string(3) \"男\" [\"name\"]=> string(6) \"小明\" [\"age\"]=> int(25) } \nstring(9) \"persion2:\" object(Person)#2 (3) { [\"sex\"]=> string(3) \"男\" [\"name\"]=> string(6) \"小明\" [\"age\"]=> int(25) }\n克隆成功。\n\n##\t__autoload()，尝试加载未定义的类\n这里没有代码\nPHP有很多成熟的框架，例如：ThinkPHP、Laravel、Yii、Ci等， 但底层都是MVC， 那么MVC是如何运行的？\nMVC的运行，离不开PSR_0, PSR_4以及autoload(类的自动加载), 感兴趣的同学可以google或者其他的方式去了解的\n\n##\t__debugInfo()，打印所需调试信息\n该方法在PHP 5.6.0及其以上版本才可以用，如果你发现使用无效或者报错，请查看啊你的版本\n```\n\t<?php\n\tclass C {\n\t  private $prop;\n\t \n\t  public function __construct($val) {\n\t    $this->prop = $val;\n\t  }\n\t \n\t  /**\n\t   * @return array\n\t   */\n\t  public function __debugInfo() {\n\t    return [\n\t      'propSquared' => $this->prop ** 2,\n\t    ];\n\t  }\n\t}\n\t \n\tvar_dump(new C(42));\n```\n结果：\n\nobject(C)#1 (1) { [\"propSquared\"]=> int(1764) }\n\n\n\n\n","slug":"PHP中的魔术方法","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuwb000aydqni5sjcnsl","content":"<p>PHP中魔术方法一共有十六中魔术方法</p>\n<a id=\"more\"></a>\n<h2 id=\"魔术方法列表\"><a href=\"#魔术方法列表\" class=\"headerlink\" title=\"魔术方法列表\"></a>魔术方法列表</h2><figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">__construct</span>()，类的构造函数</span><br><span class=\"line\"><span class=\"selector-tag\">__destruct</span>()，类的析构函数</span><br><span class=\"line\"><span class=\"selector-tag\">__call</span>()，在对象中调用一个不可访问方法时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__callStatic</span>()，用静态方式中调用一个不可访问方法时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__get</span>()，获得一个类的成员变量时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__set</span>()，设置一个类的成员变量时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__isset</span>()，当对不可访问属性调用<span class=\"selector-tag\">isset</span>()或<span class=\"selector-tag\">empty</span>()时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__unset</span>()，当对不可访问属性调用<span class=\"selector-tag\">unset</span>()时被调用。</span><br><span class=\"line\"><span class=\"selector-tag\">__sleep</span>()，执行<span class=\"selector-tag\">serialize</span>()时，先会调用这个函数</span><br><span class=\"line\"><span class=\"selector-tag\">__wakeup</span>()，执行<span class=\"selector-tag\">unserialize</span>()时，先会调用这个函数</span><br><span class=\"line\"><span class=\"selector-tag\">__toString</span>()，类被当成字符串时的回应方法</span><br><span class=\"line\"><span class=\"selector-tag\">__invoke</span>()，调用函数的方式调用一个对象时的回应方法</span><br><span class=\"line\"><span class=\"selector-tag\">__set_state</span>()，调用<span class=\"selector-tag\">var_export</span>()导出类时，此静态方法会被调用。</span><br><span class=\"line\"><span class=\"selector-tag\">__clone</span>()，当对象复制完成时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__autoload</span>()，尝试加载未定义的类</span><br><span class=\"line\"><span class=\"selector-tag\">__debugInfo</span>()，打印所需调试信息</span><br></pre></td></tr></table></figure>\n<h2 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h2><p>在同一个类中只能声明一个构造方法，原因是，PHP不支持构造函数重载。<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Db</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $name;    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age;    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> $sex;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 显示声明一个构造方法且带参数</span></span><br><span class=\"line\"><span class=\"comment\">    */</span>                                           </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $sex=<span class=\"string\">\"男\"</span>, $age=<span class=\"number\">22</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;   </span><br><span class=\"line\">      <span class=\"keyword\">$this</span>-&gt;name = $name;</span><br><span class=\"line\">      <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span><br><span class=\"line\">      <span class=\"keyword\">$this</span>-&gt;age = $age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * say 方法</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123; </span><br><span class=\"line\">      <span class=\"keyword\">echo</span> <span class=\"string\">\"我叫：\"</span> . <span class=\"keyword\">$this</span>-&gt;name . <span class=\"string\">\"，性别：\"</span> . <span class=\"keyword\">$this</span>-&gt;sex . <span class=\"string\">\"，年龄：\"</span> . <span class=\"keyword\">$this</span>-&gt;age;</span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"析构函数\"><a href=\"#析构函数\" class=\"headerlink\" title=\"析构函数\"></a>析构函数</h2><p>析构方法允许在销毁一个类之前执行的一些操作或完成一些功能，比如说关闭文件、释放结果集等。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//方法体</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"call-在对象中调用一个不可访问方法时调用。\"><a href=\"#call-在对象中调用一个不可访问方法时调用。\" class=\"headerlink\" title=\"__call(),在对象中调用一个不可访问方法时调用。\"></a>__call(),在对象中调用一个不可访问方法时调用。</h2><p>为了避免当调用的方法不存在时产生错误，而意外的导致程序中止，可以使用 __call() 方法来避免。<br>该方法在调用的方法不存在时会自动调用，程序仍会继续执行下去。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;               </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123; </span></span><br><span class=\"line\"><span class=\"php\">                </span></span><br><span class=\"line\"><span class=\"php\">      <span class=\"keyword\">echo</span> <span class=\"string\">\"Hello, world!&lt;br&gt;\"</span>; </span></span><br><span class=\"line\"><span class=\"php\">  &#125;   </span></span><br><span class=\"line\"><span class=\"php\">     </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * 声明此方法用来处理调用对象中不存在的方法</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($funName, $arguments)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123; </span></span><br><span class=\"line\"><span class=\"php\">     <span class=\"keyword\">echo</span> <span class=\"string\">\"你所调用的函数：\"</span> . $funName . <span class=\"string\">\"(参数：\"</span> ; <span class=\"comment\">// 输出调用不存在的方法名</span></span></span><br><span class=\"line\"><span class=\"php\">     print_r($arguments); <span class=\"comment\">// 输出调用不存在的方法时的参数列表</span></span></span><br><span class=\"line\"><span class=\"php\">     <span class=\"keyword\">echo</span> <span class=\"string\">\")不存在！&lt;br&gt;\\n\"</span>; <span class=\"comment\">// 结束换行           </span></span></span><br><span class=\"line\"><span class=\"php\">  &#125;                     </span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$Person = <span class=\"keyword\">new</span> Person();      </span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;run(<span class=\"string\">\"teacher\"</span>); <span class=\"comment\">// 调用对象中不存在的方法，则自动调用了对象中的__call()方法</span></span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;eat(<span class=\"string\">\"小明\"</span>, <span class=\"string\">\"苹果\"</span>);       </span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;say();</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果:</p>\n<p>调用的函数：run(参数：Array ( [0] =&gt; teacher ) )不存在！<br>调用的函数：eat(参数：Array ( [0] =&gt; 小明 [1] =&gt; 苹果 ) )不存在！<br>Hello, world!</p>\n<h2 id=\"callStatic-用静态方式中调用一个不可访问方法时调用\"><a href=\"#callStatic-用静态方式中调用一个不可访问方法时调用\" class=\"headerlink\" title=\"__callStatic(),用静态方式中调用一个不可访问方法时调用\"></a>__callStatic(),用静态方式中调用一个不可访问方法时调用</h2><p>此方法与上面所说的 <strong>call() 功能除了 </strong>callStatic() 是未静态方法准备的之外，其它都是一样的<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"Hello, world!&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * 声明此方法用来处理调用对象中不存在的方法</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__callStatic</span><span class=\"params\">($funName, $arguments)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"你所调用的静态方法：\"</span> . $funName . <span class=\"string\">\"(参数：\"</span> ; <span class=\"comment\">// 输出调用不存在的方法名</span></span></span><br><span class=\"line\"><span class=\"php\">    print_r($arguments); <span class=\"comment\">// 输出调用不存在的方法时的参数列表</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\")不存在！&lt;br&gt;\\n\"</span>; <span class=\"comment\">// 结束换行</span></span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$Person = <span class=\"keyword\">new</span> Person();</span></span><br><span class=\"line\"><span class=\"php\">$Person::run(<span class=\"string\">\"teacher\"</span>); <span class=\"comment\">// 调用对象中不存在的方法，则自动调用了对象中的__call()方法</span></span></span><br><span class=\"line\"><span class=\"php\">$Person::eat(<span class=\"string\">\"小明\"</span>, <span class=\"string\">\"苹果\"</span>);</span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;say();</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果如下：</p>\n<p>调用的静态方法：run(参数：Array ( [0] =&gt; teacher ) )不存在！<br>调用的静态方法：eat(参数：Array ( [0] =&gt; 小明 [1] =&gt; 苹果 ) )不存在！<br>Hello, world!</p>\n<h2 id=\"get-获得一个类的成员变量时调用\"><a href=\"#get-获得一个类的成员变量时调用\" class=\"headerlink\" title=\"__get(),获得一个类的成员变量时调用\"></a>__get(),获得一个类的成员变量时调用</h2><p>在 php 面向对象编程中，类的成员属性被设定为 private 后，如果我们试图在外面调用它则会出现“不能访问某个私有属性”的错误。那么为了解决这个问题，我们可以使用魔术方法 __get()。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">1</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * 在类中添加__get()方法，在直接获取属性值时自动调用一次，以属性名作为参数传入并处理</span><br><span class=\"line\">   * @param $propertyName</span><br><span class=\"line\">   *</span><br><span class=\"line\">   * @return int</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($propertyName)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;  </span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">if</span> ($propertyName == <span class=\"string\">\"age\"</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;age &gt; <span class=\"number\">30</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;age - <span class=\"number\">10</span>;</span></span><br><span class=\"line\"><span class=\"php\">      &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$propertyName;</span></span><br><span class=\"line\"><span class=\"php\">      &#125;</span></span><br><span class=\"line\"><span class=\"php\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">      <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$propertyName;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$Person = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"小明\"</span>, <span class=\"number\">60</span>);  <span class=\"comment\">// 通过Person类实例化的对象，并通过构造方法为属性赋初值</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">\"姓名：\"</span> . $Person-&gt;name . <span class=\"string\">\"&lt;br&gt;\"</span>;  <span class=\"comment\">// 直接访问私有属性name，自动调用了__get()方法可以间接获取</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">\"年龄：\"</span> . $Person-&gt;age . <span class=\"string\">\"&lt;br&gt;\"</span>;  <span class=\"comment\">// 自动调用了__get()方法，根据对象本身的情况会返回不同的值</span></span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果：</p>\n<p>姓名：小明<br>年龄：50</p>\n<h2 id=\"set-，设置一个类的成员变量时调用\"><a href=\"#set-，设置一个类的成员变量时调用\" class=\"headerlink\" title=\"__set()，设置一个类的成员变量时调用\"></a>__set()，设置一个类的成员变量时调用</h2><p>用来设置私有属性， 给一个未定义的属性赋值时，此方法会被触发，传递的参数是被设置的属性名和值。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * 声明魔术方法需要两个参数，真接为私有属性赋值时自动调用，并可以屏蔽一些非法赋值</span><br><span class=\"line\">   * @param $property</span><br><span class=\"line\">   * @param $value</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__set</span><span class=\"params\">($property, $value)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">if</span> ($property==<span class=\"string\">\"age\"</span>)</span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">      <span class=\"keyword\">if</span> ($value &gt; <span class=\"number\">150</span> || $value &lt; <span class=\"number\">0</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span>;</span></span><br><span class=\"line\"><span class=\"php\">      &#125;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;$property = $value;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * 在类中声明说话的方法，将所有的私有属性说出</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"我叫\"</span>.<span class=\"keyword\">$this</span>-&gt;name.<span class=\"string\">\"，今年\"</span>.<span class=\"keyword\">$this</span>-&gt;age.<span class=\"string\">\"岁了\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$Person=<span class=\"keyword\">new</span> Person(<span class=\"string\">\"小明\"</span>, <span class=\"number\">25</span>); <span class=\"comment\">//注意，初始值将被下面所改变</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//自动调用了__set()函数，将属性名name传给第一个参数，将属性值”李四”传给第二个参数</span></span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;name = <span class=\"string\">\"小红\"</span>;   <span class=\"comment\">//赋值成功。如果没有__set()，则出错。</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//自动调用了__set()函数，将属性名age传给第一个参数，将属性值26传给第二个参数</span></span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;age = <span class=\"number\">16</span>; <span class=\"comment\">//赋值成功</span></span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;age = <span class=\"number\">160</span>; <span class=\"comment\">//160是一个非法值，赋值失效</span></span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;say(); <span class=\"comment\">//输出：我叫小红，今年16岁了</span></span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果：</p>\n<p>我叫小红，今年16岁了</p>\n<h2 id=\"isset-当对不可访问属性调用isset-或empty-时调用\"><a href=\"#isset-当对不可访问属性调用isset-或empty-时调用\" class=\"headerlink\" title=\"__isset(),当对不可访问属性调用isset()或empty()时调用\"></a>__isset(),当对不可访问属性调用isset()或empty()时调用</h2><p>当对不可访问属性调用 isset() 或 empty() 时，__isset() 会被调用。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * @param $content</span><br><span class=\"line\">   *</span><br><span class=\"line\">   * @return bool</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__isset</span><span class=\"params\">($content)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"当在类外部使用isset()函数测定私有成员&#123;$content&#125;时，自动调用&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;$content);</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"小明\"</span>, <span class=\"number\">25</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"keyword\">isset</span>($person-&gt;sex),<span class=\"string\">\"&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"keyword\">isset</span>($person-&gt;name),<span class=\"string\">\"&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"keyword\">isset</span>($person-&gt;age),<span class=\"string\">\"&lt;br&gt;\"</span>;</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果如下：</p>\n<p>当在类外部使用isset()函数测定私有成员name时，自动调用 // <strong>isset() 内 第一个echo<br>当在类外部使用isset()函数测定私有成员age时，自动调用 // </strong>isset() 内 第一个echo</p>\n<h2 id=\"unset-当对不可访问属性调用unset-时被调用。\"><a href=\"#unset-当对不可访问属性调用unset-时被调用。\" class=\"headerlink\" title=\"__unset(),当对不可访问属性调用unset()时被调用。\"></a>__unset(),当对不可访问属性调用unset()时被调用。</h2><p>1、如果一个对象里面的成员属性是公有的，就可以使用这个函数在对象外面删除对象的公有属性。<br>2、如果对象的成员属性是私有的，我使用这个函数就没有权限去删除。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * @param $content</span><br><span class=\"line\">   *</span><br><span class=\"line\">   * @return bool</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__unset</span><span class=\"params\">($content)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"当在类外部使用unset()函数来删除私有成员时自动调用的&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;$content);</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"小明\"</span>, <span class=\"number\">25</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">unset</span>($person-&gt;sex);</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">unset</span>($person-&gt;name);</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">unset</span>($person-&gt;age);</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果：</p>\n<p>当在类外部使用unset()函数来删除私有成员时自动调用的</p>\n<h2 id=\"sleep-，执行serialize-时，先会调用这个函数\"><a href=\"#sleep-，执行serialize-时，先会调用这个函数\" class=\"headerlink\" title=\"__sleep()，执行serialize()时，先会调用这个函数\"></a>__sleep()，执行serialize()时，先会调用这个函数</h2><p>erialize() 函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，则该方法会优先被调用，然后才执行序列化操作。<br>此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。<br>如果该方法未返回任何内容，则 NULL 被序列化，并产生一个 E_NOTICE 级别的错误。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * @return array</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__sleep</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"当在类外部使用serialize()时会调用这里的__sleep()方法&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = base64_encode(<span class=\"keyword\">$this</span>-&gt;name);</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">return</span> <span class=\"keyword\">array</span>(<span class=\"string\">'name'</span>, <span class=\"string\">'age'</span>); <span class=\"comment\">// 这里必须返回一个数值，里边的元素表示返回的属性名称</span></span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> serialize($person);</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">'&lt;br/&gt;'</span>;</span></span><br></pre></td></tr></table></figure></p>\n<p>代码运行结果：</p>\n<p>当在类外部使用serialize()时会调用这里的__sleep()方法<br>O:6:”Person”:2:{s:4:”name”;s:8:”5bCP5piO”;s:3:”age”;i:25;}</p>\n<p>注：<strong>sleep() 不能返回父类的私有成员的名字。这样做会产生一个 E_NOTICE 级别的错误。可以用 Serializable 接口来替代。\n        </strong>sleep() 方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。</p>\n<h2 id=\"wakeup-执行unserialize-时，先会调用这个函数\"><a href=\"#wakeup-执行unserialize-时，先会调用这个函数\" class=\"headerlink\" title=\"__wakeup(),执行unserialize()时，先会调用这个函数\"></a>__wakeup(),执行unserialize()时，先会调用这个函数</h2><p>unserialize() 会检查是否存在一个 <strong>wakeup()方法。如果存在，则会先调用 </strong>wakeup方法，预先准备对象需要的资源。<br>__wakeup() 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * @return array</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__sleep</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"当在类外部使用serialize()时会调用这里的__sleep()方法&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = base64_encode(<span class=\"keyword\">$this</span>-&gt;name);</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">return</span> <span class=\"keyword\">array</span>(<span class=\"string\">'name'</span>, <span class=\"string\">'age'</span>); <span class=\"comment\">// 这里必须返回一个数值，里边的元素表示返回的属性名称</span></span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * __wakeup</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__wakeup</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"当在类外部使用unserialize()时会调用这里的__wakeup()方法&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = <span class=\"number\">2</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = <span class=\"string\">'男'</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"comment\">// 这里不需要返回数组</span></span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\">var_dump(serialize($person));</span></span><br><span class=\"line\"><span class=\"php\">var_dump(unserialize(serialize($person)));</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果：</p>\n<p>当在类外部使用serialize()时会调用这里的<strong>sleep()方法<br>string(58) “O:6:”Person”:2:{s:4:”name”;s:8:”5bCP5piO”;s:3:”age”;i:25;}” 当在类外部使用serialize()时会调用这里的</strong>sleep()方法<br>当在类外部使用unserialize()时会调用这里的__wakeup()方法<br>object(Person)#2 (3) { [“sex”]=&gt; string(3) “男” [“name”]=&gt; int(2) [“age”]=&gt; int(25) }</p>\n<h2 id=\"toString-，类被当成字符串时的回应方法\"><a href=\"#toString-，类被当成字符串时的回应方法\" class=\"headerlink\" title=\"__toString()，类被当成字符串时的回应方法\"></a>__toString()，类被当成字符串时的回应方法</h2><p><strong>toString() 方法用于一个类被当成字符串时应怎样回应。例如 <code>echo $obj;</code> 应该显示些什么。<br>此方法必须返回一个字符串，否则将发出一条 <code>E_RECOVERABLE_ERROR</code> 级别的致命错误。<br>不能在 </strong>toString() 方法中抛出异常。这么做会导致致命错误。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__toString</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">return</span> <span class=\"string\">'go go go'</span>;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> $person;</span></span><br></pre></td></tr></table></figure></p>\n<p>结果：</p>\n<p>go go go</p>\n<h2 id=\"invoke-，调用函数的方式调用一个对象时的回应方法\"><a href=\"#invoke-，调用函数的方式调用一个对象时的回应方法\" class=\"headerlink\" title=\"__invoke()，调用函数的方式调用一个对象时的回应方法\"></a>__invoke()，调用函数的方式调用一个对象时的回应方法</h2><p>当尝试以调用函数的方式调用一个对象时，__invoke() 方法会被自动调用。</p>\n<p>注意：本特性只在 PHP 5.3.0 及以上版本有效。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__invoke</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">'这可是一个对象哦'</span>;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\">$person();</span></span><br></pre></td></tr></table></figure></p>\n<p>查看运行结果：</p>\n<p>这可是一个对象哦<br>当然，如果你执意要将对象当函数方法使用，那么会得到下面结果：<br>Fatal error: index.php on line 18</p>\n<h2 id=\"set-state-，调用var-export-导出类时，此静态方法会被调用。\"><a href=\"#set-state-，调用var-export-导出类时，此静态方法会被调用。\" class=\"headerlink\" title=\"__set_state()，调用var_export()导出类时，此静态方法会被调用。\"></a>__set_state()，调用var_export()导出类时，此静态方法会被调用。</h2><p>自 PHP 5.1.0 起，当调用 var_export() 导出类时，此静态方法会被自动调用。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">\t  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">\t  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\">\t </span></span><br><span class=\"line\"><span class=\"php\">\t  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t  &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">\t    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">\t    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">\t  &#125;</span></span><br><span class=\"line\"><span class=\"php\">\t </span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t </span></span><br><span class=\"line\"><span class=\"php\">\t$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\">\tvar_export($person);</span></span><br></pre></td></tr></table></figure></p>\n<p>看结果：</p>\n<p>Person::__set_state(array( ‘sex’ =&gt; ‘男’, ‘name’ =&gt; ‘小明’, ‘age’ =&gt; 25, ))</p>\n<h2 id=\"clone-，当对象复制完成时调用\"><a href=\"#clone-，当对象复制完成时调用\" class=\"headerlink\" title=\"__clone()，当对象复制完成时调用\"></a>__clone()，当对象复制完成时调用</h2><p>对象复制可以通过 clone 关键字来完成（如果可能，这将调用对象的 <strong>clone() 方法）。对象中的 </strong>clone() 方法不能被直接调用。</p>\n<p>注意：</p>\n<p>当对象被复制后，PHP 5 会对对象的所有属性执行一个浅复制（shallow copy）。所有的引用属性 仍然会是一个指向原来的变量的引用。<br>当复制完成时，如果定义了 <strong>clone() 方法，则新创建的对象（复制生成的对象）中的 </strong>clone() 方法会被调用，可用于修改属性的值（如果有必要的话）。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__clone</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"keyword\">__METHOD__</span>.<span class=\"string\">\"你正在克隆对象&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\">$person2 = <span class=\"keyword\">clone</span> $person;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">var_dump(<span class=\"string\">'persion1:'</span>);</span></span><br><span class=\"line\"><span class=\"php\">var_dump($person);</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">'&lt;br&gt;'</span>;</span></span><br><span class=\"line\"><span class=\"php\">var_dump(<span class=\"string\">'persion2:'</span>);</span></span><br><span class=\"line\"><span class=\"php\">var_dump($person2);</span></span><br></pre></td></tr></table></figure>\n<p>看结果：</p>\n<p>Person::__clone你正在克隆对象<br>string(9) “persion1:” object(Person)#1 (3) { [“sex”]=&gt; string(3) “男” [“name”]=&gt; string(6) “小明” [“age”]=&gt; int(25) }<br>string(9) “persion2:” object(Person)#2 (3) { [“sex”]=&gt; string(3) “男” [“name”]=&gt; string(6) “小明” [“age”]=&gt; int(25) }<br>克隆成功。</p>\n<h2 id=\"autoload-，尝试加载未定义的类\"><a href=\"#autoload-，尝试加载未定义的类\" class=\"headerlink\" title=\"__autoload()，尝试加载未定义的类\"></a>__autoload()，尝试加载未定义的类</h2><p>这里没有代码<br>PHP有很多成熟的框架，例如：ThinkPHP、Laravel、Yii、Ci等， 但底层都是MVC， 那么MVC是如何运行的？<br>MVC的运行，离不开PSR_0, PSR_4以及autoload(类的自动加载), 感兴趣的同学可以google或者其他的方式去了解的</p>\n<h2 id=\"debugInfo-，打印所需调试信息\"><a href=\"#debugInfo-，打印所需调试信息\" class=\"headerlink\" title=\"__debugInfo()，打印所需调试信息\"></a>__debugInfo()，打印所需调试信息</h2><p>该方法在PHP 5.6.0及其以上版本才可以用，如果你发现使用无效或者报错，请查看啊你的版本<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">C</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $prop;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($val)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;prop = $val;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * @return array</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__debugInfo</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">return</span> [</span></span><br><span class=\"line\"><span class=\"php\">      <span class=\"string\">'propSquared'</span> =&gt; <span class=\"keyword\">$this</span>-&gt;prop ** <span class=\"number\">2</span>,</span></span><br><span class=\"line\"><span class=\"php\">    ];</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">var_dump(<span class=\"keyword\">new</span> C(<span class=\"number\">42</span>));</span></span><br></pre></td></tr></table></figure></p>\n<p>结果：</p>\n<p>object(C)#1 (1) { [“propSquared”]=&gt; int(1764) }</p>\n","site":{"data":{}},"excerpt":"<p>PHP中魔术方法一共有十六中魔术方法</p>","more":"<h2 id=\"魔术方法列表\"><a href=\"#魔术方法列表\" class=\"headerlink\" title=\"魔术方法列表\"></a>魔术方法列表</h2><figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">__construct</span>()，类的构造函数</span><br><span class=\"line\"><span class=\"selector-tag\">__destruct</span>()，类的析构函数</span><br><span class=\"line\"><span class=\"selector-tag\">__call</span>()，在对象中调用一个不可访问方法时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__callStatic</span>()，用静态方式中调用一个不可访问方法时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__get</span>()，获得一个类的成员变量时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__set</span>()，设置一个类的成员变量时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__isset</span>()，当对不可访问属性调用<span class=\"selector-tag\">isset</span>()或<span class=\"selector-tag\">empty</span>()时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__unset</span>()，当对不可访问属性调用<span class=\"selector-tag\">unset</span>()时被调用。</span><br><span class=\"line\"><span class=\"selector-tag\">__sleep</span>()，执行<span class=\"selector-tag\">serialize</span>()时，先会调用这个函数</span><br><span class=\"line\"><span class=\"selector-tag\">__wakeup</span>()，执行<span class=\"selector-tag\">unserialize</span>()时，先会调用这个函数</span><br><span class=\"line\"><span class=\"selector-tag\">__toString</span>()，类被当成字符串时的回应方法</span><br><span class=\"line\"><span class=\"selector-tag\">__invoke</span>()，调用函数的方式调用一个对象时的回应方法</span><br><span class=\"line\"><span class=\"selector-tag\">__set_state</span>()，调用<span class=\"selector-tag\">var_export</span>()导出类时，此静态方法会被调用。</span><br><span class=\"line\"><span class=\"selector-tag\">__clone</span>()，当对象复制完成时调用</span><br><span class=\"line\"><span class=\"selector-tag\">__autoload</span>()，尝试加载未定义的类</span><br><span class=\"line\"><span class=\"selector-tag\">__debugInfo</span>()，打印所需调试信息</span><br></pre></td></tr></table></figure>\n<h2 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h2><p>在同一个类中只能声明一个构造方法，原因是，PHP不支持构造函数重载。<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Db</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $name;    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age;    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> $sex;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 显示声明一个构造方法且带参数</span></span><br><span class=\"line\"><span class=\"comment\">    */</span>                                           </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $sex=<span class=\"string\">\"男\"</span>, $age=<span class=\"number\">22</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;   </span><br><span class=\"line\">      <span class=\"keyword\">$this</span>-&gt;name = $name;</span><br><span class=\"line\">      <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span><br><span class=\"line\">      <span class=\"keyword\">$this</span>-&gt;age = $age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * say 方法</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123; </span><br><span class=\"line\">      <span class=\"keyword\">echo</span> <span class=\"string\">\"我叫：\"</span> . <span class=\"keyword\">$this</span>-&gt;name . <span class=\"string\">\"，性别：\"</span> . <span class=\"keyword\">$this</span>-&gt;sex . <span class=\"string\">\"，年龄：\"</span> . <span class=\"keyword\">$this</span>-&gt;age;</span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"析构函数\"><a href=\"#析构函数\" class=\"headerlink\" title=\"析构函数\"></a>析构函数</h2><p>析构方法允许在销毁一个类之前执行的一些操作或完成一些功能，比如说关闭文件、释放结果集等。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>  <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//方法体</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"call-在对象中调用一个不可访问方法时调用。\"><a href=\"#call-在对象中调用一个不可访问方法时调用。\" class=\"headerlink\" title=\"__call(),在对象中调用一个不可访问方法时调用。\"></a>__call(),在对象中调用一个不可访问方法时调用。</h2><p>为了避免当调用的方法不存在时产生错误，而意外的导致程序中止，可以使用 __call() 方法来避免。<br>该方法在调用的方法不存在时会自动调用，程序仍会继续执行下去。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;               </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123; </span></span><br><span class=\"line\"><span class=\"php\">                </span></span><br><span class=\"line\"><span class=\"php\">      <span class=\"keyword\">echo</span> <span class=\"string\">\"Hello, world!&lt;br&gt;\"</span>; </span></span><br><span class=\"line\"><span class=\"php\">  &#125;   </span></span><br><span class=\"line\"><span class=\"php\">     </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * 声明此方法用来处理调用对象中不存在的方法</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span><span class=\"params\">($funName, $arguments)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123; </span></span><br><span class=\"line\"><span class=\"php\">     <span class=\"keyword\">echo</span> <span class=\"string\">\"你所调用的函数：\"</span> . $funName . <span class=\"string\">\"(参数：\"</span> ; <span class=\"comment\">// 输出调用不存在的方法名</span></span></span><br><span class=\"line\"><span class=\"php\">     print_r($arguments); <span class=\"comment\">// 输出调用不存在的方法时的参数列表</span></span></span><br><span class=\"line\"><span class=\"php\">     <span class=\"keyword\">echo</span> <span class=\"string\">\")不存在！&lt;br&gt;\\n\"</span>; <span class=\"comment\">// 结束换行           </span></span></span><br><span class=\"line\"><span class=\"php\">  &#125;                     </span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$Person = <span class=\"keyword\">new</span> Person();      </span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;run(<span class=\"string\">\"teacher\"</span>); <span class=\"comment\">// 调用对象中不存在的方法，则自动调用了对象中的__call()方法</span></span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;eat(<span class=\"string\">\"小明\"</span>, <span class=\"string\">\"苹果\"</span>);       </span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;say();</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果:</p>\n<p>调用的函数：run(参数：Array ( [0] =&gt; teacher ) )不存在！<br>调用的函数：eat(参数：Array ( [0] =&gt; 小明 [1] =&gt; 苹果 ) )不存在！<br>Hello, world!</p>\n<h2 id=\"callStatic-用静态方式中调用一个不可访问方法时调用\"><a href=\"#callStatic-用静态方式中调用一个不可访问方法时调用\" class=\"headerlink\" title=\"__callStatic(),用静态方式中调用一个不可访问方法时调用\"></a>__callStatic(),用静态方式中调用一个不可访问方法时调用</h2><p>此方法与上面所说的 <strong>call() 功能除了 </strong>callStatic() 是未静态方法准备的之外，其它都是一样的<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"Hello, world!&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * 声明此方法用来处理调用对象中不存在的方法</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__callStatic</span><span class=\"params\">($funName, $arguments)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"你所调用的静态方法：\"</span> . $funName . <span class=\"string\">\"(参数：\"</span> ; <span class=\"comment\">// 输出调用不存在的方法名</span></span></span><br><span class=\"line\"><span class=\"php\">    print_r($arguments); <span class=\"comment\">// 输出调用不存在的方法时的参数列表</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\")不存在！&lt;br&gt;\\n\"</span>; <span class=\"comment\">// 结束换行</span></span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$Person = <span class=\"keyword\">new</span> Person();</span></span><br><span class=\"line\"><span class=\"php\">$Person::run(<span class=\"string\">\"teacher\"</span>); <span class=\"comment\">// 调用对象中不存在的方法，则自动调用了对象中的__call()方法</span></span></span><br><span class=\"line\"><span class=\"php\">$Person::eat(<span class=\"string\">\"小明\"</span>, <span class=\"string\">\"苹果\"</span>);</span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;say();</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果如下：</p>\n<p>调用的静态方法：run(参数：Array ( [0] =&gt; teacher ) )不存在！<br>调用的静态方法：eat(参数：Array ( [0] =&gt; 小明 [1] =&gt; 苹果 ) )不存在！<br>Hello, world!</p>\n<h2 id=\"get-获得一个类的成员变量时调用\"><a href=\"#get-获得一个类的成员变量时调用\" class=\"headerlink\" title=\"__get(),获得一个类的成员变量时调用\"></a>__get(),获得一个类的成员变量时调用</h2><p>在 php 面向对象编程中，类的成员属性被设定为 private 后，如果我们试图在外面调用它则会出现“不能访问某个私有属性”的错误。那么为了解决这个问题，我们可以使用魔术方法 __get()。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">1</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * 在类中添加__get()方法，在直接获取属性值时自动调用一次，以属性名作为参数传入并处理</span><br><span class=\"line\">   * @param $propertyName</span><br><span class=\"line\">   *</span><br><span class=\"line\">   * @return int</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($propertyName)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;  </span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">if</span> ($propertyName == <span class=\"string\">\"age\"</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;age &gt; <span class=\"number\">30</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;age - <span class=\"number\">10</span>;</span></span><br><span class=\"line\"><span class=\"php\">      &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$propertyName;</span></span><br><span class=\"line\"><span class=\"php\">      &#125;</span></span><br><span class=\"line\"><span class=\"php\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"php\">      <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$propertyName;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$Person = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"小明\"</span>, <span class=\"number\">60</span>);  <span class=\"comment\">// 通过Person类实例化的对象，并通过构造方法为属性赋初值</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">\"姓名：\"</span> . $Person-&gt;name . <span class=\"string\">\"&lt;br&gt;\"</span>;  <span class=\"comment\">// 直接访问私有属性name，自动调用了__get()方法可以间接获取</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">\"年龄：\"</span> . $Person-&gt;age . <span class=\"string\">\"&lt;br&gt;\"</span>;  <span class=\"comment\">// 自动调用了__get()方法，根据对象本身的情况会返回不同的值</span></span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果：</p>\n<p>姓名：小明<br>年龄：50</p>\n<h2 id=\"set-，设置一个类的成员变量时调用\"><a href=\"#set-，设置一个类的成员变量时调用\" class=\"headerlink\" title=\"__set()，设置一个类的成员变量时调用\"></a>__set()，设置一个类的成员变量时调用</h2><p>用来设置私有属性， 给一个未定义的属性赋值时，此方法会被触发，传递的参数是被设置的属性名和值。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * 声明魔术方法需要两个参数，真接为私有属性赋值时自动调用，并可以屏蔽一些非法赋值</span><br><span class=\"line\">   * @param $property</span><br><span class=\"line\">   * @param $value</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__set</span><span class=\"params\">($property, $value)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">if</span> ($property==<span class=\"string\">\"age\"</span>)</span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">      <span class=\"keyword\">if</span> ($value &gt; <span class=\"number\">150</span> || $value &lt; <span class=\"number\">0</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span>;</span></span><br><span class=\"line\"><span class=\"php\">      &#125;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;$property = $value;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * 在类中声明说话的方法，将所有的私有属性说出</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"我叫\"</span>.<span class=\"keyword\">$this</span>-&gt;name.<span class=\"string\">\"，今年\"</span>.<span class=\"keyword\">$this</span>-&gt;age.<span class=\"string\">\"岁了\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$Person=<span class=\"keyword\">new</span> Person(<span class=\"string\">\"小明\"</span>, <span class=\"number\">25</span>); <span class=\"comment\">//注意，初始值将被下面所改变</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//自动调用了__set()函数，将属性名name传给第一个参数，将属性值”李四”传给第二个参数</span></span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;name = <span class=\"string\">\"小红\"</span>;   <span class=\"comment\">//赋值成功。如果没有__set()，则出错。</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//自动调用了__set()函数，将属性名age传给第一个参数，将属性值26传给第二个参数</span></span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;age = <span class=\"number\">16</span>; <span class=\"comment\">//赋值成功</span></span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;age = <span class=\"number\">160</span>; <span class=\"comment\">//160是一个非法值，赋值失效</span></span></span><br><span class=\"line\"><span class=\"php\">$Person-&gt;say(); <span class=\"comment\">//输出：我叫小红，今年16岁了</span></span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果：</p>\n<p>我叫小红，今年16岁了</p>\n<h2 id=\"isset-当对不可访问属性调用isset-或empty-时调用\"><a href=\"#isset-当对不可访问属性调用isset-或empty-时调用\" class=\"headerlink\" title=\"__isset(),当对不可访问属性调用isset()或empty()时调用\"></a>__isset(),当对不可访问属性调用isset()或empty()时调用</h2><p>当对不可访问属性调用 isset() 或 empty() 时，__isset() 会被调用。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * @param $content</span><br><span class=\"line\">   *</span><br><span class=\"line\">   * @return bool</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__isset</span><span class=\"params\">($content)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"当在类外部使用isset()函数测定私有成员&#123;$content&#125;时，自动调用&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;$content);</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"小明\"</span>, <span class=\"number\">25</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"keyword\">isset</span>($person-&gt;sex),<span class=\"string\">\"&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"keyword\">isset</span>($person-&gt;name),<span class=\"string\">\"&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"keyword\">isset</span>($person-&gt;age),<span class=\"string\">\"&lt;br&gt;\"</span>;</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果如下：</p>\n<p>当在类外部使用isset()函数测定私有成员name时，自动调用 // <strong>isset() 内 第一个echo<br>当在类外部使用isset()函数测定私有成员age时，自动调用 // </strong>isset() 内 第一个echo</p>\n<h2 id=\"unset-当对不可访问属性调用unset-时被调用。\"><a href=\"#unset-当对不可访问属性调用unset-时被调用。\" class=\"headerlink\" title=\"__unset(),当对不可访问属性调用unset()时被调用。\"></a>__unset(),当对不可访问属性调用unset()时被调用。</h2><p>1、如果一个对象里面的成员属性是公有的，就可以使用这个函数在对象外面删除对象的公有属性。<br>2、如果对象的成员属性是私有的，我使用这个函数就没有权限去删除。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * @param $content</span><br><span class=\"line\">   *</span><br><span class=\"line\">   * @return bool</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__unset</span><span class=\"params\">($content)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"当在类外部使用unset()函数来删除私有成员时自动调用的&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;$content);</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"小明\"</span>, <span class=\"number\">25</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">unset</span>($person-&gt;sex);</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">unset</span>($person-&gt;name);</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">unset</span>($person-&gt;age);</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果：</p>\n<p>当在类外部使用unset()函数来删除私有成员时自动调用的</p>\n<h2 id=\"sleep-，执行serialize-时，先会调用这个函数\"><a href=\"#sleep-，执行serialize-时，先会调用这个函数\" class=\"headerlink\" title=\"__sleep()，执行serialize()时，先会调用这个函数\"></a>__sleep()，执行serialize()时，先会调用这个函数</h2><p>erialize() 函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，则该方法会优先被调用，然后才执行序列化操作。<br>此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。<br>如果该方法未返回任何内容，则 NULL 被序列化，并产生一个 E_NOTICE 级别的错误。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * @return array</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__sleep</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"当在类外部使用serialize()时会调用这里的__sleep()方法&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = base64_encode(<span class=\"keyword\">$this</span>-&gt;name);</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">return</span> <span class=\"keyword\">array</span>(<span class=\"string\">'name'</span>, <span class=\"string\">'age'</span>); <span class=\"comment\">// 这里必须返回一个数值，里边的元素表示返回的属性名称</span></span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> serialize($person);</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">'&lt;br/&gt;'</span>;</span></span><br></pre></td></tr></table></figure></p>\n<p>代码运行结果：</p>\n<p>当在类外部使用serialize()时会调用这里的__sleep()方法<br>O:6:”Person”:2:{s:4:”name”;s:8:”5bCP5piO”;s:3:”age”;i:25;}</p>\n<p>注：<strong>sleep() 不能返回父类的私有成员的名字。这样做会产生一个 E_NOTICE 级别的错误。可以用 Serializable 接口来替代。\n        </strong>sleep() 方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。</p>\n<h2 id=\"wakeup-执行unserialize-时，先会调用这个函数\"><a href=\"#wakeup-执行unserialize-时，先会调用这个函数\" class=\"headerlink\" title=\"__wakeup(),执行unserialize()时，先会调用这个函数\"></a>__wakeup(),执行unserialize()时，先会调用这个函数</h2><p>unserialize() 会检查是否存在一个 <strong>wakeup()方法。如果存在，则会先调用 </strong>wakeup方法，预先准备对象需要的资源。<br>__wakeup() 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * @return array</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__sleep</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"当在类外部使用serialize()时会调用这里的__sleep()方法&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = base64_encode(<span class=\"keyword\">$this</span>-&gt;name);</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">return</span> <span class=\"keyword\">array</span>(<span class=\"string\">'name'</span>, <span class=\"string\">'age'</span>); <span class=\"comment\">// 这里必须返回一个数值，里边的元素表示返回的属性名称</span></span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * __wakeup</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__wakeup</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"当在类外部使用unserialize()时会调用这里的__wakeup()方法&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = <span class=\"number\">2</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = <span class=\"string\">'男'</span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"comment\">// 这里不需要返回数组</span></span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\">var_dump(serialize($person));</span></span><br><span class=\"line\"><span class=\"php\">var_dump(unserialize(serialize($person)));</span></span><br></pre></td></tr></table></figure></p>\n<p>运行结果：</p>\n<p>当在类外部使用serialize()时会调用这里的<strong>sleep()方法<br>string(58) “O:6:”Person”:2:{s:4:”name”;s:8:”5bCP5piO”;s:3:”age”;i:25;}” 当在类外部使用serialize()时会调用这里的</strong>sleep()方法<br>当在类外部使用unserialize()时会调用这里的__wakeup()方法<br>object(Person)#2 (3) { [“sex”]=&gt; string(3) “男” [“name”]=&gt; int(2) [“age”]=&gt; int(25) }</p>\n<h2 id=\"toString-，类被当成字符串时的回应方法\"><a href=\"#toString-，类被当成字符串时的回应方法\" class=\"headerlink\" title=\"__toString()，类被当成字符串时的回应方法\"></a>__toString()，类被当成字符串时的回应方法</h2><p><strong>toString() 方法用于一个类被当成字符串时应怎样回应。例如 <code>echo $obj;</code> 应该显示些什么。<br>此方法必须返回一个字符串，否则将发出一条 <code>E_RECOVERABLE_ERROR</code> 级别的致命错误。<br>不能在 </strong>toString() 方法中抛出异常。这么做会导致致命错误。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__toString</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">return</span> <span class=\"string\">'go go go'</span>;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> $person;</span></span><br></pre></td></tr></table></figure></p>\n<p>结果：</p>\n<p>go go go</p>\n<h2 id=\"invoke-，调用函数的方式调用一个对象时的回应方法\"><a href=\"#invoke-，调用函数的方式调用一个对象时的回应方法\" class=\"headerlink\" title=\"__invoke()，调用函数的方式调用一个对象时的回应方法\"></a>__invoke()，调用函数的方式调用一个对象时的回应方法</h2><p>当尝试以调用函数的方式调用一个对象时，__invoke() 方法会被自动调用。</p>\n<p>注意：本特性只在 PHP 5.3.0 及以上版本有效。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__invoke</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"string\">'这可是一个对象哦'</span>;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\">$person();</span></span><br></pre></td></tr></table></figure></p>\n<p>查看运行结果：</p>\n<p>这可是一个对象哦<br>当然，如果你执意要将对象当函数方法使用，那么会得到下面结果：<br>Fatal error: index.php on line 18</p>\n<h2 id=\"set-state-，调用var-export-导出类时，此静态方法会被调用。\"><a href=\"#set-state-，调用var-export-导出类时，此静态方法会被调用。\" class=\"headerlink\" title=\"__set_state()，调用var_export()导出类时，此静态方法会被调用。\"></a>__set_state()，调用var_export()导出类时，此静态方法会被调用。</h2><p>自 PHP 5.1.0 起，当调用 var_export() 导出类时，此静态方法会被自动调用。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">\t  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">\t  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\">\t </span></span><br><span class=\"line\"><span class=\"php\">\t  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">\t  &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">\t    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">\t    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">\t  &#125;</span></span><br><span class=\"line\"><span class=\"php\">\t </span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t </span></span><br><span class=\"line\"><span class=\"php\">\t$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\">\tvar_export($person);</span></span><br></pre></td></tr></table></figure></p>\n<p>看结果：</p>\n<p>Person::__set_state(array( ‘sex’ =&gt; ‘男’, ‘name’ =&gt; ‘小明’, ‘age’ =&gt; 25, ))</p>\n<h2 id=\"clone-，当对象复制完成时调用\"><a href=\"#clone-，当对象复制完成时调用\" class=\"headerlink\" title=\"__clone()，当对象复制完成时调用\"></a>__clone()，当对象复制完成时调用</h2><p>对象复制可以通过 clone 关键字来完成（如果可能，这将调用对象的 <strong>clone() 方法）。对象中的 </strong>clone() 方法不能被直接调用。</p>\n<p>注意：</p>\n<p>当对象被复制后，PHP 5 会对对象的所有属性执行一个浅复制（shallow copy）。所有的引用属性 仍然会是一个指向原来的变量的引用。<br>当复制完成时，如果定义了 <strong>clone() 方法，则新创建的对象（复制生成的对象）中的 </strong>clone() 方法会被调用，可用于修改属性的值（如果有必要的话）。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $sex;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $name;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> $age;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">\"\"</span>, $age=<span class=\"number\">25</span>, $sex=<span class=\"string\">'男'</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;name = $name;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;age = $age;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;sex = $sex;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__clone</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">  &#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> <span class=\"keyword\">__METHOD__</span>.<span class=\"string\">\"你正在克隆对象&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">$person = <span class=\"keyword\">new</span> Person(<span class=\"string\">'小明'</span>); <span class=\"comment\">// 初始赋值</span></span></span><br><span class=\"line\"><span class=\"php\">$person2 = <span class=\"keyword\">clone</span> $person;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">var_dump(<span class=\"string\">'persion1:'</span>);</span></span><br><span class=\"line\"><span class=\"php\">var_dump($person);</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">'&lt;br&gt;'</span>;</span></span><br><span class=\"line\"><span class=\"php\">var_dump(<span class=\"string\">'persion2:'</span>);</span></span><br><span class=\"line\"><span class=\"php\">var_dump($person2);</span></span><br></pre></td></tr></table></figure>\n<p>看结果：</p>\n<p>Person::__clone你正在克隆对象<br>string(9) “persion1:” object(Person)#1 (3) { [“sex”]=&gt; string(3) “男” [“name”]=&gt; string(6) “小明” [“age”]=&gt; int(25) }<br>string(9) “persion2:” object(Person)#2 (3) { [“sex”]=&gt; string(3) “男” [“name”]=&gt; string(6) “小明” [“age”]=&gt; int(25) }<br>克隆成功。</p>\n<h2 id=\"autoload-，尝试加载未定义的类\"><a href=\"#autoload-，尝试加载未定义的类\" class=\"headerlink\" title=\"__autoload()，尝试加载未定义的类\"></a>__autoload()，尝试加载未定义的类</h2><p>这里没有代码<br>PHP有很多成熟的框架，例如：ThinkPHP、Laravel、Yii、Ci等， 但底层都是MVC， 那么MVC是如何运行的？<br>MVC的运行，离不开PSR_0, PSR_4以及autoload(类的自动加载), 感兴趣的同学可以google或者其他的方式去了解的</p>\n<h2 id=\"debugInfo-，打印所需调试信息\"><a href=\"#debugInfo-，打印所需调试信息\" class=\"headerlink\" title=\"__debugInfo()，打印所需调试信息\"></a>__debugInfo()，打印所需调试信息</h2><p>该方法在PHP 5.6.0及其以上版本才可以用，如果你发现使用无效或者报错，请查看啊你的版本<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">C</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">private</span> $prop;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($val)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">$this</span>-&gt;prop = $val;</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\">  /**</span><br><span class=\"line\">   * @return array</span><br><span class=\"line\"><span class=\"php\">   */</span></span><br><span class=\"line\"><span class=\"php\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__debugInfo</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">return</span> [</span></span><br><span class=\"line\"><span class=\"php\">      <span class=\"string\">'propSquared'</span> =&gt; <span class=\"keyword\">$this</span>-&gt;prop ** <span class=\"number\">2</span>,</span></span><br><span class=\"line\"><span class=\"php\">    ];</span></span><br><span class=\"line\"><span class=\"php\">  &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\">var_dump(<span class=\"keyword\">new</span> C(<span class=\"number\">42</span>));</span></span><br></pre></td></tr></table></figure></p>\n<p>结果：</p>\n<p>object(C)#1 (1) { [“propSquared”]=&gt; int(1764) }</p>"},{"title":"PHP常用字符串函数","date":"2017-11-22T12:00:47.000Z","_content":"\n本文列举常用的PHP字符串函数\n\n<!-- more -->\n\n##\t查找字符位置函数\n\n```\nstrpos($str,search,[int])://查找search在$str中的第一次位置从int开始；\nstrrpos($str,search,[int])://查找search在$str中的最后一次出现的位置从int开始\n```\n\n##\t提取子字符函数（双字节）\n\n```\nsubmit($str,int start[,int length])://从$str中strat位置开始提取[length长度的字符串]。\nstrstr($str1,$str2)://从$str1(第一个的位置)搜索$str2并从它开始截取到结束字符串;若没有则返回FALSE。\nstristr()://功能同strstr，只是不区分大小写。\nstrrchr()://从最后一次搜索到的字符处返回；用处：取路径中文件名\n```\n\n##\t替换字符串\n\n```\nstr_replace(search,replace,$str):从$str中查找search用replace来替换\nstr_irreplace(search,replace,$str):\nstrtr($str,search,replace):这个函数中replace不能为\"\";\nsubstr_replace($Str,$rep,$start[,length])$str原始字符串,$rep替换后的新字符串,$start起始位置,$length替换的长度，该项可选\n```\n\n##\t查询字符串长度\n\n```\nint strlen($str)\n```\n\n##\t比较字符函数\n\n```\nint strcmp($str1,$str2):$str1>=<$str2分别为正1,0,-1（字符串比较)\nstrcasecmp() 同上:(不分大小写)\nstrnatcmp(\"4\",\"14\") :按自然排序比较字符串\nstrnatcasecmp() :同上,(区分大小写）\n```\n\n##\t分割成数组函数\n\n```\nstr_split($str,len):把$str按len长度进行分割返回数组\nsplit(search,$str[,int]):把$str按search字符进行分割返回数组int是分割几 次，后面的将不分割\nexplode(search,$str[,int])\n```\n\n##\t去除空格：\n\n```\nltrim:去除字符串左边空格\nrtrim:去除字符串右边边空格\ntrim:去除字符串两边空格\n```\n\n##\t加空格函数\n\n```\nchunk_split($str,2);向$str字符里面按2个字符就加入一个空格;\n```\n\n##\t返回指定的字符或ascii\n\n```\nchr、ord\n```\n\n##\tHTML代码有关函数\n\n```\nnl2br():使\\n转换为<br>。\nstrip_tags($str[,'<p>'])://去除HTML和PHP标记\nhtmlspecialchars($str[,参数])://页面正常输出HTML代码参数是转换方式\n```\n\n##\t字符大小写转换函数\n\n```\nstrtolower($str) :字符串转换为小写\nstrtoupper($str) :字符串转换为大写\nucfirst($str) :将函数的第一个字符转换为大写\nucwords($str) :将每个单词的首字母转换为大写\n```\n\n##\t数据库相关函数\n\n```\naddslashes($str):使str内单引号（'）、双引号（\"）、反斜线（\\）与 NUL字符串转换为\\',\\\",\\\\。\nmagic_quotes_gpc = On :自动对 get post cookie的内容进行转义\nget_magic_quotes_gpc（）:检测是否打开magic_quotes_gpc\nstripslashes() :去除字符串中的反斜杠\n```\n\n##\t连接函数\n\n```\nimplode(str,$arr) :将字符串数组按指定字符连接成一个字符串；\nimplode():函数有个别名函数join\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/PHP常用字符串函数.md","raw":"---\ntitle: PHP常用字符串函数\ndate: 2017-11-22 20:00:47\ntags: PHP\ncategories: PHP\n---\n\n本文列举常用的PHP字符串函数\n\n<!-- more -->\n\n##\t查找字符位置函数\n\n```\nstrpos($str,search,[int])://查找search在$str中的第一次位置从int开始；\nstrrpos($str,search,[int])://查找search在$str中的最后一次出现的位置从int开始\n```\n\n##\t提取子字符函数（双字节）\n\n```\nsubmit($str,int start[,int length])://从$str中strat位置开始提取[length长度的字符串]。\nstrstr($str1,$str2)://从$str1(第一个的位置)搜索$str2并从它开始截取到结束字符串;若没有则返回FALSE。\nstristr()://功能同strstr，只是不区分大小写。\nstrrchr()://从最后一次搜索到的字符处返回；用处：取路径中文件名\n```\n\n##\t替换字符串\n\n```\nstr_replace(search,replace,$str):从$str中查找search用replace来替换\nstr_irreplace(search,replace,$str):\nstrtr($str,search,replace):这个函数中replace不能为\"\";\nsubstr_replace($Str,$rep,$start[,length])$str原始字符串,$rep替换后的新字符串,$start起始位置,$length替换的长度，该项可选\n```\n\n##\t查询字符串长度\n\n```\nint strlen($str)\n```\n\n##\t比较字符函数\n\n```\nint strcmp($str1,$str2):$str1>=<$str2分别为正1,0,-1（字符串比较)\nstrcasecmp() 同上:(不分大小写)\nstrnatcmp(\"4\",\"14\") :按自然排序比较字符串\nstrnatcasecmp() :同上,(区分大小写）\n```\n\n##\t分割成数组函数\n\n```\nstr_split($str,len):把$str按len长度进行分割返回数组\nsplit(search,$str[,int]):把$str按search字符进行分割返回数组int是分割几 次，后面的将不分割\nexplode(search,$str[,int])\n```\n\n##\t去除空格：\n\n```\nltrim:去除字符串左边空格\nrtrim:去除字符串右边边空格\ntrim:去除字符串两边空格\n```\n\n##\t加空格函数\n\n```\nchunk_split($str,2);向$str字符里面按2个字符就加入一个空格;\n```\n\n##\t返回指定的字符或ascii\n\n```\nchr、ord\n```\n\n##\tHTML代码有关函数\n\n```\nnl2br():使\\n转换为<br>。\nstrip_tags($str[,'<p>'])://去除HTML和PHP标记\nhtmlspecialchars($str[,参数])://页面正常输出HTML代码参数是转换方式\n```\n\n##\t字符大小写转换函数\n\n```\nstrtolower($str) :字符串转换为小写\nstrtoupper($str) :字符串转换为大写\nucfirst($str) :将函数的第一个字符转换为大写\nucwords($str) :将每个单词的首字母转换为大写\n```\n\n##\t数据库相关函数\n\n```\naddslashes($str):使str内单引号（'）、双引号（\"）、反斜线（\\）与 NUL字符串转换为\\',\\\",\\\\。\nmagic_quotes_gpc = On :自动对 get post cookie的内容进行转义\nget_magic_quotes_gpc（）:检测是否打开magic_quotes_gpc\nstripslashes() :去除字符串中的反斜杠\n```\n\n##\t连接函数\n\n```\nimplode(str,$arr) :将字符串数组按指定字符连接成一个字符串；\nimplode():函数有个别名函数join\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"PHP常用字符串函数","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuwe000bydqnuhx59z4h","content":"<p>本文列举常用的PHP字符串函数</p>\n<a id=\"more\"></a>\n<h2 id=\"查找字符位置函数\"><a href=\"#查找字符位置函数\" class=\"headerlink\" title=\"查找字符位置函数\"></a>查找字符位置函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">strpos</span><span class=\"params\">(<span class=\"variable\">$str</span>,search,[int])</span></span>:<span class=\"comment\">//查找search在$str中的第一次位置从int开始；</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strrpos</span><span class=\"params\">(<span class=\"variable\">$str</span>,search,[int])</span></span>:<span class=\"comment\">//查找search在$str中的最后一次出现的位置从int开始</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"提取子字符函数（双字节）\"><a href=\"#提取子字符函数（双字节）\" class=\"headerlink\" title=\"提取子字符函数（双字节）\"></a>提取子字符函数（双字节）</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">submit</span><span class=\"params\">(<span class=\"variable\">$str</span>,int start[,int length])</span></span>:<span class=\"comment\">//从$str中strat位置开始提取[length长度的字符串]。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strstr</span><span class=\"params\">(<span class=\"variable\">$str1</span>,<span class=\"variable\">$str2</span>)</span></span>:<span class=\"comment\">//从$str1(第一个的位置)搜索$str2并从它开始截取到结束字符串;若没有则返回FALSE。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">stristr</span><span class=\"params\">()</span></span>:<span class=\"comment\">//功能同strstr，只是不区分大小写。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strrchr</span><span class=\"params\">()</span></span>:<span class=\"comment\">//从最后一次搜索到的字符处返回；用处：取路径中文件名</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"替换字符串\"><a href=\"#替换字符串\" class=\"headerlink\" title=\"替换字符串\"></a>替换字符串</h2><figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str_replace(<span class=\"keyword\">search</span>,<span class=\"keyword\">replace</span>,<span class=\"variable\">$str</span>):从<span class=\"variable\">$str</span>中查找<span class=\"keyword\">search</span>用<span class=\"keyword\">replace</span>来替换</span><br><span class=\"line\">str_irreplace(<span class=\"keyword\">search</span>,<span class=\"keyword\">replace</span>,<span class=\"variable\">$str</span>):</span><br><span class=\"line\">strtr(<span class=\"variable\">$str</span>,<span class=\"keyword\">search</span>,<span class=\"keyword\">replace</span>):这个函数中<span class=\"keyword\">replace</span>不能为<span class=\"string\">\"\"</span>;</span><br><span class=\"line\">substr_replace(<span class=\"variable\">$Str</span>,<span class=\"variable\">$rep</span>,<span class=\"variable\">$start</span>[,length])<span class=\"variable\">$str</span>原始字符串,<span class=\"variable\">$rep</span>替换后的新字符串,<span class=\"variable\">$start</span>起始位置,<span class=\"variable\">$length</span>替换的长度，该项可选</span><br></pre></td></tr></table></figure>\n<h2 id=\"查询字符串长度\"><a href=\"#查询字符串长度\" class=\"headerlink\" title=\"查询字符串长度\"></a>查询字符串长度</h2><figure class=\"highlight hsp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> <span class=\"keyword\">strlen</span>($<span class=\"keyword\">str</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"比较字符函数\"><a href=\"#比较字符函数\" class=\"headerlink\" title=\"比较字符函数\"></a>比较字符函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int strcmp(<span class=\"variable\">$str1</span>,<span class=\"variable\">$str2</span>):<span class=\"variable\">$str1</span>&gt;=&lt;<span class=\"variable\">$str2</span>分别为正<span class=\"number\">1</span>,<span class=\"number\">0</span>,-<span class=\"number\">1</span>（字符串比较)</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strcasecmp</span><span class=\"params\">()</span></span> 同上:(不分大小写)</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strnatcmp</span><span class=\"params\">(<span class=\"string\">\"4\"</span>,<span class=\"string\">\"14\"</span>)</span></span> :按自然排序比较字符串</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strnatcasecmp</span><span class=\"params\">()</span></span> :同上,(区分大小写）</span><br></pre></td></tr></table></figure>\n<h2 id=\"分割成数组函数\"><a href=\"#分割成数组函数\" class=\"headerlink\" title=\"分割成数组函数\"></a>分割成数组函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">str_split</span><span class=\"params\">(<span class=\"variable\">$str</span>,len)</span></span>:把<span class=\"variable\">$str</span>按len长度进行分割返回数组</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">split</span><span class=\"params\">(search,<span class=\"variable\">$str</span>[,int])</span></span>:把<span class=\"variable\">$str</span>按search字符进行分割返回数组int是分割几 次，后面的将不分割</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">explode</span><span class=\"params\">(search,<span class=\"variable\">$str</span>[,int])</span></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"去除空格：\"><a href=\"#去除空格：\" class=\"headerlink\" title=\"去除空格：\"></a>去除空格：</h2><figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">ltrim:</span>去除字符串左边空格</span><br><span class=\"line\"><span class=\"symbol\">rtrim:</span>去除字符串右边边空格</span><br><span class=\"line\"><span class=\"symbol\">trim:</span>去除字符串两边空格</span><br></pre></td></tr></table></figure>\n<h2 id=\"加空格函数\"><a href=\"#加空格函数\" class=\"headerlink\" title=\"加空格函数\"></a>加空格函数</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">chunk_split($</span><span class=\"bash\">str,2);向<span class=\"variable\">$str</span>字符里面按2个字符就加入一个空格;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"返回指定的字符或ascii\"><a href=\"#返回指定的字符或ascii\" class=\"headerlink\" title=\"返回指定的字符或ascii\"></a>返回指定的字符或ascii</h2><figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">chr</span>、<span class=\"keyword\">ord</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"HTML代码有关函数\"><a href=\"#HTML代码有关函数\" class=\"headerlink\" title=\"HTML代码有关函数\"></a>HTML代码有关函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">nl2br</span><span class=\"params\">()</span></span>:使\\n转换为&lt;br&gt;。</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strip_tags</span><span class=\"params\">(<span class=\"variable\">$str</span>[,<span class=\"string\">'&lt;p&gt;'</span>])</span></span>:<span class=\"comment\">//去除HTML和PHP标记</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">htmlspecialchars</span><span class=\"params\">(<span class=\"variable\">$str</span>[,参数])</span></span>:<span class=\"comment\">//页面正常输出HTML代码参数是转换方式</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"字符大小写转换函数\"><a href=\"#字符大小写转换函数\" class=\"headerlink\" title=\"字符大小写转换函数\"></a>字符大小写转换函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">strtolower</span><span class=\"params\">(<span class=\"variable\">$str</span>)</span></span> :字符串转换为小写</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strtoupper</span><span class=\"params\">(<span class=\"variable\">$str</span>)</span></span> :字符串转换为大写</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ucfirst</span><span class=\"params\">(<span class=\"variable\">$str</span>)</span></span> :将函数的第一个字符转换为大写</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ucwords</span><span class=\"params\">(<span class=\"variable\">$str</span>)</span></span> :将每个单词的首字母转换为大写</span><br></pre></td></tr></table></figure>\n<h2 id=\"数据库相关函数\"><a href=\"#数据库相关函数\" class=\"headerlink\" title=\"数据库相关函数\"></a>数据库相关函数</h2><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">addslashes($str):使str内单引号（'）、双引号（\"）、反斜线（\\）与 NUL字符串转换为\\',\\\",\\\\。</span></span><br><span class=\"line\">magic_quotes_gpc = On :自动对 get post cookie的内容进行转义</span><br><span class=\"line\"><span class=\"section\">get_magic_quotes_gpc（）:检测是否打开magic_quotes_gpc</span></span><br><span class=\"line\">stripslashes() :去除字符串中的反斜杠</span><br></pre></td></tr></table></figure>\n<h2 id=\"连接函数\"><a href=\"#连接函数\" class=\"headerlink\" title=\"连接函数\"></a>连接函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">implode</span><span class=\"params\">(str,<span class=\"variable\">$arr</span>)</span></span> :将字符串数组按指定字符连接成一个字符串；</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">implode</span><span class=\"params\">()</span></span>:函数有个别名函数join</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>本文列举常用的PHP字符串函数</p>","more":"<h2 id=\"查找字符位置函数\"><a href=\"#查找字符位置函数\" class=\"headerlink\" title=\"查找字符位置函数\"></a>查找字符位置函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">strpos</span><span class=\"params\">(<span class=\"variable\">$str</span>,search,[int])</span></span>:<span class=\"comment\">//查找search在$str中的第一次位置从int开始；</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strrpos</span><span class=\"params\">(<span class=\"variable\">$str</span>,search,[int])</span></span>:<span class=\"comment\">//查找search在$str中的最后一次出现的位置从int开始</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"提取子字符函数（双字节）\"><a href=\"#提取子字符函数（双字节）\" class=\"headerlink\" title=\"提取子字符函数（双字节）\"></a>提取子字符函数（双字节）</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">submit</span><span class=\"params\">(<span class=\"variable\">$str</span>,int start[,int length])</span></span>:<span class=\"comment\">//从$str中strat位置开始提取[length长度的字符串]。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strstr</span><span class=\"params\">(<span class=\"variable\">$str1</span>,<span class=\"variable\">$str2</span>)</span></span>:<span class=\"comment\">//从$str1(第一个的位置)搜索$str2并从它开始截取到结束字符串;若没有则返回FALSE。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">stristr</span><span class=\"params\">()</span></span>:<span class=\"comment\">//功能同strstr，只是不区分大小写。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strrchr</span><span class=\"params\">()</span></span>:<span class=\"comment\">//从最后一次搜索到的字符处返回；用处：取路径中文件名</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"替换字符串\"><a href=\"#替换字符串\" class=\"headerlink\" title=\"替换字符串\"></a>替换字符串</h2><figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str_replace(<span class=\"keyword\">search</span>,<span class=\"keyword\">replace</span>,<span class=\"variable\">$str</span>):从<span class=\"variable\">$str</span>中查找<span class=\"keyword\">search</span>用<span class=\"keyword\">replace</span>来替换</span><br><span class=\"line\">str_irreplace(<span class=\"keyword\">search</span>,<span class=\"keyword\">replace</span>,<span class=\"variable\">$str</span>):</span><br><span class=\"line\">strtr(<span class=\"variable\">$str</span>,<span class=\"keyword\">search</span>,<span class=\"keyword\">replace</span>):这个函数中<span class=\"keyword\">replace</span>不能为<span class=\"string\">\"\"</span>;</span><br><span class=\"line\">substr_replace(<span class=\"variable\">$Str</span>,<span class=\"variable\">$rep</span>,<span class=\"variable\">$start</span>[,length])<span class=\"variable\">$str</span>原始字符串,<span class=\"variable\">$rep</span>替换后的新字符串,<span class=\"variable\">$start</span>起始位置,<span class=\"variable\">$length</span>替换的长度，该项可选</span><br></pre></td></tr></table></figure>\n<h2 id=\"查询字符串长度\"><a href=\"#查询字符串长度\" class=\"headerlink\" title=\"查询字符串长度\"></a>查询字符串长度</h2><figure class=\"highlight hsp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> <span class=\"keyword\">strlen</span>($<span class=\"keyword\">str</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"比较字符函数\"><a href=\"#比较字符函数\" class=\"headerlink\" title=\"比较字符函数\"></a>比较字符函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int strcmp(<span class=\"variable\">$str1</span>,<span class=\"variable\">$str2</span>):<span class=\"variable\">$str1</span>&gt;=&lt;<span class=\"variable\">$str2</span>分别为正<span class=\"number\">1</span>,<span class=\"number\">0</span>,-<span class=\"number\">1</span>（字符串比较)</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strcasecmp</span><span class=\"params\">()</span></span> 同上:(不分大小写)</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strnatcmp</span><span class=\"params\">(<span class=\"string\">\"4\"</span>,<span class=\"string\">\"14\"</span>)</span></span> :按自然排序比较字符串</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strnatcasecmp</span><span class=\"params\">()</span></span> :同上,(区分大小写）</span><br></pre></td></tr></table></figure>\n<h2 id=\"分割成数组函数\"><a href=\"#分割成数组函数\" class=\"headerlink\" title=\"分割成数组函数\"></a>分割成数组函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">str_split</span><span class=\"params\">(<span class=\"variable\">$str</span>,len)</span></span>:把<span class=\"variable\">$str</span>按len长度进行分割返回数组</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">split</span><span class=\"params\">(search,<span class=\"variable\">$str</span>[,int])</span></span>:把<span class=\"variable\">$str</span>按search字符进行分割返回数组int是分割几 次，后面的将不分割</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">explode</span><span class=\"params\">(search,<span class=\"variable\">$str</span>[,int])</span></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"去除空格：\"><a href=\"#去除空格：\" class=\"headerlink\" title=\"去除空格：\"></a>去除空格：</h2><figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">ltrim:</span>去除字符串左边空格</span><br><span class=\"line\"><span class=\"symbol\">rtrim:</span>去除字符串右边边空格</span><br><span class=\"line\"><span class=\"symbol\">trim:</span>去除字符串两边空格</span><br></pre></td></tr></table></figure>\n<h2 id=\"加空格函数\"><a href=\"#加空格函数\" class=\"headerlink\" title=\"加空格函数\"></a>加空格函数</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">chunk_split($</span><span class=\"bash\">str,2);向<span class=\"variable\">$str</span>字符里面按2个字符就加入一个空格;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"返回指定的字符或ascii\"><a href=\"#返回指定的字符或ascii\" class=\"headerlink\" title=\"返回指定的字符或ascii\"></a>返回指定的字符或ascii</h2><figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">chr</span>、<span class=\"keyword\">ord</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"HTML代码有关函数\"><a href=\"#HTML代码有关函数\" class=\"headerlink\" title=\"HTML代码有关函数\"></a>HTML代码有关函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">nl2br</span><span class=\"params\">()</span></span>:使\\n转换为&lt;br&gt;。</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strip_tags</span><span class=\"params\">(<span class=\"variable\">$str</span>[,<span class=\"string\">'&lt;p&gt;'</span>])</span></span>:<span class=\"comment\">//去除HTML和PHP标记</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">htmlspecialchars</span><span class=\"params\">(<span class=\"variable\">$str</span>[,参数])</span></span>:<span class=\"comment\">//页面正常输出HTML代码参数是转换方式</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"字符大小写转换函数\"><a href=\"#字符大小写转换函数\" class=\"headerlink\" title=\"字符大小写转换函数\"></a>字符大小写转换函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">strtolower</span><span class=\"params\">(<span class=\"variable\">$str</span>)</span></span> :字符串转换为小写</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">strtoupper</span><span class=\"params\">(<span class=\"variable\">$str</span>)</span></span> :字符串转换为大写</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ucfirst</span><span class=\"params\">(<span class=\"variable\">$str</span>)</span></span> :将函数的第一个字符转换为大写</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ucwords</span><span class=\"params\">(<span class=\"variable\">$str</span>)</span></span> :将每个单词的首字母转换为大写</span><br></pre></td></tr></table></figure>\n<h2 id=\"数据库相关函数\"><a href=\"#数据库相关函数\" class=\"headerlink\" title=\"数据库相关函数\"></a>数据库相关函数</h2><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">addslashes($str):使str内单引号（'）、双引号（\"）、反斜线（\\）与 NUL字符串转换为\\',\\\",\\\\。</span></span><br><span class=\"line\">magic_quotes_gpc = On :自动对 get post cookie的内容进行转义</span><br><span class=\"line\"><span class=\"section\">get_magic_quotes_gpc（）:检测是否打开magic_quotes_gpc</span></span><br><span class=\"line\">stripslashes() :去除字符串中的反斜杠</span><br></pre></td></tr></table></figure>\n<h2 id=\"连接函数\"><a href=\"#连接函数\" class=\"headerlink\" title=\"连接函数\"></a>连接函数</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">implode</span><span class=\"params\">(str,<span class=\"variable\">$arr</span>)</span></span> :将字符串数组按指定字符连接成一个字符串；</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">implode</span><span class=\"params\">()</span></span>:函数有个别名函数join</span><br></pre></td></tr></table></figure>"},{"title":"PHP常用数组函数","date":"2017-11-13T11:49:52.000Z","_content":"\n本文包含有数组操作的基本函数、数组的分段和填充、数组与栈、数组与列队、回调函数、排序、计算、其他的数组函数共8个知识点，非常适合正在学习PHP的初学者\n<!-- more -->\n\n##\t数组操作的基本函数\n\n###\t1、数组的键名和值\n\narray_values($arr);获得数组的值\n\narray_keys($arr);获得数组的键名\n\narray_flip($arr);数组中的值与键名互换（如果有重复前面的会被后面的覆盖）\n\nin_array(\"apple\",$arr);在数组中检索apple\n\narray_search(\"apple\",$arr);在数组中检索apple ，如果存在返回键名\n\narray_key_exists(\"apple\",$arr);检索给定的键名是否存在数组中\n\nisset($arr[apple]):检索给定的键名是否存在数组中\n\n###\t2、数组的内部指针\n\ncurrent($arr);返回数组中的当前单元\n\npos($arr);返回数组中的当前单元\n\nkey($arr);返回数组中当前单元的键名\n\nprev($arr);将数组中的内部指针倒回一位\n\nnext($arr);将数组中的内部指针向前移动一位\n\nend($arr);将数组中的内部指针指向最后一个单元\n\nreset($arr;将数组中的内部指针指向第一个单元\n\neach($arr);将返回数组当前元素的一个键名/值的构造数组，并使数组指针向前移动一位\n\nlist($key,$value)=each($arr);获得数组当前元素的键名和值\n\n数组和变量之间的转换\n\nextract($arr);用于把数组中的元素转换成变量导入到当前文件中，键名当作变量名，值作为变量值\n\n注：（第二个参数很重要，可以看手册使用）使用方法  echo $a;\n\ncompact(var1,var2,var3);用给定的变量名创建一个数组\n\n##\t数组的分段和填充\n\n###\t1、数组的分段\n\narray_slice($arr,0,3);可以将数组中的一段取出，此函数忽略键名\n\narray_splice($arr,0,3，array(\"black\",\"maroon\"));可以将数组中的一段取出，与上个函数不同在于返回的序列从原数组中删除\n\n###\t2、分割多个数组\n\narray_chunk($arr,3,TRUE);可以将一个数组分割成多个，TRUE为保留原数组的键名\n\n###\t3、数组的填充\n\narray_pad($arr,5,'x');将一个数组填补到制定长度\n\n##\t数组与栈\n\narray_push($arr,\"apple\",\"pear\");将一个或多个元素压入数组栈的末尾（入栈），返回入栈元素的个数\n\narray_pop($arr);将数组栈的最后一个元素弹出（出栈）\n\n##\t数组与列队\n\narray_shift($arr);数组中的第一个元素移出并作为结果返回（数组长度减1，其他元素向前移动一位，数字键名改为从零技术，文字键名不变）\n\narray_unshift($arr,\"a\",array(1,2));在数组的开头插入一个或多个元素\n\n##\t回调函数\n\narray_walk($arr,'function','words');使用用户函数对数组中的每个成员进行处理（第三个参数传递给回调函数function）\n\narray_mpa(\"function\",$arr1,$arr2);可以处理多个数组（当使用两个或更多数组时，他们的长度应该相同）\n\narray_filter($arr,\"function\");使用回调函数过滤数组中的每个元素，如果回调函数为TRUE，数组的当前元素会被包含在返回的结果数组中，数组的键名保留不变\n\narray_reduce($arr,\"function\",\"*\");转化为单值函数（*为数组的第一个值）\n\n##\t数组的排序\n\n###\t1、通过元素值对数组排序\n\nsort($arr);由小到大的顺序排序（第二个参数为按什么方式排序）忽略键名的数组排序\n\nrsort($arr);由大到小的顺序排序（第二个参数为按什么方式排序）忽略键名的数组排序\n\nusort($arr,\"function\");使用用户自定义的比较函数对数组中的值进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）忽略键名的数组排序\n\nasort($arr);由小到大的顺序排序（第二个参数为按什么方式排序）保留键名的数组排序\n\narsort($arr);由大到小的顺序排序（第二个参数为按什么方式排序）保留键名的数组排序\n\nuasort($arr,\"function\");使用用户自定义的比较函数对数组中的值进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）保留键名的数组排序\n\n###\t2、通过键名对数组排序\n\nksort($arr);按照键名正序排序\n\nkrsort($arr);按照键名逆序排序\n\nuksort($arr,\"function\");使用用户自定义的比较函数对数组中的键名进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）\n\n###\t3、自然排序法排序\n\nnatsort($arr);自然排序（忽略键名）\n\nnatcasesort($arr);自然排序（忽略大小写，忽略键名）\n\n##\t数组的计算\n\n###\t1、数组元素的求和\n\narray_sum($arr);对数组内部的所有元素做求和运算\n\n###\t2、数组的合并\n\narray_merge($arr1,$arr2);合并两个或多个数组（相同的字符串键名，后面的覆盖前面的，相同的数字键名，后面的不会做覆盖操作，而是附加到后面）\n\n“+”$arr1+$arr2;对于相同的键名只保留后一个\n\narray_merge_recursive($arr1,$arr2); 递归合并操作，如果数组中有相同的字符串键名，这些值将被合并到一个数组中去。如果一个值本身是一个数组，将按照相应的键名把它合并为另一个数组。当数组 具有相同的数组键名时，后一个值将不会覆盖原来的值，而是附加到后面\n\n###\t3、数组的差集\n\narray_diff($arr1,$arr2);返回差集结果数组\n\narray_diff_assoc($arr1,$arr2,$arr3);返回差集结果数组，键名也做比较\n\n###\t4、数组的交集\n\narray_intersect($arr1,$arr2);返回交集结果数组\n\narray_intersect_assoc($arr1,$arr2);返回交集结果数组，键名也做比较\n\n##\t其他的数组函数\n\nrange(0,12);创建一个包含指定范围单元的数组\n\narray_unique($arr);移除数组中重复的值，新的数组中会保留原始的键名\n\narray_reverse($arr,TRUE);返回一个单元顺序与原数组相反的数组，如果第二个参数为TRUE保留原来的键名\n\nsrand((float)microtime()*10000000);\t 随机种子触发器\n\narray_rand($arr,2);从数组中随机取出一个或 多个元素\n\nshuffle($arr);将数组的顺序打乱\n\n本类函数允许用多种方法来操作数组和与之交互。数组的本质是储存，管理和操作一组变量。\n\nPHP 支持一维和多维数组，可以是用户创建或由另一个函数创建。有一些特定的数据库处理函数可以从数据库查询中生成数组，还有一些函数返回数组。\n\narray_change_key_case — 返回字符串键名全为小写或大写的数组\n\narray_chunk — 将一个数组分割成多个\n\narray_combine — 创建一个数组，用一个数组的值作为其键名，另一个数组的值作为其值\n\narray_count_values — 统计数组中所有的值出现的次数\n\narray_diff_assoc — 带索引检查计算数组的差集\n\narray_diff_key — 使用键名比较计算数组的差集\n\narray_diff_uassoc — 用用户提供的回调函数做索引检查来计算数组的差集\n\narray_diff_ukey — 用回调函数对键名比较计算数组的差集\n\narray_diff — 计算数组的差集\n\narray_fill_keys — Fill an array with values, specifying keys\n\narray_fill — 用给定的值填充数组\n\narray_filter — 用回调函数过滤数组中的单元\n\narray_flip — 交换数组中的键和值\n\narray_intersect_assoc — 带索引检查计算数组的交集\n\narray_intersect_key — 使用键名比较计算数组的交集\n\narray_intersect_uassoc — 带索引检查计算数组的交集，用回调函数比较索引\n\narray_intersect_ukey — 用回调函数比较键名来计算数组的交集\n\narray_intersect — 计算数组的交集\n\narray_key_exists — 检查给定的键名或索引是否存在于数组中\n\narray_keys — 返回数组中所有的键名\n\narray_map — 将回调函数作用到给定数组的单元上\n\narray_merge_recursive — 递归地合并一个或多个数组\n\narray_merge — 合并一个或多个数组\n\narray_multisort — 对多个数组或多维数组进行排序\n\narray_pad — 用值将数组填补到指定长度\n\narray_pop — 将数组最后一个单元弹出（出栈）\n\narray_product — 计算数组中所有值的乘积\n\narray_push — 将一个或多个单元压入数组的末尾（入栈）\n\narray_rand — 从数组中随机取出一个或多个单元\n\narray_reduce — 用回调函数迭代地将数组简化为单一的值\n\narray_reverse — 返回一个单元顺序相反的数组\n\narray_search — 在数组中搜索给定的值，如果成功则返回相应的键名\n\narray_shift — 将数组开头的单元移出数组\n\narray_slice — 从数组中取出一段\n\narray_splice — 把数组中的一部分去掉并用其它值取代\n\narray_sum — 计算数组中所有值的和\n\narray_udiff_assoc — 带索引检查计算数组的差集，用回调函数比较数据\n\narray_udiff_uassoc — 带索引检查计算数组的差集，用回调函数比较数据和索引\n\narray_udiff — 用回调函数比较数据来计算数组的差集\n\narray_uintersect_assoc — 带索引检查计算数组的交集，用回调函数比较数据\n\narray_uintersect_uassoc — 带索引检查计算数组的交集，用回调函数比较数据和索引\n\narray_uintersect — 计算数组的交集，用回调函数比较数据\n\narray_unique — 移除数组中重复的值\n\narray_unshift — 在数组开头插入一个或多个单元\n\narray_values — 返回数组中所有的值\n\narray_walk_recursive — 对数组中的每个成员递归地应用用户函数\n\narray_walk — 对数组中的每个成员应用用户函数\n\narray — 新建一个数组\n\narsort — 对数组进行逆向排序并保持索引关系\n\nasort — 对数组进行排序并保持索引关系\n\ncompact — 建立一个数组，包括变量名和它们的值\n\ncount — 计算数组中的单元数目或对象中的属性个数\n\ncurrent — 返回数组中的当前单元\n\neach — 返回数组中当前的键／值对并将数组指针向前移动一步\n\nend — 将数组的内部指针指向最后一个单元\n\nextract — 从数组中将变量导入到当前的符号表\n\nin_array — 检查数组中是否存在某个值\n\nkey — 从关联数组中取得键名\n\nkrsort — 对数组按照键名逆向排序\n\nksort — 对数组按照键名排序\n\nlist — 把数组中的值赋给一些变量\n\nnatcasesort — 用“自然排序”算法对数组进行不区分大小写字母的排序\n\nnatsort — 用“自然排序”算法对数组排序\n\nnext — 将数组中的内部指针向前移动一位\n\npos — current() 的别名\n\nprev — 将数组的内部指针倒回一位\n\nrange — 建立一个包含指定范围单元的数组\n\nreset — 将数组的内部指针指向第一个单元\n\nrsort — 对数组逆向排序\n\nshuffle — 将数组打乱\n\nsizeof — count() 的别名\n\nsort — 对数组排序\n\nuasort — 使用用户自定义的比较函数对数组中的值进行排序并保持索引关联\n\nuksort — 使用用户自定义的比较函数对数组中的键名进行排序\n\nusort — 使用用户自定义的比较函数对数组中的值进行排序\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/PHP常用数组函数.md","raw":"---\ntitle: PHP常用数组函数\ndate: 2017-11-13 19:49:52\ntags: PHP\ncategories: PHP\n---\n\n本文包含有数组操作的基本函数、数组的分段和填充、数组与栈、数组与列队、回调函数、排序、计算、其他的数组函数共8个知识点，非常适合正在学习PHP的初学者\n<!-- more -->\n\n##\t数组操作的基本函数\n\n###\t1、数组的键名和值\n\narray_values($arr);获得数组的值\n\narray_keys($arr);获得数组的键名\n\narray_flip($arr);数组中的值与键名互换（如果有重复前面的会被后面的覆盖）\n\nin_array(\"apple\",$arr);在数组中检索apple\n\narray_search(\"apple\",$arr);在数组中检索apple ，如果存在返回键名\n\narray_key_exists(\"apple\",$arr);检索给定的键名是否存在数组中\n\nisset($arr[apple]):检索给定的键名是否存在数组中\n\n###\t2、数组的内部指针\n\ncurrent($arr);返回数组中的当前单元\n\npos($arr);返回数组中的当前单元\n\nkey($arr);返回数组中当前单元的键名\n\nprev($arr);将数组中的内部指针倒回一位\n\nnext($arr);将数组中的内部指针向前移动一位\n\nend($arr);将数组中的内部指针指向最后一个单元\n\nreset($arr;将数组中的内部指针指向第一个单元\n\neach($arr);将返回数组当前元素的一个键名/值的构造数组，并使数组指针向前移动一位\n\nlist($key,$value)=each($arr);获得数组当前元素的键名和值\n\n数组和变量之间的转换\n\nextract($arr);用于把数组中的元素转换成变量导入到当前文件中，键名当作变量名，值作为变量值\n\n注：（第二个参数很重要，可以看手册使用）使用方法  echo $a;\n\ncompact(var1,var2,var3);用给定的变量名创建一个数组\n\n##\t数组的分段和填充\n\n###\t1、数组的分段\n\narray_slice($arr,0,3);可以将数组中的一段取出，此函数忽略键名\n\narray_splice($arr,0,3，array(\"black\",\"maroon\"));可以将数组中的一段取出，与上个函数不同在于返回的序列从原数组中删除\n\n###\t2、分割多个数组\n\narray_chunk($arr,3,TRUE);可以将一个数组分割成多个，TRUE为保留原数组的键名\n\n###\t3、数组的填充\n\narray_pad($arr,5,'x');将一个数组填补到制定长度\n\n##\t数组与栈\n\narray_push($arr,\"apple\",\"pear\");将一个或多个元素压入数组栈的末尾（入栈），返回入栈元素的个数\n\narray_pop($arr);将数组栈的最后一个元素弹出（出栈）\n\n##\t数组与列队\n\narray_shift($arr);数组中的第一个元素移出并作为结果返回（数组长度减1，其他元素向前移动一位，数字键名改为从零技术，文字键名不变）\n\narray_unshift($arr,\"a\",array(1,2));在数组的开头插入一个或多个元素\n\n##\t回调函数\n\narray_walk($arr,'function','words');使用用户函数对数组中的每个成员进行处理（第三个参数传递给回调函数function）\n\narray_mpa(\"function\",$arr1,$arr2);可以处理多个数组（当使用两个或更多数组时，他们的长度应该相同）\n\narray_filter($arr,\"function\");使用回调函数过滤数组中的每个元素，如果回调函数为TRUE，数组的当前元素会被包含在返回的结果数组中，数组的键名保留不变\n\narray_reduce($arr,\"function\",\"*\");转化为单值函数（*为数组的第一个值）\n\n##\t数组的排序\n\n###\t1、通过元素值对数组排序\n\nsort($arr);由小到大的顺序排序（第二个参数为按什么方式排序）忽略键名的数组排序\n\nrsort($arr);由大到小的顺序排序（第二个参数为按什么方式排序）忽略键名的数组排序\n\nusort($arr,\"function\");使用用户自定义的比较函数对数组中的值进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）忽略键名的数组排序\n\nasort($arr);由小到大的顺序排序（第二个参数为按什么方式排序）保留键名的数组排序\n\narsort($arr);由大到小的顺序排序（第二个参数为按什么方式排序）保留键名的数组排序\n\nuasort($arr,\"function\");使用用户自定义的比较函数对数组中的值进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）保留键名的数组排序\n\n###\t2、通过键名对数组排序\n\nksort($arr);按照键名正序排序\n\nkrsort($arr);按照键名逆序排序\n\nuksort($arr,\"function\");使用用户自定义的比较函数对数组中的键名进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）\n\n###\t3、自然排序法排序\n\nnatsort($arr);自然排序（忽略键名）\n\nnatcasesort($arr);自然排序（忽略大小写，忽略键名）\n\n##\t数组的计算\n\n###\t1、数组元素的求和\n\narray_sum($arr);对数组内部的所有元素做求和运算\n\n###\t2、数组的合并\n\narray_merge($arr1,$arr2);合并两个或多个数组（相同的字符串键名，后面的覆盖前面的，相同的数字键名，后面的不会做覆盖操作，而是附加到后面）\n\n“+”$arr1+$arr2;对于相同的键名只保留后一个\n\narray_merge_recursive($arr1,$arr2); 递归合并操作，如果数组中有相同的字符串键名，这些值将被合并到一个数组中去。如果一个值本身是一个数组，将按照相应的键名把它合并为另一个数组。当数组 具有相同的数组键名时，后一个值将不会覆盖原来的值，而是附加到后面\n\n###\t3、数组的差集\n\narray_diff($arr1,$arr2);返回差集结果数组\n\narray_diff_assoc($arr1,$arr2,$arr3);返回差集结果数组，键名也做比较\n\n###\t4、数组的交集\n\narray_intersect($arr1,$arr2);返回交集结果数组\n\narray_intersect_assoc($arr1,$arr2);返回交集结果数组，键名也做比较\n\n##\t其他的数组函数\n\nrange(0,12);创建一个包含指定范围单元的数组\n\narray_unique($arr);移除数组中重复的值，新的数组中会保留原始的键名\n\narray_reverse($arr,TRUE);返回一个单元顺序与原数组相反的数组，如果第二个参数为TRUE保留原来的键名\n\nsrand((float)microtime()*10000000);\t 随机种子触发器\n\narray_rand($arr,2);从数组中随机取出一个或 多个元素\n\nshuffle($arr);将数组的顺序打乱\n\n本类函数允许用多种方法来操作数组和与之交互。数组的本质是储存，管理和操作一组变量。\n\nPHP 支持一维和多维数组，可以是用户创建或由另一个函数创建。有一些特定的数据库处理函数可以从数据库查询中生成数组，还有一些函数返回数组。\n\narray_change_key_case — 返回字符串键名全为小写或大写的数组\n\narray_chunk — 将一个数组分割成多个\n\narray_combine — 创建一个数组，用一个数组的值作为其键名，另一个数组的值作为其值\n\narray_count_values — 统计数组中所有的值出现的次数\n\narray_diff_assoc — 带索引检查计算数组的差集\n\narray_diff_key — 使用键名比较计算数组的差集\n\narray_diff_uassoc — 用用户提供的回调函数做索引检查来计算数组的差集\n\narray_diff_ukey — 用回调函数对键名比较计算数组的差集\n\narray_diff — 计算数组的差集\n\narray_fill_keys — Fill an array with values, specifying keys\n\narray_fill — 用给定的值填充数组\n\narray_filter — 用回调函数过滤数组中的单元\n\narray_flip — 交换数组中的键和值\n\narray_intersect_assoc — 带索引检查计算数组的交集\n\narray_intersect_key — 使用键名比较计算数组的交集\n\narray_intersect_uassoc — 带索引检查计算数组的交集，用回调函数比较索引\n\narray_intersect_ukey — 用回调函数比较键名来计算数组的交集\n\narray_intersect — 计算数组的交集\n\narray_key_exists — 检查给定的键名或索引是否存在于数组中\n\narray_keys — 返回数组中所有的键名\n\narray_map — 将回调函数作用到给定数组的单元上\n\narray_merge_recursive — 递归地合并一个或多个数组\n\narray_merge — 合并一个或多个数组\n\narray_multisort — 对多个数组或多维数组进行排序\n\narray_pad — 用值将数组填补到指定长度\n\narray_pop — 将数组最后一个单元弹出（出栈）\n\narray_product — 计算数组中所有值的乘积\n\narray_push — 将一个或多个单元压入数组的末尾（入栈）\n\narray_rand — 从数组中随机取出一个或多个单元\n\narray_reduce — 用回调函数迭代地将数组简化为单一的值\n\narray_reverse — 返回一个单元顺序相反的数组\n\narray_search — 在数组中搜索给定的值，如果成功则返回相应的键名\n\narray_shift — 将数组开头的单元移出数组\n\narray_slice — 从数组中取出一段\n\narray_splice — 把数组中的一部分去掉并用其它值取代\n\narray_sum — 计算数组中所有值的和\n\narray_udiff_assoc — 带索引检查计算数组的差集，用回调函数比较数据\n\narray_udiff_uassoc — 带索引检查计算数组的差集，用回调函数比较数据和索引\n\narray_udiff — 用回调函数比较数据来计算数组的差集\n\narray_uintersect_assoc — 带索引检查计算数组的交集，用回调函数比较数据\n\narray_uintersect_uassoc — 带索引检查计算数组的交集，用回调函数比较数据和索引\n\narray_uintersect — 计算数组的交集，用回调函数比较数据\n\narray_unique — 移除数组中重复的值\n\narray_unshift — 在数组开头插入一个或多个单元\n\narray_values — 返回数组中所有的值\n\narray_walk_recursive — 对数组中的每个成员递归地应用用户函数\n\narray_walk — 对数组中的每个成员应用用户函数\n\narray — 新建一个数组\n\narsort — 对数组进行逆向排序并保持索引关系\n\nasort — 对数组进行排序并保持索引关系\n\ncompact — 建立一个数组，包括变量名和它们的值\n\ncount — 计算数组中的单元数目或对象中的属性个数\n\ncurrent — 返回数组中的当前单元\n\neach — 返回数组中当前的键／值对并将数组指针向前移动一步\n\nend — 将数组的内部指针指向最后一个单元\n\nextract — 从数组中将变量导入到当前的符号表\n\nin_array — 检查数组中是否存在某个值\n\nkey — 从关联数组中取得键名\n\nkrsort — 对数组按照键名逆向排序\n\nksort — 对数组按照键名排序\n\nlist — 把数组中的值赋给一些变量\n\nnatcasesort — 用“自然排序”算法对数组进行不区分大小写字母的排序\n\nnatsort — 用“自然排序”算法对数组排序\n\nnext — 将数组中的内部指针向前移动一位\n\npos — current() 的别名\n\nprev — 将数组的内部指针倒回一位\n\nrange — 建立一个包含指定范围单元的数组\n\nreset — 将数组的内部指针指向第一个单元\n\nrsort — 对数组逆向排序\n\nshuffle — 将数组打乱\n\nsizeof — count() 的别名\n\nsort — 对数组排序\n\nuasort — 使用用户自定义的比较函数对数组中的值进行排序并保持索引关联\n\nuksort — 使用用户自定义的比较函数对数组中的键名进行排序\n\nusort — 使用用户自定义的比较函数对数组中的值进行排序\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"PHP常用数组函数","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuwf000fydqnup6jwb71","content":"<p>本文包含有数组操作的基本函数、数组的分段和填充、数组与栈、数组与列队、回调函数、排序、计算、其他的数组函数共8个知识点，非常适合正在学习PHP的初学者<br><a id=\"more\"></a></p>\n<h2 id=\"数组操作的基本函数\"><a href=\"#数组操作的基本函数\" class=\"headerlink\" title=\"数组操作的基本函数\"></a>数组操作的基本函数</h2><h3 id=\"1、数组的键名和值\"><a href=\"#1、数组的键名和值\" class=\"headerlink\" title=\"1、数组的键名和值\"></a>1、数组的键名和值</h3><p>array_values($arr);获得数组的值</p>\n<p>array_keys($arr);获得数组的键名</p>\n<p>array_flip($arr);数组中的值与键名互换（如果有重复前面的会被后面的覆盖）</p>\n<p>in_array(“apple”,$arr);在数组中检索apple</p>\n<p>array_search(“apple”,$arr);在数组中检索apple ，如果存在返回键名</p>\n<p>array_key_exists(“apple”,$arr);检索给定的键名是否存在数组中</p>\n<p>isset($arr[apple]):检索给定的键名是否存在数组中</p>\n<h3 id=\"2、数组的内部指针\"><a href=\"#2、数组的内部指针\" class=\"headerlink\" title=\"2、数组的内部指针\"></a>2、数组的内部指针</h3><p>current($arr);返回数组中的当前单元</p>\n<p>pos($arr);返回数组中的当前单元</p>\n<p>key($arr);返回数组中当前单元的键名</p>\n<p>prev($arr);将数组中的内部指针倒回一位</p>\n<p>next($arr);将数组中的内部指针向前移动一位</p>\n<p>end($arr);将数组中的内部指针指向最后一个单元</p>\n<p>reset($arr;将数组中的内部指针指向第一个单元</p>\n<p>each($arr);将返回数组当前元素的一个键名/值的构造数组，并使数组指针向前移动一位</p>\n<p>list($key,$value)=each($arr);获得数组当前元素的键名和值</p>\n<p>数组和变量之间的转换</p>\n<p>extract($arr);用于把数组中的元素转换成变量导入到当前文件中，键名当作变量名，值作为变量值</p>\n<p>注：（第二个参数很重要，可以看手册使用）使用方法  echo $a;</p>\n<p>compact(var1,var2,var3);用给定的变量名创建一个数组</p>\n<h2 id=\"数组的分段和填充\"><a href=\"#数组的分段和填充\" class=\"headerlink\" title=\"数组的分段和填充\"></a>数组的分段和填充</h2><h3 id=\"1、数组的分段\"><a href=\"#1、数组的分段\" class=\"headerlink\" title=\"1、数组的分段\"></a>1、数组的分段</h3><p>array_slice($arr,0,3);可以将数组中的一段取出，此函数忽略键名</p>\n<p>array_splice($arr,0,3，array(“black”,”maroon”));可以将数组中的一段取出，与上个函数不同在于返回的序列从原数组中删除</p>\n<h3 id=\"2、分割多个数组\"><a href=\"#2、分割多个数组\" class=\"headerlink\" title=\"2、分割多个数组\"></a>2、分割多个数组</h3><p>array_chunk($arr,3,TRUE);可以将一个数组分割成多个，TRUE为保留原数组的键名</p>\n<h3 id=\"3、数组的填充\"><a href=\"#3、数组的填充\" class=\"headerlink\" title=\"3、数组的填充\"></a>3、数组的填充</h3><p>array_pad($arr,5,’x’);将一个数组填补到制定长度</p>\n<h2 id=\"数组与栈\"><a href=\"#数组与栈\" class=\"headerlink\" title=\"数组与栈\"></a>数组与栈</h2><p>array_push($arr,”apple”,”pear”);将一个或多个元素压入数组栈的末尾（入栈），返回入栈元素的个数</p>\n<p>array_pop($arr);将数组栈的最后一个元素弹出（出栈）</p>\n<h2 id=\"数组与列队\"><a href=\"#数组与列队\" class=\"headerlink\" title=\"数组与列队\"></a>数组与列队</h2><p>array_shift($arr);数组中的第一个元素移出并作为结果返回（数组长度减1，其他元素向前移动一位，数字键名改为从零技术，文字键名不变）</p>\n<p>array_unshift($arr,”a”,array(1,2));在数组的开头插入一个或多个元素</p>\n<h2 id=\"回调函数\"><a href=\"#回调函数\" class=\"headerlink\" title=\"回调函数\"></a>回调函数</h2><p>array_walk($arr,’function’,’words’);使用用户函数对数组中的每个成员进行处理（第三个参数传递给回调函数function）</p>\n<p>array_mpa(“function”,$arr1,$arr2);可以处理多个数组（当使用两个或更多数组时，他们的长度应该相同）</p>\n<p>array_filter($arr,”function”);使用回调函数过滤数组中的每个元素，如果回调函数为TRUE，数组的当前元素会被包含在返回的结果数组中，数组的键名保留不变</p>\n<p>array_reduce($arr,”function”,”<em>“);转化为单值函数（</em>为数组的第一个值）</p>\n<h2 id=\"数组的排序\"><a href=\"#数组的排序\" class=\"headerlink\" title=\"数组的排序\"></a>数组的排序</h2><h3 id=\"1、通过元素值对数组排序\"><a href=\"#1、通过元素值对数组排序\" class=\"headerlink\" title=\"1、通过元素值对数组排序\"></a>1、通过元素值对数组排序</h3><p>sort($arr);由小到大的顺序排序（第二个参数为按什么方式排序）忽略键名的数组排序</p>\n<p>rsort($arr);由大到小的顺序排序（第二个参数为按什么方式排序）忽略键名的数组排序</p>\n<p>usort($arr,”function”);使用用户自定义的比较函数对数组中的值进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）忽略键名的数组排序</p>\n<p>asort($arr);由小到大的顺序排序（第二个参数为按什么方式排序）保留键名的数组排序</p>\n<p>arsort($arr);由大到小的顺序排序（第二个参数为按什么方式排序）保留键名的数组排序</p>\n<p>uasort($arr,”function”);使用用户自定义的比较函数对数组中的值进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）保留键名的数组排序</p>\n<h3 id=\"2、通过键名对数组排序\"><a href=\"#2、通过键名对数组排序\" class=\"headerlink\" title=\"2、通过键名对数组排序\"></a>2、通过键名对数组排序</h3><p>ksort($arr);按照键名正序排序</p>\n<p>krsort($arr);按照键名逆序排序</p>\n<p>uksort($arr,”function”);使用用户自定义的比较函数对数组中的键名进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）</p>\n<h3 id=\"3、自然排序法排序\"><a href=\"#3、自然排序法排序\" class=\"headerlink\" title=\"3、自然排序法排序\"></a>3、自然排序法排序</h3><p>natsort($arr);自然排序（忽略键名）</p>\n<p>natcasesort($arr);自然排序（忽略大小写，忽略键名）</p>\n<h2 id=\"数组的计算\"><a href=\"#数组的计算\" class=\"headerlink\" title=\"数组的计算\"></a>数组的计算</h2><h3 id=\"1、数组元素的求和\"><a href=\"#1、数组元素的求和\" class=\"headerlink\" title=\"1、数组元素的求和\"></a>1、数组元素的求和</h3><p>array_sum($arr);对数组内部的所有元素做求和运算</p>\n<h3 id=\"2、数组的合并\"><a href=\"#2、数组的合并\" class=\"headerlink\" title=\"2、数组的合并\"></a>2、数组的合并</h3><p>array_merge($arr1,$arr2);合并两个或多个数组（相同的字符串键名，后面的覆盖前面的，相同的数字键名，后面的不会做覆盖操作，而是附加到后面）</p>\n<p>“+”$arr1+$arr2;对于相同的键名只保留后一个</p>\n<p>array_merge_recursive($arr1,$arr2); 递归合并操作，如果数组中有相同的字符串键名，这些值将被合并到一个数组中去。如果一个值本身是一个数组，将按照相应的键名把它合并为另一个数组。当数组 具有相同的数组键名时，后一个值将不会覆盖原来的值，而是附加到后面</p>\n<h3 id=\"3、数组的差集\"><a href=\"#3、数组的差集\" class=\"headerlink\" title=\"3、数组的差集\"></a>3、数组的差集</h3><p>array_diff($arr1,$arr2);返回差集结果数组</p>\n<p>array_diff_assoc($arr1,$arr2,$arr3);返回差集结果数组，键名也做比较</p>\n<h3 id=\"4、数组的交集\"><a href=\"#4、数组的交集\" class=\"headerlink\" title=\"4、数组的交集\"></a>4、数组的交集</h3><p>array_intersect($arr1,$arr2);返回交集结果数组</p>\n<p>array_intersect_assoc($arr1,$arr2);返回交集结果数组，键名也做比较</p>\n<h2 id=\"其他的数组函数\"><a href=\"#其他的数组函数\" class=\"headerlink\" title=\"其他的数组函数\"></a>其他的数组函数</h2><p>range(0,12);创建一个包含指定范围单元的数组</p>\n<p>array_unique($arr);移除数组中重复的值，新的数组中会保留原始的键名</p>\n<p>array_reverse($arr,TRUE);返回一个单元顺序与原数组相反的数组，如果第二个参数为TRUE保留原来的键名</p>\n<p>srand((float)microtime()*10000000);     随机种子触发器</p>\n<p>array_rand($arr,2);从数组中随机取出一个或 多个元素</p>\n<p>shuffle($arr);将数组的顺序打乱</p>\n<p>本类函数允许用多种方法来操作数组和与之交互。数组的本质是储存，管理和操作一组变量。</p>\n<p>PHP 支持一维和多维数组，可以是用户创建或由另一个函数创建。有一些特定的数据库处理函数可以从数据库查询中生成数组，还有一些函数返回数组。</p>\n<p>array_change_key_case — 返回字符串键名全为小写或大写的数组</p>\n<p>array_chunk — 将一个数组分割成多个</p>\n<p>array_combine — 创建一个数组，用一个数组的值作为其键名，另一个数组的值作为其值</p>\n<p>array_count_values — 统计数组中所有的值出现的次数</p>\n<p>array_diff_assoc — 带索引检查计算数组的差集</p>\n<p>array_diff_key — 使用键名比较计算数组的差集</p>\n<p>array_diff_uassoc — 用用户提供的回调函数做索引检查来计算数组的差集</p>\n<p>array_diff_ukey — 用回调函数对键名比较计算数组的差集</p>\n<p>array_diff — 计算数组的差集</p>\n<p>array_fill_keys — Fill an array with values, specifying keys</p>\n<p>array_fill — 用给定的值填充数组</p>\n<p>array_filter — 用回调函数过滤数组中的单元</p>\n<p>array_flip — 交换数组中的键和值</p>\n<p>array_intersect_assoc — 带索引检查计算数组的交集</p>\n<p>array_intersect_key — 使用键名比较计算数组的交集</p>\n<p>array_intersect_uassoc — 带索引检查计算数组的交集，用回调函数比较索引</p>\n<p>array_intersect_ukey — 用回调函数比较键名来计算数组的交集</p>\n<p>array_intersect — 计算数组的交集</p>\n<p>array_key_exists — 检查给定的键名或索引是否存在于数组中</p>\n<p>array_keys — 返回数组中所有的键名</p>\n<p>array_map — 将回调函数作用到给定数组的单元上</p>\n<p>array_merge_recursive — 递归地合并一个或多个数组</p>\n<p>array_merge — 合并一个或多个数组</p>\n<p>array_multisort — 对多个数组或多维数组进行排序</p>\n<p>array_pad — 用值将数组填补到指定长度</p>\n<p>array_pop — 将数组最后一个单元弹出（出栈）</p>\n<p>array_product — 计算数组中所有值的乘积</p>\n<p>array_push — 将一个或多个单元压入数组的末尾（入栈）</p>\n<p>array_rand — 从数组中随机取出一个或多个单元</p>\n<p>array_reduce — 用回调函数迭代地将数组简化为单一的值</p>\n<p>array_reverse — 返回一个单元顺序相反的数组</p>\n<p>array_search — 在数组中搜索给定的值，如果成功则返回相应的键名</p>\n<p>array_shift — 将数组开头的单元移出数组</p>\n<p>array_slice — 从数组中取出一段</p>\n<p>array_splice — 把数组中的一部分去掉并用其它值取代</p>\n<p>array_sum — 计算数组中所有值的和</p>\n<p>array_udiff_assoc — 带索引检查计算数组的差集，用回调函数比较数据</p>\n<p>array_udiff_uassoc — 带索引检查计算数组的差集，用回调函数比较数据和索引</p>\n<p>array_udiff — 用回调函数比较数据来计算数组的差集</p>\n<p>array_uintersect_assoc — 带索引检查计算数组的交集，用回调函数比较数据</p>\n<p>array_uintersect_uassoc — 带索引检查计算数组的交集，用回调函数比较数据和索引</p>\n<p>array_uintersect — 计算数组的交集，用回调函数比较数据</p>\n<p>array_unique — 移除数组中重复的值</p>\n<p>array_unshift — 在数组开头插入一个或多个单元</p>\n<p>array_values — 返回数组中所有的值</p>\n<p>array_walk_recursive — 对数组中的每个成员递归地应用用户函数</p>\n<p>array_walk — 对数组中的每个成员应用用户函数</p>\n<p>array — 新建一个数组</p>\n<p>arsort — 对数组进行逆向排序并保持索引关系</p>\n<p>asort — 对数组进行排序并保持索引关系</p>\n<p>compact — 建立一个数组，包括变量名和它们的值</p>\n<p>count — 计算数组中的单元数目或对象中的属性个数</p>\n<p>current — 返回数组中的当前单元</p>\n<p>each — 返回数组中当前的键／值对并将数组指针向前移动一步</p>\n<p>end — 将数组的内部指针指向最后一个单元</p>\n<p>extract — 从数组中将变量导入到当前的符号表</p>\n<p>in_array — 检查数组中是否存在某个值</p>\n<p>key — 从关联数组中取得键名</p>\n<p>krsort — 对数组按照键名逆向排序</p>\n<p>ksort — 对数组按照键名排序</p>\n<p>list — 把数组中的值赋给一些变量</p>\n<p>natcasesort — 用“自然排序”算法对数组进行不区分大小写字母的排序</p>\n<p>natsort — 用“自然排序”算法对数组排序</p>\n<p>next — 将数组中的内部指针向前移动一位</p>\n<p>pos — current() 的别名</p>\n<p>prev — 将数组的内部指针倒回一位</p>\n<p>range — 建立一个包含指定范围单元的数组</p>\n<p>reset — 将数组的内部指针指向第一个单元</p>\n<p>rsort — 对数组逆向排序</p>\n<p>shuffle — 将数组打乱</p>\n<p>sizeof — count() 的别名</p>\n<p>sort — 对数组排序</p>\n<p>uasort — 使用用户自定义的比较函数对数组中的值进行排序并保持索引关联</p>\n<p>uksort — 使用用户自定义的比较函数对数组中的键名进行排序</p>\n<p>usort — 使用用户自定义的比较函数对数组中的值进行排序</p>\n","site":{"data":{}},"excerpt":"<p>本文包含有数组操作的基本函数、数组的分段和填充、数组与栈、数组与列队、回调函数、排序、计算、其他的数组函数共8个知识点，非常适合正在学习PHP的初学者<br>","more":"</p>\n<h2 id=\"数组操作的基本函数\"><a href=\"#数组操作的基本函数\" class=\"headerlink\" title=\"数组操作的基本函数\"></a>数组操作的基本函数</h2><h3 id=\"1、数组的键名和值\"><a href=\"#1、数组的键名和值\" class=\"headerlink\" title=\"1、数组的键名和值\"></a>1、数组的键名和值</h3><p>array_values($arr);获得数组的值</p>\n<p>array_keys($arr);获得数组的键名</p>\n<p>array_flip($arr);数组中的值与键名互换（如果有重复前面的会被后面的覆盖）</p>\n<p>in_array(“apple”,$arr);在数组中检索apple</p>\n<p>array_search(“apple”,$arr);在数组中检索apple ，如果存在返回键名</p>\n<p>array_key_exists(“apple”,$arr);检索给定的键名是否存在数组中</p>\n<p>isset($arr[apple]):检索给定的键名是否存在数组中</p>\n<h3 id=\"2、数组的内部指针\"><a href=\"#2、数组的内部指针\" class=\"headerlink\" title=\"2、数组的内部指针\"></a>2、数组的内部指针</h3><p>current($arr);返回数组中的当前单元</p>\n<p>pos($arr);返回数组中的当前单元</p>\n<p>key($arr);返回数组中当前单元的键名</p>\n<p>prev($arr);将数组中的内部指针倒回一位</p>\n<p>next($arr);将数组中的内部指针向前移动一位</p>\n<p>end($arr);将数组中的内部指针指向最后一个单元</p>\n<p>reset($arr;将数组中的内部指针指向第一个单元</p>\n<p>each($arr);将返回数组当前元素的一个键名/值的构造数组，并使数组指针向前移动一位</p>\n<p>list($key,$value)=each($arr);获得数组当前元素的键名和值</p>\n<p>数组和变量之间的转换</p>\n<p>extract($arr);用于把数组中的元素转换成变量导入到当前文件中，键名当作变量名，值作为变量值</p>\n<p>注：（第二个参数很重要，可以看手册使用）使用方法  echo $a;</p>\n<p>compact(var1,var2,var3);用给定的变量名创建一个数组</p>\n<h2 id=\"数组的分段和填充\"><a href=\"#数组的分段和填充\" class=\"headerlink\" title=\"数组的分段和填充\"></a>数组的分段和填充</h2><h3 id=\"1、数组的分段\"><a href=\"#1、数组的分段\" class=\"headerlink\" title=\"1、数组的分段\"></a>1、数组的分段</h3><p>array_slice($arr,0,3);可以将数组中的一段取出，此函数忽略键名</p>\n<p>array_splice($arr,0,3，array(“black”,”maroon”));可以将数组中的一段取出，与上个函数不同在于返回的序列从原数组中删除</p>\n<h3 id=\"2、分割多个数组\"><a href=\"#2、分割多个数组\" class=\"headerlink\" title=\"2、分割多个数组\"></a>2、分割多个数组</h3><p>array_chunk($arr,3,TRUE);可以将一个数组分割成多个，TRUE为保留原数组的键名</p>\n<h3 id=\"3、数组的填充\"><a href=\"#3、数组的填充\" class=\"headerlink\" title=\"3、数组的填充\"></a>3、数组的填充</h3><p>array_pad($arr,5,’x’);将一个数组填补到制定长度</p>\n<h2 id=\"数组与栈\"><a href=\"#数组与栈\" class=\"headerlink\" title=\"数组与栈\"></a>数组与栈</h2><p>array_push($arr,”apple”,”pear”);将一个或多个元素压入数组栈的末尾（入栈），返回入栈元素的个数</p>\n<p>array_pop($arr);将数组栈的最后一个元素弹出（出栈）</p>\n<h2 id=\"数组与列队\"><a href=\"#数组与列队\" class=\"headerlink\" title=\"数组与列队\"></a>数组与列队</h2><p>array_shift($arr);数组中的第一个元素移出并作为结果返回（数组长度减1，其他元素向前移动一位，数字键名改为从零技术，文字键名不变）</p>\n<p>array_unshift($arr,”a”,array(1,2));在数组的开头插入一个或多个元素</p>\n<h2 id=\"回调函数\"><a href=\"#回调函数\" class=\"headerlink\" title=\"回调函数\"></a>回调函数</h2><p>array_walk($arr,’function’,’words’);使用用户函数对数组中的每个成员进行处理（第三个参数传递给回调函数function）</p>\n<p>array_mpa(“function”,$arr1,$arr2);可以处理多个数组（当使用两个或更多数组时，他们的长度应该相同）</p>\n<p>array_filter($arr,”function”);使用回调函数过滤数组中的每个元素，如果回调函数为TRUE，数组的当前元素会被包含在返回的结果数组中，数组的键名保留不变</p>\n<p>array_reduce($arr,”function”,”<em>“);转化为单值函数（</em>为数组的第一个值）</p>\n<h2 id=\"数组的排序\"><a href=\"#数组的排序\" class=\"headerlink\" title=\"数组的排序\"></a>数组的排序</h2><h3 id=\"1、通过元素值对数组排序\"><a href=\"#1、通过元素值对数组排序\" class=\"headerlink\" title=\"1、通过元素值对数组排序\"></a>1、通过元素值对数组排序</h3><p>sort($arr);由小到大的顺序排序（第二个参数为按什么方式排序）忽略键名的数组排序</p>\n<p>rsort($arr);由大到小的顺序排序（第二个参数为按什么方式排序）忽略键名的数组排序</p>\n<p>usort($arr,”function”);使用用户自定义的比较函数对数组中的值进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）忽略键名的数组排序</p>\n<p>asort($arr);由小到大的顺序排序（第二个参数为按什么方式排序）保留键名的数组排序</p>\n<p>arsort($arr);由大到小的顺序排序（第二个参数为按什么方式排序）保留键名的数组排序</p>\n<p>uasort($arr,”function”);使用用户自定义的比较函数对数组中的值进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）保留键名的数组排序</p>\n<h3 id=\"2、通过键名对数组排序\"><a href=\"#2、通过键名对数组排序\" class=\"headerlink\" title=\"2、通过键名对数组排序\"></a>2、通过键名对数组排序</h3><p>ksort($arr);按照键名正序排序</p>\n<p>krsort($arr);按照键名逆序排序</p>\n<p>uksort($arr,”function”);使用用户自定义的比较函数对数组中的键名进行排序（function中有两个参数，0表示相等，正数表示第一个大于第二个，负数表示第一个小于第二个）</p>\n<h3 id=\"3、自然排序法排序\"><a href=\"#3、自然排序法排序\" class=\"headerlink\" title=\"3、自然排序法排序\"></a>3、自然排序法排序</h3><p>natsort($arr);自然排序（忽略键名）</p>\n<p>natcasesort($arr);自然排序（忽略大小写，忽略键名）</p>\n<h2 id=\"数组的计算\"><a href=\"#数组的计算\" class=\"headerlink\" title=\"数组的计算\"></a>数组的计算</h2><h3 id=\"1、数组元素的求和\"><a href=\"#1、数组元素的求和\" class=\"headerlink\" title=\"1、数组元素的求和\"></a>1、数组元素的求和</h3><p>array_sum($arr);对数组内部的所有元素做求和运算</p>\n<h3 id=\"2、数组的合并\"><a href=\"#2、数组的合并\" class=\"headerlink\" title=\"2、数组的合并\"></a>2、数组的合并</h3><p>array_merge($arr1,$arr2);合并两个或多个数组（相同的字符串键名，后面的覆盖前面的，相同的数字键名，后面的不会做覆盖操作，而是附加到后面）</p>\n<p>“+”$arr1+$arr2;对于相同的键名只保留后一个</p>\n<p>array_merge_recursive($arr1,$arr2); 递归合并操作，如果数组中有相同的字符串键名，这些值将被合并到一个数组中去。如果一个值本身是一个数组，将按照相应的键名把它合并为另一个数组。当数组 具有相同的数组键名时，后一个值将不会覆盖原来的值，而是附加到后面</p>\n<h3 id=\"3、数组的差集\"><a href=\"#3、数组的差集\" class=\"headerlink\" title=\"3、数组的差集\"></a>3、数组的差集</h3><p>array_diff($arr1,$arr2);返回差集结果数组</p>\n<p>array_diff_assoc($arr1,$arr2,$arr3);返回差集结果数组，键名也做比较</p>\n<h3 id=\"4、数组的交集\"><a href=\"#4、数组的交集\" class=\"headerlink\" title=\"4、数组的交集\"></a>4、数组的交集</h3><p>array_intersect($arr1,$arr2);返回交集结果数组</p>\n<p>array_intersect_assoc($arr1,$arr2);返回交集结果数组，键名也做比较</p>\n<h2 id=\"其他的数组函数\"><a href=\"#其他的数组函数\" class=\"headerlink\" title=\"其他的数组函数\"></a>其他的数组函数</h2><p>range(0,12);创建一个包含指定范围单元的数组</p>\n<p>array_unique($arr);移除数组中重复的值，新的数组中会保留原始的键名</p>\n<p>array_reverse($arr,TRUE);返回一个单元顺序与原数组相反的数组，如果第二个参数为TRUE保留原来的键名</p>\n<p>srand((float)microtime()*10000000);     随机种子触发器</p>\n<p>array_rand($arr,2);从数组中随机取出一个或 多个元素</p>\n<p>shuffle($arr);将数组的顺序打乱</p>\n<p>本类函数允许用多种方法来操作数组和与之交互。数组的本质是储存，管理和操作一组变量。</p>\n<p>PHP 支持一维和多维数组，可以是用户创建或由另一个函数创建。有一些特定的数据库处理函数可以从数据库查询中生成数组，还有一些函数返回数组。</p>\n<p>array_change_key_case — 返回字符串键名全为小写或大写的数组</p>\n<p>array_chunk — 将一个数组分割成多个</p>\n<p>array_combine — 创建一个数组，用一个数组的值作为其键名，另一个数组的值作为其值</p>\n<p>array_count_values — 统计数组中所有的值出现的次数</p>\n<p>array_diff_assoc — 带索引检查计算数组的差集</p>\n<p>array_diff_key — 使用键名比较计算数组的差集</p>\n<p>array_diff_uassoc — 用用户提供的回调函数做索引检查来计算数组的差集</p>\n<p>array_diff_ukey — 用回调函数对键名比较计算数组的差集</p>\n<p>array_diff — 计算数组的差集</p>\n<p>array_fill_keys — Fill an array with values, specifying keys</p>\n<p>array_fill — 用给定的值填充数组</p>\n<p>array_filter — 用回调函数过滤数组中的单元</p>\n<p>array_flip — 交换数组中的键和值</p>\n<p>array_intersect_assoc — 带索引检查计算数组的交集</p>\n<p>array_intersect_key — 使用键名比较计算数组的交集</p>\n<p>array_intersect_uassoc — 带索引检查计算数组的交集，用回调函数比较索引</p>\n<p>array_intersect_ukey — 用回调函数比较键名来计算数组的交集</p>\n<p>array_intersect — 计算数组的交集</p>\n<p>array_key_exists — 检查给定的键名或索引是否存在于数组中</p>\n<p>array_keys — 返回数组中所有的键名</p>\n<p>array_map — 将回调函数作用到给定数组的单元上</p>\n<p>array_merge_recursive — 递归地合并一个或多个数组</p>\n<p>array_merge — 合并一个或多个数组</p>\n<p>array_multisort — 对多个数组或多维数组进行排序</p>\n<p>array_pad — 用值将数组填补到指定长度</p>\n<p>array_pop — 将数组最后一个单元弹出（出栈）</p>\n<p>array_product — 计算数组中所有值的乘积</p>\n<p>array_push — 将一个或多个单元压入数组的末尾（入栈）</p>\n<p>array_rand — 从数组中随机取出一个或多个单元</p>\n<p>array_reduce — 用回调函数迭代地将数组简化为单一的值</p>\n<p>array_reverse — 返回一个单元顺序相反的数组</p>\n<p>array_search — 在数组中搜索给定的值，如果成功则返回相应的键名</p>\n<p>array_shift — 将数组开头的单元移出数组</p>\n<p>array_slice — 从数组中取出一段</p>\n<p>array_splice — 把数组中的一部分去掉并用其它值取代</p>\n<p>array_sum — 计算数组中所有值的和</p>\n<p>array_udiff_assoc — 带索引检查计算数组的差集，用回调函数比较数据</p>\n<p>array_udiff_uassoc — 带索引检查计算数组的差集，用回调函数比较数据和索引</p>\n<p>array_udiff — 用回调函数比较数据来计算数组的差集</p>\n<p>array_uintersect_assoc — 带索引检查计算数组的交集，用回调函数比较数据</p>\n<p>array_uintersect_uassoc — 带索引检查计算数组的交集，用回调函数比较数据和索引</p>\n<p>array_uintersect — 计算数组的交集，用回调函数比较数据</p>\n<p>array_unique — 移除数组中重复的值</p>\n<p>array_unshift — 在数组开头插入一个或多个单元</p>\n<p>array_values — 返回数组中所有的值</p>\n<p>array_walk_recursive — 对数组中的每个成员递归地应用用户函数</p>\n<p>array_walk — 对数组中的每个成员应用用户函数</p>\n<p>array — 新建一个数组</p>\n<p>arsort — 对数组进行逆向排序并保持索引关系</p>\n<p>asort — 对数组进行排序并保持索引关系</p>\n<p>compact — 建立一个数组，包括变量名和它们的值</p>\n<p>count — 计算数组中的单元数目或对象中的属性个数</p>\n<p>current — 返回数组中的当前单元</p>\n<p>each — 返回数组中当前的键／值对并将数组指针向前移动一步</p>\n<p>end — 将数组的内部指针指向最后一个单元</p>\n<p>extract — 从数组中将变量导入到当前的符号表</p>\n<p>in_array — 检查数组中是否存在某个值</p>\n<p>key — 从关联数组中取得键名</p>\n<p>krsort — 对数组按照键名逆向排序</p>\n<p>ksort — 对数组按照键名排序</p>\n<p>list — 把数组中的值赋给一些变量</p>\n<p>natcasesort — 用“自然排序”算法对数组进行不区分大小写字母的排序</p>\n<p>natsort — 用“自然排序”算法对数组排序</p>\n<p>next — 将数组中的内部指针向前移动一位</p>\n<p>pos — current() 的别名</p>\n<p>prev — 将数组的内部指针倒回一位</p>\n<p>range — 建立一个包含指定范围单元的数组</p>\n<p>reset — 将数组的内部指针指向第一个单元</p>\n<p>rsort — 对数组逆向排序</p>\n<p>shuffle — 将数组打乱</p>\n<p>sizeof — count() 的别名</p>\n<p>sort — 对数组排序</p>\n<p>uasort — 使用用户自定义的比较函数对数组中的值进行排序并保持索引关联</p>\n<p>uksort — 使用用户自定义的比较函数对数组中的键名进行排序</p>\n<p>usort — 使用用户自定义的比较函数对数组中的值进行排序</p>"},{"title":"千万级表查询","date":"2017-10-31T07:27:28.000Z","_content":"当一张千万级数据表时，如何提高他的查询速度或者使用什么样的软件？\n\n<!-- more -->\n\n##\tMYSQL千万级数据量的优化方法积累\n1、对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。\n\n2、应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：select id from t where num is null可以在num上设置默认值0，确保表中num列没有null值，然后这样查询：select id from t where num=0\n\n3、应尽量避免在 where 子句中使用!=或<>操作符，否则引擎将放弃使用索引而进行全表扫描。\n\n4、应尽量避免在 where 子句中使用or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：select id from t where num=10 or num=20可以这样查询：select id from t where num=10 union all select id from t where num=20\n\n5、in 和 not in 也要慎用，否则会导致全表扫描，如：select id from t where num in(1,2,3) 对于连续的数值，能用 between 就不要用 in 了：select id from t where num between 1 and 3\n\n6、下面的查询也将导致全表扫描：select id from t where name like ‘%李%’若要提高效率，可以考虑全文检索。\n\n7、如果在 where 子句中使用参数，也会导致全表扫描。因为SQL只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然 而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：select id from t where num=@num可以改为强制查询使用索引：select id from t with(index(索引名)) where num=@num\n\n8、应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：select id from t where num/2=100应改为:select id from t where num=100*2\n\n9、应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：select id from t where substring(name,1,3)=’abc’ ，name以abc开头的id应改为: \nselect id from t where name like ‘abc%’\n\n10、不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。\n\n11、在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。\n\n12、不要写一些没有意义的查询，如需要生成一个空表结构：select col1,col2 into #t from t where 1=0 \n这类代码不会返回任何结果集，但是会消耗系统资源的，应改成这样： \ncreate table #t(…)\n\n13、很多时候用 exists 代替 in 是一个好的选择：select num from a where num in(select num from b) \n用下面的语句替换： \nselect num from a where exists(select 1 from b where num=a.num)\n\n14、并不是所有索引对查询都有效，SQL是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL查询可能不会去利用索引，如一表中有字段sex，male、female几乎各一半，那么即使在sex上建了索引也对查询效率起不了作用。\n\n索引并不是越多越好，索引固然可 以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有 必要。\n\n应尽可能的避免更新 clustered 索引数据列，因为 clustered 索引数据列的顺序就是表记录的物理存储顺序，一旦该列值改变将导致整个表记录的顺序的调整，会耗费相当大的资源。若应用系统需要频繁更新 clustered 索引数据列，那么需要考虑是否应将该索引建为 clustered 索引。\n\n17、尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了.\n\n18、尽可能的使用 varchar/nvarchar 代替 char/nchar ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。\n\n19、任何地方都不要使用 select * from t ，用具体的字段列表代替“*”，不要返回用不到的任何字段。\n\n20、尽量使用表变量来代替临时表。如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。\n\n21、避免频繁创建和删除临时表，以减少系统表资源的消耗。\n\n22、临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使用导出表。\n\n23、在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。\n\n24、如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定。\n\n25、尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。\n\n26、使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。\n\n与临时表一样，游标并不是不可使 用。对小型数据集使用 FAST_FORWARD 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时。在结果集中包括“合计”的例程通常要比使用游标执行的速度快。如果开发时 间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。\n28.在所有的存储过程和触发器的开始处设置 SET NOCOUNT ON ，在结束时设置 SET NOCOUNT OFF 。无需在执行存储过程和触发器的每个语句后向客户端发送DONE_IN_PROC 消息。\n\n29、尽量避免大事务操作，提高系统并发能力.\n\n30、尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。\n","source":"_posts/千万级表查询.md","raw":"---\ntitle: 千万级表查询\ndate: 2017-10-31 15:27:28\ntags: MySQL\ncategories: MySQL\n\n---\n当一张千万级数据表时，如何提高他的查询速度或者使用什么样的软件？\n\n<!-- more -->\n\n##\tMYSQL千万级数据量的优化方法积累\n1、对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。\n\n2、应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：select id from t where num is null可以在num上设置默认值0，确保表中num列没有null值，然后这样查询：select id from t where num=0\n\n3、应尽量避免在 where 子句中使用!=或<>操作符，否则引擎将放弃使用索引而进行全表扫描。\n\n4、应尽量避免在 where 子句中使用or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：select id from t where num=10 or num=20可以这样查询：select id from t where num=10 union all select id from t where num=20\n\n5、in 和 not in 也要慎用，否则会导致全表扫描，如：select id from t where num in(1,2,3) 对于连续的数值，能用 between 就不要用 in 了：select id from t where num between 1 and 3\n\n6、下面的查询也将导致全表扫描：select id from t where name like ‘%李%’若要提高效率，可以考虑全文检索。\n\n7、如果在 where 子句中使用参数，也会导致全表扫描。因为SQL只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然 而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：select id from t where num=@num可以改为强制查询使用索引：select id from t with(index(索引名)) where num=@num\n\n8、应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：select id from t where num/2=100应改为:select id from t where num=100*2\n\n9、应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：select id from t where substring(name,1,3)=’abc’ ，name以abc开头的id应改为: \nselect id from t where name like ‘abc%’\n\n10、不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。\n\n11、在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。\n\n12、不要写一些没有意义的查询，如需要生成一个空表结构：select col1,col2 into #t from t where 1=0 \n这类代码不会返回任何结果集，但是会消耗系统资源的，应改成这样： \ncreate table #t(…)\n\n13、很多时候用 exists 代替 in 是一个好的选择：select num from a where num in(select num from b) \n用下面的语句替换： \nselect num from a where exists(select 1 from b where num=a.num)\n\n14、并不是所有索引对查询都有效，SQL是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL查询可能不会去利用索引，如一表中有字段sex，male、female几乎各一半，那么即使在sex上建了索引也对查询效率起不了作用。\n\n索引并不是越多越好，索引固然可 以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有 必要。\n\n应尽可能的避免更新 clustered 索引数据列，因为 clustered 索引数据列的顺序就是表记录的物理存储顺序，一旦该列值改变将导致整个表记录的顺序的调整，会耗费相当大的资源。若应用系统需要频繁更新 clustered 索引数据列，那么需要考虑是否应将该索引建为 clustered 索引。\n\n17、尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了.\n\n18、尽可能的使用 varchar/nvarchar 代替 char/nchar ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。\n\n19、任何地方都不要使用 select * from t ，用具体的字段列表代替“*”，不要返回用不到的任何字段。\n\n20、尽量使用表变量来代替临时表。如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。\n\n21、避免频繁创建和删除临时表，以减少系统表资源的消耗。\n\n22、临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使用导出表。\n\n23、在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。\n\n24、如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定。\n\n25、尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。\n\n26、使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。\n\n与临时表一样，游标并不是不可使 用。对小型数据集使用 FAST_FORWARD 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时。在结果集中包括“合计”的例程通常要比使用游标执行的速度快。如果开发时 间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。\n28.在所有的存储过程和触发器的开始处设置 SET NOCOUNT ON ，在结束时设置 SET NOCOUNT OFF 。无需在执行存储过程和触发器的每个语句后向客户端发送DONE_IN_PROC 消息。\n\n29、尽量避免大事务操作，提高系统并发能力.\n\n30、尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。\n","slug":"千万级表查询","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuwg000hydqneij1drs2","content":"<p>当一张千万级数据表时，如何提高他的查询速度或者使用什么样的软件？</p>\n<a id=\"more\"></a>\n<h2 id=\"MYSQL千万级数据量的优化方法积累\"><a href=\"#MYSQL千万级数据量的优化方法积累\" class=\"headerlink\" title=\"MYSQL千万级数据量的优化方法积累\"></a>MYSQL千万级数据量的优化方法积累</h2><p>1、对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。</p>\n<p>2、应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：select id from t where num is null可以在num上设置默认值0，确保表中num列没有null值，然后这样查询：select id from t where num=0</p>\n<p>3、应尽量避免在 where 子句中使用!=或&lt;&gt;操作符，否则引擎将放弃使用索引而进行全表扫描。</p>\n<p>4、应尽量避免在 where 子句中使用or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：select id from t where num=10 or num=20可以这样查询：select id from t where num=10 union all select id from t where num=20</p>\n<p>5、in 和 not in 也要慎用，否则会导致全表扫描，如：select id from t where num in(1,2,3) 对于连续的数值，能用 between 就不要用 in 了：select id from t where num between 1 and 3</p>\n<p>6、下面的查询也将导致全表扫描：select id from t where name like ‘%李%’若要提高效率，可以考虑全文检索。</p>\n<p>7、如果在 where 子句中使用参数，也会导致全表扫描。因为SQL只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然 而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：select id from t where num=@num可以改为强制查询使用索引：select id from t with(index(索引名)) where num=@num</p>\n<p>8、应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：select id from t where num/2=100应改为:select id from t where num=100*2</p>\n<p>9、应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：select id from t where substring(name,1,3)=’abc’ ，name以abc开头的id应改为:<br>select id from t where name like ‘abc%’</p>\n<p>10、不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。</p>\n<p>11、在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。</p>\n<p>12、不要写一些没有意义的查询，如需要生成一个空表结构：select col1,col2 into #t from t where 1=0<br>这类代码不会返回任何结果集，但是会消耗系统资源的，应改成这样：<br>create table #t(…)</p>\n<p>13、很多时候用 exists 代替 in 是一个好的选择：select num from a where num in(select num from b)<br>用下面的语句替换：<br>select num from a where exists(select 1 from b where num=a.num)</p>\n<p>14、并不是所有索引对查询都有效，SQL是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL查询可能不会去利用索引，如一表中有字段sex，male、female几乎各一半，那么即使在sex上建了索引也对查询效率起不了作用。</p>\n<p>索引并不是越多越好，索引固然可 以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有 必要。</p>\n<p>应尽可能的避免更新 clustered 索引数据列，因为 clustered 索引数据列的顺序就是表记录的物理存储顺序，一旦该列值改变将导致整个表记录的顺序的调整，会耗费相当大的资源。若应用系统需要频繁更新 clustered 索引数据列，那么需要考虑是否应将该索引建为 clustered 索引。</p>\n<p>17、尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了.</p>\n<p>18、尽可能的使用 varchar/nvarchar 代替 char/nchar ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。</p>\n<p>19、任何地方都不要使用 select <em> from t ，用具体的字段列表代替“</em>”，不要返回用不到的任何字段。</p>\n<p>20、尽量使用表变量来代替临时表。如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。</p>\n<p>21、避免频繁创建和删除临时表，以减少系统表资源的消耗。</p>\n<p>22、临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使用导出表。</p>\n<p>23、在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。</p>\n<p>24、如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定。</p>\n<p>25、尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。</p>\n<p>26、使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。</p>\n<p>与临时表一样，游标并不是不可使 用。对小型数据集使用 FAST_FORWARD 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时。在结果集中包括“合计”的例程通常要比使用游标执行的速度快。如果开发时 间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。<br>28.在所有的存储过程和触发器的开始处设置 SET NOCOUNT ON ，在结束时设置 SET NOCOUNT OFF 。无需在执行存储过程和触发器的每个语句后向客户端发送DONE_IN_PROC 消息。</p>\n<p>29、尽量避免大事务操作，提高系统并发能力.</p>\n<p>30、尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。</p>\n","site":{"data":{}},"excerpt":"<p>当一张千万级数据表时，如何提高他的查询速度或者使用什么样的软件？</p>","more":"<h2 id=\"MYSQL千万级数据量的优化方法积累\"><a href=\"#MYSQL千万级数据量的优化方法积累\" class=\"headerlink\" title=\"MYSQL千万级数据量的优化方法积累\"></a>MYSQL千万级数据量的优化方法积累</h2><p>1、对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。</p>\n<p>2、应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：select id from t where num is null可以在num上设置默认值0，确保表中num列没有null值，然后这样查询：select id from t where num=0</p>\n<p>3、应尽量避免在 where 子句中使用!=或&lt;&gt;操作符，否则引擎将放弃使用索引而进行全表扫描。</p>\n<p>4、应尽量避免在 where 子句中使用or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：select id from t where num=10 or num=20可以这样查询：select id from t where num=10 union all select id from t where num=20</p>\n<p>5、in 和 not in 也要慎用，否则会导致全表扫描，如：select id from t where num in(1,2,3) 对于连续的数值，能用 between 就不要用 in 了：select id from t where num between 1 and 3</p>\n<p>6、下面的查询也将导致全表扫描：select id from t where name like ‘%李%’若要提高效率，可以考虑全文检索。</p>\n<p>7、如果在 where 子句中使用参数，也会导致全表扫描。因为SQL只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然 而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：select id from t where num=@num可以改为强制查询使用索引：select id from t with(index(索引名)) where num=@num</p>\n<p>8、应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：select id from t where num/2=100应改为:select id from t where num=100*2</p>\n<p>9、应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：select id from t where substring(name,1,3)=’abc’ ，name以abc开头的id应改为:<br>select id from t where name like ‘abc%’</p>\n<p>10、不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。</p>\n<p>11、在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。</p>\n<p>12、不要写一些没有意义的查询，如需要生成一个空表结构：select col1,col2 into #t from t where 1=0<br>这类代码不会返回任何结果集，但是会消耗系统资源的，应改成这样：<br>create table #t(…)</p>\n<p>13、很多时候用 exists 代替 in 是一个好的选择：select num from a where num in(select num from b)<br>用下面的语句替换：<br>select num from a where exists(select 1 from b where num=a.num)</p>\n<p>14、并不是所有索引对查询都有效，SQL是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL查询可能不会去利用索引，如一表中有字段sex，male、female几乎各一半，那么即使在sex上建了索引也对查询效率起不了作用。</p>\n<p>索引并不是越多越好，索引固然可 以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有 必要。</p>\n<p>应尽可能的避免更新 clustered 索引数据列，因为 clustered 索引数据列的顺序就是表记录的物理存储顺序，一旦该列值改变将导致整个表记录的顺序的调整，会耗费相当大的资源。若应用系统需要频繁更新 clustered 索引数据列，那么需要考虑是否应将该索引建为 clustered 索引。</p>\n<p>17、尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了.</p>\n<p>18、尽可能的使用 varchar/nvarchar 代替 char/nchar ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。</p>\n<p>19、任何地方都不要使用 select <em> from t ，用具体的字段列表代替“</em>”，不要返回用不到的任何字段。</p>\n<p>20、尽量使用表变量来代替临时表。如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。</p>\n<p>21、避免频繁创建和删除临时表，以减少系统表资源的消耗。</p>\n<p>22、临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使用导出表。</p>\n<p>23、在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。</p>\n<p>24、如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定。</p>\n<p>25、尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。</p>\n<p>26、使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。</p>\n<p>与临时表一样，游标并不是不可使 用。对小型数据集使用 FAST_FORWARD 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时。在结果集中包括“合计”的例程通常要比使用游标执行的速度快。如果开发时 间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。<br>28.在所有的存储过程和触发器的开始处设置 SET NOCOUNT ON ，在结束时设置 SET NOCOUNT OFF 。无需在执行存储过程和触发器的每个语句后向客户端发送DONE_IN_PROC 消息。</p>\n<p>29、尽量避免大事务操作，提高系统并发能力.</p>\n<p>30、尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。</p>"},{"title":"单例设计模式","date":"2017-08-07T15:55:33.000Z","_content":"\n我们无论是在疯狂的敲代码中还是在面试当中，都会不可避免的用到设计模式，首先先介绍单例，这也是用到最多的一种设计模式\n<!-- more -->\n\n##\t介绍\n单例模式，是一种常用的软件设计模式。在它的核心结构中只包含一个被称为单例的特殊类。通过单例模式可以保证系统中一个类只有一个实例。即一个类只有一个对象实例。\n\n具体实现角度来说，就是以下三点：\n一:\t单例模式的类只提供私有的构造函数;\n二:\t是类定义中含有一个该类的静态私有对象;\n三:\t是该类提供了一个静态的公有的函数用于创建或获取它本身的静态私有对象;\n当然还要有一个private的clone方法，防止克隆;\n\n##\t优点\n一、实例控制\n单例模式会阻止其他对象实例化其自己的单例对象的副本，从而确保所有对象都访问唯一实例;\n二、灵活性\n因为类控制了实例化过程，所以类可以灵活更改实例化过程;\n\n##\t缺点\n一、开销\n虽然数量很少，但如果每次对象请求引用时都要检查是否存在类的实例，将仍然需要一些开销。可以通过使用静态初始化解决此问题;\n二、可能的开发混淆\n使用单例对象（尤其在类库中定义的对象）时，开发人员必须记住自己不能使用new关键字实例化对象。因为可能无法访问库源代码，因此应用程序开发人员可能会意外发现自己无法直接实例化此类;\n三、对象生存期\n不能解决删除单个对象的问题。在提供内存管理的语言中（例如基于.NET Framework的语言），只有单例类能够导致实例被取消分配，因为它包含对该实例的私有引用;\n\n##\t运行场景介绍\n单例设计模式一般用户像MVC底层的Model类，其次就是你的项目需要进行加密的时候用到。\n\n## 代码\n```\n\t<?php \n\t//单例\n\tclass Uni{\n\t        //创建静态私有的变量保存该类对象\n\t    static private $instance;\n\t        //参数\n\t    private $config;\n\t        //防止直接创建对象\n\t    private function __construct($config){\n\t        $this -> config = $config;\n\t                echo \"我被实例化了\";\n\t    }\n\t        //防止克隆对象\n\t    private function __clone(){\n\n\t    }\n\t    static public function getInstance($config){\n\t                //判断$instance是否是Uni的对象\n\t                //没有则创建\n\t        if (!self::$instance instanceof self) {\n\t            self::$instance = new self($config);\n\t        }\n\t        return self::$instance;\n\t        \n\t    }\n\t    public function getName(){\n\t        echo $this -> config;\n\t    }\n\t}\n\t$db1 = Uni::getInstance(1);\n\t$db1 -> getName();\n\techo \"<br>\";\n\t$db2 = Uni::getInstance(4);\n\t$db2 -> getName();\n\t?>\n```\n运行结果：\n\n我被实例化了1\n1\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/单例设计模式.md","raw":"---\ntitle: 单例设计模式\ndate: 2017-08-07 23:55:33\ntags: 设计模式\ncategories: 设计模式\n---\n\n我们无论是在疯狂的敲代码中还是在面试当中，都会不可避免的用到设计模式，首先先介绍单例，这也是用到最多的一种设计模式\n<!-- more -->\n\n##\t介绍\n单例模式，是一种常用的软件设计模式。在它的核心结构中只包含一个被称为单例的特殊类。通过单例模式可以保证系统中一个类只有一个实例。即一个类只有一个对象实例。\n\n具体实现角度来说，就是以下三点：\n一:\t单例模式的类只提供私有的构造函数;\n二:\t是类定义中含有一个该类的静态私有对象;\n三:\t是该类提供了一个静态的公有的函数用于创建或获取它本身的静态私有对象;\n当然还要有一个private的clone方法，防止克隆;\n\n##\t优点\n一、实例控制\n单例模式会阻止其他对象实例化其自己的单例对象的副本，从而确保所有对象都访问唯一实例;\n二、灵活性\n因为类控制了实例化过程，所以类可以灵活更改实例化过程;\n\n##\t缺点\n一、开销\n虽然数量很少，但如果每次对象请求引用时都要检查是否存在类的实例，将仍然需要一些开销。可以通过使用静态初始化解决此问题;\n二、可能的开发混淆\n使用单例对象（尤其在类库中定义的对象）时，开发人员必须记住自己不能使用new关键字实例化对象。因为可能无法访问库源代码，因此应用程序开发人员可能会意外发现自己无法直接实例化此类;\n三、对象生存期\n不能解决删除单个对象的问题。在提供内存管理的语言中（例如基于.NET Framework的语言），只有单例类能够导致实例被取消分配，因为它包含对该实例的私有引用;\n\n##\t运行场景介绍\n单例设计模式一般用户像MVC底层的Model类，其次就是你的项目需要进行加密的时候用到。\n\n## 代码\n```\n\t<?php \n\t//单例\n\tclass Uni{\n\t        //创建静态私有的变量保存该类对象\n\t    static private $instance;\n\t        //参数\n\t    private $config;\n\t        //防止直接创建对象\n\t    private function __construct($config){\n\t        $this -> config = $config;\n\t                echo \"我被实例化了\";\n\t    }\n\t        //防止克隆对象\n\t    private function __clone(){\n\n\t    }\n\t    static public function getInstance($config){\n\t                //判断$instance是否是Uni的对象\n\t                //没有则创建\n\t        if (!self::$instance instanceof self) {\n\t            self::$instance = new self($config);\n\t        }\n\t        return self::$instance;\n\t        \n\t    }\n\t    public function getName(){\n\t        echo $this -> config;\n\t    }\n\t}\n\t$db1 = Uni::getInstance(1);\n\t$db1 -> getName();\n\techo \"<br>\";\n\t$db2 = Uni::getInstance(4);\n\t$db2 -> getName();\n\t?>\n```\n运行结果：\n\n我被实例化了1\n1\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"单例设计模式","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuwi000lydqnbxn6qwbh","content":"<p>我们无论是在疯狂的敲代码中还是在面试当中，都会不可避免的用到设计模式，首先先介绍单例，这也是用到最多的一种设计模式<br><a id=\"more\"></a></p>\n<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>单例模式，是一种常用的软件设计模式。在它的核心结构中只包含一个被称为单例的特殊类。通过单例模式可以保证系统中一个类只有一个实例。即一个类只有一个对象实例。</p>\n<p>具体实现角度来说，就是以下三点：<br>一:    单例模式的类只提供私有的构造函数;<br>二:    是类定义中含有一个该类的静态私有对象;<br>三:    是该类提供了一个静态的公有的函数用于创建或获取它本身的静态私有对象;<br>当然还要有一个private的clone方法，防止克隆;</p>\n<h2 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h2><p>一、实例控制<br>单例模式会阻止其他对象实例化其自己的单例对象的副本，从而确保所有对象都访问唯一实例;<br>二、灵活性<br>因为类控制了实例化过程，所以类可以灵活更改实例化过程;</p>\n<h2 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h2><p>一、开销<br>虽然数量很少，但如果每次对象请求引用时都要检查是否存在类的实例，将仍然需要一些开销。可以通过使用静态初始化解决此问题;<br>二、可能的开发混淆<br>使用单例对象（尤其在类库中定义的对象）时，开发人员必须记住自己不能使用new关键字实例化对象。因为可能无法访问库源代码，因此应用程序开发人员可能会意外发现自己无法直接实例化此类;<br>三、对象生存期<br>不能解决删除单个对象的问题。在提供内存管理的语言中（例如基于.NET Framework的语言），只有单例类能够导致实例被取消分配，因为它包含对该实例的私有引用;</p>\n<h2 id=\"运行场景介绍\"><a href=\"#运行场景介绍\" class=\"headerlink\" title=\"运行场景介绍\"></a>运行场景介绍</h2><p>单例设计模式一般用户像MVC底层的Model类，其次就是你的项目需要进行加密的时候用到。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span> </span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//单例</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Uni</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"comment\">//创建静态私有的变量保存该类对象</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">static</span> <span class=\"keyword\">private</span> $instance;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"comment\">//参数</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">private</span> $config;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"comment\">//防止直接创建对象</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($config)</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">$this</span> -&gt; config = $config;</span></span><br><span class=\"line\"><span class=\"php\">                <span class=\"keyword\">echo</span> <span class=\"string\">\"我被实例化了\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"comment\">//防止克隆对象</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__clone</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">static</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getInstance</span><span class=\"params\">($config)</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">                <span class=\"comment\">//判断$instance是否是Uni的对象</span></span></span><br><span class=\"line\"><span class=\"php\">                <span class=\"comment\">//没有则创建</span></span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">self</span>::$instance <span class=\"keyword\">instanceof</span> <span class=\"keyword\">self</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">            <span class=\"keyword\">self</span>::$instance = <span class=\"keyword\">new</span> <span class=\"keyword\">self</span>($config);</span></span><br><span class=\"line\"><span class=\"php\">        &#125;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>::$instance;</span></span><br><span class=\"line\"><span class=\"php\">        </span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getName</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span> -&gt; config;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$db1 = Uni::getInstance(<span class=\"number\">1</span>);</span></span><br><span class=\"line\"><span class=\"php\">$db1 -&gt; getName();</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">$db2 = Uni::getInstance(<span class=\"number\">4</span>);</span></span><br><span class=\"line\"><span class=\"php\">$db2 -&gt; getName();</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"meta\">?&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<p>我被实例化了1<br>1</p>\n","site":{"data":{}},"excerpt":"<p>我们无论是在疯狂的敲代码中还是在面试当中，都会不可避免的用到设计模式，首先先介绍单例，这也是用到最多的一种设计模式<br>","more":"</p>\n<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>单例模式，是一种常用的软件设计模式。在它的核心结构中只包含一个被称为单例的特殊类。通过单例模式可以保证系统中一个类只有一个实例。即一个类只有一个对象实例。</p>\n<p>具体实现角度来说，就是以下三点：<br>一:    单例模式的类只提供私有的构造函数;<br>二:    是类定义中含有一个该类的静态私有对象;<br>三:    是该类提供了一个静态的公有的函数用于创建或获取它本身的静态私有对象;<br>当然还要有一个private的clone方法，防止克隆;</p>\n<h2 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h2><p>一、实例控制<br>单例模式会阻止其他对象实例化其自己的单例对象的副本，从而确保所有对象都访问唯一实例;<br>二、灵活性<br>因为类控制了实例化过程，所以类可以灵活更改实例化过程;</p>\n<h2 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h2><p>一、开销<br>虽然数量很少，但如果每次对象请求引用时都要检查是否存在类的实例，将仍然需要一些开销。可以通过使用静态初始化解决此问题;<br>二、可能的开发混淆<br>使用单例对象（尤其在类库中定义的对象）时，开发人员必须记住自己不能使用new关键字实例化对象。因为可能无法访问库源代码，因此应用程序开发人员可能会意外发现自己无法直接实例化此类;<br>三、对象生存期<br>不能解决删除单个对象的问题。在提供内存管理的语言中（例如基于.NET Framework的语言），只有单例类能够导致实例被取消分配，因为它包含对该实例的私有引用;</p>\n<h2 id=\"运行场景介绍\"><a href=\"#运行场景介绍\" class=\"headerlink\" title=\"运行场景介绍\"></a>运行场景介绍</h2><p>单例设计模式一般用户像MVC底层的Model类，其次就是你的项目需要进行加密的时候用到。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span> </span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//单例</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Uni</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"comment\">//创建静态私有的变量保存该类对象</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">static</span> <span class=\"keyword\">private</span> $instance;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"comment\">//参数</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">private</span> $config;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"comment\">//防止直接创建对象</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($config)</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">$this</span> -&gt; config = $config;</span></span><br><span class=\"line\"><span class=\"php\">                <span class=\"keyword\">echo</span> <span class=\"string\">\"我被实例化了\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"comment\">//防止克隆对象</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__clone</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">static</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getInstance</span><span class=\"params\">($config)</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">                <span class=\"comment\">//判断$instance是否是Uni的对象</span></span></span><br><span class=\"line\"><span class=\"php\">                <span class=\"comment\">//没有则创建</span></span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">self</span>::$instance <span class=\"keyword\">instanceof</span> <span class=\"keyword\">self</span>) &#123;</span></span><br><span class=\"line\"><span class=\"php\">            <span class=\"keyword\">self</span>::$instance = <span class=\"keyword\">new</span> <span class=\"keyword\">self</span>($config);</span></span><br><span class=\"line\"><span class=\"php\">        &#125;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>::$instance;</span></span><br><span class=\"line\"><span class=\"php\">        </span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getName</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span> -&gt; config;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$db1 = Uni::getInstance(<span class=\"number\">1</span>);</span></span><br><span class=\"line\"><span class=\"php\">$db1 -&gt; getName();</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;br&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">$db2 = Uni::getInstance(<span class=\"number\">4</span>);</span></span><br><span class=\"line\"><span class=\"php\">$db2 -&gt; getName();</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"meta\">?&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<p>我被实例化了1<br>1</p>"},{"title":"工厂设计模式","date":"2017-08-14T19:06:43.000Z","_content":"工厂设计模式通俗一点就是像工厂流水线一样的运行模式\n\n<!-- more -->\n##\t介绍\n\n工厂方法模式(Factory Method Pattern)又称为工厂模式，也叫虚拟构造器(Virtual Constructor)模式或者多态工厂(Polymorphic Factory)模式，它属于类创建型模式。在工厂方法模式中，工厂父类负责定义创建产品对象的公共接口，而工厂子类则负责生成具体的产品对象，这样做的目的是将产品类的实例化操作延迟到工厂子类中完成，即通过工厂子类来确定究竟应该实例化哪一个具体产品类。\n\n##\t模式结构\n工厂方法模式包含如下角色：\n```\n\tProduct：抽象产品\n\tConcreteProduct：具体产品\n\tFactory：抽象工厂\n\tConcreteFactory：具体工厂\n```\n##\t代码\n```\n\t<?php\n\t//抽象产品\n\tabstract class Operation\n\t{\n\t    private $numA,$numB;\n\t    public function __set($name,$value){\n\t        $this->$name=$value;\n\t    }\n\n\t    public function __get($name){\n\t        return $this->$name;\n\t    }\n\t    abstract public function getResult();\n\t}\n\n\t//具体产品\n\tclass OperateAdd extends Operation\n\t{\n\t    public function getResult(){\n\t        $result=$this->numA+$this->numB;\n\t        return $result;\n\t    }\n\t}\n\tclass OperateSub extends Operation\n\t{\n\t    public function getResult(){\n\t        $result=$this->numA-$this->numB;\n\t        return $result;\n\t    }\n\t}\n\n\t//抽象工厂\n\tinterface Factory\n\t{\n\t    public function createOperation();\n\t}\n\n\t//具体工厂\n\tclass AddFactory implements Factory\n\t{\n\t    public function createOperation()\n\t    {\n\t        return new OperateAdd();\n\t    }\n\t}\n\tclass SubFactory implements Factory\n\t{\n\t    public function createOperation()\n\t    {\n\t        return new OperateSub();\n\t    }\n\t}\n\t$a=new AddFactory();\n\t$b=$a->createOperation();\n\t$b->numA=1;\n\t$b->numB=5;\n\t$c=$b->getResult();\n\tvar_dump($c);\n```\n运行结果\n\nint 6","source":"_posts/工厂设计模式.md","raw":"---\ntitle: 工厂设计模式\ndate: 2017-08-15 03:06:43\ntags: 设计模式\ncategories: 设计模式\n---\n工厂设计模式通俗一点就是像工厂流水线一样的运行模式\n\n<!-- more -->\n##\t介绍\n\n工厂方法模式(Factory Method Pattern)又称为工厂模式，也叫虚拟构造器(Virtual Constructor)模式或者多态工厂(Polymorphic Factory)模式，它属于类创建型模式。在工厂方法模式中，工厂父类负责定义创建产品对象的公共接口，而工厂子类则负责生成具体的产品对象，这样做的目的是将产品类的实例化操作延迟到工厂子类中完成，即通过工厂子类来确定究竟应该实例化哪一个具体产品类。\n\n##\t模式结构\n工厂方法模式包含如下角色：\n```\n\tProduct：抽象产品\n\tConcreteProduct：具体产品\n\tFactory：抽象工厂\n\tConcreteFactory：具体工厂\n```\n##\t代码\n```\n\t<?php\n\t//抽象产品\n\tabstract class Operation\n\t{\n\t    private $numA,$numB;\n\t    public function __set($name,$value){\n\t        $this->$name=$value;\n\t    }\n\n\t    public function __get($name){\n\t        return $this->$name;\n\t    }\n\t    abstract public function getResult();\n\t}\n\n\t//具体产品\n\tclass OperateAdd extends Operation\n\t{\n\t    public function getResult(){\n\t        $result=$this->numA+$this->numB;\n\t        return $result;\n\t    }\n\t}\n\tclass OperateSub extends Operation\n\t{\n\t    public function getResult(){\n\t        $result=$this->numA-$this->numB;\n\t        return $result;\n\t    }\n\t}\n\n\t//抽象工厂\n\tinterface Factory\n\t{\n\t    public function createOperation();\n\t}\n\n\t//具体工厂\n\tclass AddFactory implements Factory\n\t{\n\t    public function createOperation()\n\t    {\n\t        return new OperateAdd();\n\t    }\n\t}\n\tclass SubFactory implements Factory\n\t{\n\t    public function createOperation()\n\t    {\n\t        return new OperateSub();\n\t    }\n\t}\n\t$a=new AddFactory();\n\t$b=$a->createOperation();\n\t$b->numA=1;\n\t$b->numB=5;\n\t$c=$b->getResult();\n\tvar_dump($c);\n```\n运行结果\n\nint 6","slug":"工厂设计模式","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuwl000nydqnjm4xfcdw","content":"<p>工厂设计模式通俗一点就是像工厂流水线一样的运行模式</p>\n<a id=\"more\"></a>\n<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>工厂方法模式(Factory Method Pattern)又称为工厂模式，也叫虚拟构造器(Virtual Constructor)模式或者多态工厂(Polymorphic Factory)模式，它属于类创建型模式。在工厂方法模式中，工厂父类负责定义创建产品对象的公共接口，而工厂子类则负责生成具体的产品对象，这样做的目的是将产品类的实例化操作延迟到工厂子类中完成，即通过工厂子类来确定究竟应该实例化哪一个具体产品类。</p>\n<h2 id=\"模式结构\"><a href=\"#模式结构\" class=\"headerlink\" title=\"模式结构\"></a>模式结构</h2><p>工厂方法模式包含如下角色：<br><figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Product</span>：抽象产品</span><br><span class=\"line\">ConcreteProduct：具体产品</span><br><span class=\"line\">Factory：抽象工厂</span><br><span class=\"line\">ConcreteFactory：具体工厂</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//抽象产品</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Operation</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">private</span> $numA,$numB;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__set</span><span class=\"params\">($name,$value)</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">$this</span>-&gt;$name=$value;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name)</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">abstract</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getResult</span><span class=\"params\">()</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//具体产品</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OperateAdd</span> <span class=\"keyword\">extends</span> <span class=\"title\">Operation</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getResult</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        $result=<span class=\"keyword\">$this</span>-&gt;numA+<span class=\"keyword\">$this</span>-&gt;numB;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> $result;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OperateSub</span> <span class=\"keyword\">extends</span> <span class=\"title\">Operation</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getResult</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        $result=<span class=\"keyword\">$this</span>-&gt;numA-<span class=\"keyword\">$this</span>-&gt;numB;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> $result;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//抽象工厂</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Factory</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createOperation</span><span class=\"params\">()</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//具体工厂</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AddFactory</span> <span class=\"keyword\">implements</span> <span class=\"title\">Factory</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createOperation</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> OperateAdd();</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SubFactory</span> <span class=\"keyword\">implements</span> <span class=\"title\">Factory</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createOperation</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> OperateSub();</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$a=<span class=\"keyword\">new</span> AddFactory();</span></span><br><span class=\"line\"><span class=\"php\">$b=$a-&gt;createOperation();</span></span><br><span class=\"line\"><span class=\"php\">$b-&gt;numA=<span class=\"number\">1</span>;</span></span><br><span class=\"line\"><span class=\"php\">$b-&gt;numB=<span class=\"number\">5</span>;</span></span><br><span class=\"line\"><span class=\"php\">$c=$b-&gt;getResult();</span></span><br><span class=\"line\"><span class=\"php\">var_dump($c);</span></span><br></pre></td></tr></table></figure>\n<p>运行结果</p>\n<p>int 6</p>\n","site":{"data":{}},"excerpt":"<p>工厂设计模式通俗一点就是像工厂流水线一样的运行模式</p>","more":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>工厂方法模式(Factory Method Pattern)又称为工厂模式，也叫虚拟构造器(Virtual Constructor)模式或者多态工厂(Polymorphic Factory)模式，它属于类创建型模式。在工厂方法模式中，工厂父类负责定义创建产品对象的公共接口，而工厂子类则负责生成具体的产品对象，这样做的目的是将产品类的实例化操作延迟到工厂子类中完成，即通过工厂子类来确定究竟应该实例化哪一个具体产品类。</p>\n<h2 id=\"模式结构\"><a href=\"#模式结构\" class=\"headerlink\" title=\"模式结构\"></a>模式结构</h2><p>工厂方法模式包含如下角色：<br><figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Product</span>：抽象产品</span><br><span class=\"line\">ConcreteProduct：具体产品</span><br><span class=\"line\">Factory：抽象工厂</span><br><span class=\"line\">ConcreteFactory：具体工厂</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//抽象产品</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Operation</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">private</span> $numA,$numB;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__set</span><span class=\"params\">($name,$value)</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">$this</span>-&gt;$name=$value;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name)</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">abstract</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getResult</span><span class=\"params\">()</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//具体产品</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OperateAdd</span> <span class=\"keyword\">extends</span> <span class=\"title\">Operation</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getResult</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        $result=<span class=\"keyword\">$this</span>-&gt;numA+<span class=\"keyword\">$this</span>-&gt;numB;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> $result;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OperateSub</span> <span class=\"keyword\">extends</span> <span class=\"title\">Operation</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getResult</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        $result=<span class=\"keyword\">$this</span>-&gt;numA-<span class=\"keyword\">$this</span>-&gt;numB;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> $result;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//抽象工厂</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Factory</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createOperation</span><span class=\"params\">()</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//具体工厂</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AddFactory</span> <span class=\"keyword\">implements</span> <span class=\"title\">Factory</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createOperation</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> OperateAdd();</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SubFactory</span> <span class=\"keyword\">implements</span> <span class=\"title\">Factory</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createOperation</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> OperateSub();</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$a=<span class=\"keyword\">new</span> AddFactory();</span></span><br><span class=\"line\"><span class=\"php\">$b=$a-&gt;createOperation();</span></span><br><span class=\"line\"><span class=\"php\">$b-&gt;numA=<span class=\"number\">1</span>;</span></span><br><span class=\"line\"><span class=\"php\">$b-&gt;numB=<span class=\"number\">5</span>;</span></span><br><span class=\"line\"><span class=\"php\">$c=$b-&gt;getResult();</span></span><br><span class=\"line\"><span class=\"php\">var_dump($c);</span></span><br></pre></td></tr></table></figure>\n<p>运行结果</p>\n<p>int 6</p>"},{"title":"常见的几种算法","date":"2017-10-23T11:59:14.000Z","_content":"冒泡排序、递归、快排等\n\n<!-- more -->\n\n## \t冒泡排序\n它重复地走访过要排序的元素列，一次比较两个相邻的元素，如果他们的顺序（如从大到小、首字母从A到Z）错误就把他们交换过来。走访元素的工作是重复地进行直到没有相邻元素需要交换，也就是说该元素已经排序完成。\n```\n\t<?php\n\tfunction bubble_sort(&$arr)\n\t{\n\t\tfor($len = cout($arr); $i = 0; $i++) {\n\t\t\tfor($j = 1; $i < $len; $i++) {\n\t\t\t\tif($arr[$j - 1] > $arr[$j]) {\n\t\t\t\t\t$temp = $arr[$j -1];\n\t\t\t\t\t$arr[$j - 1] = $arr[$j];\n\t\t\t\t\t$arr[$j] = $stmp;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t$arr = array(10,  2,  3, 1,  89, 92);\n\tbubble_sort($arr);\n\tprint_r($arr);\n```\n## \t快排\n```\n\tfunction partition(&$arr,$low,$high)\n\t{ \n\t\t$pivotkey = $arr[$low]; \n\t\twhile($low < $high){ \n\t\t\twhile($low < $high && $arr[$high] >= $pivotkey)\n\t\t\t{\n\t\t\t\t$high--; \n\t\t\t}\n\t\t\t$temp = $arr[$low];\n\t\t\t$arr[$low] = $arr[$high] = $temp;\n\t\t\t$arr[$high];\n\t\t\twhile($low < $high && $pivotkey){ \n\t\t\t\t$low++;\n\t\t\t}\n\t\t\t$temp = $arr[$low];\n\t\t\t$arr[$low] = $arr[$high];\n\t\t\t$arr[$high] = $temp;\n\t\t }\n\t\treturn $low; \n\t}\n```\n##\t递归\n实现无限分类\n```\n\t<?php\n\tfunction tree($arr, $pid = 0; $level = 0)\n\t{\n\t\tstatic $list = array();\n\t\tforeach($arr as $v) {\n\t\t\t//如果是顶级分类，则将其存到$list中\n\t\t\t//并以节点作为根节点，遍历找子节点\n\t\t\tif($v['oarent_id'] == $pid) {\n\t\t\t\t$v['level'] = $level;\n\t\t\t\t$list[] = $v;\n\t\t\t\ttree($arr, $v['cat_id'], $level+1);\n\t\t\t}\n\t\t}\n\t\treturn $list;\n\t}\n```\n## \t插入排序\n插入排序思路：\n\t将数组分成两个区域：已排序区域和未排序区域。首先假设数组的第一个元素处于已排序区域，\n    第一个元素之后的所有元素都处于未排序区域。\n    排序时用到两层循环，第一层循环用于从未排序区域中取出待排序元素，并逐步缩小未排序区域，\n    第二层循环用于从已排序区域中寻找插入位置（即不断地从已排序区域中寻找比待排序元素大的元素，\n    然后将较大的已排序区的元素后移，后移的最终结果是已排序区元素的最后一个元素占据\n    待排序元素原来的位置，而已排序区中间空出一个位置），最后将待排序元素插入元素后移后留下的空位\n代码:\n```\n\t<?php \n\theader('content-type:text/html;charset=utf8 ');\n\t$arr=array(50,2,45,42,6,47,23,22,15,11,30,16,13,3);\n\t \n\t//调用排序方法\n\techo \"<pre>\";\n\tprint_r(insert_sort($arr));\n```\n插入排序法的方法\n```\n\tfunction insert_sort($arr) {\n\t    //区分 哪部分是已经排序好的\n\t    //哪部分是没有排序的\n\t    //找到其中一个需要排序的元素\n\t    //这个元素 就是从第二个元素开始，到最后一个元素都是这个需要排序的元素\n\t    //利用循环就可以标志出来\n\t    //i循环控制 每次需要插入的元素，一旦需要插入的元素控制好了，\n\t    //间接已经将数组分成了2部分，下标小于当前的（左边的），是排序好的序列\n\t    for($i=1, $len=count($arr); $i<$len; $i++) {\n\t        //获得当前需要比较的元素值。\n\t        $tmp = $arr[$i];\n\t        //内层循环控制 比较 并 插入\n\t        for($j=$i-1;$j>=0;$j--) {\n\t   //$arr[$i];//需要插入的元素; $arr[$j];//需要比较的元素\n\t            if($tmp < $arr[$j]) {\n\t                //发现插入的元素要小，交换位置\n\t                //将后边的元素与前面的元素互换\n\t                $arr[$j+1] = $arr[$j];\n\t                //将前面的数设置为 当前需要交换的数\n\t                $arr[$j] = $tmp;\n\t            } else {\n\t                //如果碰到不需要移动的元素\n\t           //由于是已经排序好是数组，则前面的就不需要再次比较了。\n\t                break;\n\t            }\n\t        }\n\t    }\n\t    //将这个元素 插入到已经排序好的序列内。\n\t    //返回\n\t    return $arr;\n\t}\n```\n输出结果\n```\n\tArray\n\t(\n\t    [0] => 2\n\t    [1] => 3\n\t    [2] => 6\n\t    [3] => 11\n\t    [4] => 13\n\t    [5] => 15\n\t    [6] => 16\n\t    [7] => 22\n\t    [8] => 23\n\t    [9] => 30\n\t    [10] => 42\n\t    [11] => 45\n\t    [12] => 47\n\t    [13] => 50\n\t)\n```","source":"_posts/常见的几种算法.md","raw":"---\ntitle: 常见的几种算法\ndate: 2017-10-23 19:59:14\ntags: PHP\ncategories: PHP\n---\n冒泡排序、递归、快排等\n\n<!-- more -->\n\n## \t冒泡排序\n它重复地走访过要排序的元素列，一次比较两个相邻的元素，如果他们的顺序（如从大到小、首字母从A到Z）错误就把他们交换过来。走访元素的工作是重复地进行直到没有相邻元素需要交换，也就是说该元素已经排序完成。\n```\n\t<?php\n\tfunction bubble_sort(&$arr)\n\t{\n\t\tfor($len = cout($arr); $i = 0; $i++) {\n\t\t\tfor($j = 1; $i < $len; $i++) {\n\t\t\t\tif($arr[$j - 1] > $arr[$j]) {\n\t\t\t\t\t$temp = $arr[$j -1];\n\t\t\t\t\t$arr[$j - 1] = $arr[$j];\n\t\t\t\t\t$arr[$j] = $stmp;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t$arr = array(10,  2,  3, 1,  89, 92);\n\tbubble_sort($arr);\n\tprint_r($arr);\n```\n## \t快排\n```\n\tfunction partition(&$arr,$low,$high)\n\t{ \n\t\t$pivotkey = $arr[$low]; \n\t\twhile($low < $high){ \n\t\t\twhile($low < $high && $arr[$high] >= $pivotkey)\n\t\t\t{\n\t\t\t\t$high--; \n\t\t\t}\n\t\t\t$temp = $arr[$low];\n\t\t\t$arr[$low] = $arr[$high] = $temp;\n\t\t\t$arr[$high];\n\t\t\twhile($low < $high && $pivotkey){ \n\t\t\t\t$low++;\n\t\t\t}\n\t\t\t$temp = $arr[$low];\n\t\t\t$arr[$low] = $arr[$high];\n\t\t\t$arr[$high] = $temp;\n\t\t }\n\t\treturn $low; \n\t}\n```\n##\t递归\n实现无限分类\n```\n\t<?php\n\tfunction tree($arr, $pid = 0; $level = 0)\n\t{\n\t\tstatic $list = array();\n\t\tforeach($arr as $v) {\n\t\t\t//如果是顶级分类，则将其存到$list中\n\t\t\t//并以节点作为根节点，遍历找子节点\n\t\t\tif($v['oarent_id'] == $pid) {\n\t\t\t\t$v['level'] = $level;\n\t\t\t\t$list[] = $v;\n\t\t\t\ttree($arr, $v['cat_id'], $level+1);\n\t\t\t}\n\t\t}\n\t\treturn $list;\n\t}\n```\n## \t插入排序\n插入排序思路：\n\t将数组分成两个区域：已排序区域和未排序区域。首先假设数组的第一个元素处于已排序区域，\n    第一个元素之后的所有元素都处于未排序区域。\n    排序时用到两层循环，第一层循环用于从未排序区域中取出待排序元素，并逐步缩小未排序区域，\n    第二层循环用于从已排序区域中寻找插入位置（即不断地从已排序区域中寻找比待排序元素大的元素，\n    然后将较大的已排序区的元素后移，后移的最终结果是已排序区元素的最后一个元素占据\n    待排序元素原来的位置，而已排序区中间空出一个位置），最后将待排序元素插入元素后移后留下的空位\n代码:\n```\n\t<?php \n\theader('content-type:text/html;charset=utf8 ');\n\t$arr=array(50,2,45,42,6,47,23,22,15,11,30,16,13,3);\n\t \n\t//调用排序方法\n\techo \"<pre>\";\n\tprint_r(insert_sort($arr));\n```\n插入排序法的方法\n```\n\tfunction insert_sort($arr) {\n\t    //区分 哪部分是已经排序好的\n\t    //哪部分是没有排序的\n\t    //找到其中一个需要排序的元素\n\t    //这个元素 就是从第二个元素开始，到最后一个元素都是这个需要排序的元素\n\t    //利用循环就可以标志出来\n\t    //i循环控制 每次需要插入的元素，一旦需要插入的元素控制好了，\n\t    //间接已经将数组分成了2部分，下标小于当前的（左边的），是排序好的序列\n\t    for($i=1, $len=count($arr); $i<$len; $i++) {\n\t        //获得当前需要比较的元素值。\n\t        $tmp = $arr[$i];\n\t        //内层循环控制 比较 并 插入\n\t        for($j=$i-1;$j>=0;$j--) {\n\t   //$arr[$i];//需要插入的元素; $arr[$j];//需要比较的元素\n\t            if($tmp < $arr[$j]) {\n\t                //发现插入的元素要小，交换位置\n\t                //将后边的元素与前面的元素互换\n\t                $arr[$j+1] = $arr[$j];\n\t                //将前面的数设置为 当前需要交换的数\n\t                $arr[$j] = $tmp;\n\t            } else {\n\t                //如果碰到不需要移动的元素\n\t           //由于是已经排序好是数组，则前面的就不需要再次比较了。\n\t                break;\n\t            }\n\t        }\n\t    }\n\t    //将这个元素 插入到已经排序好的序列内。\n\t    //返回\n\t    return $arr;\n\t}\n```\n输出结果\n```\n\tArray\n\t(\n\t    [0] => 2\n\t    [1] => 3\n\t    [2] => 6\n\t    [3] => 11\n\t    [4] => 13\n\t    [5] => 15\n\t    [6] => 16\n\t    [7] => 22\n\t    [8] => 23\n\t    [9] => 30\n\t    [10] => 42\n\t    [11] => 45\n\t    [12] => 47\n\t    [13] => 50\n\t)\n```","slug":"常见的几种算法","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuwn000sydqn84fssgch","content":"<p>冒泡排序、递归、快排等</p>\n<a id=\"more\"></a>\n<h2 id=\"冒泡排序\"><a href=\"#冒泡排序\" class=\"headerlink\" title=\"冒泡排序\"></a>冒泡排序</h2><p>它重复地走访过要排序的元素列，一次比较两个相邻的元素，如果他们的顺序（如从大到小、首字母从A到Z）错误就把他们交换过来。走访元素的工作是重复地进行直到没有相邻元素需要交换，也就是说该元素已经排序完成。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bubble_sort</span><span class=\"params\">(&amp;$arr)</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">for</span>($len = cout($arr); $i = <span class=\"number\">0</span>; $i++) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">for</span>($j = <span class=\"number\">1</span>; $i &lt; $len; $i++) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">if</span>($arr[$j - <span class=\"number\">1</span>] &gt; $arr[$j]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$temp = $arr[$j <span class=\"number\">-1</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$arr[$j - <span class=\"number\">1</span>] = $arr[$j];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$arr[$j] = $stmp;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$arr = <span class=\"keyword\">array</span>(<span class=\"number\">10</span>,  <span class=\"number\">2</span>,  <span class=\"number\">3</span>, <span class=\"number\">1</span>,  <span class=\"number\">89</span>, <span class=\"number\">92</span>);</span></span><br><span class=\"line\"><span class=\"php\">bubble_sort($arr);</span></span><br><span class=\"line\"><span class=\"php\">print_r($arr);</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"快排\"><a href=\"#快排\" class=\"headerlink\" title=\"快排\"></a>快排</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function partition(&amp;$arr,$low,$high)</span><br><span class=\"line\">&#123; </span><br><span class=\"line\"><span class=\"meta\">\t$</span><span class=\"bash\">pivotkey = <span class=\"variable\">$arr</span>[<span class=\"variable\">$low</span>]; </span></span><br><span class=\"line\"><span class=\"meta\">\twhile($</span><span class=\"bash\">low &lt; <span class=\"variable\">$high</span>)&#123; </span></span><br><span class=\"line\"><span class=\"meta\">\t\twhile($</span><span class=\"bash\">low &lt; <span class=\"variable\">$high</span> &amp;&amp; <span class=\"variable\">$arr</span>[<span class=\"variable\">$high</span>] &gt;= <span class=\"variable\">$pivotkey</span>)</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\"><span class=\"meta\">\t\t\t$</span><span class=\"bash\">high--; </span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">temp = <span class=\"variable\">$arr</span>[<span class=\"variable\">$low</span>];</span></span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">arr[<span class=\"variable\">$low</span>] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$high</span>] = <span class=\"variable\">$temp</span>;</span></span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">arr[<span class=\"variable\">$high</span>];</span></span><br><span class=\"line\"><span class=\"meta\">\t\twhile($</span><span class=\"bash\">low &lt; <span class=\"variable\">$high</span> &amp;&amp; <span class=\"variable\">$pivotkey</span>)&#123; </span></span><br><span class=\"line\"><span class=\"meta\">\t\t\t$</span><span class=\"bash\">low++;</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">temp = <span class=\"variable\">$arr</span>[<span class=\"variable\">$low</span>];</span></span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">arr[<span class=\"variable\">$low</span>] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$high</span>];</span></span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">arr[<span class=\"variable\">$high</span>] = <span class=\"variable\">$temp</span>;</span></span><br><span class=\"line\">\t &#125;</span><br><span class=\"line\">\treturn $low; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"递归\"><a href=\"#递归\" class=\"headerlink\" title=\"递归\"></a>递归</h2><p>实现无限分类<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">tree</span><span class=\"params\">($arr, $pid = <span class=\"number\">0</span>; $level = <span class=\"number\">0</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">static</span> $list = <span class=\"keyword\">array</span>();</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">foreach</span>($arr <span class=\"keyword\">as</span> $v) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果是顶级分类，则将其存到$list中</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//并以节点作为根节点，遍历找子节点</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span>($v[<span class=\"string\">'oarent_id'</span>] == $pid) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$v[<span class=\"string\">'level'</span>] = $level;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$list[] = $v;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\ttree($arr, $v[<span class=\"string\">'cat_id'</span>], $level+<span class=\"number\">1</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">return</span> $list;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"插入排序\"><a href=\"#插入排序\" class=\"headerlink\" title=\"插入排序\"></a>插入排序</h2><p>插入排序思路：<br>    将数组分成两个区域：已排序区域和未排序区域。首先假设数组的第一个元素处于已排序区域，<br>    第一个元素之后的所有元素都处于未排序区域。<br>    排序时用到两层循环，第一层循环用于从未排序区域中取出待排序元素，并逐步缩小未排序区域，<br>    第二层循环用于从已排序区域中寻找插入位置（即不断地从已排序区域中寻找比待排序元素大的元素，<br>    然后将较大的已排序区的元素后移，后移的最终结果是已排序区元素的最后一个元素占据<br>    待排序元素原来的位置，而已排序区中间空出一个位置），最后将待排序元素插入元素后移后留下的空位<br>代码:<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span> </span></span><br><span class=\"line\"><span class=\"php\">header(<span class=\"string\">'content-type:text/html;charset=utf8 '</span>);</span></span><br><span class=\"line\"><span class=\"php\">$arr=<span class=\"keyword\">array</span>(<span class=\"number\">50</span>,<span class=\"number\">2</span>,<span class=\"number\">45</span>,<span class=\"number\">42</span>,<span class=\"number\">6</span>,<span class=\"number\">47</span>,<span class=\"number\">23</span>,<span class=\"number\">22</span>,<span class=\"number\">15</span>,<span class=\"number\">11</span>,<span class=\"number\">30</span>,<span class=\"number\">16</span>,<span class=\"number\">13</span>,<span class=\"number\">3</span>);</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//调用排序方法</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;pre&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">print_r(insert_sort($arr));</span></span><br></pre></td></tr></table></figure></p>\n<p>插入排序法的方法<br><figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> insert_sort(<span class=\"variable\">$arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"regexp\">//</span>区分 哪部分是已经排序好的</span><br><span class=\"line\">    <span class=\"regexp\">//</span>哪部分是没有排序的</span><br><span class=\"line\">    <span class=\"regexp\">//</span>找到其中一个需要排序的元素</span><br><span class=\"line\">    <span class=\"regexp\">//</span>这个元素 就是从第二个元素开始，到最后一个元素都是这个需要排序的元素</span><br><span class=\"line\">    <span class=\"regexp\">//</span>利用循环就可以标志出来</span><br><span class=\"line\">    <span class=\"regexp\">//i</span>循环控制 每次需要插入的元素，一旦需要插入的元素控制好了，</span><br><span class=\"line\">    <span class=\"regexp\">//</span>间接已经将数组分成了<span class=\"number\">2</span>部分，下标小于当前的（左边的），是排序好的序列</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span>=<span class=\"number\">1</span>, <span class=\"variable\">$len</span>=count(<span class=\"variable\">$arr</span>); <span class=\"variable\">$i</span>&lt;<span class=\"variable\">$len</span>; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">        <span class=\"regexp\">//</span>获得当前需要比较的元素值。</span><br><span class=\"line\">        <span class=\"variable\">$tmp</span> = <span class=\"variable\">$arr</span>[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">        <span class=\"regexp\">//</span>内层循环控制 比较 并 插入</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$j</span>=<span class=\"variable\">$i</span>-<span class=\"number\">1</span>;<span class=\"variable\">$j</span>&gt;=<span class=\"number\">0</span>;<span class=\"variable\">$j</span>--) &#123;</span><br><span class=\"line\">   <span class=\"regexp\">//</span><span class=\"variable\">$arr</span>[<span class=\"variable\">$i</span>];<span class=\"regexp\">//</span>需要插入的元素; <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>];<span class=\"regexp\">//</span>需要比较的元素</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable\">$tmp</span> &lt; <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>]) &#123;</span><br><span class=\"line\">                <span class=\"regexp\">//</span>发现插入的元素要小，交换位置</span><br><span class=\"line\">                <span class=\"regexp\">//</span>将后边的元素与前面的元素互换</span><br><span class=\"line\">                <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>+<span class=\"number\">1</span>] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>];</span><br><span class=\"line\">                <span class=\"regexp\">//</span>将前面的数设置为 当前需要交换的数</span><br><span class=\"line\">                <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>] = <span class=\"variable\">$tmp</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"regexp\">//</span>如果碰到不需要移动的元素</span><br><span class=\"line\">           <span class=\"regexp\">//</span>由于是已经排序好是数组，则前面的就不需要再次比较了。</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"regexp\">//</span>将这个元素 插入到已经排序好的序列内。</span><br><span class=\"line\">    <span class=\"regexp\">//</span>返回</span><br><span class=\"line\">    return <span class=\"variable\">$arr</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>输出结果<br><figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Array</span><br><span class=\"line\">(</span><br><span class=\"line\">    [<span class=\"number\">0</span>] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">    [<span class=\"number\">1</span>] =&gt; <span class=\"number\">3</span></span><br><span class=\"line\">    [<span class=\"number\">2</span>] =&gt; <span class=\"number\">6</span></span><br><span class=\"line\">    [<span class=\"number\">3</span>] =&gt; <span class=\"number\">11</span></span><br><span class=\"line\">    [<span class=\"number\">4</span>] =&gt; <span class=\"number\">13</span></span><br><span class=\"line\">    [<span class=\"number\">5</span>] =&gt; <span class=\"number\">15</span></span><br><span class=\"line\">    [<span class=\"number\">6</span>] =&gt; <span class=\"number\">16</span></span><br><span class=\"line\">    [<span class=\"number\">7</span>] =&gt; <span class=\"number\">22</span></span><br><span class=\"line\">    [<span class=\"number\">8</span>] =&gt; <span class=\"number\">23</span></span><br><span class=\"line\">    [<span class=\"number\">9</span>] =&gt; <span class=\"number\">30</span></span><br><span class=\"line\">    [<span class=\"number\">10</span>] =&gt; <span class=\"number\">42</span></span><br><span class=\"line\">    [<span class=\"number\">11</span>] =&gt; <span class=\"number\">45</span></span><br><span class=\"line\">    [<span class=\"number\">12</span>] =&gt; <span class=\"number\">47</span></span><br><span class=\"line\">    [<span class=\"number\">13</span>] =&gt; <span class=\"number\">50</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"<p>冒泡排序、递归、快排等</p>","more":"<h2 id=\"冒泡排序\"><a href=\"#冒泡排序\" class=\"headerlink\" title=\"冒泡排序\"></a>冒泡排序</h2><p>它重复地走访过要排序的元素列，一次比较两个相邻的元素，如果他们的顺序（如从大到小、首字母从A到Z）错误就把他们交换过来。走访元素的工作是重复地进行直到没有相邻元素需要交换，也就是说该元素已经排序完成。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bubble_sort</span><span class=\"params\">(&amp;$arr)</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">for</span>($len = cout($arr); $i = <span class=\"number\">0</span>; $i++) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">for</span>($j = <span class=\"number\">1</span>; $i &lt; $len; $i++) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t<span class=\"keyword\">if</span>($arr[$j - <span class=\"number\">1</span>] &gt; $arr[$j]) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$temp = $arr[$j <span class=\"number\">-1</span>];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$arr[$j - <span class=\"number\">1</span>] = $arr[$j];</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t\t$arr[$j] = $stmp;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\">$arr = <span class=\"keyword\">array</span>(<span class=\"number\">10</span>,  <span class=\"number\">2</span>,  <span class=\"number\">3</span>, <span class=\"number\">1</span>,  <span class=\"number\">89</span>, <span class=\"number\">92</span>);</span></span><br><span class=\"line\"><span class=\"php\">bubble_sort($arr);</span></span><br><span class=\"line\"><span class=\"php\">print_r($arr);</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"快排\"><a href=\"#快排\" class=\"headerlink\" title=\"快排\"></a>快排</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function partition(&amp;$arr,$low,$high)</span><br><span class=\"line\">&#123; </span><br><span class=\"line\"><span class=\"meta\">\t$</span><span class=\"bash\">pivotkey = <span class=\"variable\">$arr</span>[<span class=\"variable\">$low</span>]; </span></span><br><span class=\"line\"><span class=\"meta\">\twhile($</span><span class=\"bash\">low &lt; <span class=\"variable\">$high</span>)&#123; </span></span><br><span class=\"line\"><span class=\"meta\">\t\twhile($</span><span class=\"bash\">low &lt; <span class=\"variable\">$high</span> &amp;&amp; <span class=\"variable\">$arr</span>[<span class=\"variable\">$high</span>] &gt;= <span class=\"variable\">$pivotkey</span>)</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\"><span class=\"meta\">\t\t\t$</span><span class=\"bash\">high--; </span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">temp = <span class=\"variable\">$arr</span>[<span class=\"variable\">$low</span>];</span></span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">arr[<span class=\"variable\">$low</span>] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$high</span>] = <span class=\"variable\">$temp</span>;</span></span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">arr[<span class=\"variable\">$high</span>];</span></span><br><span class=\"line\"><span class=\"meta\">\t\twhile($</span><span class=\"bash\">low &lt; <span class=\"variable\">$high</span> &amp;&amp; <span class=\"variable\">$pivotkey</span>)&#123; </span></span><br><span class=\"line\"><span class=\"meta\">\t\t\t$</span><span class=\"bash\">low++;</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">temp = <span class=\"variable\">$arr</span>[<span class=\"variable\">$low</span>];</span></span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">arr[<span class=\"variable\">$low</span>] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$high</span>];</span></span><br><span class=\"line\"><span class=\"meta\">\t\t$</span><span class=\"bash\">arr[<span class=\"variable\">$high</span>] = <span class=\"variable\">$temp</span>;</span></span><br><span class=\"line\">\t &#125;</span><br><span class=\"line\">\treturn $low; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"递归\"><a href=\"#递归\" class=\"headerlink\" title=\"递归\"></a>递归</h2><p>实现无限分类<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">tree</span><span class=\"params\">($arr, $pid = <span class=\"number\">0</span>; $level = <span class=\"number\">0</span>)</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">static</span> $list = <span class=\"keyword\">array</span>();</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">foreach</span>($arr <span class=\"keyword\">as</span> $v) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//如果是顶级分类，则将其存到$list中</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"comment\">//并以节点作为根节点，遍历找子节点</span></span></span><br><span class=\"line\"><span class=\"php\">\t\t<span class=\"keyword\">if</span>($v[<span class=\"string\">'oarent_id'</span>] == $pid) &#123;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$v[<span class=\"string\">'level'</span>] = $level;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\t$list[] = $v;</span></span><br><span class=\"line\"><span class=\"php\">\t\t\ttree($arr, $v[<span class=\"string\">'cat_id'</span>], $level+<span class=\"number\">1</span>);</span></span><br><span class=\"line\"><span class=\"php\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t&#125;</span></span><br><span class=\"line\"><span class=\"php\">\t<span class=\"keyword\">return</span> $list;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"插入排序\"><a href=\"#插入排序\" class=\"headerlink\" title=\"插入排序\"></a>插入排序</h2><p>插入排序思路：<br>    将数组分成两个区域：已排序区域和未排序区域。首先假设数组的第一个元素处于已排序区域，<br>    第一个元素之后的所有元素都处于未排序区域。<br>    排序时用到两层循环，第一层循环用于从未排序区域中取出待排序元素，并逐步缩小未排序区域，<br>    第二层循环用于从已排序区域中寻找插入位置（即不断地从已排序区域中寻找比待排序元素大的元素，<br>    然后将较大的已排序区的元素后移，后移的最终结果是已排序区元素的最后一个元素占据<br>    待排序元素原来的位置，而已排序区中间空出一个位置），最后将待排序元素插入元素后移后留下的空位<br>代码:<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span> </span></span><br><span class=\"line\"><span class=\"php\">header(<span class=\"string\">'content-type:text/html;charset=utf8 '</span>);</span></span><br><span class=\"line\"><span class=\"php\">$arr=<span class=\"keyword\">array</span>(<span class=\"number\">50</span>,<span class=\"number\">2</span>,<span class=\"number\">45</span>,<span class=\"number\">42</span>,<span class=\"number\">6</span>,<span class=\"number\">47</span>,<span class=\"number\">23</span>,<span class=\"number\">22</span>,<span class=\"number\">15</span>,<span class=\"number\">11</span>,<span class=\"number\">30</span>,<span class=\"number\">16</span>,<span class=\"number\">13</span>,<span class=\"number\">3</span>);</span></span><br><span class=\"line\"><span class=\"php\"> </span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//调用排序方法</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;pre&gt;\"</span>;</span></span><br><span class=\"line\"><span class=\"php\">print_r(insert_sort($arr));</span></span><br></pre></td></tr></table></figure></p>\n<p>插入排序法的方法<br><figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> insert_sort(<span class=\"variable\">$arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"regexp\">//</span>区分 哪部分是已经排序好的</span><br><span class=\"line\">    <span class=\"regexp\">//</span>哪部分是没有排序的</span><br><span class=\"line\">    <span class=\"regexp\">//</span>找到其中一个需要排序的元素</span><br><span class=\"line\">    <span class=\"regexp\">//</span>这个元素 就是从第二个元素开始，到最后一个元素都是这个需要排序的元素</span><br><span class=\"line\">    <span class=\"regexp\">//</span>利用循环就可以标志出来</span><br><span class=\"line\">    <span class=\"regexp\">//i</span>循环控制 每次需要插入的元素，一旦需要插入的元素控制好了，</span><br><span class=\"line\">    <span class=\"regexp\">//</span>间接已经将数组分成了<span class=\"number\">2</span>部分，下标小于当前的（左边的），是排序好的序列</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span>=<span class=\"number\">1</span>, <span class=\"variable\">$len</span>=count(<span class=\"variable\">$arr</span>); <span class=\"variable\">$i</span>&lt;<span class=\"variable\">$len</span>; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">        <span class=\"regexp\">//</span>获得当前需要比较的元素值。</span><br><span class=\"line\">        <span class=\"variable\">$tmp</span> = <span class=\"variable\">$arr</span>[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">        <span class=\"regexp\">//</span>内层循环控制 比较 并 插入</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$j</span>=<span class=\"variable\">$i</span>-<span class=\"number\">1</span>;<span class=\"variable\">$j</span>&gt;=<span class=\"number\">0</span>;<span class=\"variable\">$j</span>--) &#123;</span><br><span class=\"line\">   <span class=\"regexp\">//</span><span class=\"variable\">$arr</span>[<span class=\"variable\">$i</span>];<span class=\"regexp\">//</span>需要插入的元素; <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>];<span class=\"regexp\">//</span>需要比较的元素</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable\">$tmp</span> &lt; <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>]) &#123;</span><br><span class=\"line\">                <span class=\"regexp\">//</span>发现插入的元素要小，交换位置</span><br><span class=\"line\">                <span class=\"regexp\">//</span>将后边的元素与前面的元素互换</span><br><span class=\"line\">                <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>+<span class=\"number\">1</span>] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>];</span><br><span class=\"line\">                <span class=\"regexp\">//</span>将前面的数设置为 当前需要交换的数</span><br><span class=\"line\">                <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>] = <span class=\"variable\">$tmp</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"regexp\">//</span>如果碰到不需要移动的元素</span><br><span class=\"line\">           <span class=\"regexp\">//</span>由于是已经排序好是数组，则前面的就不需要再次比较了。</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"regexp\">//</span>将这个元素 插入到已经排序好的序列内。</span><br><span class=\"line\">    <span class=\"regexp\">//</span>返回</span><br><span class=\"line\">    return <span class=\"variable\">$arr</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>输出结果<br><figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Array</span><br><span class=\"line\">(</span><br><span class=\"line\">    [<span class=\"number\">0</span>] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">    [<span class=\"number\">1</span>] =&gt; <span class=\"number\">3</span></span><br><span class=\"line\">    [<span class=\"number\">2</span>] =&gt; <span class=\"number\">6</span></span><br><span class=\"line\">    [<span class=\"number\">3</span>] =&gt; <span class=\"number\">11</span></span><br><span class=\"line\">    [<span class=\"number\">4</span>] =&gt; <span class=\"number\">13</span></span><br><span class=\"line\">    [<span class=\"number\">5</span>] =&gt; <span class=\"number\">15</span></span><br><span class=\"line\">    [<span class=\"number\">6</span>] =&gt; <span class=\"number\">16</span></span><br><span class=\"line\">    [<span class=\"number\">7</span>] =&gt; <span class=\"number\">22</span></span><br><span class=\"line\">    [<span class=\"number\">8</span>] =&gt; <span class=\"number\">23</span></span><br><span class=\"line\">    [<span class=\"number\">9</span>] =&gt; <span class=\"number\">30</span></span><br><span class=\"line\">    [<span class=\"number\">10</span>] =&gt; <span class=\"number\">42</span></span><br><span class=\"line\">    [<span class=\"number\">11</span>] =&gt; <span class=\"number\">45</span></span><br><span class=\"line\">    [<span class=\"number\">12</span>] =&gt; <span class=\"number\">47</span></span><br><span class=\"line\">    [<span class=\"number\">13</span>] =&gt; <span class=\"number\">50</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure></p>"},{"title":"策略模式","date":"2017-08-23T12:12:25.000Z","_content":"策略模式是对象的行为模式，用意是对一组算法的封装。动态的选择需要的算法并使用。\n\n<!-- more -->\n\n##\t介绍\n策略模式指的是程序中涉及决策控制的一种模式。策略模式功能非常强大，因为这个设计模式本身的核心思想就是面向对象编程的多形性思想。\n\n##\t策略模式的三个角色：\n1、抽象策略角色\n2、具体策略角色\n3、环境角色（对抽象策略角色的引用）\n\n##\t实现步骤\n1、定义抽象角色类（定义好各个实现的共同抽象方法）\n2、定义具体策略类（具体实现父类的共同方法）\n3、定义环境角色类（私有化申明抽象角色变量，重载构造方法，执行抽象方法）\n\n##\t实现代码\n```\n\t<?php\n\t    abstract class baseAgent { //抽象策略类\n\t        abstract function PrintPage();\n\t    }\n\t    //用于客户端是IE时调用的类（环境角色）\n\t    class ieAgent extends baseAgent {\n\t        function PrintPage() {\n\t            return 'IE';\n\t        }\n\t    }\n\t    //用于客户端不是IE时调用的类（环境角色）\n\t    class otherAgent extends baseAgent {\n\t        function PrintPage() {\n\t            return 'not IE';\n\t        }\n\t    }\n\t    class Browser { //具体策略角色\n\t        public function call($object) {\n\t                return $object->PrintPage ();\n\t            }\n\t        }\n\t        $bro = new Browser ();\n\t    echo $bro->call ( new ieAgent () );\n\t?>\n\t```\n\t","source":"_posts/策略模式.md","raw":"---\ntitle: 策略模式\ndate: 2017-08-23 20:12:25\ntags: 设计模式\ncategories: 设计模式\n---\n策略模式是对象的行为模式，用意是对一组算法的封装。动态的选择需要的算法并使用。\n\n<!-- more -->\n\n##\t介绍\n策略模式指的是程序中涉及决策控制的一种模式。策略模式功能非常强大，因为这个设计模式本身的核心思想就是面向对象编程的多形性思想。\n\n##\t策略模式的三个角色：\n1、抽象策略角色\n2、具体策略角色\n3、环境角色（对抽象策略角色的引用）\n\n##\t实现步骤\n1、定义抽象角色类（定义好各个实现的共同抽象方法）\n2、定义具体策略类（具体实现父类的共同方法）\n3、定义环境角色类（私有化申明抽象角色变量，重载构造方法，执行抽象方法）\n\n##\t实现代码\n```\n\t<?php\n\t    abstract class baseAgent { //抽象策略类\n\t        abstract function PrintPage();\n\t    }\n\t    //用于客户端是IE时调用的类（环境角色）\n\t    class ieAgent extends baseAgent {\n\t        function PrintPage() {\n\t            return 'IE';\n\t        }\n\t    }\n\t    //用于客户端不是IE时调用的类（环境角色）\n\t    class otherAgent extends baseAgent {\n\t        function PrintPage() {\n\t            return 'not IE';\n\t        }\n\t    }\n\t    class Browser { //具体策略角色\n\t        public function call($object) {\n\t                return $object->PrintPage ();\n\t            }\n\t        }\n\t        $bro = new Browser ();\n\t    echo $bro->call ( new ieAgent () );\n\t?>\n\t```\n\t","slug":"策略模式","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuwp000uydqn2ah5km0i","content":"<p>策略模式是对象的行为模式，用意是对一组算法的封装。动态的选择需要的算法并使用。</p>\n<a id=\"more\"></a>\n<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>策略模式指的是程序中涉及决策控制的一种模式。策略模式功能非常强大，因为这个设计模式本身的核心思想就是面向对象编程的多形性思想。</p>\n<h2 id=\"策略模式的三个角色：\"><a href=\"#策略模式的三个角色：\" class=\"headerlink\" title=\"策略模式的三个角色：\"></a>策略模式的三个角色：</h2><p>1、抽象策略角色<br>2、具体策略角色<br>3、环境角色（对抽象策略角色的引用）</p>\n<h2 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h2><p>1、定义抽象角色类（定义好各个实现的共同抽象方法）<br>2、定义具体策略类（具体实现父类的共同方法）<br>3、定义环境角色类（私有化申明抽象角色变量，重载构造方法，执行抽象方法）</p>\n<h2 id=\"实现代码\"><a href=\"#实现代码\" class=\"headerlink\" title=\"实现代码\"></a>实现代码</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">baseAgent</span> </span>&#123; <span class=\"comment\">//抽象策略类</span></span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">abstract</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">PrintPage</span><span class=\"params\">()</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"comment\">//用于客户端是IE时调用的类（环境角色）</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ieAgent</span> <span class=\"keyword\">extends</span> <span class=\"title\">baseAgent</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">PrintPage</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">            <span class=\"keyword\">return</span> <span class=\"string\">'IE'</span>;</span></span><br><span class=\"line\"><span class=\"php\">        &#125;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"comment\">//用于客户端不是IE时调用的类（环境角色）</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">otherAgent</span> <span class=\"keyword\">extends</span> <span class=\"title\">baseAgent</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">PrintPage</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">            <span class=\"keyword\">return</span> <span class=\"string\">'not IE'</span>;</span></span><br><span class=\"line\"><span class=\"php\">        &#125;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Browser</span> </span>&#123; <span class=\"comment\">//具体策略角色</span></span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">call</span><span class=\"params\">($object)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">                <span class=\"keyword\">return</span> $object-&gt;PrintPage ();</span></span><br><span class=\"line\"><span class=\"php\">            &#125;</span></span><br><span class=\"line\"><span class=\"php\">        &#125;</span></span><br><span class=\"line\"><span class=\"php\">        $bro = <span class=\"keyword\">new</span> Browser ();</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> $bro-&gt;call ( <span class=\"keyword\">new</span> ieAgent () );</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"meta\">?&gt;</span></span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>策略模式是对象的行为模式，用意是对一组算法的封装。动态的选择需要的算法并使用。</p>","more":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>策略模式指的是程序中涉及决策控制的一种模式。策略模式功能非常强大，因为这个设计模式本身的核心思想就是面向对象编程的多形性思想。</p>\n<h2 id=\"策略模式的三个角色：\"><a href=\"#策略模式的三个角色：\" class=\"headerlink\" title=\"策略模式的三个角色：\"></a>策略模式的三个角色：</h2><p>1、抽象策略角色<br>2、具体策略角色<br>3、环境角色（对抽象策略角色的引用）</p>\n<h2 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h2><p>1、定义抽象角色类（定义好各个实现的共同抽象方法）<br>2、定义具体策略类（具体实现父类的共同方法）<br>3、定义环境角色类（私有化申明抽象角色变量，重载构造方法，执行抽象方法）</p>\n<h2 id=\"实现代码\"><a href=\"#实现代码\" class=\"headerlink\" title=\"实现代码\"></a>实现代码</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">baseAgent</span> </span>&#123; <span class=\"comment\">//抽象策略类</span></span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">abstract</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">PrintPage</span><span class=\"params\">()</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"comment\">//用于客户端是IE时调用的类（环境角色）</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ieAgent</span> <span class=\"keyword\">extends</span> <span class=\"title\">baseAgent</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">PrintPage</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">            <span class=\"keyword\">return</span> <span class=\"string\">'IE'</span>;</span></span><br><span class=\"line\"><span class=\"php\">        &#125;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"comment\">//用于客户端不是IE时调用的类（环境角色）</span></span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">otherAgent</span> <span class=\"keyword\">extends</span> <span class=\"title\">baseAgent</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">PrintPage</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">            <span class=\"keyword\">return</span> <span class=\"string\">'not IE'</span>;</span></span><br><span class=\"line\"><span class=\"php\">        &#125;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Browser</span> </span>&#123; <span class=\"comment\">//具体策略角色</span></span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">call</span><span class=\"params\">($object)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">                <span class=\"keyword\">return</span> $object-&gt;PrintPage ();</span></span><br><span class=\"line\"><span class=\"php\">            &#125;</span></span><br><span class=\"line\"><span class=\"php\">        &#125;</span></span><br><span class=\"line\"><span class=\"php\">        $bro = <span class=\"keyword\">new</span> Browser ();</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">echo</span> $bro-&gt;call ( <span class=\"keyword\">new</span> ieAgent () );</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"meta\">?&gt;</span></span></span><br></pre></td></tr></table></figure>"},{"title":"观察者模式","date":"2017-09-01T11:17:41.000Z","_content":"观察者模式(Observer)，简单理解就是当你的程序在运行时，会有另一套程序在观察。\n\n<!-- more -->\n\n##\t介绍\n1、观察者模式(Observer)，当一个对象状态发生变化时，依赖它的对象全部会收到通知，并自动更新。 \n2、场景:一个事件发生后，要执行一连串更新操作。传统的编程方式，就是在事件的代码之后直接加入处理的逻辑。当更新的逻辑增多之后，代码会变得难以维护。这种方式是耦合的，侵入式的，增加新的逻辑需要修改事件的主体代码。 \n3、观察者模式实现了低耦合，非侵入式的通知与更新机制。  \n\n##\t定义一个事件触发抽象类。\n```\n\tEventGenerator.php\n\t<?php\n\trequire_once 'Loader.php';\n\tabstract class EventGenerator{\n\t    private $observers = array();\n\t        function addObserver(Observer $observer){\n\t        $this->observers[]=$observer;\n\t    }\n\t    function notify(){\n\t        foreach ($this->observers as $observer){\n\t            $observer->update();\n\t        }\n\t    }\n\t}\n```\n##\t定义一个观察者接口\n```\n\tObserver.php\n\t<?php\n\trequire_once 'Loader.php';\n\tinterface Observer{\n\t    function update();//这里就是在事件发生后要执行的逻辑\n\t}\n\t//一个实现了EventGenerator抽象类的类，用于具体定义某个发生的事件\n```\n##\t实现\n```\n\trequire 'Loader.php';\n\tclass Event extends EventGenerator{\n\t    function triger(){\n\t        echo \"Event<br>\";\n\t    }\n\t}\n\tclass Observer1 implements Observer{\n\t    function update(){\n\t        echo \"逻辑1<br>\";\n\t    }\n\t}\n\tclass Observer2 implements Observer{\n\t    function update(){\n\t        echo \"逻辑2<br>\";\n\t    }\n\t}\n\t$event = new Event();\n\t$event->addObserver(new Observer1());\n\t$event->addObserver(new Observer2());\n\t$event->triger();\n\t$event->notify();\n```","source":"_posts/观察者模式.md","raw":"---\ntitle: 观察者模式\ndate: 2017-09-01 19:17:41\ntags: 设计模式\ncategories: 设计模式\n---\n观察者模式(Observer)，简单理解就是当你的程序在运行时，会有另一套程序在观察。\n\n<!-- more -->\n\n##\t介绍\n1、观察者模式(Observer)，当一个对象状态发生变化时，依赖它的对象全部会收到通知，并自动更新。 \n2、场景:一个事件发生后，要执行一连串更新操作。传统的编程方式，就是在事件的代码之后直接加入处理的逻辑。当更新的逻辑增多之后，代码会变得难以维护。这种方式是耦合的，侵入式的，增加新的逻辑需要修改事件的主体代码。 \n3、观察者模式实现了低耦合，非侵入式的通知与更新机制。  \n\n##\t定义一个事件触发抽象类。\n```\n\tEventGenerator.php\n\t<?php\n\trequire_once 'Loader.php';\n\tabstract class EventGenerator{\n\t    private $observers = array();\n\t        function addObserver(Observer $observer){\n\t        $this->observers[]=$observer;\n\t    }\n\t    function notify(){\n\t        foreach ($this->observers as $observer){\n\t            $observer->update();\n\t        }\n\t    }\n\t}\n```\n##\t定义一个观察者接口\n```\n\tObserver.php\n\t<?php\n\trequire_once 'Loader.php';\n\tinterface Observer{\n\t    function update();//这里就是在事件发生后要执行的逻辑\n\t}\n\t//一个实现了EventGenerator抽象类的类，用于具体定义某个发生的事件\n```\n##\t实现\n```\n\trequire 'Loader.php';\n\tclass Event extends EventGenerator{\n\t    function triger(){\n\t        echo \"Event<br>\";\n\t    }\n\t}\n\tclass Observer1 implements Observer{\n\t    function update(){\n\t        echo \"逻辑1<br>\";\n\t    }\n\t}\n\tclass Observer2 implements Observer{\n\t    function update(){\n\t        echo \"逻辑2<br>\";\n\t    }\n\t}\n\t$event = new Event();\n\t$event->addObserver(new Observer1());\n\t$event->addObserver(new Observer2());\n\t$event->triger();\n\t$event->notify();\n```","slug":"观察者模式","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuwq000xydqn7csv28td","content":"<p>观察者模式(Observer)，简单理解就是当你的程序在运行时，会有另一套程序在观察。</p>\n<a id=\"more\"></a>\n<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>1、观察者模式(Observer)，当一个对象状态发生变化时，依赖它的对象全部会收到通知，并自动更新。<br>2、场景:一个事件发生后，要执行一连串更新操作。传统的编程方式，就是在事件的代码之后直接加入处理的逻辑。当更新的逻辑增多之后，代码会变得难以维护。这种方式是耦合的，侵入式的，增加新的逻辑需要修改事件的主体代码。<br>3、观察者模式实现了低耦合，非侵入式的通知与更新机制。  </p>\n<h2 id=\"定义一个事件触发抽象类。\"><a href=\"#定义一个事件触发抽象类。\" class=\"headerlink\" title=\"定义一个事件触发抽象类。\"></a>定义一个事件触发抽象类。</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EventGenerator.php</span><br><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">require_once</span> <span class=\"string\">'Loader.php'</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EventGenerator</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">private</span> $observers = <span class=\"keyword\">array</span>();</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addObserver</span><span class=\"params\">(Observer $observer)</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">$this</span>-&gt;observers[]=$observer;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">notify</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;observers <span class=\"keyword\">as</span> $observer)&#123;</span></span><br><span class=\"line\"><span class=\"php\">            $observer-&gt;update();</span></span><br><span class=\"line\"><span class=\"php\">        &#125;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"定义一个观察者接口\"><a href=\"#定义一个观察者接口\" class=\"headerlink\" title=\"定义一个观察者接口\"></a>定义一个观察者接口</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Observer.php</span><br><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">require_once</span> <span class=\"string\">'Loader.php'</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Observer</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>;<span class=\"comment\">//这里就是在事件发生后要执行的逻辑</span></span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//一个实现了EventGenerator抽象类的类，用于具体定义某个发生的事件</span></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'Loader.php'</span>;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Event</span> <span class=\"keyword\">extends</span> <span class=\"title\">EventGenerator</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">triger</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"Event&lt;br&gt;\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Observer1</span> <span class=\"keyword\">implements</span> <span class=\"title\">Observer</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"逻辑1&lt;br&gt;\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Observer2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Observer</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"逻辑2&lt;br&gt;\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$event = <span class=\"keyword\">new</span> Event();</span><br><span class=\"line\">$event-&gt;addObserver(<span class=\"keyword\">new</span> Observer1());</span><br><span class=\"line\">$event-&gt;addObserver(<span class=\"keyword\">new</span> Observer2());</span><br><span class=\"line\">$event-&gt;triger();</span><br><span class=\"line\">$event-&gt;notify();</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>观察者模式(Observer)，简单理解就是当你的程序在运行时，会有另一套程序在观察。</p>","more":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>1、观察者模式(Observer)，当一个对象状态发生变化时，依赖它的对象全部会收到通知，并自动更新。<br>2、场景:一个事件发生后，要执行一连串更新操作。传统的编程方式，就是在事件的代码之后直接加入处理的逻辑。当更新的逻辑增多之后，代码会变得难以维护。这种方式是耦合的，侵入式的，增加新的逻辑需要修改事件的主体代码。<br>3、观察者模式实现了低耦合，非侵入式的通知与更新机制。  </p>\n<h2 id=\"定义一个事件触发抽象类。\"><a href=\"#定义一个事件触发抽象类。\" class=\"headerlink\" title=\"定义一个事件触发抽象类。\"></a>定义一个事件触发抽象类。</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EventGenerator.php</span><br><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">require_once</span> <span class=\"string\">'Loader.php'</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EventGenerator</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">private</span> $observers = <span class=\"keyword\">array</span>();</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addObserver</span><span class=\"params\">(Observer $observer)</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">$this</span>-&gt;observers[]=$observer;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">notify</span><span class=\"params\">()</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;observers <span class=\"keyword\">as</span> $observer)&#123;</span></span><br><span class=\"line\"><span class=\"php\">            $observer-&gt;update();</span></span><br><span class=\"line\"><span class=\"php\">        &#125;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"定义一个观察者接口\"><a href=\"#定义一个观察者接口\" class=\"headerlink\" title=\"定义一个观察者接口\"></a>定义一个观察者接口</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Observer.php</span><br><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">require_once</span> <span class=\"string\">'Loader.php'</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Observer</span></span>&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>;<span class=\"comment\">//这里就是在事件发生后要执行的逻辑</span></span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"comment\">//一个实现了EventGenerator抽象类的类，用于具体定义某个发生的事件</span></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'Loader.php'</span>;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Event</span> <span class=\"keyword\">extends</span> <span class=\"title\">EventGenerator</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">triger</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"Event&lt;br&gt;\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Observer1</span> <span class=\"keyword\">implements</span> <span class=\"title\">Observer</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"逻辑1&lt;br&gt;\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Observer2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Observer</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"逻辑2&lt;br&gt;\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$event = <span class=\"keyword\">new</span> Event();</span><br><span class=\"line\">$event-&gt;addObserver(<span class=\"keyword\">new</span> Observer1());</span><br><span class=\"line\">$event-&gt;addObserver(<span class=\"keyword\">new</span> Observer2());</span><br><span class=\"line\">$event-&gt;triger();</span><br><span class=\"line\">$event-&gt;notify();</span><br></pre></td></tr></table></figure>"},{"title":"适配器模式","date":"2017-09-05T14:10:29.000Z","_content":"当接口发生改变时，适配器模式就派上了用场。\n<!-- more -->\n\n##\t为什么要用适配器模式\n当我们引用一个第三方类库。这个类库随着版本的改变，它提供的API也可能会改变。如果很不幸的是，你的应用里引用的某个API已经发生改变的时候，你还得去硬着头皮去改大量的代码，那么这时候就需要用到适配器模式了\n\n##\t应用的地方在哪\nPHP中的数据库操作有MySQL,MySQLi,PDO三种，可以用适配器模式统一成一致，使不同的数据库操作，统一成一样的API。类似的场景还有cache适配器，可以将memcache,redis,file,apc等不同的缓存函数，统一成一致。 \n\n##\t实现\n1、首先定义一个接口\n```\n\t接口 IDatabase\n\t<?php\n\tnamespace IMooc;\n\tinterface IDatabase\n\t{\n\t    function connect($host, $user, $passwd, $dbname);\n\t    function query($sql);\n\t    function close();\n\t}\n```\n2、MySQL\n```\n\t<?php\n\tnamespace IMooc\\Database;\n\tuse IMooc\\IDatabase;\n\tclass MySQL implements IDatabase\n\t{\n\t    protected $conn;\n\t        function connect($host, $user, $passwd, $dbname)\n\t        {\n\t            $conn = mysql_connect($host, $user, $passwd);\n\t            mysql_select_db($dbname, $conn);\n\t            $this->conn = $conn;\n\t    }\n\t    function query($sql)\n\t        {\n\t            $res = mysql_query($sql, $this->conn);\n\t            return $res;\n\t    }\n\t    function close()\n\t    {\n\t        mysql_close($this->conn);\n\t    }\n\t}\n```\n注意：PHP在5.5.12以后已经不再支持mysql\n\n3、MySQLi\n```\n\t<?php\n\tnamespace IMooc\\Database;\n\tuse IMooc\\IDatabase;\n\tclass MySQLi implements IDatabase\n\t{\n\t    protected $conn;\n\t    function connect($host, $user, $passwd, $dbname)\n\t    {\n\t        $conn = mysqli_connect($host, $user, $passwd, $dbname);\n\t        $this->conn = $conn;\n\t    }\n\t    function query($sql)\n\t    {\n\t        return mysqli_query($this->conn, $sql);\n\t    }\n\t    function close()\n\t    {\n\t        mysqli_close($this->conn);\n\t    }\n\t}\n```","source":"_posts/适配器模式.md","raw":"---\ntitle: 适配器模式\ndate: 2017-09-05 22:10:29\ntags: 设计模式\ncategories: 设计模式\n---\n当接口发生改变时，适配器模式就派上了用场。\n<!-- more -->\n\n##\t为什么要用适配器模式\n当我们引用一个第三方类库。这个类库随着版本的改变，它提供的API也可能会改变。如果很不幸的是，你的应用里引用的某个API已经发生改变的时候，你还得去硬着头皮去改大量的代码，那么这时候就需要用到适配器模式了\n\n##\t应用的地方在哪\nPHP中的数据库操作有MySQL,MySQLi,PDO三种，可以用适配器模式统一成一致，使不同的数据库操作，统一成一样的API。类似的场景还有cache适配器，可以将memcache,redis,file,apc等不同的缓存函数，统一成一致。 \n\n##\t实现\n1、首先定义一个接口\n```\n\t接口 IDatabase\n\t<?php\n\tnamespace IMooc;\n\tinterface IDatabase\n\t{\n\t    function connect($host, $user, $passwd, $dbname);\n\t    function query($sql);\n\t    function close();\n\t}\n```\n2、MySQL\n```\n\t<?php\n\tnamespace IMooc\\Database;\n\tuse IMooc\\IDatabase;\n\tclass MySQL implements IDatabase\n\t{\n\t    protected $conn;\n\t        function connect($host, $user, $passwd, $dbname)\n\t        {\n\t            $conn = mysql_connect($host, $user, $passwd);\n\t            mysql_select_db($dbname, $conn);\n\t            $this->conn = $conn;\n\t    }\n\t    function query($sql)\n\t        {\n\t            $res = mysql_query($sql, $this->conn);\n\t            return $res;\n\t    }\n\t    function close()\n\t    {\n\t        mysql_close($this->conn);\n\t    }\n\t}\n```\n注意：PHP在5.5.12以后已经不再支持mysql\n\n3、MySQLi\n```\n\t<?php\n\tnamespace IMooc\\Database;\n\tuse IMooc\\IDatabase;\n\tclass MySQLi implements IDatabase\n\t{\n\t    protected $conn;\n\t    function connect($host, $user, $passwd, $dbname)\n\t    {\n\t        $conn = mysqli_connect($host, $user, $passwd, $dbname);\n\t        $this->conn = $conn;\n\t    }\n\t    function query($sql)\n\t    {\n\t        return mysqli_query($this->conn, $sql);\n\t    }\n\t    function close()\n\t    {\n\t        mysqli_close($this->conn);\n\t    }\n\t}\n```","slug":"适配器模式","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxuwz001qydqn90rs6vlt","content":"<p>当接口发生改变时，适配器模式就派上了用场。<br><a id=\"more\"></a></p>\n<h2 id=\"为什么要用适配器模式\"><a href=\"#为什么要用适配器模式\" class=\"headerlink\" title=\"为什么要用适配器模式\"></a>为什么要用适配器模式</h2><p>当我们引用一个第三方类库。这个类库随着版本的改变，它提供的API也可能会改变。如果很不幸的是，你的应用里引用的某个API已经发生改变的时候，你还得去硬着头皮去改大量的代码，那么这时候就需要用到适配器模式了</p>\n<h2 id=\"应用的地方在哪\"><a href=\"#应用的地方在哪\" class=\"headerlink\" title=\"应用的地方在哪\"></a>应用的地方在哪</h2><p>PHP中的数据库操作有MySQL,MySQLi,PDO三种，可以用适配器模式统一成一致，使不同的数据库操作，统一成一样的API。类似的场景还有cache适配器，可以将memcache,redis,file,apc等不同的缓存函数，统一成一致。 </p>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><p>1、首先定义一个接口<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">接口 IDatabase</span><br><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">IMooc</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">IDatabase</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span><span class=\"params\">($host, $user, $passwd, $dbname)</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">query</span><span class=\"params\">($sql)</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">close</span><span class=\"params\">()</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>2、MySQL<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">IMooc</span>\\<span class=\"title\">Database</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">use</span> <span class=\"title\">IMooc</span>\\<span class=\"title\">IDatabase</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MySQL</span> <span class=\"keyword\">implements</span> <span class=\"title\">IDatabase</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">protected</span> $conn;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span><span class=\"params\">($host, $user, $passwd, $dbname)</span></span></span></span><br><span class=\"line\"><span class=\"php\">        &#123;</span></span><br><span class=\"line\"><span class=\"php\">            $conn = mysql_connect($host, $user, $passwd);</span></span><br><span class=\"line\"><span class=\"php\">            mysql_select_db($dbname, $conn);</span></span><br><span class=\"line\"><span class=\"php\">            <span class=\"keyword\">$this</span>-&gt;conn = $conn;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">query</span><span class=\"params\">($sql)</span></span></span></span><br><span class=\"line\"><span class=\"php\">        &#123;</span></span><br><span class=\"line\"><span class=\"php\">            $res = mysql_query($sql, <span class=\"keyword\">$this</span>-&gt;conn);</span></span><br><span class=\"line\"><span class=\"php\">            <span class=\"keyword\">return</span> $res;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">close</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        mysql_close(<span class=\"keyword\">$this</span>-&gt;conn);</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>注意：PHP在5.5.12以后已经不再支持mysql</p>\n<p>3、MySQLi<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">IMooc</span>\\<span class=\"title\">Database</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">use</span> <span class=\"title\">IMooc</span>\\<span class=\"title\">IDatabase</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MySQLi</span> <span class=\"keyword\">implements</span> <span class=\"title\">IDatabase</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">protected</span> $conn;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span><span class=\"params\">($host, $user, $passwd, $dbname)</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        $conn = mysqli_connect($host, $user, $passwd, $dbname);</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">$this</span>-&gt;conn = $conn;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">query</span><span class=\"params\">($sql)</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> mysqli_query(<span class=\"keyword\">$this</span>-&gt;conn, $sql);</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">close</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        mysqli_close(<span class=\"keyword\">$this</span>-&gt;conn);</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"<p>当接口发生改变时，适配器模式就派上了用场。<br>","more":"</p>\n<h2 id=\"为什么要用适配器模式\"><a href=\"#为什么要用适配器模式\" class=\"headerlink\" title=\"为什么要用适配器模式\"></a>为什么要用适配器模式</h2><p>当我们引用一个第三方类库。这个类库随着版本的改变，它提供的API也可能会改变。如果很不幸的是，你的应用里引用的某个API已经发生改变的时候，你还得去硬着头皮去改大量的代码，那么这时候就需要用到适配器模式了</p>\n<h2 id=\"应用的地方在哪\"><a href=\"#应用的地方在哪\" class=\"headerlink\" title=\"应用的地方在哪\"></a>应用的地方在哪</h2><p>PHP中的数据库操作有MySQL,MySQLi,PDO三种，可以用适配器模式统一成一致，使不同的数据库操作，统一成一样的API。类似的场景还有cache适配器，可以将memcache,redis,file,apc等不同的缓存函数，统一成一致。 </p>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><p>1、首先定义一个接口<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">接口 IDatabase</span><br><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">IMooc</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">IDatabase</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span><span class=\"params\">($host, $user, $passwd, $dbname)</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">query</span><span class=\"params\">($sql)</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">close</span><span class=\"params\">()</span></span>;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>2、MySQL<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">IMooc</span>\\<span class=\"title\">Database</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">use</span> <span class=\"title\">IMooc</span>\\<span class=\"title\">IDatabase</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MySQL</span> <span class=\"keyword\">implements</span> <span class=\"title\">IDatabase</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">protected</span> $conn;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span><span class=\"params\">($host, $user, $passwd, $dbname)</span></span></span></span><br><span class=\"line\"><span class=\"php\">        &#123;</span></span><br><span class=\"line\"><span class=\"php\">            $conn = mysql_connect($host, $user, $passwd);</span></span><br><span class=\"line\"><span class=\"php\">            mysql_select_db($dbname, $conn);</span></span><br><span class=\"line\"><span class=\"php\">            <span class=\"keyword\">$this</span>-&gt;conn = $conn;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">query</span><span class=\"params\">($sql)</span></span></span></span><br><span class=\"line\"><span class=\"php\">        &#123;</span></span><br><span class=\"line\"><span class=\"php\">            $res = mysql_query($sql, <span class=\"keyword\">$this</span>-&gt;conn);</span></span><br><span class=\"line\"><span class=\"php\">            <span class=\"keyword\">return</span> $res;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">close</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        mysql_close(<span class=\"keyword\">$this</span>-&gt;conn);</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>注意：PHP在5.5.12以后已经不再支持mysql</p>\n<p>3、MySQLi<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?php</span></span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">namespace</span> <span class=\"title\">IMooc</span>\\<span class=\"title\">Database</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"keyword\">use</span> <span class=\"title\">IMooc</span>\\<span class=\"title\">IDatabase</span>;</span></span><br><span class=\"line\"><span class=\"php\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MySQLi</span> <span class=\"keyword\">implements</span> <span class=\"title\">IDatabase</span></span></span></span><br><span class=\"line\"><span class=\"php\">&#123;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"keyword\">protected</span> $conn;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span><span class=\"params\">($host, $user, $passwd, $dbname)</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        $conn = mysqli_connect($host, $user, $passwd, $dbname);</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">$this</span>-&gt;conn = $conn;</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">query</span><span class=\"params\">($sql)</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        <span class=\"keyword\">return</span> mysqli_query(<span class=\"keyword\">$this</span>-&gt;conn, $sql);</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">close</span><span class=\"params\">()</span></span></span></span><br><span class=\"line\"><span class=\"php\">    &#123;</span></span><br><span class=\"line\"><span class=\"php\">        mysqli_close(<span class=\"keyword\">$this</span>-&gt;conn);</span></span><br><span class=\"line\"><span class=\"php\">    &#125;</span></span><br><span class=\"line\"><span class=\"php\">&#125;</span></span><br></pre></td></tr></table></figure></p>"},{"title":"锁机制","date":"2017-07-24T07:27:17.000Z","mathjax":true,"_content":"\n常见的各种锁机制\n\n<!-- more -->\n## 概述\n相对其他数据库而言，MySQL的锁机制比较简单，其最显著的特点是不同的存储引擎支持不同的锁机制\nMySQL大致可归纳为以下3种锁：\n~~~\n\t表级锁：开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。\n\t行级锁：开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。\n\t页面锁：开销和加锁时间界于表锁和行锁之间；会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般\n~~~\n\n## MySQL表级锁的锁模式（MyISAM)\nMyISAM存储引擎只支持表锁，这也是MySQL开始几个版本中唯一支持的锁类型。随着应用对事务完整性和并发性要求的不断提高，\nMySQL才开始开发基于事务的存储引擎，后来慢慢出现了支持页锁的BDB存储引擎和支持行锁的InnoDB存储引擎（实际 InnoDB是单独的一个公司，现在已经被Oracle公司收购）。但是MyISAM的表锁依然是使用最为广泛的锁类型。\n查询表级锁争用情况可以通过检查table_locks_waited和table_locks_immediate状态变量来分析系统上的表锁定争夺：\n\t1、 mysql> show status like 'table%';\n~~~\n\tmysql> show status like 'table%';\n\t+-----------------------+-------+\n\t| Variable_name         | Value |\n\t+-----------------------+-------+\n\t| Table_locks_immediate | 2979  |\n\t| Table_locks_waited    | 0     |\n\t+-----------------------+-------+\n~~~\n\t2、 MySQL中的表锁兼容性 \n\n当前锁模式 / 是否兼容 / 请求锁模式 | None| 读锁 | 写锁\n------- | ------- | ------- | -------\n读锁 | 是 | 是 | 否\n写锁 | 是 | 否 | 否\n可见，对MyISAM表的读操作，不会阻塞其他用户对同一表的读请求，但会阻塞对同一表的写请求；对MyISAM表的写操作，则会阻塞其他用户对同一表的读和写操作；MyISAM表的读操作与写操作之间，以及写操作之间是串行的！根据如下表所示的例子可以知道，当一个线程获得对一个表的写锁后，只有持有锁的线程可以对表进行更新操作。其他线程的读、写操作都会等待，直到锁被释放为止。\n## InnoDB锁问题\nInnoDB与MyISAM的最大不同有两点：一是支持事务（TRANSACTION）；二是采用了行级锁。行级锁和表级锁本来就有许多不同之处，另外，事务的引入也带来了一些新问题。\n###\t1、 事务（Transaction）及其ACID属性\n事务是由一组SQL语句组成的逻辑处理单元，事务具有4属性，通常称为事务的ACID属性。\n\n原性性（Actomicity）：事务是一个原子操作单元，其对数据的修改，要么全都执行，要么全都不执行.\n\n一致性（Consistent）：在事务开始和完成时，数据都必须保持一致状态。这意味着所有相关的数据规则都必须应用于事务的修改，以操持完整性；事务结束时，所有的内部数据结构 （如B树索引或双向链表）也都必须是正确的。\n\n隔离性（Isolation）：数据库系统提供一定的隔离机制，保证事务在不受外部并发操作影响的“独立”环境执行。这意味着事务处理过程中的中间状态对外部是不可见的，反之亦然。\n\n持久性（Durable）：事务完成之后，它对于数据的修改是永久性的，即使出现系统故障也能够保持。\n\n###\t2、 并发事务带来的问题\n更新丢失（Lost Update）：当两个或多个事务选择同一行，然后基于最初选定的值更新该行时，由于每个事务都不知道其他事务的存在，就会发生丢失更新问题——最后的更新覆盖了其他事务所做的更新。例如，两个编辑人员制作了同一文档的电子副本。每个编辑人员独立地更改其副本，然后保存更改后的副本，这样就覆盖了原始文档。最后保存其更改保存其更改副本的编辑人员覆盖另一个编辑人员所做的修改。如果在一个编辑人员完成并提交事务之前，另一个编辑人员不能访问同一文件，则可避免此问题\n\n脏读（Dirty Reads）：一个事务正在对一条记录做修改，在这个事务并提交前，这条记录的数据就处于不一致状态；这时，另一个事务也来读取同一条记录，如果不加控制，第二个事务读取了这些“脏”的数据，并据此做进一步的处理，就会产生未提交的数据依赖关系。这种现象被形象地叫做“脏读”。\n\n不可重复读（Non-Repeatable Reads）：一个事务在读取某些数据已经发生了改变、或某些记录已经被删除了！这种现象叫做“不可重复读”。\n\n幻读（Phantom Reads）：一个事务按相同的查询条件重新读取以前检索过的数据，却发现其他事务插入了满足其查询条件的新数据，这种现象就称为“幻读”。\n\n###\t3、 事务隔离级别\n在并发事务处理带来的问题中，“更新丢失”通常应该是完全避免的。但防止更新丢失，并不能单靠数据库事务控制器来解决，需要应用程序对要更新的数据加必要的锁来解决，因此，防止更新丢失应该是应用的责任。\n\n“脏读”、“不可重复读”和“幻读”，其实都是数据库读一致性问题，必须由数据库提供一定的事务隔离机制来解决。数据库实现事务隔离的方式，基本可以分为以下两种。一种是在读取数据前，对其加锁，阻止其他事务对数据进行修改。另一种是不用加任何锁，通过一定机制生成一个数据请求时间点的一致性数据快照（Snapshot），并用这个快照来提供一定级别（语句级或事务级）的一致性读取。\n\n从用户的角度，好像是数据库可以提供同一数据的多个版本,因此,这种技术叫做数据多版本并发控制（ＭultiVersion Concurrency control，简称MVCC或MCC），也经常称为多版本数据库。\n\n数据库的事务隔离级别越严格，并发副作用越小，但付出的代价也就越大，因为事务隔离实质上就是使事务在一定程度上“串行化”进行，这显然与“并发”是矛盾的，同时，不同的应用对读一致性和事务隔离程度的要求也是不同的，比如许多应用对“不可重复读”和“幻读”并不敏感，可能更关心数据并发访问的能力。为了解决“隔离”与“并发”的矛盾，ISO/ANSI SQL92定义了４个事务隔离级别，\n\n每个级别的隔离程度不同，允许出现的副作用也不同，应用可以根据自己业务逻辑要求，通过选择不同的隔离级别来平衡＂隔离＂与＂并发＂的矛盾\n\n###   4、 事务４种隔离级别比较\n隔离级别/读数据一致性及允许的并发副作用 | 读数据一致性 | 脏读 | 不可重复读 | 幻读\n------- | ------- | ------- | ------- | -------\n未提交读（Read uncommitted) | 最低级别，只能保证不读取物理上损坏的数据 | 是 | 是 | 是\n已提交度（Read committed） | 语句级 | 否 | 是 | 是\n可重复读（Repeatable read） | 事务级 | 否 | 否 | 是\n已提交度（Read committed） | 最高级别，事务级级 | 否 | 否 | 否\n\n###\t5、 获取InonoD行锁争用情况\n```\n\tmysql> show status like 'innodb_row_lock%';\n\t+-------------------------------+-------+\n\t| Variable_name | Value |\n\t+-------------------------------+-------+\n\t| Innodb_row_lock_current_waits | 0 |\n\t| Innodb_row_lock_time | 0 |\n\t| Innodb_row_lock_time_avg | 0 |\n\t| Innodb_row_lock_time_max | 0 |\n\t| Innodb_row_lock_waits | 0 |\n\t+-------------------------------+-------+\n\t5 rows in set (0.00 sec)\n```\n## 悲观锁\n总是假设最坏的情况，每次取数据时都认为其他线程会修改，所以都会加锁(读锁、写锁、行锁等)当其他线程想要访问数据时，都需要阻塞挂起。可以依靠数据库实现，如行锁、读锁和写锁等，都是在操作之前加锁，在Java中，synchronized的思想也是悲观锁。\n## 乐观锁\n\n总是认为不会产生并发问题，每次去取数据的时候总认为不会有其他线程对数据进行修改，因此不会上锁，但是在更新时会判断其他线程在这之前有没有对数据进行修改，一般会使用版本号机制或CAS操作实现。\n\nversion方式：一般是在数据表中加上一个数据版本号version字段，表示数据被修改的次数，当数据被修改时，version值会加一。当线程A要更新数据值时，在读取数据的同时也会读取version值，在提交更新时，若刚才读取到的version值为当前数据库中的version值相等时才更新，否则重试更新操作，直到更新成功。\n\n核心SQL代码：\n```\n\tupdate table set x=x+1, version=version+1 where id=#{id} and version=#{version};  \n```\nCAS操作方式：即compare and swap 或者 compare and set，涉及到三个操作数，数据所在的内存值，预期值，新值。当需要更新时，判断当前内存值与之前取到的值是否相等，若相等，则用新值更新，若失败则重试，一般情况下是一个自旋操作，即不断的重试。\n\n\n\n\n","source":"_posts/锁机制.md","raw":"---\ntitle: 锁机制\ndate: 2017-07-24 15:27:17\ntags: MySQL\ncategories: MySQL\nmathjax: true\n\n---\n\n常见的各种锁机制\n\n<!-- more -->\n## 概述\n相对其他数据库而言，MySQL的锁机制比较简单，其最显著的特点是不同的存储引擎支持不同的锁机制\nMySQL大致可归纳为以下3种锁：\n~~~\n\t表级锁：开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。\n\t行级锁：开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。\n\t页面锁：开销和加锁时间界于表锁和行锁之间；会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般\n~~~\n\n## MySQL表级锁的锁模式（MyISAM)\nMyISAM存储引擎只支持表锁，这也是MySQL开始几个版本中唯一支持的锁类型。随着应用对事务完整性和并发性要求的不断提高，\nMySQL才开始开发基于事务的存储引擎，后来慢慢出现了支持页锁的BDB存储引擎和支持行锁的InnoDB存储引擎（实际 InnoDB是单独的一个公司，现在已经被Oracle公司收购）。但是MyISAM的表锁依然是使用最为广泛的锁类型。\n查询表级锁争用情况可以通过检查table_locks_waited和table_locks_immediate状态变量来分析系统上的表锁定争夺：\n\t1、 mysql> show status like 'table%';\n~~~\n\tmysql> show status like 'table%';\n\t+-----------------------+-------+\n\t| Variable_name         | Value |\n\t+-----------------------+-------+\n\t| Table_locks_immediate | 2979  |\n\t| Table_locks_waited    | 0     |\n\t+-----------------------+-------+\n~~~\n\t2、 MySQL中的表锁兼容性 \n\n当前锁模式 / 是否兼容 / 请求锁模式 | None| 读锁 | 写锁\n------- | ------- | ------- | -------\n读锁 | 是 | 是 | 否\n写锁 | 是 | 否 | 否\n可见，对MyISAM表的读操作，不会阻塞其他用户对同一表的读请求，但会阻塞对同一表的写请求；对MyISAM表的写操作，则会阻塞其他用户对同一表的读和写操作；MyISAM表的读操作与写操作之间，以及写操作之间是串行的！根据如下表所示的例子可以知道，当一个线程获得对一个表的写锁后，只有持有锁的线程可以对表进行更新操作。其他线程的读、写操作都会等待，直到锁被释放为止。\n## InnoDB锁问题\nInnoDB与MyISAM的最大不同有两点：一是支持事务（TRANSACTION）；二是采用了行级锁。行级锁和表级锁本来就有许多不同之处，另外，事务的引入也带来了一些新问题。\n###\t1、 事务（Transaction）及其ACID属性\n事务是由一组SQL语句组成的逻辑处理单元，事务具有4属性，通常称为事务的ACID属性。\n\n原性性（Actomicity）：事务是一个原子操作单元，其对数据的修改，要么全都执行，要么全都不执行.\n\n一致性（Consistent）：在事务开始和完成时，数据都必须保持一致状态。这意味着所有相关的数据规则都必须应用于事务的修改，以操持完整性；事务结束时，所有的内部数据结构 （如B树索引或双向链表）也都必须是正确的。\n\n隔离性（Isolation）：数据库系统提供一定的隔离机制，保证事务在不受外部并发操作影响的“独立”环境执行。这意味着事务处理过程中的中间状态对外部是不可见的，反之亦然。\n\n持久性（Durable）：事务完成之后，它对于数据的修改是永久性的，即使出现系统故障也能够保持。\n\n###\t2、 并发事务带来的问题\n更新丢失（Lost Update）：当两个或多个事务选择同一行，然后基于最初选定的值更新该行时，由于每个事务都不知道其他事务的存在，就会发生丢失更新问题——最后的更新覆盖了其他事务所做的更新。例如，两个编辑人员制作了同一文档的电子副本。每个编辑人员独立地更改其副本，然后保存更改后的副本，这样就覆盖了原始文档。最后保存其更改保存其更改副本的编辑人员覆盖另一个编辑人员所做的修改。如果在一个编辑人员完成并提交事务之前，另一个编辑人员不能访问同一文件，则可避免此问题\n\n脏读（Dirty Reads）：一个事务正在对一条记录做修改，在这个事务并提交前，这条记录的数据就处于不一致状态；这时，另一个事务也来读取同一条记录，如果不加控制，第二个事务读取了这些“脏”的数据，并据此做进一步的处理，就会产生未提交的数据依赖关系。这种现象被形象地叫做“脏读”。\n\n不可重复读（Non-Repeatable Reads）：一个事务在读取某些数据已经发生了改变、或某些记录已经被删除了！这种现象叫做“不可重复读”。\n\n幻读（Phantom Reads）：一个事务按相同的查询条件重新读取以前检索过的数据，却发现其他事务插入了满足其查询条件的新数据，这种现象就称为“幻读”。\n\n###\t3、 事务隔离级别\n在并发事务处理带来的问题中，“更新丢失”通常应该是完全避免的。但防止更新丢失，并不能单靠数据库事务控制器来解决，需要应用程序对要更新的数据加必要的锁来解决，因此，防止更新丢失应该是应用的责任。\n\n“脏读”、“不可重复读”和“幻读”，其实都是数据库读一致性问题，必须由数据库提供一定的事务隔离机制来解决。数据库实现事务隔离的方式，基本可以分为以下两种。一种是在读取数据前，对其加锁，阻止其他事务对数据进行修改。另一种是不用加任何锁，通过一定机制生成一个数据请求时间点的一致性数据快照（Snapshot），并用这个快照来提供一定级别（语句级或事务级）的一致性读取。\n\n从用户的角度，好像是数据库可以提供同一数据的多个版本,因此,这种技术叫做数据多版本并发控制（ＭultiVersion Concurrency control，简称MVCC或MCC），也经常称为多版本数据库。\n\n数据库的事务隔离级别越严格，并发副作用越小，但付出的代价也就越大，因为事务隔离实质上就是使事务在一定程度上“串行化”进行，这显然与“并发”是矛盾的，同时，不同的应用对读一致性和事务隔离程度的要求也是不同的，比如许多应用对“不可重复读”和“幻读”并不敏感，可能更关心数据并发访问的能力。为了解决“隔离”与“并发”的矛盾，ISO/ANSI SQL92定义了４个事务隔离级别，\n\n每个级别的隔离程度不同，允许出现的副作用也不同，应用可以根据自己业务逻辑要求，通过选择不同的隔离级别来平衡＂隔离＂与＂并发＂的矛盾\n\n###   4、 事务４种隔离级别比较\n隔离级别/读数据一致性及允许的并发副作用 | 读数据一致性 | 脏读 | 不可重复读 | 幻读\n------- | ------- | ------- | ------- | -------\n未提交读（Read uncommitted) | 最低级别，只能保证不读取物理上损坏的数据 | 是 | 是 | 是\n已提交度（Read committed） | 语句级 | 否 | 是 | 是\n可重复读（Repeatable read） | 事务级 | 否 | 否 | 是\n已提交度（Read committed） | 最高级别，事务级级 | 否 | 否 | 否\n\n###\t5、 获取InonoD行锁争用情况\n```\n\tmysql> show status like 'innodb_row_lock%';\n\t+-------------------------------+-------+\n\t| Variable_name | Value |\n\t+-------------------------------+-------+\n\t| Innodb_row_lock_current_waits | 0 |\n\t| Innodb_row_lock_time | 0 |\n\t| Innodb_row_lock_time_avg | 0 |\n\t| Innodb_row_lock_time_max | 0 |\n\t| Innodb_row_lock_waits | 0 |\n\t+-------------------------------+-------+\n\t5 rows in set (0.00 sec)\n```\n## 悲观锁\n总是假设最坏的情况，每次取数据时都认为其他线程会修改，所以都会加锁(读锁、写锁、行锁等)当其他线程想要访问数据时，都需要阻塞挂起。可以依靠数据库实现，如行锁、读锁和写锁等，都是在操作之前加锁，在Java中，synchronized的思想也是悲观锁。\n## 乐观锁\n\n总是认为不会产生并发问题，每次去取数据的时候总认为不会有其他线程对数据进行修改，因此不会上锁，但是在更新时会判断其他线程在这之前有没有对数据进行修改，一般会使用版本号机制或CAS操作实现。\n\nversion方式：一般是在数据表中加上一个数据版本号version字段，表示数据被修改的次数，当数据被修改时，version值会加一。当线程A要更新数据值时，在读取数据的同时也会读取version值，在提交更新时，若刚才读取到的version值为当前数据库中的version值相等时才更新，否则重试更新操作，直到更新成功。\n\n核心SQL代码：\n```\n\tupdate table set x=x+1, version=version+1 where id=#{id} and version=#{version};  \n```\nCAS操作方式：即compare and swap 或者 compare and set，涉及到三个操作数，数据所在的内存值，预期值，新值。当需要更新时，判断当前内存值与之前取到的值是否相等，若相等，则用新值更新，若失败则重试，一般情况下是一个自旋操作，即不断的重试。\n\n\n\n\n","slug":"锁机制","published":1,"updated":"2018-07-31T12:37:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk9oxux0001rydqn2x10pmmq","content":"<p>常见的各种锁机制</p>\n<a id=\"more\"></a>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>相对其他数据库而言，MySQL的锁机制比较简单，其最显著的特点是不同的存储引擎支持不同的锁机制<br>MySQL大致可归纳为以下3种锁：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">表级锁：开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。</span><br><span class=\"line\">行级锁：开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。</span><br><span class=\"line\">页面锁：开销和加锁时间界于表锁和行锁之间；会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"MySQL表级锁的锁模式（MyISAM\"><a href=\"#MySQL表级锁的锁模式（MyISAM\" class=\"headerlink\" title=\"MySQL表级锁的锁模式（MyISAM)\"></a>MySQL表级锁的锁模式（MyISAM)</h2><p>MyISAM存储引擎只支持表锁，这也是MySQL开始几个版本中唯一支持的锁类型。随着应用对事务完整性和并发性要求的不断提高，<br>MySQL才开始开发基于事务的存储引擎，后来慢慢出现了支持页锁的BDB存储引擎和支持行锁的InnoDB存储引擎（实际 InnoDB是单独的一个公司，现在已经被Oracle公司收购）。但是MyISAM的表锁依然是使用最为广泛的锁类型。<br>查询表级锁争用情况可以通过检查table_locks_waited和table_locks_immediate状态变量来分析系统上的表锁定争夺：<br>    1、 mysql&gt; show status like ‘table%’;<br><figure class=\"highlight asciidoc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; show status like <span class=\"emphasis\">'table%'</span>;</span><br><span class=\"line\"><span class=\"code\">+-----------------------+</span>-------+</span><br><span class=\"line\">| Variable<span class=\"emphasis\">_name         | Value |</span></span><br><span class=\"line\"><span class=\"emphasis\">+-----------------------+-------+</span></span><br><span class=\"line\"><span class=\"emphasis\">| Table_</span>locks<span class=\"emphasis\">_immediate | 2979  |</span></span><br><span class=\"line\"><span class=\"emphasis\">| Table_</span>locks<span class=\"emphasis\">_waited    | 0     |</span></span><br><span class=\"line\"><span class=\"emphasis\">+-----------------------+-------+</span></span><br></pre></td></tr></table></figure></p>\n<pre><code>2、 MySQL中的表锁兼容性 \n</code></pre><table>\n<thead>\n<tr>\n<th>当前锁模式 / 是否兼容 / 请求锁模式</th>\n<th>None</th>\n<th>读锁</th>\n<th>写锁</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>读锁</td>\n<td>是</td>\n<td>是</td>\n<td>否</td>\n</tr>\n<tr>\n<td>写锁</td>\n<td>是</td>\n<td>否</td>\n<td>否</td>\n</tr>\n</tbody>\n</table>\n<p>可见，对MyISAM表的读操作，不会阻塞其他用户对同一表的读请求，但会阻塞对同一表的写请求；对MyISAM表的写操作，则会阻塞其他用户对同一表的读和写操作；MyISAM表的读操作与写操作之间，以及写操作之间是串行的！根据如下表所示的例子可以知道，当一个线程获得对一个表的写锁后，只有持有锁的线程可以对表进行更新操作。其他线程的读、写操作都会等待，直到锁被释放为止。</p>\n<h2 id=\"InnoDB锁问题\"><a href=\"#InnoDB锁问题\" class=\"headerlink\" title=\"InnoDB锁问题\"></a>InnoDB锁问题</h2><p>InnoDB与MyISAM的最大不同有两点：一是支持事务（TRANSACTION）；二是采用了行级锁。行级锁和表级锁本来就有许多不同之处，另外，事务的引入也带来了一些新问题。</p>\n<h3 id=\"1、-事务（Transaction）及其ACID属性\"><a href=\"#1、-事务（Transaction）及其ACID属性\" class=\"headerlink\" title=\"1、 事务（Transaction）及其ACID属性\"></a>1、 事务（Transaction）及其ACID属性</h3><p>事务是由一组SQL语句组成的逻辑处理单元，事务具有4属性，通常称为事务的ACID属性。</p>\n<p>原性性（Actomicity）：事务是一个原子操作单元，其对数据的修改，要么全都执行，要么全都不执行.</p>\n<p>一致性（Consistent）：在事务开始和完成时，数据都必须保持一致状态。这意味着所有相关的数据规则都必须应用于事务的修改，以操持完整性；事务结束时，所有的内部数据结构 （如B树索引或双向链表）也都必须是正确的。</p>\n<p>隔离性（Isolation）：数据库系统提供一定的隔离机制，保证事务在不受外部并发操作影响的“独立”环境执行。这意味着事务处理过程中的中间状态对外部是不可见的，反之亦然。</p>\n<p>持久性（Durable）：事务完成之后，它对于数据的修改是永久性的，即使出现系统故障也能够保持。</p>\n<h3 id=\"2、-并发事务带来的问题\"><a href=\"#2、-并发事务带来的问题\" class=\"headerlink\" title=\"2、 并发事务带来的问题\"></a>2、 并发事务带来的问题</h3><p>更新丢失（Lost Update）：当两个或多个事务选择同一行，然后基于最初选定的值更新该行时，由于每个事务都不知道其他事务的存在，就会发生丢失更新问题——最后的更新覆盖了其他事务所做的更新。例如，两个编辑人员制作了同一文档的电子副本。每个编辑人员独立地更改其副本，然后保存更改后的副本，这样就覆盖了原始文档。最后保存其更改保存其更改副本的编辑人员覆盖另一个编辑人员所做的修改。如果在一个编辑人员完成并提交事务之前，另一个编辑人员不能访问同一文件，则可避免此问题</p>\n<p>脏读（Dirty Reads）：一个事务正在对一条记录做修改，在这个事务并提交前，这条记录的数据就处于不一致状态；这时，另一个事务也来读取同一条记录，如果不加控制，第二个事务读取了这些“脏”的数据，并据此做进一步的处理，就会产生未提交的数据依赖关系。这种现象被形象地叫做“脏读”。</p>\n<p>不可重复读（Non-Repeatable Reads）：一个事务在读取某些数据已经发生了改变、或某些记录已经被删除了！这种现象叫做“不可重复读”。</p>\n<p>幻读（Phantom Reads）：一个事务按相同的查询条件重新读取以前检索过的数据，却发现其他事务插入了满足其查询条件的新数据，这种现象就称为“幻读”。</p>\n<h3 id=\"3、-事务隔离级别\"><a href=\"#3、-事务隔离级别\" class=\"headerlink\" title=\"3、 事务隔离级别\"></a>3、 事务隔离级别</h3><p>在并发事务处理带来的问题中，“更新丢失”通常应该是完全避免的。但防止更新丢失，并不能单靠数据库事务控制器来解决，需要应用程序对要更新的数据加必要的锁来解决，因此，防止更新丢失应该是应用的责任。</p>\n<p>“脏读”、“不可重复读”和“幻读”，其实都是数据库读一致性问题，必须由数据库提供一定的事务隔离机制来解决。数据库实现事务隔离的方式，基本可以分为以下两种。一种是在读取数据前，对其加锁，阻止其他事务对数据进行修改。另一种是不用加任何锁，通过一定机制生成一个数据请求时间点的一致性数据快照（Snapshot），并用这个快照来提供一定级别（语句级或事务级）的一致性读取。</p>\n<p>从用户的角度，好像是数据库可以提供同一数据的多个版本,因此,这种技术叫做数据多版本并发控制（ＭultiVersion Concurrency control，简称MVCC或MCC），也经常称为多版本数据库。</p>\n<p>数据库的事务隔离级别越严格，并发副作用越小，但付出的代价也就越大，因为事务隔离实质上就是使事务在一定程度上“串行化”进行，这显然与“并发”是矛盾的，同时，不同的应用对读一致性和事务隔离程度的要求也是不同的，比如许多应用对“不可重复读”和“幻读”并不敏感，可能更关心数据并发访问的能力。为了解决“隔离”与“并发”的矛盾，ISO/ANSI SQL92定义了４个事务隔离级别，</p>\n<p>每个级别的隔离程度不同，允许出现的副作用也不同，应用可以根据自己业务逻辑要求，通过选择不同的隔离级别来平衡＂隔离＂与＂并发＂的矛盾</p>\n<h3 id=\"4、-事务４种隔离级别比较\"><a href=\"#4、-事务４种隔离级别比较\" class=\"headerlink\" title=\"4、 事务４种隔离级别比较\"></a>4、 事务４种隔离级别比较</h3><table>\n<thead>\n<tr>\n<th>隔离级别/读数据一致性及允许的并发副作用</th>\n<th>读数据一致性</th>\n<th>脏读</th>\n<th>不可重复读</th>\n<th>幻读</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>未提交读（Read uncommitted)</td>\n<td>最低级别，只能保证不读取物理上损坏的数据</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>已提交度（Read committed）</td>\n<td>语句级</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>可重复读（Repeatable read）</td>\n<td>事务级</td>\n<td>否</td>\n<td>否</td>\n<td>是</td>\n</tr>\n<tr>\n<td>已提交度（Read committed）</td>\n<td>最高级别，事务级级</td>\n<td>否</td>\n<td>否</td>\n<td>否</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"5、-获取InonoD行锁争用情况\"><a href=\"#5、-获取InonoD行锁争用情况\" class=\"headerlink\" title=\"5、 获取InonoD行锁争用情况\"></a>5、 获取InonoD行锁争用情况</h3><figure class=\"highlight asciidoc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; show status like <span class=\"emphasis\">'innodb_row_lock%'</span>;</span><br><span class=\"line\"><span class=\"code\">+-------------------------------+</span>-------+</span><br><span class=\"line\">| Variable<span class=\"emphasis\">_name | Value |</span></span><br><span class=\"line\"><span class=\"emphasis\">+-------------------------------+-------+</span></span><br><span class=\"line\"><span class=\"emphasis\">| Innodb_</span>row<span class=\"emphasis\">_lock_</span>current<span class=\"emphasis\">_waits | 0 |</span></span><br><span class=\"line\"><span class=\"emphasis\">| Innodb_</span>row<span class=\"emphasis\">_lock_</span>time | 0 |</span><br><span class=\"line\">| Innodb<span class=\"emphasis\">_row_</span>lock<span class=\"emphasis\">_time_</span>avg | 0 |</span><br><span class=\"line\">| Innodb<span class=\"emphasis\">_row_</span>lock<span class=\"emphasis\">_time_</span>max | 0 |</span><br><span class=\"line\">| Innodb<span class=\"emphasis\">_row_</span>lock<span class=\"emphasis\">_waits | 0 |</span></span><br><span class=\"line\"><span class=\"emphasis\">+-------------------------------+-------+</span></span><br><span class=\"line\"><span class=\"emphasis\">5 rows in set (0.00 sec)</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"悲观锁\"><a href=\"#悲观锁\" class=\"headerlink\" title=\"悲观锁\"></a>悲观锁</h2><p>总是假设最坏的情况，每次取数据时都认为其他线程会修改，所以都会加锁(读锁、写锁、行锁等)当其他线程想要访问数据时，都需要阻塞挂起。可以依靠数据库实现，如行锁、读锁和写锁等，都是在操作之前加锁，在Java中，synchronized的思想也是悲观锁。</p>\n<h2 id=\"乐观锁\"><a href=\"#乐观锁\" class=\"headerlink\" title=\"乐观锁\"></a>乐观锁</h2><p>总是认为不会产生并发问题，每次去取数据的时候总认为不会有其他线程对数据进行修改，因此不会上锁，但是在更新时会判断其他线程在这之前有没有对数据进行修改，一般会使用版本号机制或CAS操作实现。</p>\n<p>version方式：一般是在数据表中加上一个数据版本号version字段，表示数据被修改的次数，当数据被修改时，version值会加一。当线程A要更新数据值时，在读取数据的同时也会读取version值，在提交更新时，若刚才读取到的version值为当前数据库中的version值相等时才更新，否则重试更新操作，直到更新成功。</p>\n<p>核心SQL代码：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">update</span> <span class=\"keyword\">table</span> <span class=\"keyword\">set</span> x=x+<span class=\"number\">1</span>, <span class=\"keyword\">version</span>=<span class=\"keyword\">version</span>+<span class=\"number\">1</span> <span class=\"keyword\">where</span> <span class=\"keyword\">id</span>=#&#123;<span class=\"keyword\">id</span>&#125; <span class=\"keyword\">and</span> <span class=\"keyword\">version</span>=#&#123;<span class=\"keyword\">version</span>&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>CAS操作方式：即compare and swap 或者 compare and set，涉及到三个操作数，数据所在的内存值，预期值，新值。当需要更新时，判断当前内存值与之前取到的值是否相等，若相等，则用新值更新，若失败则重试，一般情况下是一个自旋操作，即不断的重试。</p>\n","site":{"data":{}},"excerpt":"<p>常见的各种锁机制</p>","more":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>相对其他数据库而言，MySQL的锁机制比较简单，其最显著的特点是不同的存储引擎支持不同的锁机制<br>MySQL大致可归纳为以下3种锁：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">表级锁：开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。</span><br><span class=\"line\">行级锁：开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。</span><br><span class=\"line\">页面锁：开销和加锁时间界于表锁和行锁之间；会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"MySQL表级锁的锁模式（MyISAM\"><a href=\"#MySQL表级锁的锁模式（MyISAM\" class=\"headerlink\" title=\"MySQL表级锁的锁模式（MyISAM)\"></a>MySQL表级锁的锁模式（MyISAM)</h2><p>MyISAM存储引擎只支持表锁，这也是MySQL开始几个版本中唯一支持的锁类型。随着应用对事务完整性和并发性要求的不断提高，<br>MySQL才开始开发基于事务的存储引擎，后来慢慢出现了支持页锁的BDB存储引擎和支持行锁的InnoDB存储引擎（实际 InnoDB是单独的一个公司，现在已经被Oracle公司收购）。但是MyISAM的表锁依然是使用最为广泛的锁类型。<br>查询表级锁争用情况可以通过检查table_locks_waited和table_locks_immediate状态变量来分析系统上的表锁定争夺：<br>    1、 mysql&gt; show status like ‘table%’;<br><figure class=\"highlight asciidoc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; show status like <span class=\"emphasis\">'table%'</span>;</span><br><span class=\"line\"><span class=\"code\">+-----------------------+</span>-------+</span><br><span class=\"line\">| Variable<span class=\"emphasis\">_name         | Value |</span></span><br><span class=\"line\"><span class=\"emphasis\">+-----------------------+-------+</span></span><br><span class=\"line\"><span class=\"emphasis\">| Table_</span>locks<span class=\"emphasis\">_immediate | 2979  |</span></span><br><span class=\"line\"><span class=\"emphasis\">| Table_</span>locks<span class=\"emphasis\">_waited    | 0     |</span></span><br><span class=\"line\"><span class=\"emphasis\">+-----------------------+-------+</span></span><br></pre></td></tr></table></figure></p>\n<pre><code>2、 MySQL中的表锁兼容性 \n</code></pre><table>\n<thead>\n<tr>\n<th>当前锁模式 / 是否兼容 / 请求锁模式</th>\n<th>None</th>\n<th>读锁</th>\n<th>写锁</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>读锁</td>\n<td>是</td>\n<td>是</td>\n<td>否</td>\n</tr>\n<tr>\n<td>写锁</td>\n<td>是</td>\n<td>否</td>\n<td>否</td>\n</tr>\n</tbody>\n</table>\n<p>可见，对MyISAM表的读操作，不会阻塞其他用户对同一表的读请求，但会阻塞对同一表的写请求；对MyISAM表的写操作，则会阻塞其他用户对同一表的读和写操作；MyISAM表的读操作与写操作之间，以及写操作之间是串行的！根据如下表所示的例子可以知道，当一个线程获得对一个表的写锁后，只有持有锁的线程可以对表进行更新操作。其他线程的读、写操作都会等待，直到锁被释放为止。</p>\n<h2 id=\"InnoDB锁问题\"><a href=\"#InnoDB锁问题\" class=\"headerlink\" title=\"InnoDB锁问题\"></a>InnoDB锁问题</h2><p>InnoDB与MyISAM的最大不同有两点：一是支持事务（TRANSACTION）；二是采用了行级锁。行级锁和表级锁本来就有许多不同之处，另外，事务的引入也带来了一些新问题。</p>\n<h3 id=\"1、-事务（Transaction）及其ACID属性\"><a href=\"#1、-事务（Transaction）及其ACID属性\" class=\"headerlink\" title=\"1、 事务（Transaction）及其ACID属性\"></a>1、 事务（Transaction）及其ACID属性</h3><p>事务是由一组SQL语句组成的逻辑处理单元，事务具有4属性，通常称为事务的ACID属性。</p>\n<p>原性性（Actomicity）：事务是一个原子操作单元，其对数据的修改，要么全都执行，要么全都不执行.</p>\n<p>一致性（Consistent）：在事务开始和完成时，数据都必须保持一致状态。这意味着所有相关的数据规则都必须应用于事务的修改，以操持完整性；事务结束时，所有的内部数据结构 （如B树索引或双向链表）也都必须是正确的。</p>\n<p>隔离性（Isolation）：数据库系统提供一定的隔离机制，保证事务在不受外部并发操作影响的“独立”环境执行。这意味着事务处理过程中的中间状态对外部是不可见的，反之亦然。</p>\n<p>持久性（Durable）：事务完成之后，它对于数据的修改是永久性的，即使出现系统故障也能够保持。</p>\n<h3 id=\"2、-并发事务带来的问题\"><a href=\"#2、-并发事务带来的问题\" class=\"headerlink\" title=\"2、 并发事务带来的问题\"></a>2、 并发事务带来的问题</h3><p>更新丢失（Lost Update）：当两个或多个事务选择同一行，然后基于最初选定的值更新该行时，由于每个事务都不知道其他事务的存在，就会发生丢失更新问题——最后的更新覆盖了其他事务所做的更新。例如，两个编辑人员制作了同一文档的电子副本。每个编辑人员独立地更改其副本，然后保存更改后的副本，这样就覆盖了原始文档。最后保存其更改保存其更改副本的编辑人员覆盖另一个编辑人员所做的修改。如果在一个编辑人员完成并提交事务之前，另一个编辑人员不能访问同一文件，则可避免此问题</p>\n<p>脏读（Dirty Reads）：一个事务正在对一条记录做修改，在这个事务并提交前，这条记录的数据就处于不一致状态；这时，另一个事务也来读取同一条记录，如果不加控制，第二个事务读取了这些“脏”的数据，并据此做进一步的处理，就会产生未提交的数据依赖关系。这种现象被形象地叫做“脏读”。</p>\n<p>不可重复读（Non-Repeatable Reads）：一个事务在读取某些数据已经发生了改变、或某些记录已经被删除了！这种现象叫做“不可重复读”。</p>\n<p>幻读（Phantom Reads）：一个事务按相同的查询条件重新读取以前检索过的数据，却发现其他事务插入了满足其查询条件的新数据，这种现象就称为“幻读”。</p>\n<h3 id=\"3、-事务隔离级别\"><a href=\"#3、-事务隔离级别\" class=\"headerlink\" title=\"3、 事务隔离级别\"></a>3、 事务隔离级别</h3><p>在并发事务处理带来的问题中，“更新丢失”通常应该是完全避免的。但防止更新丢失，并不能单靠数据库事务控制器来解决，需要应用程序对要更新的数据加必要的锁来解决，因此，防止更新丢失应该是应用的责任。</p>\n<p>“脏读”、“不可重复读”和“幻读”，其实都是数据库读一致性问题，必须由数据库提供一定的事务隔离机制来解决。数据库实现事务隔离的方式，基本可以分为以下两种。一种是在读取数据前，对其加锁，阻止其他事务对数据进行修改。另一种是不用加任何锁，通过一定机制生成一个数据请求时间点的一致性数据快照（Snapshot），并用这个快照来提供一定级别（语句级或事务级）的一致性读取。</p>\n<p>从用户的角度，好像是数据库可以提供同一数据的多个版本,因此,这种技术叫做数据多版本并发控制（ＭultiVersion Concurrency control，简称MVCC或MCC），也经常称为多版本数据库。</p>\n<p>数据库的事务隔离级别越严格，并发副作用越小，但付出的代价也就越大，因为事务隔离实质上就是使事务在一定程度上“串行化”进行，这显然与“并发”是矛盾的，同时，不同的应用对读一致性和事务隔离程度的要求也是不同的，比如许多应用对“不可重复读”和“幻读”并不敏感，可能更关心数据并发访问的能力。为了解决“隔离”与“并发”的矛盾，ISO/ANSI SQL92定义了４个事务隔离级别，</p>\n<p>每个级别的隔离程度不同，允许出现的副作用也不同，应用可以根据自己业务逻辑要求，通过选择不同的隔离级别来平衡＂隔离＂与＂并发＂的矛盾</p>\n<h3 id=\"4、-事务４种隔离级别比较\"><a href=\"#4、-事务４种隔离级别比较\" class=\"headerlink\" title=\"4、 事务４种隔离级别比较\"></a>4、 事务４种隔离级别比较</h3><table>\n<thead>\n<tr>\n<th>隔离级别/读数据一致性及允许的并发副作用</th>\n<th>读数据一致性</th>\n<th>脏读</th>\n<th>不可重复读</th>\n<th>幻读</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>未提交读（Read uncommitted)</td>\n<td>最低级别，只能保证不读取物理上损坏的数据</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>已提交度（Read committed）</td>\n<td>语句级</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>可重复读（Repeatable read）</td>\n<td>事务级</td>\n<td>否</td>\n<td>否</td>\n<td>是</td>\n</tr>\n<tr>\n<td>已提交度（Read committed）</td>\n<td>最高级别，事务级级</td>\n<td>否</td>\n<td>否</td>\n<td>否</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"5、-获取InonoD行锁争用情况\"><a href=\"#5、-获取InonoD行锁争用情况\" class=\"headerlink\" title=\"5、 获取InonoD行锁争用情况\"></a>5、 获取InonoD行锁争用情况</h3><figure class=\"highlight asciidoc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; show status like <span class=\"emphasis\">'innodb_row_lock%'</span>;</span><br><span class=\"line\"><span class=\"code\">+-------------------------------+</span>-------+</span><br><span class=\"line\">| Variable<span class=\"emphasis\">_name | Value |</span></span><br><span class=\"line\"><span class=\"emphasis\">+-------------------------------+-------+</span></span><br><span class=\"line\"><span class=\"emphasis\">| Innodb_</span>row<span class=\"emphasis\">_lock_</span>current<span class=\"emphasis\">_waits | 0 |</span></span><br><span class=\"line\"><span class=\"emphasis\">| Innodb_</span>row<span class=\"emphasis\">_lock_</span>time | 0 |</span><br><span class=\"line\">| Innodb<span class=\"emphasis\">_row_</span>lock<span class=\"emphasis\">_time_</span>avg | 0 |</span><br><span class=\"line\">| Innodb<span class=\"emphasis\">_row_</span>lock<span class=\"emphasis\">_time_</span>max | 0 |</span><br><span class=\"line\">| Innodb<span class=\"emphasis\">_row_</span>lock<span class=\"emphasis\">_waits | 0 |</span></span><br><span class=\"line\"><span class=\"emphasis\">+-------------------------------+-------+</span></span><br><span class=\"line\"><span class=\"emphasis\">5 rows in set (0.00 sec)</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"悲观锁\"><a href=\"#悲观锁\" class=\"headerlink\" title=\"悲观锁\"></a>悲观锁</h2><p>总是假设最坏的情况，每次取数据时都认为其他线程会修改，所以都会加锁(读锁、写锁、行锁等)当其他线程想要访问数据时，都需要阻塞挂起。可以依靠数据库实现，如行锁、读锁和写锁等，都是在操作之前加锁，在Java中，synchronized的思想也是悲观锁。</p>\n<h2 id=\"乐观锁\"><a href=\"#乐观锁\" class=\"headerlink\" title=\"乐观锁\"></a>乐观锁</h2><p>总是认为不会产生并发问题，每次去取数据的时候总认为不会有其他线程对数据进行修改，因此不会上锁，但是在更新时会判断其他线程在这之前有没有对数据进行修改，一般会使用版本号机制或CAS操作实现。</p>\n<p>version方式：一般是在数据表中加上一个数据版本号version字段，表示数据被修改的次数，当数据被修改时，version值会加一。当线程A要更新数据值时，在读取数据的同时也会读取version值，在提交更新时，若刚才读取到的version值为当前数据库中的version值相等时才更新，否则重试更新操作，直到更新成功。</p>\n<p>核心SQL代码：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">update</span> <span class=\"keyword\">table</span> <span class=\"keyword\">set</span> x=x+<span class=\"number\">1</span>, <span class=\"keyword\">version</span>=<span class=\"keyword\">version</span>+<span class=\"number\">1</span> <span class=\"keyword\">where</span> <span class=\"keyword\">id</span>=#&#123;<span class=\"keyword\">id</span>&#125; <span class=\"keyword\">and</span> <span class=\"keyword\">version</span>=#&#123;<span class=\"keyword\">version</span>&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>CAS操作方式：即compare and swap 或者 compare and set，涉及到三个操作数，数据所在的内存值，预期值，新值。当需要更新时，判断当前内存值与之前取到的值是否相等，若相等，则用新值更新，若失败则重试，一般情况下是一个自旋操作，即不断的重试。</p>"}],"PostAsset":[],"PostCategory":[{"post_id":"cjk9oxuw10000ydqnvo7n60ur","category_id":"cjk9oxuw50002ydqnkj50kkcg","_id":"cjk9oxuwf000cydqncrpjegq2"},{"post_id":"cjk9oxuw40001ydqnhid2838f","category_id":"cjk9oxuwa0007ydqnbd7k1jrx","_id":"cjk9oxuwh000iydqnrogtx9mv"},{"post_id":"cjk9oxuw70004ydqn0jv3djmx","category_id":"cjk9oxuwf000dydqn9lllvelq","_id":"cjk9oxuwm000oydqnawod2cjp"},{"post_id":"cjk9oxuwi000lydqnbxn6qwbh","category_id":"cjk9oxuwh000jydqn8s3trdx2","_id":"cjk9oxuwp000vydqno45heu6w"},{"post_id":"cjk9oxuw80005ydqndmoasn9z","category_id":"cjk9oxuwh000jydqn8s3trdx2","_id":"cjk9oxuwr000yydqn96fei3e1"},{"post_id":"cjk9oxuwl000nydqnjm4xfcdw","category_id":"cjk9oxuwh000jydqn8s3trdx2","_id":"cjk9oxuws0012ydqn1fm7ebsk"},{"post_id":"cjk9oxuwp000uydqn2ah5km0i","category_id":"cjk9oxuwh000jydqn8s3trdx2","_id":"cjk9oxuws0014ydqn7440zpr7"},{"post_id":"cjk9oxuw90006ydqn406pm855","category_id":"cjk9oxuwm000qydqndbbogj0a","_id":"cjk9oxuwu0018ydqnd6k8ddmc"},{"post_id":"cjk9oxuwq000xydqn7csv28td","category_id":"cjk9oxuwh000jydqn8s3trdx2","_id":"cjk9oxuwu001aydqn1abbcodu"},{"post_id":"cjk9oxuwb000aydqni5sjcnsl","category_id":"cjk9oxuwr000zydqn1h7ckw5z","_id":"cjk9oxuwv001dydqnsi33v4m7"},{"post_id":"cjk9oxuwe000bydqnuhx59z4h","category_id":"cjk9oxuwr000zydqn1h7ckw5z","_id":"cjk9oxuww001gydqn7dm8f9ql"},{"post_id":"cjk9oxuwf000fydqnup6jwb71","category_id":"cjk9oxuwr000zydqn1h7ckw5z","_id":"cjk9oxuwx001kydqnginlzycb"},{"post_id":"cjk9oxuwg000hydqneij1drs2","category_id":"cjk9oxuwm000qydqndbbogj0a","_id":"cjk9oxuwx001nydqn6hgbgise"},{"post_id":"cjk9oxuwn000sydqn84fssgch","category_id":"cjk9oxuwr000zydqn1h7ckw5z","_id":"cjk9oxuwy001pydqnke6hyuub"},{"post_id":"cjk9oxuwz001qydqn90rs6vlt","category_id":"cjk9oxuwh000jydqn8s3trdx2","_id":"cjk9oxux1001uydqn28nf98k8"},{"post_id":"cjk9oxux0001rydqn2x10pmmq","category_id":"cjk9oxuwm000qydqndbbogj0a","_id":"cjk9oxux1001vydqnsku2gvo5"}],"PostTag":[{"post_id":"cjk9oxuw10000ydqnvo7n60ur","tag_id":"cjk9oxuw70003ydqnhh4csvge","_id":"cjk9oxuwb0009ydqnmr9bzt3y"},{"post_id":"cjk9oxuw40001ydqnhid2838f","tag_id":"cjk9oxuwa0008ydqns4rdoagv","_id":"cjk9oxuwg000gydqn0akg86df"},{"post_id":"cjk9oxuw70004ydqn0jv3djmx","tag_id":"cjk9oxuwf000eydqny7lnav8p","_id":"cjk9oxuwk000mydqnvn50hfbd"},{"post_id":"cjk9oxuwi000lydqnbxn6qwbh","tag_id":"cjk9oxuwi000kydqnt1e5yq32","_id":"cjk9oxuwm000pydqngklo6hat"},{"post_id":"cjk9oxuw80005ydqndmoasn9z","tag_id":"cjk9oxuwi000kydqnt1e5yq32","_id":"cjk9oxuwo000tydqnb98elufs"},{"post_id":"cjk9oxuwl000nydqnjm4xfcdw","tag_id":"cjk9oxuwi000kydqnt1e5yq32","_id":"cjk9oxuwq000wydqnhhzpesb8"},{"post_id":"cjk9oxuwp000uydqn2ah5km0i","tag_id":"cjk9oxuwi000kydqnt1e5yq32","_id":"cjk9oxuws0011ydqnfbqn2ysl"},{"post_id":"cjk9oxuw90006ydqn406pm855","tag_id":"cjk9oxuwn000rydqnpw587tv7","_id":"cjk9oxuws0013ydqn31fvsa11"},{"post_id":"cjk9oxuwq000xydqn7csv28td","tag_id":"cjk9oxuwi000kydqnt1e5yq32","_id":"cjk9oxuwu0017ydqneilcy9w9"},{"post_id":"cjk9oxuwb000aydqni5sjcnsl","tag_id":"cjk9oxuwr0010ydqn84ffd2wt","_id":"cjk9oxuwu0019ydqn5p0wulr1"},{"post_id":"cjk9oxuwe000bydqnuhx59z4h","tag_id":"cjk9oxuwr0010ydqn84ffd2wt","_id":"cjk9oxuwv001eydqnh49dvwfh"},{"post_id":"cjk9oxuwf000fydqnup6jwb71","tag_id":"cjk9oxuwr0010ydqn84ffd2wt","_id":"cjk9oxuww001iydqnrbbf6i3r"},{"post_id":"cjk9oxuwg000hydqneij1drs2","tag_id":"cjk9oxuwn000rydqnpw587tv7","_id":"cjk9oxuwx001mydqnlgy3451f"},{"post_id":"cjk9oxuwn000sydqn84fssgch","tag_id":"cjk9oxuwr0010ydqn84ffd2wt","_id":"cjk9oxuwy001oydqnihwn00yr"},{"post_id":"cjk9oxuwz001qydqn90rs6vlt","tag_id":"cjk9oxuwi000kydqnt1e5yq32","_id":"cjk9oxux1001sydqn9hyoevql"},{"post_id":"cjk9oxux0001rydqn2x10pmmq","tag_id":"cjk9oxuwn000rydqnpw587tv7","_id":"cjk9oxux1001tydqn4dpotmkc"}],"Tag":[{"name":"Docker","_id":"cjk9oxuw70003ydqnhh4csvge"},{"name":"Hexo","_id":"cjk9oxuwa0008ydqns4rdoagv"},{"name":"Linux","_id":"cjk9oxuwf000eydqny7lnav8p"},{"name":"设计模式","_id":"cjk9oxuwi000kydqnt1e5yq32"},{"name":"MySQL","_id":"cjk9oxuwn000rydqnpw587tv7"},{"name":"PHP","_id":"cjk9oxuwr0010ydqn84ffd2wt"}]}}