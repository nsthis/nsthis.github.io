<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="keywords" content="hello  广华, 广华, yuehuaxw, "><title>LNMP环境安装 | Hello  广华</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '9b7534d772981730a36e6d23548ffe6a';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
  </script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">LNMP环境安装</h1><a id="logo" href="/.">Hello  广华</a><p class="description">今天你是否还有事情未完成？</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">LNMP环境安装</h1><div class="post-meta">Dec 19, 2017<span> | </span><span class="category"><a href="/categories/Linux/">Linux</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><!-- span.post-meta-item-text= " 字数统计："--><span class="post-count"> 2,245</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time">  |  <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><!-- span.post-meta-item-text= " 阅读时长："--><span class="post-count"> 12</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><p>本文为大家讲解PHP的环境分布安装及快速安装</p>
<a id="more"></a> 
<h2 id="LNMP一键安装"><a href="#LNMP一键安装" class="headerlink" title="LNMP一键安装"></a>LNMP一键安装</h2><p>如果你觉得分布安装太费时间或者容易出问题，可以考虑LNMP一键安装, 下附地址<br>LNMP一键安装官网：lnmp.org</p>
<h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><p>服务器选用CentOS 6.8</p>
<h2 id="yum更新"><a href="#yum更新" class="headerlink" title="yum更新"></a>yum更新</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">yun -y update</span></span><br></pre></td></tr></table></figure>
<h2 id="路径约定"><a href="#路径约定" class="headerlink" title="路径约定"></a>路径约定</h2><p>1、软件源代码包存放位置：/lnmp/src</p>
<p>2、源码包编译安装位置：/usr/local/软件名</p>
<p>3、数据库数据文件存储路径/data/mysql</p>
<h2 id="系统软件包"><a href="#系统软件包" class="headerlink" title="系统软件包"></a>系统软件包</h2><p>git地址：<a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:yuehuaxw/lnmp.git</p>
<h2 id="安装编译工具及库文件"><a href="#安装编译工具及库文件" class="headerlink" title="安装编译工具及库文件"></a>安装编译工具及库文件</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y make apr<span class="bullet">* autoconf automake curl curl-devel gcc gcc-c++  cmake  gtk+-devel zlib-devel openssl openssl-devel pcre-devel gd kernel keyutils patch perl kernel-headers compat*</span> cpp glibc libgomp libstdc++-devel keyutils-libs-devel  libarchive   libsepol-devel libselinux-devel krb5-devel libXpm<span class="bullet">* freetype freetype-devel freetype*</span> fontconfig fontconfig-devel libjpeg<span class="bullet">* libpng*</span> php-common php-gd gettext gettext-devel ncurses<span class="bullet">* libtool*</span> libxml2 libxml2-devel patch policycoreutils bison</span><br></pre></td></tr></table></figure>
<h2 id="安装cmake"><a href="#安装cmake" class="headerlink" title="安装cmake"></a>安装cmake</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd  /lnmp/src/cmake-2.8.7</span><br><span class="line">./configure <span class="attribute">--prefix</span>=/usr/local/cmake</span><br><span class="line">make #编译</span><br><span class="line">make install #安装</span><br><span class="line">vim /etc<span class="built_in">/profile </span>在path路径中增加cmake执行文件路径</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:/usr/local/cmake/bin</span><br><span class="line">source /etc<span class="built_in">/profile	</span>#使配置立即生效</span><br></pre></td></tr></table></figure>
<h2 id="安装pcre"><a href="#安装pcre" class="headerlink" title="安装pcre"></a>安装pcre</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/lnmp/src/</span></span><br><span class="line">tar zxvf pcre-8.39.tar.gz</span><br><span class="line"><span class="keyword">cd</span> pcre-8.39</span><br><span class="line">mkdir <span class="string">/usr/local/pcre</span> <span class="comment">#创建安装目录</span></span><br><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/pcre</span> </span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h2 id="安装libmcrypt"><a href="#安装libmcrypt" class="headerlink" title="安装libmcrypt"></a>安装libmcrypt</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/lnmp/src/libmcrypt-2.5.8</span></span><br><span class="line"><span class="string">./configure</span> <span class="comment">#配置</span></span><br><span class="line">make <span class="comment">#编译</span></span><br><span class="line">make install <span class="comment">#安装</span></span><br></pre></td></tr></table></figure>
<h2 id="安装gd库"><a href="#安装gd库" class="headerlink" title="安装gd库"></a>安装gd库</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/lnmp/src/</span></span><br><span class="line">tar zxvf gd-2.0.36RC1.tar.gz</span><br><span class="line"><span class="keyword">cd</span> gd-2.0.36RC1</span><br><span class="line"><span class="string">./configure</span> <span class="params">--enable-m4_pattern_allow</span> <span class="params">--prefix=/usr/local/gd</span> <span class="params">--with-jpeg=/usr/lib</span> <span class="params">--with-png=/usr/lib</span> <span class="params">--with-xpm=/usr/lib</span> <span class="params">--with-freetype=/usr/lib</span> <span class="params">--with-fontconfig=/usr/lib</span> </span><br><span class="line">make <span class="comment">#编译</span></span><br><span class="line">make install <span class="comment">#安装</span></span><br></pre></td></tr></table></figure>
<h2 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql #添加mysql组</span><br><span class="line">useradd -g mysql mysql -s /sbin/nologin #创建用户mysql并加入到mysql组，不允许mysql用户直接登录系统</span><br><span class="line">mkdir -p /var/mysql/data #创建MySQL数据库存放目录</span><br><span class="line">chown -R mysql:mysql /var/mysql/data #设置MySQL数据库目录权限</span><br><span class="line">cd /lnmp/src</span><br><span class="line">tar zxvf mysql-5.5.28.tar.gz #解压</span><br><span class="line">cd mysql-5.5.28</span><br><span class="line">cmake <span class="attribute">-DCMAKE_INSTALL_PREFIX</span>=/usr/local/mysql \</span><br><span class="line"><span class="attribute">-DMYSQL_UNIX_ADDR</span>=/usr/local/mysql/mysql.sock \</span><br><span class="line"><span class="attribute">-DDEFAULT_CHARSET</span>=utf8 \</span><br><span class="line"><span class="attribute">-DDEFAULT_COLLATION</span>=utf8_general_ci \</span><br><span class="line"><span class="attribute">-DWITH_MYISAM_STORAGE_ENGINE</span>=1 \</span><br><span class="line"><span class="attribute">-DWITH_INNOBASE_STORAGE_ENGINE</span>=1 \</span><br><span class="line"><span class="attribute">-DWITH_MEMORY_STORAGE_ENGINE</span>=1 \</span><br><span class="line"><span class="attribute">-DWITH_READLINE</span>=1 <span class="attribute">-DENABLED_LOCAL_INFILE</span>=1 \</span><br><span class="line"><span class="attribute">-DMYSQL_DATADIR</span>=/var/mysql/data \</span><br><span class="line"><span class="attribute">-DMYSQL_USER</span>=mysql <span class="attribute">-DMYSQL_TCP_PORT</span>=3306</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">cd /usr/local/mysql</span><br><span class="line">cp ./support-files/my-huge.cnf /etc/my.cnf #拷贝配置文件（注意：如果/etc目录下面默认有一个my.cnf，直接覆盖即可）</span><br><span class="line">vi /etc/my.cnf #编辑配置文件,在 [mysqld] 部分增加</span><br><span class="line">datadir = /var/mysql/data #添加MySQL数据库路径</span><br><span class="line">./scripts/mysql_install_db <span class="attribute">--user</span>=mysql #生成mysql系统数据库</span><br><span class="line">cp ./support-files/mysql.server /etc/rc.d/init.d/mysqld #把Mysql加入系统启动</span><br><span class="line">chmod 755 /etc/init.d/mysqld #增加执行权限</span><br><span class="line">chkconfig mysqld on #加入开机启动</span><br><span class="line">vi /etc/rc.d/init.d/mysqld #编辑</span><br><span class="line"><span class="attribute">basedir</span>=/usr/local/mysql #MySQL程序安装路径</span><br><span class="line"><span class="attribute">datadir</span>=/var/mysql/data #MySQl数据库存放目录</span><br><span class="line">service mysqld start #启动,可能无法写入pid文件，注意将mysql用户权限加入至/usr/local/mysql</span><br><span class="line">vi /etc<span class="built_in">/profile </span>#把mysql服务加入系统环境变量：在最后添加下面这一行</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:/usr/local/cmake/bin:/usr/local/mysql/bin</span><br><span class="line">source /etc<span class="built_in">/profile </span>#使配置立即生效</span><br><span class="line">mkdir /var/lib/mysql #创建目录</span><br><span class="line">ln -s /tmp/mysql.sock /var/lib/mysql/mysql.sock #添加软链接</span><br><span class="line">mysql_secure_installation #设置Mysql密码，根据提示按Y 回车输入2次密码</span><br><span class="line">/usr/local/mysql/bin/mysqladmin -u root -p password <span class="string">"123456"</span> #或者直接修改密码</span><br><span class="line">到此，mysql安装完成！</span><br></pre></td></tr></table></figure>
<h2 id="安装-nginx"><a href="#安装-nginx" class="headerlink" title="安装 nginx"></a>安装 nginx</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/lnmp/src</span></span><br><span class="line">tar -zxvf nginx-1.11.5.tar.gz</span><br><span class="line">groupadd www <span class="comment">#添加www组</span></span><br><span class="line">useradd -g www www -s <span class="string">/sbin/nologin</span> <span class="comment">#创建nginx运行账户www并加入到www组，不允许www用户直接登录系统</span></span><br><span class="line"><span class="keyword">cd</span> <span class="string">/lnmp/src/</span></span><br><span class="line">openssl-1.1.0b.tar.gz</span><br><span class="line"><span class="keyword">cd</span> nginx-1.11.5</span><br><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/nginx</span> <span class="params">--without-http_memcached_module</span> <span class="params">--user=www</span> <span class="params">--group=www</span> <span class="params">--with-http_stub_status_module</span> <span class="params">--with-openssl=/lnmp/src/openssl-1</span>.1.0b <span class="params">--with-pcre=/lnmp/src/pcre-8</span>.39 <span class="params">--with-http_ssl_module</span></span><br><span class="line"></span><br><span class="line">注意<span class="function">:--with-pcre</span>=<span class="string">/usr/local/src/pcre-8.39</span>指向的是源码包解压的路径，而不是安装的路径，否则会报错</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="string">/usr/local/nginx/sbin/nginx</span> <span class="comment">#启动nginx</span></span><br><span class="line">设置nginx开启启动</span><br><span class="line">vi <span class="string">/etc/rc.d/init.d/nginx</span> <span class="comment">#编辑启动文件添加下面内容</span></span><br></pre></td></tr></table></figure>
<p>附nginx文件内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># nginx Startup script for the Nginx HTTP Server</span></span><br><span class="line"><span class="comment"># it is v.0.0.2 version.</span></span><br><span class="line"><span class="comment"># chkconfig: - 85 15</span></span><br><span class="line"><span class="comment"># description: Nginx is a high-performance web and proxy server.</span></span><br><span class="line"><span class="comment"># It has a lot of features, but it's not for everyone.</span></span><br><span class="line"><span class="comment"># processname: nginx</span></span><br><span class="line"><span class="comment"># pidfile: /var/run/nginx.pid</span></span><br><span class="line"><span class="comment"># config: /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line">nginxd=/usr/<span class="built_in">local</span>/nginx/sbin/nginx</span><br><span class="line">nginx_config=/usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">nginx_pid=/usr/<span class="built_in">local</span>/nginx/logs/nginx.pid</span><br><span class="line">RETVAL=0</span><br><span class="line">prog=<span class="string">"nginx"</span></span><br><span class="line"><span class="comment"># Source function library.</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line"><span class="comment"># Source networking configuration.</span></span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"><span class="comment"># Check that networking is up.</span></span><br><span class="line">[ <span class="variable">$&#123;NETWORKING&#125;</span> = <span class="string">"no"</span> ] &amp;&amp; <span class="built_in">exit</span> 0</span><br><span class="line">[ -x <span class="variable">$nginxd</span> ] || <span class="built_in">exit</span> 0</span><br><span class="line"><span class="comment"># Start nginx daemons functions.</span></span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line"><span class="keyword">if</span> [ -e <span class="variable">$nginx_pid</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"nginx already running...."</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> -n $<span class="string">"Starting <span class="variable">$prog</span>: "</span></span><br><span class="line">daemon <span class="variable">$nginxd</span> -c <span class="variable">$&#123;nginx_config&#125;</span></span><br><span class="line">RETVAL=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">[ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; touch /var/lock/subsys/nginx</span><br><span class="line"><span class="built_in">return</span> <span class="variable">$RETVAL</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Stop nginx daemons functions.</span></span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line"><span class="built_in">echo</span> -n $<span class="string">"Stopping <span class="variable">$prog</span>: "</span></span><br><span class="line">killproc <span class="variable">$nginxd</span></span><br><span class="line">RETVAL=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">[ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; rm -f /var/lock/subsys/nginx /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">reload</span></span>() &#123;</span><br><span class="line"><span class="built_in">echo</span> -n $<span class="string">"Reloading <span class="variable">$prog</span>: "</span></span><br><span class="line"><span class="comment">#kill -HUP `cat $&#123;nginx_pid&#125;`</span></span><br><span class="line">killproc <span class="variable">$nginxd</span> -HUP</span><br><span class="line">RETVAL=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># See how we were called.</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">start</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">stop</span><br><span class="line">;;</span><br><span class="line">reload)</span><br><span class="line">reload</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">stop</span><br><span class="line">start</span><br><span class="line">;;</span><br><span class="line">status)</span><br><span class="line">status <span class="variable">$prog</span></span><br><span class="line">RETVAL=$?</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line"><span class="built_in">echo</span> $<span class="string">"Usage: <span class="variable">$prog</span> &#123;start|stop|restart|reload|status|help&#125;"</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> <span class="variable">$RETVAL</span></span><br></pre></td></tr></table></figure>
<p>保存并重启Nginx</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">:wq! #保存退出</span><br><span class="line">chmod 775 /etc/rc.d/init.d/nginx #赋予文件执行权限</span><br><span class="line">chkconfig nginx on #设置开机启动</span><br><span class="line">/etc/rc.d/init.d/nginx restart #重新启动Nginx</span><br><span class="line">service nginx restart</span><br></pre></td></tr></table></figure>
<h2 id="安装php"><a href="#安装php" class="headerlink" title="安装php"></a>安装php</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/lnmp/src</span></span><br><span class="line">tar -jxvf php-7.0.7.tar.bz2</span><br><span class="line"> <span class="keyword">cd</span> php-7.0.7</span><br><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/php7</span> <span class="params">--with-config-filepath=/usr/local/php7/etc</span>  <span class="params">--with-mysqli=/usr/local/mysql/bin/mysql_config</span> <span class="params">--enable-mysqlnd</span> <span class="params">--with-mysql-sock=/usr/local/mysql/mysql</span>.sock <span class="params">--with-gd</span> <span class="params">--with-iconv</span> <span class="params">--with-zlib</span> <span class="params">--enable-xml</span> <span class="params">--enable-bcmath</span> <span class="params">--enable-shmop</span> <span class="params">--enable-sysvsem</span> <span class="params">--enable-inline-optimization</span> <span class="params">--enable-mbregex</span> <span class="params">--enable-fpm</span> <span class="params">--enable-mbstring</span> <span class="params">--enable-ftp</span> <span class="params">--enable-gd-native-ttf</span> <span class="params">--with-openssl</span> <span class="params">--enable-pcntl</span> <span class="params">--enable-sockets</span> <span class="params">--with-xmlrpc</span> <span class="params">--enable-zip</span> <span class="params">--enable-soap</span> <span class="params">--without-pear</span> <span class="params">--with-gettext</span> <span class="params">--enable-session</span> <span class="params">--with-mcrypt</span> <span class="params">--with-curl</span> <span class="params">--with-jpeg-dir</span> <span class="params">--with-freetype-dir</span>   <span class="params">--with-pdo-mysql=/usr/local/mysql/</span></span><br><span class="line">make <span class="comment">#编译,，若遇到make: *** [ext/fileinfo/libmagic/apprentice.lo] 错误 ，这加参数–-disable-fileinfo</span></span><br><span class="line">make install <span class="comment">#安装</span></span><br><span class="line">cp php.ini-production <span class="string">/usr/local/php7/etc/</span> <span class="comment">#复制php配置文件到安装目录</span></span><br><span class="line">rm -rf <span class="string">/etc/php.ini</span> <span class="comment">#删除系统自带配置文件</span></span><br><span class="line">ln -s <span class="string">/usr/local/php7/etc/php.ini</span> <span class="string">/etc/php.ini</span> <span class="comment">#添加软链接</span></span><br><span class="line">cp sapi/fpm/init.d.php-fpm <span class="string">/etc/init.d/php-fpm</span></span><br><span class="line">cp <span class="string">/usr/local/php7/etc/php-fpm.conf.default</span> <span class="string">/usr/local/php7/etc/php-fpm.conf</span> <span class="comment">#拷贝模板文件为php-fpm配置文件</span></span><br><span class="line">cp <span class="string">/usr/local/php7/etc/php-fpm.d/www.conf.default</span> <span class="string">/usr/local/php7/etc/php-fpm.d/www.conf</span>  </span><br><span class="line">vi <span class="string">/usr/local/php7/etc/php-fpm.d/www.conf</span>  <span class="comment">#编辑</span></span><br><span class="line">user = www <span class="comment">#设置php-fpm运行账号为www</span></span><br><span class="line">group = www <span class="comment">#设置php-fpm运行组为www</span></span><br><span class="line">vim <span class="string">/usr/local/php7/etc/php-fpm.conf</span></span><br><span class="line">pid = run/php-fpm.pid <span class="comment">#取消前面的分号</span></span><br><span class="line">设置 php-fpm开机启动</span><br><span class="line">cp <span class="string">/lnmp/src/php-7.0.7/sapi/fpm/init.d.php-fpm</span> <span class="string">/etc/rc.d/init.d/php-fpm</span> <span class="comment">#拷贝php-fpm到启动目录</span></span><br><span class="line">chmod +x <span class="string">/etc/rc.d/init.d/php-fpm</span> <span class="comment">#添加执行权限</span></span><br><span class="line">chkconfig php-fpm on <span class="comment">#设置开机启动</span></span><br><span class="line">vi <span class="string">/usr/local/php7/etc/php.ini</span> <span class="comment">#编辑配置文件</span></span><br><span class="line">这里暂时不给禁用</span><br><span class="line">找到：disable_functions =</span><br><span class="line">修改为：disable_functions = passthru,exec,system,chroot,scandir,chgrp,chown,shell_exec,proc_open,proc_get_status,ini_alter,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,stream_socket_server,escapeshellcmd,dll,popen,disk_free_space,checkdnsrr,checkdnsrr,getservbyname,getservbyport,disk_total_space,posix_ctermid,posix_get_last_error,posix_getcwd, posix_getegid,posix_geteuid,posix_getgid, posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid, posix_getppid,posix_getpwnam,posix_getpwuid, posix_getrlimit, posix_getsid,posix_getuid,posix_isatty, posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid, posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname</span><br><span class="line"><span class="comment">#列出PHP可以禁用的函数，如果某些程序需要用到这个函数，可以删除，取消禁用</span></span><br><span class="line">找到：;date.timezone =</span><br><span class="line">修改为：date.timezone = PRC <span class="comment">#设置时区</span></span><br><span class="line">找到：expose_php = On</span><br><span class="line">修改为：expose_php = OFF <span class="comment">#禁止显示php版本的信息</span></span><br><span class="line">找到：short_open_tag = Off</span><br><span class="line">修改为：short_open_tag = ON <span class="comment">#支持php短标签</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##	配置nginx支持php</span></span><br><span class="line">vi <span class="string">/usr/local/nginx/conf/nginx.conf</span></span><br><span class="line">	修改<span class="string">/usr/local/nginx/conf/nginx.conf</span> 配置文件,需做如下修改</span><br></pre></td></tr></table></figure>
<p>nginx.conf内容</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span> www www; <span class="comment">#首行user去掉注释,修改Nginx运行组为www www；必须与/usr/local/php/etc/php-fpm.conf中的user,group配置相同，否则php运行出错</span></span><br><span class="line"><span class="attribute">user</span> www www;</span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">1</span>;</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">	<span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">	<span class="attribute">include</span> mime.types;</span><br><span class="line">	<span class="attribute">default_type</span> application/octet-stream;</span><br><span class="line">	<span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line">	<span class="attribute">keepalive_timeout</span> <span class="number">65</span>;</span><br><span class="line">	<span class="section">server</span> &#123;</span><br><span class="line">		<span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">		<span class="attribute">server_name</span> localhost;</span><br><span class="line">			<span class="attribute">location</span> / &#123;</span><br><span class="line">			<span class="attribute">root</span> /data/www;</span><br><span class="line">			<span class="attribute">index</span> index.php index.html index.htm;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">			<span class="attribute">root</span> /data/www;</span><br><span class="line">			<span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">			<span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">			<span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">			<span class="attribute">include</span> fastcgi_params;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">chown</span> www.www /data/www/ -R <span class="comment">#设置目录所有者</span></span><br><span class="line">chmod <span class="number">700</span> /data/www -R <span class="comment">#设置目录权限</span></span><br></pre></td></tr></table></figure>
<h2 id="服务器相关操作命令"><a href="#服务器相关操作命令" class="headerlink" title="服务器相关操作命令"></a>服务器相关操作命令</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart <span class="meta">#重启nginx</span></span><br><span class="line">service mysqld restart <span class="meta">#重启mysql</span></span><br><span class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/php/</span>sbin/php-fpm <span class="meta">#启动php-fpm</span></span><br><span class="line"><span class="meta-keyword">/etc/</span>rc.d/init.d/php-fpm restart <span class="meta">#重启php-fpm</span></span><br><span class="line"><span class="meta-keyword">/etc/</span>rc.d/init.d/php-fpm stop <span class="meta">#停止php-fpm</span></span><br><span class="line"><span class="meta-keyword">/etc/</span>rc.d/init.d/php-fpm start <span class="meta">#启动php-fpm</span></span><br></pre></td></tr></table></figure>
<p>备注：CentOS7版本使用其他的命令</p>
</div><div class="tags"><a href="/tags/Linux/">Linux</a></div><div class="post-nav"><a class="pre" href="/2018/01/01/MySQL数据库设计规范/">MySQL数据库设计规范</a><a class="next" href="/2017/12/03/Hexo多设备同步代码/">Hexo多设备同步代码</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yuehuaxw.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/PHP框架/" style="font-size: 15px;">PHP框架</a> <a href="/tags/高并发/" style="font-size: 15px;">高并发</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://chensenlin.cn/" title="你好我是森林!" target="_blank">你好我是森林!</a><ul></ul><a href="https://www.eckes.site/" title="左手bug，右手情歌" target="_blank">左手bug，右手情歌</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Hello  广华</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>