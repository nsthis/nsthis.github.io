<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="keywords" content="hello  广华, 广华, yuehuaxw, "><title>MVC | Hello  广华</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '9b7534d772981730a36e6d23548ffe6a';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
  </script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">MVC</h1><a id="logo" href="/.">Hello  广华</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">MVC</h1><div class="post-meta">Sep 30, 2017<span> | </span><span class="category"><a href="/categories/设计模式/">设计模式</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><!-- span.post-meta-item-text= " 字数统计："--><span class="post-count"> 7,793</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time">  |  <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><!-- span.post-meta-item-text= " 阅读时长："--><span class="post-count"> 41</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><p>我将MVC归属在设计模式里面,个人对MVC的理解它应该为一种设计模式。</p>
<a id="more"></a>
<h2 id="什么是MVC"><a href="#什么是MVC" class="headerlink" title="什么是MVC"></a>什么是MVC</h2><p>1、由模型(model),视图(view),控制器(controller)完成的应用程序由模型发出要实现的功能到控制器,控制器接收组织功能传递给视图;</p>
<p>2、Model(模型)，程序应用功能的实现，程序的逻辑的实现。在PHP中负责数据管理，数据生成;</p>
<p>3、View(视图)，图形界面逻辑。在PHP中负责输出，处理如何调用模板、需要的资源文件;</p>
<p>4、Controller(控制器)，负责转发请求，对请求处理。在PHP中根据请求决定调用的视图及使用的数据;</p>
<h2 id="为什么使用MVC"><a href="#为什么使用MVC" class="headerlink" title="为什么使用MVC"></a>为什么使用MVC</h2><p>1、MVC的主要作用是为了将代码分层、分类;</p>
<p>2、MVC的主要目的是为了解决Web开发中分离开发与设计工作，使其工作相对独立;</p>
<p>3、在这样的过程中还发现了其他的一些优点，网站的目录结构更加清晰，网站更易维护与扩展，可以实现模块的复用;</p>
<h2 id="我所认知的MVC"><a href="#我所认知的MVC" class="headerlink" title="我所认知的MVC"></a>我所认知的MVC</h2><p>MVC 是一个设计模式，它强制性的使应用程序的输入、处理和输出分开。使用 MVC 应 用程序被分成三个核心部件:模型、视图、控制器。它们各自处理自己的任务。视图是 用户看到并与之交互的界面。模型表示企业数据和业务规则。控制器接受用户的输入并 调用模型和视图去完成用户的需求。</p>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><p>低耦合性、高重用性和可适用性、较低的生命周期成本、快速的部署、 可维护性、可扩展性，有利于软件工程化管理</p>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><p>没有明确的定义，完全理解 MVC 并不容易。不适合小型规模的应用程序;</p>
<h2 id="MVC底层架构"><a href="#MVC底层架构" class="headerlink" title="MVC底层架构"></a>MVC底层架构</h2><p>Image类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Framework</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Image</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">	<span class="comment">//路径</span></span></span><br><span class="line"><span class="php">	<span class="keyword">private</span> $path = <span class="string">'./upload/'</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//随机文件名</span></span></span><br><span class="line"><span class="php">	<span class="keyword">private</span> $isRandName;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//初使化成员属性</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__construct</span><span class="params">($path = null , $r = true)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (!is_null($path)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;path = rtrim($path,<span class="string">'/'</span>).<span class="string">'/'</span>;</span></span><br><span class="line"><span class="php">		&#125; </span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;isRandName = $r;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//water水印的方法  目标和源，自适应能力更强一些，直接调成员方法即可</span></span></span><br><span class="line"><span class="php">	<span class="comment">//源、目标、位置 、透明度</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">water</span><span class="params">($dst,$src,$pos = <span class="number">9</span>, $prefix = <span class="string">'wa_'</span>, $tmd = <span class="number">100</span>)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//判断文件路径是否存在</span></span></span><br><span class="line"><span class="php">		$src = <span class="keyword">$this</span>-&gt;path . $src;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (!file_exists($dst) || !file_exists($src))</span></span><br><span class="line"><span class="php">		&#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">exit</span>(<span class="string">'目标者水印图片不存在'</span>);</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		<span class="comment">//获取图像的相关信息</span></span></span><br><span class="line"><span class="php">		$dstInfo = <span class="keyword">self</span>::getImageInfo($dst);</span></span><br><span class="line"><span class="php">		$srcInfo = <span class="keyword">self</span>::getImageInfo($src);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//判断宽高是否超过了目标图片的宽和高</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;_checkSize($dstInfo,$srcInfo)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">exit</span>(<span class="string">'水印图片宽、高不合法'</span>);</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		<span class="comment">//摆放位置 </span></span></span><br><span class="line"><span class="php">		$position = <span class="keyword">self</span>::getPosition($dstInfo,$srcInfo,$pos);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//打开图片</span></span></span><br><span class="line"><span class="php">		$dstRes = <span class="keyword">self</span>::openImg($dst, $dstInfo);</span></span><br><span class="line"><span class="php">		$srcRes = <span class="keyword">self</span>::openImg($src, $srcInfo);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//将两个图片合并在一起</span></span></span><br><span class="line"><span class="php">		$newRes = <span class="keyword">$this</span>-&gt;_mergeImage($dstRes,$srcRes,$position,$dstInfo,$srcInfo,$tmd);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;isRandName) &#123;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			$path = <span class="keyword">$this</span>-&gt;path.$prefix.uniqid().<span class="string">'.'</span>.$dstInfo[<span class="string">'subfix'</span>];</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			$path = <span class="keyword">$this</span>-&gt;path.$prefix.$dstInfo[<span class="string">'basename'</span>];</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		<span class="comment">//保存图片</span></span></span><br><span class="line"><span class="php">		<span class="keyword">self</span>::saveImage($newRes,$path,$dstInfo);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//销毁资源</span></span></span><br><span class="line"><span class="php">		imagedestroy($newRes);</span></span><br><span class="line"><span class="php">		imagedestroy($srcRes);</span></span><br><span class="line"><span class="php">		<span class="comment">//返回路径</span></span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $path;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//thumb 源 和 宽高</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">thumb</span><span class="params">($dst,$width,$height,$prefix = <span class="string">'thumb_'</span>)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//判断文件是否在</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (!file_exists($dst)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">exit</span>(<span class="string">'文件路径不存在'</span>);</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		<span class="comment">//获取图像的信息，没有信息，你什么都 做不鸟</span></span></span><br><span class="line"><span class="php">		$info = <span class="keyword">self</span>::getImageInfo($dst);</span></span><br><span class="line"><span class="php">		<span class="comment">//得到新的尺寸</span></span></span><br><span class="line"><span class="php">		$newSize = <span class="keyword">self</span>::getNewSize($width,$height,$info);</span></span><br><span class="line"><span class="php">		<span class="comment">//打开资源</span></span></span><br><span class="line"><span class="php">		$res = <span class="keyword">self</span>::openImg($dst,$info);</span></span><br><span class="line"><span class="php">		<span class="comment">//等比缩放这个资源，处理gif背景变黑的问题 </span></span></span><br><span class="line"><span class="php">		$newRes = <span class="keyword">self</span>::kidOfImage($res,$newSize,$info);</span></span><br><span class="line"><span class="php">		<span class="comment">//保存</span></span></span><br><span class="line"><span class="php">		$path = <span class="keyword">$this</span>-&gt;path.$prefix.$info[<span class="string">'basename'</span>];</span></span><br><span class="line"><span class="php">		<span class="keyword">self</span>::saveImage($newRes,$path,$info);</span></span><br><span class="line"><span class="php">		<span class="comment">//销毁</span></span></span><br><span class="line"><span class="php">		imagedestroy($newRes);</span></span><br><span class="line"><span class="php">		<span class="comment">//返回路径</span></span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $path;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">kidOfImage</span><span class="params">($srcImg, $size, $imgInfo)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		$newImg = imagecreatetruecolor($size[<span class="string">"width"</span>], $size[<span class="string">"height"</span>]);		</span></span><br><span class="line"><span class="php">		$otsc = imagecolortransparent($srcImg);</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> ( $otsc &gt;= <span class="number">0</span> &amp;&amp; $otsc &lt; imagecolorstotal($srcImg)) &#123;</span></span><br><span class="line"><span class="php">			 $transparentcolor = imagecolorsforindex( $srcImg, $otsc );</span></span><br><span class="line"><span class="php">				 $newtransparentcolor = imagecolorallocate(</span></span><br><span class="line"><span class="php">				 $newImg,</span></span><br><span class="line"><span class="php">				 $transparentcolor[<span class="string">'red'</span>],</span></span><br><span class="line"><span class="php">					 $transparentcolor[<span class="string">'green'</span>],</span></span><br><span class="line"><span class="php">				 $transparentcolor[<span class="string">'blue'</span>]</span></span><br><span class="line"><span class="php">			 );</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">			 imagefill( $newImg, <span class="number">0</span>, <span class="number">0</span>, $newtransparentcolor );</span></span><br><span class="line"><span class="php">			 imagecolortransparent( $newImg, $newtransparentcolor );</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">		imagecopyresized( $newImg, $srcImg, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, $size[<span class="string">"width"</span>], $size[<span class="string">"height"</span>], $imgInfo[<span class="string">"width"</span>], $imgInfo[<span class="string">"height"</span>] );</span></span><br><span class="line"><span class="php">		imagedestroy($srcImg);</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $newImg;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewSize</span><span class="params">($width, $height, $imgInfo)</span></span></span></span><br><span class="line"><span class="php">	&#123;	</span></span><br><span class="line"><span class="php">		$size[<span class="string">"width"</span>] = $imgInfo[<span class="string">"width"</span>];   <span class="comment">//将原图片的宽度给数组中的$size["width"]</span></span></span><br><span class="line"><span class="php">		$size[<span class="string">"height"</span>] = $imgInfo[<span class="string">"height"</span>];  <span class="comment">//将原图片的高度给数组中的$size["height"]</span></span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span>($width &lt; $imgInfo[<span class="string">"width"</span>]) &#123;</span></span><br><span class="line"><span class="php">			$size[<span class="string">"width"</span>] = $width;             <span class="comment">//缩放的宽度如果比原图小才重新设置宽度</span></span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> ($width &lt; $imgInfo[<span class="string">"height"</span>]) &#123;</span></span><br><span class="line"><span class="php">			$size[<span class="string">"height"</span>] = $height;            <span class="comment">//缩放的高度如果比原图小才重新设置高度</span></span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span>($imgInfo[<span class="string">"width"</span>]*$size[<span class="string">"width"</span>] &gt; $imgInfo[<span class="string">"height"</span>] * $size[<span class="string">"height"</span>]) &#123;</span></span><br><span class="line"><span class="php">			$size[<span class="string">"height"</span>] = round($imgInfo[<span class="string">"height"</span>] * $size[<span class="string">"width"</span>] / $imgInfo[<span class="string">"width"</span>]);</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			$size[<span class="string">"width"</span>] = round($imgInfo[<span class="string">"width"</span>] * $size[<span class="string">"height"</span>] / $imgInfo[<span class="string">"height"</span>]);</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $size;</span></span><br><span class="line"><span class="php">	&#125;		</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">saveImage</span><span class="params">($res,$path,$info)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">switch</span> ($info[<span class="string">'mime'</span>]) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/png'</span>:</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/x-png'</span>:</span></span><br><span class="line"><span class="php">				imagepng($res,$path);</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/jpeg'</span>:</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/jpg'</span>:</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/pjpeg'</span>:</span></span><br><span class="line"><span class="php">				imagejpeg($res,$path);</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/gif'</span>:</span></span><br><span class="line"><span class="php">				imagegif($res,$path);</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/wbmp'</span>:</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/bmp'</span>:</span></span><br><span class="line"><span class="php">				imagewbmp($res,$path);</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_mergeImage</span><span class="params">($dstRes,$srcRes,$position,$dstInfo,$srcInfo,$tmd)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		imagecopymerge($dstRes,$srcRes,$position[<span class="string">'x'</span>],$position[<span class="string">'y'</span>],<span class="number">0</span>,<span class="number">0</span>,$srcInfo[<span class="string">'width'</span>],$srcInfo[<span class="string">'height'</span>],$tmd);</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $dstRes;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">openImg</span><span class="params">($path, $info)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">switch</span> ($info[<span class="string">'mime'</span>]) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/png'</span>:</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/x-png'</span>:</span></span><br><span class="line"><span class="php">				$res = imagecreatefrompng($path);</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/jpeg'</span>:</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/jpg'</span>:</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/pjpeg'</span>:</span></span><br><span class="line"><span class="php">				$res = imagecreatefromjpeg($path);</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/gif'</span>:</span></span><br><span class="line"><span class="php">				$res = imagecreatefromgif($path);</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/wbmp'</span>:</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="string">'image/bmp'</span>:</span></span><br><span class="line"><span class="php">				$res = imagecreatefromwbmp($path);</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $res;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getPosition</span><span class="params">($dstInfo,$srcInfo,$pos)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">switch</span> ($pos) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">1</span>:</span></span><br><span class="line"><span class="php">				$x = <span class="number">0</span>;</span></span><br><span class="line"><span class="php">				$y = <span class="number">0</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">2</span>:</span></span><br><span class="line"><span class="php">				$x = ceil(($dstInfo[<span class="string">'width'</span>] - $srcInfo[<span class="string">'width'</span>]) / <span class="number">2</span>);</span></span><br><span class="line"><span class="php">				$y = <span class="number">0</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">3</span>:</span></span><br><span class="line"><span class="php">				$x = $dstInfo[<span class="string">'width'</span>] - $srcInfo[<span class="string">'width'</span>];</span></span><br><span class="line"><span class="php">				$y = <span class="number">0</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">				</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">4</span>:</span></span><br><span class="line"><span class="php">				$x = <span class="number">0</span>;</span></span><br><span class="line"><span class="php">				$y = ceil(($dstInfo[<span class="string">'height'</span>] - $srcInfo[<span class="string">'height'</span>]) /<span class="number">2</span> );</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">5</span>:</span></span><br><span class="line"><span class="php">				$x = ceil(($dstInfo[<span class="string">'width'</span>] - $srcInfo[<span class="string">'width'</span>]) / <span class="number">2</span>);</span></span><br><span class="line"><span class="php">				$y = ceil(($dstInfo[<span class="string">'height'</span>] - $srcInfo[<span class="string">'height'</span>]) /<span class="number">2</span> );</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">6</span>:</span></span><br><span class="line"><span class="php">				$x = $dstInfo[<span class="string">'width'</span>] - $srcInfo[<span class="string">'width'</span>];</span></span><br><span class="line"><span class="php">				$y = ceil(($dstInfo[<span class="string">'height'</span>] - $srcInfo[<span class="string">'height'</span>]) /<span class="number">2</span> );</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">				</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">7</span>:</span></span><br><span class="line"><span class="php">				$x = <span class="number">0</span>;</span></span><br><span class="line"><span class="php">				$y = $dstInfo[<span class="string">'height'</span>] - $srcInfo[<span class="string">'height'</span>];</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">8</span>:</span></span><br><span class="line"><span class="php">				$x = ceil(($dstInfo[<span class="string">'width'</span>] - $srcInfo[<span class="string">'width'</span>]) / <span class="number">2</span>);</span></span><br><span class="line"><span class="php">				$y = $dstInfo[<span class="string">'height'</span>] - $srcInfo[<span class="string">'height'</span>];</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">9</span>:</span></span><br><span class="line"><span class="php">				$x = $dstInfo[<span class="string">'width'</span>] - $srcInfo[<span class="string">'width'</span>];</span></span><br><span class="line"><span class="php">				$y = $dstInfo[<span class="string">'height'</span>] - $srcInfo[<span class="string">'height'</span>];</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">default</span>:</span></span><br><span class="line"><span class="php">				$x = mt_rand(<span class="number">0</span>,$dstInfo[<span class="string">'width'</span>] - $srcInfo[<span class="string">'width'</span>]);</span></span><br><span class="line"><span class="php">				$y = mt_rand(<span class="number">0</span>,$dstInfo[<span class="string">'height'</span>] - $srcInfo[<span class="string">'height'</span>]);</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> [<span class="string">'x'</span> =&gt; $x, <span class="string">'y'</span> =&gt; $y];</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_checkSize</span><span class="params">($dstInfo,$srcInfo)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> ($dstInfo[<span class="string">'width'</span>] &lt; $srcInfo[<span class="string">'width'</span>] || $dstInfo[<span class="string">'height'</span>] &lt; $srcInfo[<span class="string">'height'</span>]) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;	</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="keyword">static</span>  <span class="function"><span class="keyword">function</span> <span class="title">getImageInfo</span><span class="params">($path)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		$data = [];</span></span><br><span class="line"><span class="php">		$info = getimagesize($path);</span></span><br><span class="line"><span class="php">		$data[<span class="string">'width'</span>] = $info[<span class="number">0</span>];</span></span><br><span class="line"><span class="php">		$data[<span class="string">'height'</span>] = $info[<span class="number">1</span>];</span></span><br><span class="line"><span class="php">		$data[<span class="string">'mime'</span>] = $info[<span class="string">'mime'</span>];</span></span><br><span class="line"><span class="php">		$path = pathinfo($path);</span></span><br><span class="line"><span class="php">		$data[<span class="string">'basename'</span>] = $path[<span class="string">'basename'</span>];</span></span><br><span class="line"><span class="php">		$data[<span class="string">'subfix'</span>] = $path[<span class="string">'extension'</span>];</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $data;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Model类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Framework</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">//连接</span></span><br><span class="line">	<span class="keyword">protected</span> $link;</span><br><span class="line">	<span class="comment">//用户名</span></span><br><span class="line">	<span class="keyword">protected</span> $user;</span><br><span class="line">	<span class="comment">//密码</span></span><br><span class="line">	<span class="keyword">protected</span> $pwd;</span><br><span class="line">	<span class="comment">//字符集</span></span><br><span class="line">	<span class="keyword">protected</span> $charset;</span><br><span class="line">	<span class="comment">//表前缀</span></span><br><span class="line">	<span class="keyword">protected</span> $prefix;</span><br><span class="line">	<span class="comment">//库名</span></span><br><span class="line">	<span class="keyword">protected</span> $dbName;</span><br><span class="line">	<span class="comment">//主机</span></span><br><span class="line">	<span class="keyword">protected</span> $host;</span><br><span class="line">	<span class="comment">//表名</span></span><br><span class="line">	<span class="keyword">protected</span> $table;</span><br><span class="line">	<span class="comment">//字段</span></span><br><span class="line">	<span class="keyword">protected</span> $fields;</span><br><span class="line">	<span class="comment">//保存的查询、更新、添加的参数</span></span><br><span class="line">	<span class="keyword">protected</span> $options;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//初使化数据库连接</span></span><br><span class="line">	<span class="comment">//把一批成员属性都 初使化</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Array $config)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;host = $config[<span class="string">'DB_HOST'</span>];</span><br><span class="line">		<span class="keyword">$this</span>-&gt;user = $config[<span class="string">'DB_USER'</span>];</span><br><span class="line">		<span class="keyword">$this</span>-&gt;pwd = $config[<span class="string">'DB_PWD'</span>];</span><br><span class="line">		<span class="keyword">$this</span>-&gt;dbName = $config[<span class="string">'DB_NAME'</span>];</span><br><span class="line">		<span class="keyword">$this</span>-&gt;charset = $config[<span class="string">'DB_CHARSET'</span>];</span><br><span class="line">		<span class="keyword">$this</span>-&gt;prefix = $config[<span class="string">'DB_PREFIX'</span>];</span><br><span class="line">		<span class="comment">//连接</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;link = <span class="keyword">$this</span>-&gt;connect();</span><br><span class="line">		<span class="comment">//判断是否连接失败</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;link) &#123;</span><br><span class="line">			<span class="keyword">exit</span>(<span class="string">'数据库连接失败'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//表名</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;table = <span class="keyword">$this</span>-&gt;getTable();</span><br><span class="line"></span><br><span class="line">		<span class="comment">//字段</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;fields = <span class="keyword">$this</span>-&gt;getFields();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//连接数库</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$conn = mysqli_connect(<span class="keyword">$this</span>-&gt;host,<span class="keyword">$this</span>-&gt;user,<span class="keyword">$this</span>-&gt;pwd);</span><br><span class="line">		<span class="comment">//连接失败</span></span><br><span class="line">		<span class="keyword">if</span> (!$conn) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//选择库失败处理</span></span><br><span class="line">		<span class="keyword">if</span> (!mysqli_select_db($conn,<span class="keyword">$this</span>-&gt;dbName)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		mysqli_set_charset($conn,<span class="keyword">$this</span>-&gt;charset);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> $conn;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//初始化表</span></span><br><span class="line">	<span class="comment">//（报错，我们再根据命名空间去解决，涉及到命名空间的类名）</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getTable</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;table)) &#123;</span><br><span class="line">			<span class="comment">//用户设置 过以用户设置的为准</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;prefix . ltrim(<span class="keyword">$this</span>-&gt;table,<span class="keyword">$this</span>-&gt;prefix);</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> ($pos = strpos(get_class(<span class="keyword">$this</span>),<span class="string">'\\'</span>)) &#123;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;prefix .  strtolower(str_replace([<span class="string">'Model'</span>,<span class="string">'model'</span>],<span class="string">''</span>,substr(get_class(<span class="keyword">$this</span>),$pos + <span class="number">1</span>)));</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			</span><br><span class="line">				<span class="comment">//用户没有设置过，以类名拼接前缀，给成成全新的表名</span></span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;prefix .strtolower(substr(get_class(<span class="keyword">$this</span>),<span class="number">0</span>,<span class="number">-5</span>));</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//始初化字段</span></span><br><span class="line">	<span class="comment">//要把字段缓存到一个文件中去</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getFields</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//如果有字段的文件则说明曾经缓存过这个文件，直接包含进来即可</span></span><br><span class="line">		<span class="comment">//知道文件路径命名的规则 </span></span><br><span class="line">		$filePath = <span class="string">'./Cache/'</span>.<span class="keyword">$this</span>-&gt;table.<span class="string">'.php'</span>;</span><br><span class="line">		<span class="keyword">if</span> (file_exists($filePath)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">include</span> $filePath;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			$fields = <span class="keyword">$this</span>-&gt;queryFields();</span><br><span class="line">			</span><br><span class="line">			$str = <span class="string">"&lt;?php \nreturn "</span>.var_export($fields,<span class="keyword">true</span>).<span class="string">';?&gt;'</span>;</span><br><span class="line">			</span><br><span class="line">			file_put_contents($filePath,$str);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> $fields;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//查询出字段</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">queryFields</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$sql = <span class="string">'desc '</span>.<span class="keyword">$this</span>-&gt;table;</span><br><span class="line">		</span><br><span class="line">		$data = <span class="keyword">$this</span>-&gt;query($sql);</span><br><span class="line">	</span><br><span class="line">		</span><br><span class="line">		$fields = [];</span><br><span class="line">		<span class="keyword">foreach</span> ($data <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">			$fields[] = $val[<span class="string">'Field'</span>];</span><br><span class="line">			<span class="keyword">if</span> ($val[<span class="string">'Key'</span>] == <span class="string">'PRI'</span>) &#123;</span><br><span class="line">				$fields[<span class="string">'_pk'</span>] = $val[<span class="string">'Field'</span>];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> $fields;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//系统级的查询方法，设置 为public ，如果在外部想要调用的时候，想自定sql句的候，可以直接query</span></span><br><span class="line">	<span class="comment">//查询应的结果，这个仅供读取使用</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">($sql)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">		$result = mysqli_query(<span class="keyword">$this</span>-&gt;link,$sql);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> ($result) &#123;</span><br><span class="line">			$data = [];</span><br><span class="line">			<span class="keyword">while</span>($row = mysqli_fetch_assoc($result)) &#123;</span><br><span class="line">				$data[] = $row;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> $data;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//查询方法</span></span><br><span class="line">	<span class="comment">//准备好无需换的SQL语句</span></span><br><span class="line">	<span class="comment">//用户调用询的时候，将call里面保存进去的参数，一一替换sql语句</span></span><br><span class="line">	<span class="comment">//发送SQL语句</span></span><br><span class="line">	<span class="comment">//返回查询果</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">select</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">		$sql = <span class="string">"select %FIELDS% from %TABLE% %WHERE% %GROUP% %HAVING% %ORDER% %LIMIT%"</span>;</span><br><span class="line">		</span><br><span class="line">		$newSql = str_replace(</span><br><span class="line">						<span class="keyword">array</span>(</span><br><span class="line">							<span class="string">'%FIELDS%'</span>,</span><br><span class="line">							<span class="string">'%TABLE%'</span>,</span><br><span class="line">							<span class="string">'%WHERE%'</span>,</span><br><span class="line">							<span class="string">'%GROUP%'</span>,</span><br><span class="line">							<span class="string">'%HAVING%'</span>,</span><br><span class="line">							<span class="string">'%ORDER%'</span>,</span><br><span class="line">							<span class="string">'%LIMIT%'</span>,</span><br><span class="line">							</span><br><span class="line">						),</span><br><span class="line">						<span class="keyword">array</span>(</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseFields(),</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseTable(),</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseWhere(),</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseGroup(),</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseHaving(),</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseOrder(),</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseLimit(),</span><br><span class="line">						),</span><br><span class="line">						$sql</span><br><span class="line">						);</span><br><span class="line">						</span><br><span class="line">		<span class="comment">//为了在外面想知道自动生成的SQL语旬是神马的时候</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;sql = $newSql;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;query($newSql);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span>  <span class="title">parseFields</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//因为我们对比字段的时候不需要对比主键是谁</span></span><br><span class="line">		<span class="comment">//因此，我干掉主键 </span></span><br><span class="line">		$fields = <span class="keyword">$this</span>-&gt;fields;</span><br><span class="line">		<span class="keyword">unset</span>($fields[<span class="string">'_pk'</span>]);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//用户向fileds('id,username,password') 先将其切割，用,号切割explode</span></span><br><span class="line">		<span class="comment">//如果用户传的是一个数组fileds(['id','username','password'])，则对比应的字段，算交集</span></span><br><span class="line">		<span class="comment">//array_intersect</span></span><br><span class="line">		<span class="comment">//array_intersect_key</span></span><br><span class="line">		<span class="comment">//array_intersect_assoc</span></span><br><span class="line">		<span class="comment">//array_intersect_ukey</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'fields'</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">			<span class="comment">//是数组的时怎么处理法</span></span><br><span class="line">			<span class="keyword">if</span> (is_array(<span class="keyword">$this</span>-&gt;options[<span class="string">'fields'</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">				<span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'fields'</span>][<span class="number">0</span>] <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">					<span class="keyword">if</span> (!in_array($val,$fields)) &#123;</span><br><span class="line">						<span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'fields'</span>][<span class="number">0</span>][$key]);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> join(<span class="string">','</span>,<span class="keyword">$this</span>-&gt;options[<span class="string">'fields'</span>][<span class="number">0</span>]);</span><br><span class="line">				</span><br><span class="line">			&#125; <span class="keyword">elseif</span> (is_string(<span class="keyword">$this</span>-&gt;options[<span class="string">'fields'</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">				<span class="comment">//是字符串的时候先变为组再处理</span></span><br><span class="line">				<span class="keyword">$this</span>-&gt;options[<span class="string">'fields'</span>][<span class="number">0</span>] = explode(<span class="string">','</span>,<span class="keyword">$this</span>-&gt;options[<span class="string">'fields'</span>][<span class="number">0</span>]);</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'fields'</span>][<span class="number">0</span>] <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">					<span class="keyword">if</span> (!in_array($val,$fields)) &#123;</span><br><span class="line">						<span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'fields'</span>][<span class="number">0</span>][$key]);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> join(<span class="string">','</span>,<span class="keyword">$this</span>-&gt;options[<span class="string">'fields'</span>][<span class="number">0</span>]);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> join(<span class="string">','</span>,$fields);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//判断用户有没有手动指定过查询哪个用</span></span><br><span class="line">	<span class="comment">//如果指定过，则以用户设定的options里面的表为准</span></span><br><span class="line">	<span class="comment">//如果没有设定过，则以默认的为准</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span>  <span class="title">parseTable</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'table'</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;options[<span class="string">'table'</span>][<span class="number">0</span>];</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;table;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//看看用户是否设置过where，如果设置过以用户设置 的为准</span></span><br><span class="line">	<span class="comment">//如果没有设置 则为空</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span>  <span class="title">parseWhere</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'where'</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">'WHERE '</span>.<span class="keyword">$this</span>-&gt;options[<span class="string">'where'</span>][<span class="number">0</span>];</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span>  <span class="title">parseGroup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'group'</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">'GROUP BY '</span>.<span class="keyword">$this</span>-&gt;options[<span class="string">'group'</span>][<span class="number">0</span>];</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span>  <span class="title">parseHaving</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'having'</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">'HAVING '</span>.<span class="keyword">$this</span>-&gt;options[<span class="string">'having'</span>][<span class="number">0</span>];</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span>  <span class="title">parseOrder</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'order'</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">'ORDER BY '</span>.<span class="keyword">$this</span>-&gt;options[<span class="string">'order'</span>][<span class="number">0</span>];</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//limit可以有以下几种传法</span></span><br><span class="line">	<span class="comment">//用户传进来的是一个整 数，就是查询指定的条数</span></span><br><span class="line">	<span class="comment">//用户传进来的是一个数组，则数组中的第一个元素为$offset,第二个元素为$num</span></span><br><span class="line">	<span class="comment">//如果户传进来的是一个字符串，则以用户传的为准</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span>  <span class="title">parseLimit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'limit'</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> (is_int(<span class="keyword">$this</span>-&gt;options[<span class="string">'limit'</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="string">'LIMIT '</span>.<span class="keyword">$this</span>-&gt;options[<span class="string">'limit'</span>][<span class="number">0</span>];</span><br><span class="line">			&#125; <span class="keyword">elseif</span> (is_array(<span class="keyword">$this</span>-&gt;options[<span class="string">'limit'</span>][<span class="number">0</span>])) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="string">'LIMIT '</span>. join(<span class="string">','</span>,<span class="keyword">$this</span>-&gt;options[<span class="string">'limit'</span>][<span class="number">0</span>]);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="string">'LIMIT '</span> . <span class="keyword">$this</span>-&gt;options[<span class="string">'limit'</span>][<span class="number">0</span>];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//增加方法</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line">		$sql = <span class="string">"insert into %TABLE%(%FIELDS%) values(%VALUES%)"</span>;</span><br><span class="line">		<span class="comment">//insert into bbs_user(username,sex) values('liwenkai','null');</span></span><br><span class="line">		$newSql = str_replace(</span><br><span class="line">					<span class="keyword">array</span>(<span class="string">'%TABLE%'</span>,<span class="string">'%FIELDS%'</span>,<span class="string">'%VALUES%'</span>),</span><br><span class="line">					<span class="keyword">array</span>(</span><br><span class="line">						<span class="keyword">$this</span>-&gt;parseTable(),</span><br><span class="line">						<span class="keyword">$this</span>-&gt;parseInsertFields($data),</span><br><span class="line">						join(<span class="string">','</span>,<span class="keyword">$this</span>-&gt;parseValue($data)),</span><br><span class="line">					),</span><br><span class="line">					$sql</span><br><span class="line">				);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">$this</span>-&gt;sql = $newSql;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//echo $newSql;</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;exec($newSql,<span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">parseValue</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (is_string($data)) &#123;</span><br><span class="line">			$data = <span class="string">'\''</span>.$data.<span class="string">'\''</span>;</span><br><span class="line">		&#125; <span class="keyword">elseif</span> (is_array($data)) &#123;</span><br><span class="line">			$data = array_map(<span class="keyword">array</span>(<span class="keyword">$this</span>,<span class="string">'parseValue'</span>),$data);</span><br><span class="line">		&#125; <span class="keyword">elseif</span> (is_null($data)) &#123;</span><br><span class="line">			$data = <span class="string">'null'</span>;</span><br><span class="line">		&#125;</span><br><span class="line"> 		</span><br><span class="line">		<span class="keyword">return</span> $data;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">parseInsertFields</span><span class="params">(&amp;$data)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">foreach</span> ($data <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!in_array($key,<span class="keyword">$this</span>-&gt;fields)) &#123;</span><br><span class="line">				<span class="keyword">unset</span>($data[$key]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> join(<span class="string">','</span>,array_keys($data));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//更新方法</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$sql = <span class="string">"update %TABLE% set %SETS% %WHERE% %ORDER% %LIMIT%"</span>;</span><br><span class="line">		$newSql = str_replace(</span><br><span class="line">						<span class="keyword">array</span>(<span class="string">'%TABLE%'</span>,<span class="string">'%SETS%'</span>,<span class="string">'%WHERE%'</span>,<span class="string">'%ORDER%'</span>,<span class="string">'%LIMIT%'</span>),</span><br><span class="line">						<span class="keyword">array</span>(</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseTable(),</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseSets($data),</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseWhere(),</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseOrder(),</span><br><span class="line">							<span class="keyword">$this</span>-&gt;parseLimit(),</span><br><span class="line">						),</span><br><span class="line">						$sql</span><br><span class="line">					);</span><br><span class="line">			</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">$this</span>-&gt;sql = $newSql;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;exec($newSql);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parseSets</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$sets = [];</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">foreach</span> ($data <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">			<span class="keyword">if</span> (in_array($key,<span class="keyword">$this</span>-&gt;fields)) &#123;</span><br><span class="line">				</span><br><span class="line">				$sets[] = $key.<span class="string">'='</span>.<span class="keyword">$this</span>-&gt;parseValue($val);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> join(<span class="string">','</span>,$sets) ;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//删除方法</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$sql = <span class="string">"delete from %TABLE% %WHERE% %ORDER% %LIMIT%"</span>;</span><br><span class="line">		</span><br><span class="line">		$newSql = str_replace(</span><br><span class="line">					<span class="keyword">array</span>(<span class="string">'%TABLE%'</span>,<span class="string">'%WHERE%'</span>,<span class="string">'%ORDER%'</span>,<span class="string">'%LIMIT%'</span>),</span><br><span class="line">					<span class="keyword">array</span>(</span><br><span class="line">						<span class="keyword">$this</span>-&gt;parseTable(),</span><br><span class="line">						<span class="keyword">$this</span>-&gt;parseWhere(),</span><br><span class="line">						<span class="keyword">$this</span>-&gt;parseOrder(),</span><br><span class="line">						<span class="keyword">$this</span>-&gt;parseLimit(),</span><br><span class="line">					),</span><br><span class="line">					$sql</span><br><span class="line">				);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">$this</span>-&gt;sql = $newSql;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;exec($newSql);</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span><span class="params">($sql, $isInsertId = false)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$result = mysqli_query(<span class="keyword">$this</span>-&gt;link,$sql);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> ($result) &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> ( $isInsertId ) &#123;</span><br><span class="line">				<span class="comment">//insert 返回自动增长的ID</span></span><br><span class="line">				<span class="keyword">return</span> mysqli_insert_id(<span class="keyword">$this</span>-&gt;link);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				</span><br><span class="line">				<span class="comment">//update delete只直返回 受影响行数</span></span><br><span class="line">				<span class="keyword">return</span> mysqli_affected_rows(<span class="keyword">$this</span>-&gt;link);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//查最大值 </span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">count</span><span class="params">($field = null)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (is_null($field)) &#123;</span><br><span class="line">			$field = <span class="keyword">$this</span>-&gt;fields[<span class="string">'_pk'</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		$sql = <span class="string">"select count($field) as num  from %TABLE% %WHERE%"</span>;</span><br><span class="line">		</span><br><span class="line">		$sql = str_replace(</span><br><span class="line">				<span class="keyword">array</span>(</span><br><span class="line">					<span class="string">'%TABLE%'</span>,</span><br><span class="line">					<span class="string">'%WHERE%'</span>,</span><br><span class="line">				),</span><br><span class="line">				<span class="keyword">array</span>(</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseTable(),</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseWhere(),</span><br><span class="line">				),</span><br><span class="line">				$sql</span><br><span class="line">				);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">$this</span>-&gt;sql = $sql;</span><br><span class="line">		$data =  <span class="keyword">$this</span>-&gt;query($sql);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> $data[<span class="number">0</span>][<span class="string">'num'</span>];</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//最小值 </span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">min</span><span class="params">($field = null)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (is_null($field)) &#123;</span><br><span class="line">			$field = <span class="keyword">$this</span>-&gt;fields[<span class="string">'_pk'</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		$sql = <span class="string">"select min($field) as num  from %TABLE% %WHERE%"</span>;</span><br><span class="line">		</span><br><span class="line">		$sql = str_replace(</span><br><span class="line">				<span class="keyword">array</span>(</span><br><span class="line">					<span class="string">'%TABLE%'</span>,</span><br><span class="line">					<span class="string">'%WHERE%'</span>,</span><br><span class="line">				),</span><br><span class="line">				<span class="keyword">array</span>(</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseTable(),</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseWhere(),</span><br><span class="line">				),</span><br><span class="line">				$sql</span><br><span class="line">				);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">$this</span>-&gt;sql = $sql;</span><br><span class="line">		$data =  <span class="keyword">$this</span>-&gt;query($sql);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> $data[<span class="number">0</span>][<span class="string">'num'</span>];</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">($field = null)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (is_null($field)) &#123;</span><br><span class="line">			$field = <span class="keyword">$this</span>-&gt;fields[<span class="string">'_pk'</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		$sql = <span class="string">"select SUM($field) as num  from %TABLE% %WHERE%"</span>;</span><br><span class="line">		</span><br><span class="line">		$sql = str_replace(</span><br><span class="line">				<span class="keyword">array</span>(</span><br><span class="line">					<span class="string">'%TABLE%'</span>,</span><br><span class="line">					<span class="string">'%WHERE%'</span>,</span><br><span class="line">				),</span><br><span class="line">				<span class="keyword">array</span>(</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseTable(),</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseWhere(),</span><br><span class="line">				),</span><br><span class="line">				$sql</span><br><span class="line">				);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">$this</span>-&gt;sql = $sql;</span><br><span class="line">		$data =  <span class="keyword">$this</span>-&gt;query($sql);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> $data[<span class="number">0</span>][<span class="string">'num'</span>];</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//求最大值 </span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">max</span><span class="params">($field = null)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (is_null($field)) &#123;</span><br><span class="line">			$field = <span class="keyword">$this</span>-&gt;fields[<span class="string">'_pk'</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		$sql = <span class="string">"select max($field) as num  from %TABLE% %WHERE%"</span>;</span><br><span class="line">		</span><br><span class="line">		$sql = str_replace(</span><br><span class="line">				<span class="keyword">array</span>(</span><br><span class="line">					<span class="string">'%TABLE%'</span>,</span><br><span class="line">					<span class="string">'%WHERE%'</span>,</span><br><span class="line">				),</span><br><span class="line">				<span class="keyword">array</span>(</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseTable(),</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseWhere(),</span><br><span class="line">				),</span><br><span class="line">				$sql</span><br><span class="line">				);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">$this</span>-&gt;sql = $sql;</span><br><span class="line">		$data =  <span class="keyword">$this</span>-&gt;query($sql);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> $data[<span class="number">0</span>][<span class="string">'num'</span>];</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//求平均数</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">avg</span><span class="params">($field = null)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (is_null($field)) &#123;</span><br><span class="line">			$field = <span class="keyword">$this</span>-&gt;fields[<span class="string">'_pk'</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		$sql = <span class="string">"select avg($field) as num  from %TABLE% %WHERE%"</span>;</span><br><span class="line">		</span><br><span class="line">		$sql = str_replace(</span><br><span class="line">				<span class="keyword">array</span>(</span><br><span class="line">					<span class="string">'%TABLE%'</span>,</span><br><span class="line">					<span class="string">'%WHERE%'</span>,</span><br><span class="line">				),</span><br><span class="line">				<span class="keyword">array</span>(</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseTable(),</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseWhere(),</span><br><span class="line">				),</span><br><span class="line">				$sql</span><br><span class="line">				);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">$this</span>-&gt;sql = $sql;</span><br><span class="line">		$data =  <span class="keyword">$this</span>-&gt;query($sql);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> $data[<span class="number">0</span>][<span class="string">'num'</span>];</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getBy</span><span class="params">($field,$value)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">		$sql = <span class="string">"select %FIELDS% from %TABLE% %WHERE%"</span>;</span><br><span class="line">		</span><br><span class="line">		$sql = str_replace(</span><br><span class="line">				<span class="keyword">array</span>(<span class="string">'%FIELDS%'</span>,<span class="string">'%TABLE%'</span>,<span class="string">'%WHERE%'</span>),</span><br><span class="line">				<span class="keyword">array</span>(</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseFields(),</span><br><span class="line">					<span class="keyword">$this</span>-&gt;parseTable(),</span><br><span class="line">					<span class="string">'WHERE '</span>.$field . <span class="string">"='$value'"</span>,</span><br><span class="line">				),</span><br><span class="line">				$sql</span><br><span class="line">				);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">$this</span>-&gt;sql = $sql;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;query($sql);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//自动的一个按照字段来查询的智能化查询方法</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//__call方法，针对用户请求的limit()  order()  group having等将其保存到options中去</span></span><br><span class="line">	<span class="comment">//并且判断方法的法性</span></span><br><span class="line">	<span class="comment">//并且return $this，让其能连贯操作。ORM （对象映射模型）$user-&gt;limit()-&gt;order()</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($func,$args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$allow = [<span class="string">'where'</span>,<span class="string">'table'</span>,<span class="string">'fields'</span>,<span class="string">'order'</span>,<span class="string">'limit'</span>,<span class="string">'group'</span>,<span class="string">'having'</span>];</span><br><span class="line">		$func = strtolower($func);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (in_array($func,$allow)) &#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;options[$func] = $args;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">		&#125; <span class="keyword">elseif</span>(substr($func,<span class="number">0</span>,<span class="number">5</span>) == <span class="string">'getby'</span>)&#123;</span><br><span class="line">			$field = substr($func,<span class="number">5</span>);</span><br><span class="line">		</span><br><span class="line">			<span class="keyword">if</span> (in_array($field,<span class="keyword">$this</span>-&gt;fields)) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getby($field,$args[<span class="number">0</span>]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">exit</span>(<span class="string">'方法不合法'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//对象销毁者关闭页面的时候，自动执行</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		mysqli_close(<span class="keyword">$this</span>-&gt;link);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Page类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Framework</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="comment">//声明page类</span></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Page</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">	<span class="comment">//url</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $url;</span></span><br><span class="line"><span class="php">	<span class="comment">//总页数</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $pageCount;</span></span><br><span class="line"><span class="php">	<span class="comment">//总条数</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $total;</span></span><br><span class="line"><span class="php">	<span class="comment">//每页显示数</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $num;</span></span><br><span class="line"><span class="php">	<span class="comment">//当前页</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $page;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//初使化成员属性</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($total, $num = <span class="number">5</span>)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//总条数</span></span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;total = ($total &gt; <span class="number">0</span>) ? (int) $total : <span class="number">1</span>;</span></span><br><span class="line"><span class="php">		<span class="comment">//每页显示数</span></span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;num = $num;</span></span><br><span class="line"><span class="php">		<span class="comment">//总页数</span></span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;pageCount = <span class="keyword">$this</span>-&gt;getPageCount();</span></span><br><span class="line"><span class="php">		<span class="comment">//当前页</span></span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;page = <span class="keyword">$this</span>-&gt;getCurrentPage();</span></span><br><span class="line"><span class="php">		<span class="comment">//url</span></span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;url = <span class="keyword">$this</span>-&gt;getUrl();</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//一次性返回所有的分页信息</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rendor</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> [</span></span><br><span class="line"><span class="php">			<span class="string">'first'</span> =&gt; <span class="keyword">$this</span>-&gt;first(),</span></span><br><span class="line"><span class="php">			<span class="string">'next'</span> =&gt; <span class="keyword">$this</span>-&gt;next(),</span></span><br><span class="line"><span class="php">			<span class="string">'prev'</span> =&gt; <span class="keyword">$this</span>-&gt;prev(),</span></span><br><span class="line"><span class="php">			<span class="string">'end'</span> =&gt; <span class="keyword">$this</span>-&gt;end(),</span></span><br><span class="line"><span class="php">		];</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//limit方法，在未来分页数据查询时候，直接返回对应的limit 0,5 这样的字符串</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">limit</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		$offset = (<span class="keyword">$this</span>-&gt;page - <span class="number">1</span>) * <span class="keyword">$this</span>-&gt;num;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		$str = $offset.<span class="string">','</span>.<span class="keyword">$this</span>-&gt;num;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $str;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">end</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setQueryString(<span class="string">'page='</span>.<span class="keyword">$this</span>-&gt;pageCount);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//上一页</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span>  <span class="title">prev</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		$page = (<span class="keyword">$this</span>-&gt;page &lt;=<span class="number">1</span>) ? <span class="number">1</span> : (<span class="keyword">$this</span>-&gt;page <span class="number">-1</span>);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setQueryString(<span class="string">'page='</span>.$page);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//下一页</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">next</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		$page = (<span class="keyword">$this</span>-&gt;page &gt;= <span class="keyword">$this</span>-&gt;pageCount) ?  <span class="keyword">$this</span>-&gt;pageCount : (<span class="keyword">$this</span>-&gt;page + <span class="number">1</span>);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setQueryString(<span class="string">'page='</span>.$page);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//首页</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">first</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//设置查询的page页码为第一页，即为首页</span></span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;setQueryString(<span class="string">'page=1'</span>);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//一种况有?，一种情况是没有?的情况</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">setQueryString</span><span class="params">($page)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//如果url当中有问号</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (strpos(<span class="keyword">$this</span>-&gt;url, <span class="string">'?'</span>)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;url.<span class="string">'&amp;'</span>.$page;</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//如果url当中没有问号</span></span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;url.<span class="string">'?'</span>.$page;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getUrl</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		$path = $_SERVER[<span class="string">'REQUEST_URI'</span>];</span></span><br><span class="line"><span class="php">		<span class="comment">//先要获取户传进来的URI</span></span></span><br><span class="line"><span class="php">		<span class="comment">//用parse_url 解释URI</span></span></span><br><span class="line"><span class="php">		$par = parse_url($path);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//判断是否设置过query</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (<span class="keyword">isset</span>($par[<span class="string">'query'</span>])) &#123;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			parse_str($par[<span class="string">'query'</span>],$query);</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			<span class="comment">//检查query里面是否有page,如果有就干掉page</span></span></span><br><span class="line"><span class="php">			<span class="keyword">unset</span>($query[<span class="string">'page'</span>]);</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			$path = $par[<span class="string">'path'</span>].<span class="string">'?'</span>.http_build_query($query);</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		$path = rtrim($path,<span class="string">'?'</span>);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//协议：主机：端口：文件和请求</span></span></span><br><span class="line"><span class="php">		<span class="comment">//判断是否定义过端口，并且端口是否为443，如果为443则是https协议，否则就是http协议</span></span></span><br><span class="line"><span class="php">		$protocal = (<span class="keyword">isset</span>($_SERVER[<span class="string">'SERVER_PORT'</span>]) &amp;&amp; $_SERVER[<span class="string">'SERVER_PORT'</span>] == <span class="number">443</span>) ?<span class="string">'https://'</span> : <span class="string">'http://'</span>;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (<span class="number">80</span> == $_SERVER[<span class="string">'SERVER_PORT'</span>] || <span class="number">443</span> == $_SERVER[<span class="string">'SERVER_PORT'</span>]) &#123;</span></span><br><span class="line"><span class="php">			$url = $protocal.$_SERVER[<span class="string">'SERVER_NAME'</span>].$path;</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			<span class="comment">//http://www.baidu.com:8012/index.php?username=liwenkai</span></span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			$url = $protocal.$_SERVER[<span class="string">'SERVER_NAME'</span>].<span class="string">':'</span>.$_SERVER[<span class="string">'SERVER_PORT'</span>].$path;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//拼接 path. ? . 全新组合成的URI</span></span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $url;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getCurrentPage</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//如果用户设置过page信息，就返回page相关信息，强制转为整型</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'page'</span>])) &#123;</span></span><br><span class="line"><span class="php">			<span class="comment">//得到页码</span></span></span><br><span class="line"><span class="php">			$page = (int) $_GET[<span class="string">'page'</span>];</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			<span class="comment">//你的页码不能够大于总页数</span></span></span><br><span class="line"><span class="php">			<span class="keyword">if</span> ($page &gt; <span class="keyword">$this</span>-&gt;pageCount) &#123;</span></span><br><span class="line"><span class="php">				$page = <span class="keyword">$this</span>-&gt;pageCount;</span></span><br><span class="line"><span class="php">			&#125;</span></span><br><span class="line"><span class="php">			<span class="comment">//你的页码不能小于1</span></span></span><br><span class="line"><span class="php">			<span class="keyword">if</span> ($page &lt; <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="php">				$page = <span class="number">1</span>;</span></span><br><span class="line"><span class="php">			&#125;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			$page = <span class="number">1</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $page;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getPageCount</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//计算总页数，使用到了进一法取整</span></span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> ceil(<span class="keyword">$this</span>-&gt;total / <span class="keyword">$this</span>-&gt;num);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Tpl类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Framework</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tpl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//缓存目录</span></span><br><span class="line">	<span class="keyword">protected</span> $cacheDir = <span class="string">'./Cache/'</span>;</span><br><span class="line">	<span class="comment">//模版目录</span></span><br><span class="line">	<span class="keyword">protected</span> $tplDir = <span class="string">'./Tpl/'</span>;</span><br><span class="line">	<span class="comment">//保存变量的成员方法</span></span><br><span class="line">	<span class="keyword">protected</span> $vars = [];</span><br><span class="line">	<span class="comment">//缓存有效期</span></span><br><span class="line">	<span class="keyword">protected</span> $cacheLifeTime = <span class="number">3600</span>;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//初使化成员属性</span></span><br><span class="line">	<span class="comment">//判断缓存目录是否存在</span></span><br><span class="line">	<span class="comment">//判断模版路径是否存在，如果不存在要创建，如果不可写，要改权限</span></span><br><span class="line">	<span class="comment">//初化缓存时间</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($tplDir = null, $cacheDir = null ,$cacheLifeTime = null)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>($tplDir)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;_checkDir($tplDir)) &#123;</span><br><span class="line">				<span class="keyword">$this</span>-&gt;tplDir = rtrim($tplDir,<span class="string">'/'</span>).<span class="string">'/'</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>($cacheDir)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;_checkDir($cacheDir)) &#123;</span><br><span class="line">				<span class="keyword">$this</span>-&gt;cacheDir = rtrim($cacheDir,<span class="string">'/'</span>).<span class="string">'/'</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>($cacheLifeTime)) &#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;cacheLifeTime = $cacheLifeTime;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_checkDir</span><span class="params">($path)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!file_exists($path) || !is_dir($path)) &#123;</span><br><span class="line">			<span class="keyword">return</span> mkdir($path,<span class="number">0755</span>,<span class="keyword">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (!is_writable($path) || !is_readable($path)) &#123;</span><br><span class="line">			<span class="keyword">return</span> chmod($path,<span class="number">0755</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//$tpl-&gt;assign()-&gt;assign()-&gt;display();</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//分配变量</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">assign</span><span class="params">($key,$val)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;vars[$key] = $val;</span><br><span class="line">		<span class="comment">//return $this;</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//display显示模版内容</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">display</span><span class="params">($file,$isExecute = true, $uri = null)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//获得模版路径（模版目录路径 + 模版文件）</span></span><br><span class="line">		$tplFilePath = <span class="keyword">$this</span>-&gt;tplDir.$file;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//判断文件是否存在</span></span><br><span class="line">		<span class="keyword">if</span> (!file_exists($tplFilePath)) &#123;</span><br><span class="line">			<span class="keyword">echo</span> $tplFilePath;</span><br><span class="line">			<span class="keyword">exit</span>(<span class="string">'模板文件不存在'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//获得编译文件路径（组合一个新的） page.php?page=3</span></span><br><span class="line">		$cacheFile = md5($file.$uri).<span class="string">'.php'</span>;</span><br><span class="line">		</span><br><span class="line">		$cacheFilePath = <span class="keyword">$this</span>-&gt;cacheDir . $cacheFile;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//检测是否编译过、是否修改过模版文件，如果编译，并且在有效期内，则不编译</span></span><br><span class="line">		<span class="keyword">if</span> (!file_exists($cacheFilePath)) &#123;</span><br><span class="line">			$html = <span class="keyword">$this</span>-&gt;compile($tplFilePath);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//如果修改过模版文件，则删除原有的编译文件重新编译</span></span><br><span class="line">			<span class="keyword">if</span> (filemtime($tplFilePath) &gt; filemtime($cacheFilePath)) &#123;</span><br><span class="line">				unlink($cacheFilePath);</span><br><span class="line">				$html = <span class="keyword">$this</span>-&gt;compile($tplFilePath);</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">			<span class="comment">// 文件创建时间 + 缓存有效期 &gt; time(当前时间) 没有过期，否则过期了</span></span><br><span class="line">			<span class="comment">//如果大于time 没过期</span></span><br><span class="line">		</span><br><span class="line">			$isTimeout = (filemtime($tplFilePath) + <span class="keyword">$this</span>-&gt;cacheLifeTime &gt; time()) ? <span class="keyword">false</span> : <span class="keyword">true</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> ($isTimeout) &#123;</span><br><span class="line">				$html = <span class="keyword">$this</span>-&gt;compile($tplFilePath);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//编译</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>($html)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!file_put_contents($cacheFilePath,$html)) &#123;</span><br><span class="line">				<span class="keyword">exit</span>(<span class="string">'编译文件写入失败'</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//判断是否需要执行</span></span><br><span class="line">		<span class="comment">//如果不需要执行则，则不包含 ，不extract变量，反之则不然</span></span><br><span class="line">		<span class="keyword">if</span> ($isExecute) &#123;</span><br><span class="line">			extract(<span class="keyword">$this</span>-&gt;vars);</span><br><span class="line">			<span class="keyword">include</span> $cacheFilePath;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">compile</span><span class="params">($tplFilePath)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$html = file_get_contents($tplFilePath);</span><br><span class="line">		</span><br><span class="line">		$keys = [</span><br><span class="line">			<span class="string">'&#123;if %%&#125;'</span> =&gt; <span class="string">'&lt;?php if(\1): ?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;else&#125;'</span> =&gt; <span class="string">'&lt;?php else : ?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;else if %%&#125;'</span> =&gt; <span class="string">'&lt;?php elseif(\1) : ?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;elseif %%&#125;'</span> =&gt; <span class="string">'&lt;?php elseif(\1) : ?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;/if&#125;'</span> =&gt; <span class="string">'&lt;?php endif;?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;$%%&#125;'</span> =&gt; <span class="string">'&lt;?=$\1;?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;foreach %%&#125;'</span> =&gt; <span class="string">'&lt;?php foreach(\1) :?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;/foreach&#125;'</span> =&gt; <span class="string">'&lt;?php endforeach;?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;for %%&#125;'</span> =&gt; <span class="string">'&lt;?php for(\1):?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;/for&#125;'</span> =&gt; <span class="string">'&lt;?php endfor;?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;while %%&#125;'</span> =&gt; <span class="string">'&lt;?php while(\1):?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;/while&#125;'</span> =&gt; <span class="string">'&lt;?php endwhile;?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;continue&#125;'</span> =&gt; <span class="string">'&lt;?php continue;?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;break&#125;'</span> =&gt; <span class="string">'&lt;?php break;?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;$%% = $%%&#125;'</span> =&gt; <span class="string">'&lt;?php $\1 = $\2;?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;$%%++&#125;'</span> =&gt; <span class="string">'&lt;?php $\1++;?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;$%%--&#125;'</span> =&gt; <span class="string">'&lt;?php $\1--;?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;comment&#125;'</span> =&gt; <span class="string">'&lt;?php /* '</span>,</span><br><span class="line">            <span class="string">'&#123;/comment&#125;'</span> =&gt; <span class="string">' */ ?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;/*&#125;'</span> =&gt; <span class="string">'&lt;?php /* '</span>,</span><br><span class="line">            <span class="string">'&#123;*/&#125;'</span> =&gt; <span class="string">'* ?&gt;'</span>,</span><br><span class="line">            <span class="string">'&#123;section&#125;'</span> =&gt; <span class="string">'&lt;?php '</span>,</span><br><span class="line">            <span class="string">'&#123;/section&#125;'</span> =&gt; <span class="string">'?&gt;'</span>,</span><br><span class="line">			<span class="string">'&#123;&#123;%%(%%)&#125;&#125;'</span> =&gt; <span class="string">'&lt;?=\1(\2);?&gt;'</span>,</span><br><span class="line">			<span class="string">'&#123;date(%%,$%%)&#125;'</span>=&gt; <span class="string">'&lt;?=date(\1,$\2);?&gt;'</span>,</span><br><span class="line">			<span class="string">'&#123;include %%&#125;'</span> =&gt; <span class="string">'&lt;?php include "\1";?&gt;'</span>,</span><br><span class="line">			</span><br><span class="line">		];</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">foreach</span> ($keys <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">			</span><br><span class="line">			$pattern = <span class="string">'#'</span>. str_replace(<span class="string">'%%'</span>,<span class="string">'(.+)'</span>,preg_quote($key,<span class="string">'#'</span>)) .<span class="string">'#imsU'</span>;</span><br><span class="line">			$replace = $val;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> (stripos($pattern,<span class="string">'include'</span>)) &#123;</span><br><span class="line">				<span class="comment">//处理一次回调</span></span><br><span class="line">			</span><br><span class="line">				$html = preg_replace_callback($pattern,<span class="keyword">array</span>(<span class="keyword">$this</span>,<span class="string">'parseInclude'</span>),$html);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				</span><br><span class="line">				$html = preg_replace($pattern,$replace,$html);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> $html;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">parseInclude</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">		$file = str_replace([<span class="string">'\''</span>,<span class="string">'"'</span>],<span class="string">''</span>,$data[<span class="number">1</span>]);</span><br><span class="line">		$path = <span class="keyword">$this</span>-&gt;parsePath($file);</span><br><span class="line">		<span class="keyword">$this</span>-&gt;display($file,<span class="keyword">false</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">'&lt;?php include "'</span>.$path.<span class="string">'";?&gt;'</span>;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">parsePath</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$path = <span class="keyword">$this</span>-&gt;cacheDir . md5($file).<span class="string">'.php'</span>;</span><br><span class="line">		<span class="keyword">return</span> $path;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//删除缓存文件（递归）</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">clearCache</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">self</span>::delDir(<span class="keyword">$this</span>-&gt;cacheDir);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">delDir</span><span class="params">($path)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$res = opendir($path);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">while</span>($file = readdir($res)) &#123;</span><br><span class="line">			<span class="keyword">if</span> ($file == <span class="string">'.'</span> || $file == <span class="string">'..'</span>) &#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			$newPath = $path.<span class="string">'/'</span>.$file;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> (is_dir($newPath)) &#123;</span><br><span class="line">				<span class="keyword">self</span>::delDir($newPath);</span><br><span class="line">			&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">				unlink($newPath);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line"> 	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Upload类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Framework</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Upload</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">	<span class="comment">//上传到哪个目录</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $path = <span class="string">'Upload/'</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//准许的MIME</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $allowmime = [<span class="string">'image/png'</span>,<span class="string">'image/jpg'</span>,<span class="string">'image/jpeg'</span>,<span class="string">'image/pjpeg'</span>,<span class="string">'image/bmp'</span>,<span class="string">'image/wbmp'</span>,<span class="string">'image/gif'</span>,<span class="string">'image/x-png'</span>];</span></span><br><span class="line"><span class="php">	<span class="comment">//准许的后缀</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $allowsubfix = [<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'jpeg'</span>,<span class="string">'gif'</span>,<span class="string">'bmp'</span>];</span></span><br><span class="line"><span class="php">	<span class="comment">//准许的大小</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $allowsize = <span class="number">2097152</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//是否准许随机文件名</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $israndname = <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//是否准许日期目录</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $isdatepath = <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//文件的大小</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $size;</span></span><br><span class="line"><span class="php">	<span class="comment">//文件的原名</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $orgname;</span></span><br><span class="line"><span class="php">	<span class="comment">//文件的新名</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $newname;</span></span><br><span class="line"><span class="php">	<span class="comment">//文件的后缀</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $subfix;</span></span><br><span class="line"><span class="php">	<span class="comment">//文件的MIME类型</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $mime;</span></span><br><span class="line"><span class="php">	<span class="comment">//文件的新路径</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $newpath;</span></span><br><span class="line"><span class="php">	<span class="comment">//错误号</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $errorno;</span></span><br><span class="line"><span class="php">	<span class="comment">//错误信息</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $errorinfo;</span></span><br><span class="line"><span class="php">	<span class="comment">//临时文件</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $tmpfile;</span></span><br><span class="line"><span class="php">	<span class="comment">//前缀</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $prefix;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//初使化成员属性，传进来的东西特别多，我们要求以数组的形式来传递</span></span></span><br><span class="line"><span class="php">	<span class="comment">//foreach循环，取出键名、值</span></span></span><br><span class="line"><span class="php">	<span class="comment">//将键名设置为成员属性名，将键值设为成员属性值</span></span></span><br><span class="line"><span class="php">	<span class="comment">//注意键名的合法性</span></span></span><br><span class="line"><span class="php">	<span class="comment">// errorInfo   errorinfo</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Array $config = [])</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">		<span class="keyword">foreach</span> ($config <span class="keyword">as</span> $key =&gt; $value) &#123;</span></span><br><span class="line"><span class="php"> </span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;setOption($key,$value);</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">setOption</span><span class="params">($key,$value)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		$key = strtolower($key);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		$allPro = get_class_vars(get_class(<span class="keyword">$this</span>));</span></span><br><span class="line"><span class="php">		<span class="comment">//var_dump($allpro);</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (array_key_exists($key,$allPro)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;$key = $value;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//设置一个get方法专门获得新路径</span></span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//设置 一个get方法专门来获得错误信息</span></span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//成员方法上传方法</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span><span class="params">($field)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//var_dump($field);die;</span></span></span><br><span class="line"><span class="php">		<span class="comment">//检测路径用户是否定义过，如果没有定义失败</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (!file_exists(<span class="keyword">$this</span>-&gt;path)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">echo</span> <span class="string">'11111111111'</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;setOption(<span class="string">'errorNo'</span>,<span class="number">-1</span>);</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//目录权限检测</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;checkPath()) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;setOption(<span class="string">'errorNo'</span>,<span class="number">-2</span>);</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//获得$_FILES当中五个基本信息</span></span></span><br><span class="line"><span class="php">		$name = $_FILES[$field][<span class="string">'name'</span>];</span></span><br><span class="line"><span class="php">		$size = $_FILES[$field][<span class="string">'size'</span>];</span></span><br><span class="line"><span class="php">		$type = $_FILES[$field][<span class="string">'type'</span>];</span></span><br><span class="line"><span class="php">		 </span></span><br><span class="line"><span class="php">		$tmpName = $_FILES[$field][<span class="string">'tmp_name'</span>];</span></span><br><span class="line"><span class="php">		$error = $_FILES[$field][<span class="string">'error'</span>];</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//var_dump($_FILES);die;</span></span></span><br><span class="line"><span class="php">		<span class="comment">//传入到一个成员方法里面进行设置</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;setFiles($name,$size,$type,$tmpName,$error)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//检测MIME是否合法，检测后缀是否合法，检测文件大小是否超过了自定义的大小</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;checkMime() || !<span class="keyword">$this</span>-&gt;checkSubfix() || !<span class="keyword">$this</span>-&gt;checkSize()) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//新名</span></span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;newname = <span class="keyword">$this</span>-&gt;getNewName();</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//新路径处理</span></span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;newpath = <span class="keyword">$this</span>-&gt;getNewPath();</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">		<span class="comment">//是否是上传文件</span></span></span><br><span class="line"><span class="php">		<span class="comment">//如果是上传文件移动上传文件至指定的目录</span></span></span><br><span class="line"><span class="php">		<span class="comment">//如果成员return true</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span>( <span class="keyword">$this</span>-&gt;move())&#123;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;newpath . <span class="keyword">$this</span>-&gt;newname;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">move</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (!is_uploaded_file(<span class="keyword">$this</span>-&gt;tmpfile)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;setOption(<span class="string">'errorNo'</span>,<span class="number">-6</span>);</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">		<span class="comment">//var_dump($this-tmpfile);</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (move_uploaded_file(<span class="keyword">$this</span>-&gt;tmpfile,<span class="keyword">$this</span>-&gt;newpath.<span class="keyword">$this</span>-&gt;newname)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;setOption(<span class="string">'errorNo'</span>,<span class="number">-7</span>);</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewPath</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;path = rtrim(<span class="keyword">$this</span>-&gt;path,<span class="string">'/'</span>).<span class="string">'/'</span>;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;isdatepath) &#123;</span></span><br><span class="line"><span class="php">			$newpath = <span class="keyword">$this</span>-&gt;path.date(<span class="string">'Y/m/d/'</span>);</span></span><br><span class="line"><span class="php">			<span class="keyword">if</span> (!file_exists($newpath)) &#123;</span></span><br><span class="line"><span class="php">				mkdir($newpath,<span class="number">0755</span>,<span class="keyword">true</span>);</span></span><br><span class="line"><span class="php">			&#125;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> $newpath;</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;path;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewName</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;israndname) &#123;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;prefix . uniqid() . <span class="string">'.'</span> . <span class="keyword">$this</span>-&gt;subfix;</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;prefix . <span class="keyword">$this</span>-&gt;orgname;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">checkSize</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;size &gt; <span class="keyword">$this</span>-&gt;allowsize) &#123;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;setOption(<span class="string">'errorNo'</span>,<span class="number">-5</span>);</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">checkSubFix</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (in_array(<span class="keyword">$this</span>-&gt;subfix,<span class="keyword">$this</span>-&gt;allowsubfix)) &#123;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;setOption(<span class="string">'errorNo'</span>,<span class="number">-4</span>);</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">checkMime</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (in_array(<span class="keyword">$this</span>-&gt;mime,<span class="keyword">$this</span>-&gt;allowmime)) &#123;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;setOption(<span class="string">'errorNo'</span>,<span class="number">-3</span>);</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">setFiles</span><span class="params">($name,$size,$type,$tmpName,$error)</span> </span>&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//1 2 3 4 6 7  0(正常)</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> ($error) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;setOption(<span class="string">'errorNo'</span>,$error);</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;orgname = $name;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;size = $size;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;tmpfile = $tmpName;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;mime = $type;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//后缀没处理</span></span></span><br><span class="line"><span class="php">		$info = pathinfo($name);</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;subfix = $info[<span class="string">'extension'</span>];</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line">		/*</span><br><span class="line">		$arr = explode('.',$name);</span><br><span class="line">		$this-&gt;subfix = array_pop($arr);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		$arr = explode('.',$name);</span><br><span class="line">		$this-&gt;subfix = $arr[count($arr)-1];</span><br><span class="line">		</span><br><span class="line">		$pos = strrpos($name,'.');</span><br><span class="line">		echo substr($name,$pos + 1);</span><br><span class="line"><span class="php">		*/</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">checkPath</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//检测路径是否是目录，如果不存在创建</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (!is_dir(<span class="keyword">$this</span>-&gt;path)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> mkdir(<span class="keyword">$this</span>-&gt;path,<span class="number">0755</span>,<span class="keyword">true</span>);</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		<span class="comment">//检测路径是否可写，如果不写写更改权限</span></span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (!is_writeable(<span class="keyword">$this</span>-&gt;path) ||  !is_readable(<span class="keyword">$this</span>-&gt;path)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> chmod(<span class="keyword">$this</span>-&gt;path,<span class="number">0755</span>);</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getErrorInfo</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">switch</span> (<span class="keyword">$this</span>-&gt;errorno) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">1</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">2</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">3</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'部份件被上传'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">4</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'没有文件被上传'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">6</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'找不到临时文件夹'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">7</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'临时文件写入失败'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">-1</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'自定义的上传路径不存在'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">-2</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'没有权限'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">-3</span>:</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">-4</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'类型或后缀不准许'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">-5</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'超过了自定义的大小'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">-6</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'不是上传文件'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">-7</span>:</span></span><br><span class="line"><span class="php">				$str = <span class="string">'移动上传文件失败'</span>;</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $str;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (in_array($key, [<span class="string">'newpath'</span>,<span class="string">'newname'</span>,<span class="string">'errorno'</span>,<span class="string">'size'</span>])) &#123;</span></span><br><span class="line"><span class="php">			var_dump($key);</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;$key;</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> ($key == <span class="string">'errorinfo'</span>) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getErrorInfo();</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Verify类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Framework</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Verify</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">	<span class="comment">//宽</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $width;</span></span><br><span class="line"><span class="php">	<span class="comment">//高</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $height;</span></span><br><span class="line"><span class="php">	<span class="comment">//图片类型</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $imgType;</span></span><br><span class="line"><span class="php">	<span class="comment">//文字类型</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $codeType;</span></span><br><span class="line"><span class="php">	<span class="comment">//文字的个数</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $num;</span></span><br><span class="line"><span class="php">	<span class="comment">//保存的验证码字符串</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $verifyCode;</span></span><br><span class="line"><span class="php">	<span class="comment">//保存验证码资源的一个成员属性</span></span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> $res;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//初始化成员</span></span></span><br><span class="line"><span class="php">	<span class="comment">//上面这些参数</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($width = <span class="number">100</span>, $height = <span class="number">50</span>, $imgType = <span class="string">'png'</span>, $codeType = <span class="number">3</span>, $num = <span class="number">4</span>)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;width = $width;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;height = $height;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;imgType = $imgType;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;codeType = $codeType;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;num = $num;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;verifyCode = <span class="keyword">$this</span>-&gt;createVerifyCode();</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span>  <span class="title">createVerifyCode</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		$string = <span class="string">''</span>;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">switch</span> (<span class="keyword">$this</span>-&gt;codeType) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">1</span>:</span></span><br><span class="line"><span class="php">				$string = implode(<span class="string">''</span>,array_rand(range(<span class="number">0</span>,<span class="number">9</span>),<span class="keyword">$this</span>-&gt;num));</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">2</span>:</span></span><br><span class="line"><span class="php">				$string = join(<span class="string">''</span>,array_rand(array_flip(range(<span class="string">'a'</span>,<span class="string">'z'</span>)),<span class="number">4</span>));</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">			<span class="keyword">case</span> <span class="number">3</span>:</span></span><br><span class="line">				/*</span><br><span class="line">				for ($i = 0; $i &lt; $this-&gt;num; $i++) &#123;</span><br><span class="line">					$r= mt_rand(0,2);</span><br><span class="line">					switch ($r) &#123;</span><br><span class="line">						case 0:</span><br><span class="line">							$ascii = mt_rand(48,57);</span><br><span class="line">							break;</span><br><span class="line">						case 1:</span><br><span class="line">							$ascii = mt_rand(65,90);</span><br><span class="line">							break;</span><br><span class="line">						case 2:</span><br><span class="line">							$ascii = mt_rand(97,122);</span><br><span class="line">							break;</span><br><span class="line">					&#125;</span><br><span class="line">					$string .= chr($ascii);</span><br><span class="line">					</span><br><span class="line">				&#125;</span><br><span class="line"><span class="php">				*/</span></span><br><span class="line"><span class="php">				$str = <span class="string">'abcdefghijkmnpqrstuvwxzABCDEFGHJKLMNPQRSTUVWXYZ23456789'</span>;</span></span><br><span class="line"><span class="php">				$string = substr(str_shuffle($str),<span class="number">0</span>,<span class="keyword">$this</span>-&gt;num);</span></span><br><span class="line"><span class="php">				<span class="keyword">break</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $string;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//调验证码显示的一个方法 output</span></span></span><br><span class="line"><span class="php">	<span class="comment">//1.画图</span></span></span><br><span class="line"><span class="php">	<span class="comment">//2.分配颜色(写两个成员方法，调的时候直接调对应的成员方法即可)</span></span></span><br><span class="line"><span class="php">	<span class="comment">//3.背景填充</span></span></span><br><span class="line"><span class="php">	<span class="comment">//4.画干扰点</span></span></span><br><span class="line"><span class="php">	<span class="comment">//5.画干扰线</span></span></span><br><span class="line"><span class="php">	<span class="comment">//6.写字 </span></span></span><br><span class="line"><span class="php">	<span class="comment">//7. 输出类型</span></span></span><br><span class="line"><span class="php">	<span class="comment">//8. 输出图片</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">outImg</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;createImg();</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;fillBgColor();</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;fillPix();</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;fillArc();</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;writeFont();</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;output();</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//imagepng</span></span></span><br><span class="line"><span class="php">		$func = <span class="string">'image'</span>.<span class="keyword">$this</span>-&gt;imgType;</span></span><br><span class="line"><span class="php">		$mime = <span class="string">'Content-type:image/'</span>.<span class="keyword">$this</span>-&gt;imgType;</span></span><br><span class="line"><span class="php">		header($mime);</span></span><br><span class="line"><span class="php">		$func(<span class="keyword">$this</span>-&gt;res);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">writeFont</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; <span class="keyword">$this</span>-&gt;num; $i++) &#123;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			$width = ceil(<span class="keyword">$this</span>-&gt;width / <span class="keyword">$this</span>-&gt;num);</span></span><br><span class="line"><span class="php">			$x = $width * $i;</span></span><br><span class="line"><span class="php">			$y= mt_rand(<span class="number">5</span>,<span class="keyword">$this</span>-&gt;height - <span class="number">10</span>);</span></span><br><span class="line"><span class="php">			$c = <span class="keyword">$this</span>-&gt;verifyCode[$i];</span></span><br><span class="line"><span class="php">			imagechar(<span class="keyword">$this</span>-&gt;res,<span class="number">5</span>,$x,$y,$c,<span class="keyword">$this</span>-&gt;darkColor());</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">fillArc</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">10</span>; $i++) &#123;</span></span><br><span class="line"><span class="php">			imagearc(<span class="keyword">$this</span>-&gt;res,</span></span><br><span class="line"><span class="php">					mt_rand(<span class="number">10</span>,<span class="keyword">$this</span>-&gt;width - <span class="number">10</span>),</span></span><br><span class="line"><span class="php">					mt_rand(<span class="number">10</span>,<span class="keyword">$this</span>-&gt;height - <span class="number">10</span>),</span></span><br><span class="line"><span class="php">					mt_rand(<span class="number">0</span>,<span class="keyword">$this</span>-&gt;width),</span></span><br><span class="line"><span class="php">					mt_rand(<span class="number">0</span>,<span class="keyword">$this</span>-&gt;height),</span></span><br><span class="line"><span class="php">					mt_rand(<span class="number">0</span>,<span class="number">180</span>),</span></span><br><span class="line"><span class="php">					mt_rand(<span class="number">181</span>,<span class="number">360</span>),</span></span><br><span class="line"><span class="php">					<span class="keyword">$this</span>-&gt;lightColor()</span></span><br><span class="line"><span class="php">					);</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">fillPix</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		$num = <span class="keyword">$this</span>-&gt;pixNum();</span></span><br><span class="line"><span class="php">		<span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $num; $i++) &#123;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			imagesetpixel(<span class="keyword">$this</span>-&gt;res,mt_rand(<span class="number">0</span>,<span class="keyword">$this</span>-&gt;width),mt_rand(<span class="number">0</span>,<span class="keyword">$this</span>-&gt;height),<span class="keyword">$this</span>-&gt;darkColor());</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">pixNum</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		$area = ceil((<span class="keyword">$this</span>-&gt;width * <span class="keyword">$this</span>-&gt;height) / <span class="number">20</span>);</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> $area;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">fillBgColor</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		imagefill(<span class="keyword">$this</span>-&gt;res,<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">$this</span>-&gt;lightColor());</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">lightColor</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> imagecolorallocate(<span class="keyword">$this</span>-&gt;res,</span></span><br><span class="line"><span class="php">						   mt_rand(<span class="number">130</span>,<span class="number">255</span>),</span></span><br><span class="line"><span class="php">						   mt_rand(<span class="number">130</span>,<span class="number">255</span>),</span></span><br><span class="line"><span class="php">						   mt_rand(<span class="number">130</span>,<span class="number">255</span>)</span></span><br><span class="line"><span class="php">							);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">darkColor</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> imagecolorallocate(<span class="keyword">$this</span>-&gt;res,</span></span><br><span class="line"><span class="php">						   mt_rand(<span class="number">0</span>,<span class="number">120</span>),</span></span><br><span class="line"><span class="php">						   mt_rand(<span class="number">0</span>,<span class="number">120</span>),</span></span><br><span class="line"><span class="php">						   mt_rand(<span class="number">0</span>,<span class="number">120</span>)</span></span><br><span class="line"><span class="php">							);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">createImg</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;res = imagecreatetruecolor(<span class="keyword">$this</span>-&gt;width,<span class="keyword">$this</span>-&gt;height);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//9 .销毁图片资源</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="comment">//imagedestroy($this-&gt;res);</span></span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="comment">//可以做一个魔术方法__get专门用于得到验证码字符串</span></span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> ($key == <span class="string">'verifyCode'</span>) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;$key;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>
<p>auto_load(类的自动加载)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">	<span class="class"><span class="keyword">class</span> <span class="title">Init</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loader</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">		&#123;</span></span><br><span class="line"><span class="php">			$psr = <span class="keyword">new</span> Psr4();</span></span><br><span class="line"><span class="php">			$psr-&gt;register();</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			<span class="keyword">foreach</span> ($GLOBALS[<span class="string">'nameSpace'</span>] <span class="keyword">as</span> $name =&gt; $baseDir) &#123;</span></span><br><span class="line"><span class="php">				$psr-&gt;addNamespace($name,$baseDir);</span></span><br><span class="line"><span class="php">			&#125;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">router</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">		&#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;loader();</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			$_GET[<span class="string">'m'</span>] = <span class="keyword">isset</span>($_GET[<span class="string">'m'</span>]) ? ucfirst(strtolower($_GET[<span class="string">'m'</span>])) : <span class="string">'Index'</span>;</span></span><br><span class="line"><span class="php">			$_GET[<span class="string">'a'</span>] = <span class="keyword">isset</span>($_GET[<span class="string">'a'</span>]) ? $_GET[<span class="string">'a'</span>] :<span class="string">'index'</span>;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			$controllerName = <span class="string">'Controller\\'</span>.$_GET[<span class="string">'m'</span>].<span class="string">'Controller'</span>;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			$mod = <span class="keyword">new</span> $controllerName();</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			<span class="keyword">if</span> (method_exists($mod,$_GET[<span class="string">'a'</span>])) &#123;</span></span><br><span class="line"><span class="php">				</span></span><br><span class="line"><span class="php">				call_user_func(<span class="keyword">array</span>($mod,$_GET[<span class="string">'a'</span>]));</span></span><br><span class="line"><span class="php">			&#125; <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">				<span class="keyword">exit</span>(<span class="string">'方法不合法'</span>);</span></span><br><span class="line"><span class="php">				</span></span><br><span class="line"><span class="php">			&#125;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br></pre></td></tr></table></figure>
<p>8、PSR_4<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Psr4</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">private</span> $prefixes;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		spl_autoload_register(<span class="keyword">array</span>(<span class="keyword">$this</span>,<span class="string">'loadClass'</span>));</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addNamespace</span><span class="params">($nameSpace, $path)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		$nameSpace = trim($nameSpace,<span class="string">'\\'</span>);</span></span><br><span class="line"><span class="php">		$path = rtrim($path,DIRECTORY_SEPARATOR).<span class="string">'/'</span>;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;prefixes[$nameSpace]) == <span class="keyword">false</span>) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;prefixes[$nameSpace] = <span class="keyword">array</span>();</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		array_push(<span class="keyword">$this</span>-&gt;prefixes[$nameSpace],$path);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">loadClass</span><span class="params">($className)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		$pos = strrpos($className,<span class="string">'\\'</span>);</span></span><br><span class="line"><span class="php">		<span class="comment">//µÃµ½ÃüÃû¿Õ¼ä</span></span></span><br><span class="line"><span class="php">		$nameSpace = substr($className,<span class="number">0</span>, $pos);</span></span><br><span class="line"><span class="php">		$realClass = substr($className,$pos + <span class="number">1</span>);</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="comment">//´¦ÀíÓ³Éä°üº¬</span></span></span><br><span class="line"><span class="php">		<span class="keyword">$this</span>-&gt;mappingFile($nameSpace, $realClass);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">mappingFile</span><span class="params">($nameSpace, $realClass)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;prefixes[$nameSpace]) == <span class="keyword">false</span>) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">		<span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;prefixes[$nameSpace] <span class="keyword">as</span> $baseDir) &#123;</span></span><br><span class="line"><span class="php">			$file = $baseDir . str_replace(<span class="string">'\\'</span>,<span class="string">'/'</span>,$realClass).<span class="string">'.php'</span>;</span></span><br><span class="line"><span class="php">			</span></span><br><span class="line"><span class="php">			<span class="keyword">$this</span>-&gt;requireFile($file);</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">	<span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">requireFile</span><span class="params">($file)</span></span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> (file_exists($file)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">include</span> $file;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">		</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>NameSpace</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">return</span> [</span></span><br><span class="line"><span class="php">	<span class="string">'Model'</span> =&gt; <span class="string">'App/Model/'</span>,</span></span><br><span class="line"><span class="php">	<span class="string">'Controller'</span> =&gt; <span class="string">'App/Controller/'</span>,</span></span><br><span class="line"><span class="php">	<span class="string">'Framework'</span> =&gt; <span class="string">'Vendor/Phone/Framework/Src/'</span>,</span></span><br><span class="line"><span class="php">];</span></span><br></pre></td></tr></table></figure></div><div class="tags"><a href="/tags/设计模式/">设计模式</a></div><div class="post-nav"><a class="pre" href="/2017/10/15/Docker/">Docker</a><a class="next" href="/2017/09/05/适配器模式/">适配器模式</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://yuehuaxw.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/PHP框架/" style="font-size: 15px;">PHP框架</a> <a href="/tags/高并发/" style="font-size: 15px;">高并发</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://chensenlin.cn/" title="你好我是森林!" target="_blank">你好我是森林!</a><ul></ul><a href="https://www.eckes.site/" title="左手bug，右手情歌" target="_blank">左手bug，右手情歌</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Hello  广华</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>