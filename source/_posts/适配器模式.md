---
title: 适配器模式
date: 2017-09-05 22:10:29
tags: 设计模式
categories: 设计模式
---
当接口发生改变时，适配器模式就派上了用场。
<!-- more -->

##	为什么要用适配器模式
当我们引用一个第三方类库。这个类库随着版本的改变，它提供的API也可能会改变。如果很不幸的是，你的应用里引用的某个API已经发生改变的时候，你还得去硬着头皮去改大量的代码，那么这时候就需要用到适配器模式了

##	应用的地方在哪
PHP中的数据库操作有MySQL,MySQLi,PDO三种，可以用适配器模式统一成一致，使不同的数据库操作，统一成一样的API。类似的场景还有cache适配器，可以将memcache,redis,file,apc等不同的缓存函数，统一成一致。 

##	实现
1、首先定义一个接口
```
	接口 IDatabase
	<?php
	namespace IMooc;
	interface IDatabase
	{
	    function connect($host, $user, $passwd, $dbname);
	    function query($sql);
	    function close();
	}
```
2、MySQL
```
	<?php
	namespace IMooc\Database;
	use IMooc\IDatabase;
	class MySQL implements IDatabase
	{
	    protected $conn;
	        function connect($host, $user, $passwd, $dbname)
	        {
	            $conn = mysql_connect($host, $user, $passwd);
	            mysql_select_db($dbname, $conn);
	            $this->conn = $conn;
	    }
	    function query($sql)
	        {
	            $res = mysql_query($sql, $this->conn);
	            return $res;
	    }
	    function close()
	    {
	        mysql_close($this->conn);
	    }
	}
```
注意：PHP在5.5.12以后已经不再支持mysql

3、MySQLi
```
	<?php
	namespace IMooc\Database;
	use IMooc\IDatabase;
	class MySQLi implements IDatabase
	{
	    protected $conn;
	    function connect($host, $user, $passwd, $dbname)
	    {
	        $conn = mysqli_connect($host, $user, $passwd, $dbname);
	        $this->conn = $conn;
	    }
	    function query($sql)
	    {
	        return mysqli_query($this->conn, $sql);
	    }
	    function close()
	    {
	        mysqli_close($this->conn);
	    }
	}
```